<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>DO IT</title>
  
  <subtitle>é’Ÿå®‡é¹çš„åšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zhongyp.me/"/>
  <updated>2018-12-05T11:56:22.186Z</updated>
  <id>http://zhongyp.me/</id>
  
  <author>
    <name>zhongyp</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>çº¿ç¨‹å¯åŠ¨ä¸ç»ˆæ­¢</title>
    <link href="http://zhongyp.me/2018/12/04/concurrent/2018-12-04-thread-start-end/"/>
    <id>http://zhongyp.me/2018/12/04/concurrent/2018-12-04-thread-start-end/</id>
    <published>2018-12-03T16:00:00.000Z</published>
    <updated>2018-12-05T11:56:22.186Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šç¯‡å¯¹<a href="https://zhongyp.me/2018/03/16/concurrent/2017-03-16-Thread-brief/">ä»€ä¹ˆæ˜¯çº¿ç¨‹</a>åšäº†ç®€å•çš„ä»‹ç»,æœ¬ç¯‡ä¸»è¦æ˜¯ä»æ„é€ çº¿ç¨‹ã€ä¸­æ–­çº¿ç¨‹ã€ç»ˆæ­¢çº¿ç¨‹3ä¸ªæ–¹é¢äº†è§£çº¿ç¨‹ã€‚</p><h3 id="1-æ„é€ çº¿ç¨‹"><a href="#1-æ„é€ çº¿ç¨‹" class="headerlink" title="1. æ„é€ çº¿ç¨‹"></a>1. æ„é€ çº¿ç¨‹</h3><p>æ„é€ çº¿ç¨‹ä¸»è¦æ˜¯ä»æ„é€ æ–¹å¼å’Œæ„é€ çº¿ç¨‹å±æ€§ã€‚</p><h4 id="1-1-æ„é€ çº¿ç¨‹çš„æ–¹å¼"><a href="#1-1-æ„é€ çº¿ç¨‹çš„æ–¹å¼" class="headerlink" title="1.1 æ„é€ çº¿ç¨‹çš„æ–¹å¼"></a>1.1 æ„é€ çº¿ç¨‹çš„æ–¹å¼</h4><p>Javaæ„é€ ä¸€ä¸ªçº¿ç¨‹æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>ä¸€ç§ç›´æ¥new Thread()çº¿ç¨‹å®ä¾‹æˆ–è€…æ˜¯å£°æ˜å­ç±»ç»§æ‰¿Threadçˆ¶ç±»å¹¶é‡å†™çˆ¶ç±»çš„runæ–¹æ³•ã€‚å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// çº¿ç¨‹ç±»</span><br><span class="line">class PrimeThread extends Thread &#123;</span><br><span class="line">    long minPrime;</span><br><span class="line">    PrimeThread(long minPrime) &#123;</span><br><span class="line">        this.minPrime = minPrime;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    public void run() &#123;</span><br><span class="line">        // compute primes larger than minPrime</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å¯åŠ¨çº¿ç¨‹å®ä¾‹</span><br><span class="line">PrimeThread p = new PrimeThread(143);</span><br><span class="line">p.start();</span><br></pre></td></tr></table></figure></p><p>å¦ä¸€ç§æ–¹å¼æ˜¯å£°æ˜å­ç±»å®ç°Runnableæ¥å£ï¼Œå¹¶å®ç°runæ–¹æ³•ã€‚å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// çº¿ç¨‹ç±»</span><br><span class="line">class PrimeRun implements Runnable &#123;</span><br><span class="line">    long minPrime;</span><br><span class="line">    PrimeRun(long minPrime) &#123;</span><br><span class="line">        this.minPrime = minPrime;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    public void run() &#123;</span><br><span class="line">        // compute primes larger than minPrime</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//å¯åŠ¨çº¿ç¨‹å®ä¾‹</span><br><span class="line">PrimeRun p = new PrimeRun(143);</span><br><span class="line">new Thread(p).start();</span><br></pre></td></tr></table></figure></p><p>ä¸¤è€…å…¶å®åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œå®ç°/é‡å†™Runableä¸­çš„runæ–¹æ³•ï¼Œå› ä¸ºThreadç±»ä¹Ÿç»§æ‰¿äº†Runableæ¥å£ã€‚Javaå°†çº¿ç¨‹çš„æ‰§è¡Œå’Œæ‰§è¡Œå¯¹è±¡æŠ½è±¡å¼€æ¥ï¼ŒJDKä¸­æ‰§è¡Œçš„æ˜¯Threadç±»ï¼ŒExecutoræ¡†æ¶ï¼Œå¯æ‰§è¡Œç›®æ ‡æœ‰Runableï¼ŒCallableã€‚å¯¹äºç¬¬ä¸€ç§æ–¹å¼å¹¶ä¸æ¨èï¼Œå› ä¸ºç»§æ‰¿Threadç±»é™å®šäº†å…¶åŸºæœ¬è¡Œä¸ºï¼Œåœ¨è®¾è®¡ä¸Šè¿åï¼ˆå¤šç”¨ç»„åˆ å°‘ç”¨ç»§æ‰¿ï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æ„é€ çº¿ç¨‹ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚</p><h4 id="1-2-æ„é€ çº¿ç¨‹çš„å±æ€§"><a href="#1-2-æ„é€ çº¿ç¨‹çš„å±æ€§" class="headerlink" title="1.2 æ„é€ çº¿ç¨‹çš„å±æ€§"></a>1.2 æ„é€ çº¿ç¨‹çš„å±æ€§</h4><p>æ„é€ çº¿ç¨‹æ—¶éœ€è¦æä¾›çº¿ç¨‹æ‰€éœ€è¦çš„å±æ€§ã€‚ä¸€ä¸ªæ–°çš„ï¼ˆchildï¼‰çº¿ç¨‹å¯¹è±¡æ˜¯ç”±parentçº¿ç¨‹è¿›è¡Œç©ºé—´åˆ†é…çš„ï¼Œè€Œchildçº¿ç¨‹ç»§æ‰¿äº†parentæ˜¯å¦ä¸ºDaemonã€ä¼˜å…ˆçº§ã€å’ŒåŠ è½½èµ„æºçš„contextClassLoaderä»¥åŠå¯ç»§æ‰¿çš„ThreadLocalï¼ŒåŒæ—¶åˆ†é…å”¯ä¸€çš„IDæ¥è¡¨ç¤ºè¿™ä¸ªchildçº¿ç¨‹ã€‚å¦‚æœåˆ›å»ºçº¿ç¨‹å®ä¾‹åéœ€è¦ä¿®æ”¹çº¿ç¨‹å±æ€§ï¼Œåˆ™å¯ä»¥é€šè¿‡Threadæä¾›çš„ä¸€äº›ä¿®æ”¹å±æ€§çš„æ–¹æ³•è¿›è¡Œä¿®æ”¹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">setPriority()</span><br><span class="line">getPriority()</span><br><span class="line">setName()</span><br><span class="line">getName()</span><br><span class="line">setDaemon()</span><br><span class="line">isDaemon()</span><br><span class="line">getContextClassLoader()</span><br><span class="line">setContextClassLoader()</span><br><span class="line">getStackTrace()</span><br><span class="line">getAllStackTraces()</span><br><span class="line">checkAccess()</span><br><span class="line">isCCLOverridden()</span><br><span class="line">auditSubclass()</span><br><span class="line">dumpThreads()</span><br><span class="line">getThreads()</span><br><span class="line">getId()</span><br><span class="line">getState()</span><br><span class="line">setDefaultUncaughtExceptionHandler()</span><br><span class="line">getDefaultUncaughtExceptionHandler()</span><br><span class="line">getUncaughtExceptionHandler()</span><br><span class="line">setUncaughtExceptionHandler()</span><br><span class="line">dispatchUncaughtException()</span><br><span class="line">processQueue()</span><br></pre></td></tr></table></figure></p><p>å½“ç„¶æ„é€ çº¿ç¨‹å±æ€§æœ‰äº›å±æ€§è¿˜å¯ä»¥åœ¨åˆ›å»ºçº¿ç¨‹å®ä¾‹æ—¶å°±è®¾ç½®ï¼Œå¦‚ä¸‹æ˜¯ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–æ—¶çš„ä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * @param g</span><br><span class="line"> * @param target</span><br><span class="line"> * @param name</span><br><span class="line"> * @param stackSize çº¿ç¨‹çš„æ ˆå¤§å° æ ¹æ®å‚æ•°ä¼ é€’è¿‡ç¨‹å¯ä»¥çœ‹å‡ºé»˜è®¤å¤§å°ä¸ºé›¶ï¼Œå³ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹æ ˆå¤§å°</span><br><span class="line"> * @param acc è®¿é—®æ§åˆ¶æƒé™</span><br><span class="line"> * @param inheritThreadLocals // å¯ç»§æ‰¿çš„ThreadLocal</span><br><span class="line"> *</span><br><span class="line"> * ThreadGroup çº¿ç¨‹ç»„ï¼ˆThreadGroupï¼‰å°±æ˜¯ç”±çº¿ç¨‹ç»„æˆçš„ç®¡ç†çº¿ç¨‹çš„ç±»ï¼Œ</span><br><span class="line"> *     è¿™ä¸ªç±»æ˜¯java.lang.ThreadGroupç±»ã€‚</span><br><span class="line"> *     å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ç»„ï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç å¯ä»¥å®ç°ã€‚</span><br><span class="line"> *     ThreadGroup group=new ThreadGroup(&quot;group&quot;);</span><br><span class="line"> *     Thread thread=new Thread(group,&quot;the first thread of group&quot;);</span><br><span class="line"> *     ThreadGroupç±»ä¸­çš„æŸäº›æ–¹æ³•ï¼Œå¯ä»¥å¯¹çº¿ç¨‹ç»„ä¸­çš„çº¿ç¨‹äº§ç”Ÿä½œç”¨ã€‚ä¾‹å¦‚ï¼ŒsetMaxPriority()æ–¹æ³•å¯ä»¥è®¾å®šçº¿ç¨‹ç»„ä¸­çš„æ‰€æœ‰çº¿ç¨‹æ‹¥æœ‰æœ€å¤§çš„ä¼˜å…ˆæƒã€‚</span><br><span class="line"> */</span><br><span class="line">private void init(ThreadGroup g, Runnable target, String name,</span><br><span class="line">                  long stackSize, AccessControlContext acc,</span><br><span class="line">                  boolean inheritThreadLocals) &#123;</span><br><span class="line">    if (name == null) &#123;// çº¿ç¨‹åï¼Œå¯ç›¸åŒ</span><br><span class="line">        throw new NullPointerException(&quot;name cannot be null&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.name = name;</span><br><span class="line"></span><br><span class="line">    Thread parent = currentThread();// è·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶ä½œä¸ºçˆ¶çº¿ç¨‹ã€‚</span><br><span class="line">    SecurityManager security = System.getSecurityManager();// è·å–å®‰å…¨ç­–ç•¥</span><br><span class="line">    if (g == null) &#123;</span><br><span class="line">        /* Determine if it&apos;s an applet or not */</span><br><span class="line"></span><br><span class="line">        /* If there is a security manager, ask the security manager</span><br><span class="line">           what to do. */</span><br><span class="line">        if (security != null) &#123;//å¦‚æœå­˜åœ¨å®‰å…¨ç®¡ç†å™¨ï¼Œåˆ™è·å–å®ƒé‡å†™çš„çº¿ç¨‹ç»„</span><br><span class="line">            g = security.getThreadGroup();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* If the security doesn&apos;t have a strong opinion of the matter</span><br><span class="line">           use the parent thread group. */</span><br><span class="line">        if (g == null) &#123;</span><br><span class="line">            g = parent.getThreadGroup();//ä½¿ç”¨çˆ¶çº¿ç¨‹ç»„</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* checkAccess regardless of whether or not threadgroup is</span><br><span class="line">       explicitly passed in. */</span><br><span class="line">    g.checkAccess();</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">     * Do we have the required permissions?</span><br><span class="line">     */</span><br><span class="line">    if (security != null) &#123;</span><br><span class="line">        if (isCCLOverridden(getClass())) &#123;</span><br><span class="line">            security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g.addUnstarted();</span><br><span class="line"></span><br><span class="line">    this.group = g;</span><br><span class="line">    this.daemon = parent.isDaemon();//ç»§æ‰¿çˆ¶çº¿ç¨‹çš„å®ˆæŠ¤å±æ€§</span><br><span class="line">    this.priority = parent.getPriority();//ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ä¼˜å…ˆçº§</span><br><span class="line">    //ç»§æ‰¿çˆ¶çº¿ç¨‹åŠ è½½èµ„æºçš„contextClassLoader</span><br><span class="line">    if (security == null || isCCLOverridden(parent.getClass()))</span><br><span class="line">        this.contextClassLoader = parent.getContextClassLoader();</span><br><span class="line">    else</span><br><span class="line">        this.contextClassLoader = parent.contextClassLoader;</span><br><span class="line">    this.inheritedAccessControlContext =</span><br><span class="line">            acc != null ? acc : AccessController.getContext();</span><br><span class="line">    this.target = target;</span><br><span class="line">    setPriority(priority);</span><br><span class="line">    // ç»§æ‰¿çˆ¶çº¿ç¨‹å¯ç»§æ‰¿çš„ThreadLocal</span><br><span class="line">    if (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != null)</span><br><span class="line">        this.inheritableThreadLocals =</span><br><span class="line">            ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);</span><br><span class="line">    /* Stash the specified stack size in case the VM cares */</span><br><span class="line">    this.stackSize = stackSize;</span><br><span class="line"></span><br><span class="line">    /* Set thread ID */</span><br><span class="line">    tid = nextThreadID();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-å¯åŠ¨çº¿ç¨‹"><a href="#1-3-å¯åŠ¨çº¿ç¨‹" class="headerlink" title="1.3 å¯åŠ¨çº¿ç¨‹"></a>1.3 å¯åŠ¨çº¿ç¨‹</h4><p>çº¿ç¨‹å¯¹è±¡åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œè°ƒç”¨startæ–¹æ³•å°±å¯ä»¥å¯åŠ¨çº¿ç¨‹ã€‚<br><strong><em>æ³¨æ„ï¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæœ€å¥½ä¸ºè¿™ä¸ªçº¿ç¨‹è®¾ç½®çº¿ç¨‹åç§°ï¼Œè¿™è¡Œæœ‰åŠ©äºåˆ†ææˆ–è€…æ’æŸ¥é—®é¢˜</em></strong></p><h3 id="2-ä¸­æ–­çº¿ç¨‹"><a href="#2-ä¸­æ–­çº¿ç¨‹" class="headerlink" title="2. ä¸­æ–­çº¿ç¨‹"></a>2. ä¸­æ–­çº¿ç¨‹</h3><h4 id="2-1-ä¸­æ–­çš„åŸç†"><a href="#2-1-ä¸­æ–­çš„åŸç†" class="headerlink" title="2.1 ä¸­æ–­çš„åŸç†"></a>2.1 ä¸­æ–­çš„åŸç†</h4><p>ä¸­æ–­ï¼Œå¯ä»¥ç†è§£ä¸ºè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œæ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†ä¸­æ–­æ“ä½œã€‚ä¸­æ–­æ“ä½œæœ‰çš„æƒ…å†µä¸‹ä»…ä»…è®¾ç½®ä¸­æ–­çŠ¶æ€ï¼Œæœ‰çš„<br>ä¸­æ–­æ“ä½œåŒ…å«ä¸‰ä¸ªæ–¹æ³•ã€‚interrupt(),interrupted(),isInterrupted()ã€‚ä¸‹é¢æˆ‘ä»¬å°†å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œè¯¦ç»†äº†è§£ã€‚</p><h5 id="2-1-1-interrupt"><a href="#2-1-1-interrupt" class="headerlink" title="2.1.1 interrupt()"></a>2.1.1 interrupt()</h5><p>ä¸­æ–­æ“ä½œé€šè¿‡è°ƒç”¨çº¿ç¨‹çš„interrupt()æ–¹æ³•è¿›è¡Œã€‚ä¾‹å¦‚çº¿ç¨‹Aä¸­æ–­çº¿ç¨‹Bï¼Œåœ¨çº¿ç¨‹Açš„ä»£ç ä¸­è°ƒç”¨ThreadB.interrupt()å³å¯ã€‚</p><p>interrupt()æ–¹æ³•å¯¹äºä¸åŒæƒ…å†µçš„ä¸åŒå¤„ç†å¦‚ä¸‹ã€‚ç¿»è¯‘è‡ª<a href="https://docs.oracle.com/javase/7/docs/api/" target="_blank" rel="noopener">Java se7docs</a>ï¼š</p><ol><li>é™¤éç»ˆæ­¢çš„æ˜¯å½“å‰çº¿ç¨‹ï¼ˆå§‹ç»ˆè¢«å…è®¸ï¼‰ï¼Œå¦åˆ™è°ƒç”¨checkAccessæ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŠ›å‡ºSecurityExceptionå¼‚å¸¸ã€‚</li><li>å¦‚æœè°ƒç”¨Objectç±»çš„wait(),wait(long)æˆ–è€…wait(long, int)ç­‰æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨æ­¤çº¿ç¨‹çš„join(),join(long),join(long, int), sleep(long), sleep(long, int)æ–¹æ³•ï¼Œ<strong><em>æ­¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€å°†è¢«æ¸…é™¤ï¼ŒåŒæ—¶å°†æŠ›å‡ºInterruptedExceptionå¼‚å¸¸</em></strong>ã€‚</li><li>å¦‚æœæ­¤çº¿ç¨‹åœ¨å¯ä¸­æ–­é€šé“çš„IOæ“ä½œä¸Šï¼Œé€šé“å°†è¢«å…³é—­ï¼Œçº¿ç¨‹è¢«è®¾ç½®ä¸­æ–­çŠ¶æ€ï¼ŒåŒæ—¶å°†æŠ›å‡ºClosedByInterruptExceptionå¼‚å¸¸ã€‚</li><li>å¦‚æœçº¿ç¨‹åœ¨é€‰æ‹©å™¨(Selector)é˜»å¡ï¼Œçº¿ç¨‹å°†è¢«è®¾ç½®ä¸­æ–­çŠ¶æ€ï¼Œç«‹å³ä»é€‰æ‹©æ“ä½œä¸­è¿”å›ï¼Œå¯èƒ½å¸¦æœ‰éé›¶å€¼ï¼Œå°±åƒé€‰æ‹©å™¨å”¤é†’æ–¹æ³•è¢«è°ƒç”¨ä¸€æ ·ã€‚</li><li>å¦‚æœä»¥ä¸Šçš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæ­¤çº¿ç¨‹å°†è¢«è®¾ç½®ä¸­æ–­çŠ¶æ€ã€‚</li><li>ä¸­æ–­ä¸å­˜æ´»çš„çº¿ç¨‹ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚</li></ol><p>è¿™é‡Œæä¾›äº†ä¸Šé¢çš„ç»ˆæ­¢å½“å‰çº¿ç¨‹ï¼Œsleepé˜»å¡çº¿ç¨‹ï¼ŒIOé˜»å¡çº¿ç¨‹ä¾‹å­ï¼Œè¯»è€…å¯æ ¹æ®ä¸Šè¿°è¦æ±‚æµ‹è¯•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class InterruptCurrentThread extends Thread&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        super.run();</span><br><span class="line">        this.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class InterruptBlockedThread extends Thread&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        super.run();</span><br><span class="line">        SleepUtils.sleep(100);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class InterruptIOBlockedThread extends Thread&#123;</span><br><span class="line">    private LinkedBlockingQueue&lt;String&gt; queue = new LinkedBlockingQueue&lt;&gt;();</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        super.run();</span><br><span class="line">        try &#123;</span><br><span class="line">            queue.take();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨ï¼šSelectorï¼ˆé€‰æ‹©å™¨ï¼‰æ˜¯Java NIOä¸­èƒ½å¤Ÿæ£€æµ‹ä¸€åˆ°å¤šä¸ªNIOé€šé“ï¼Œå¹¶èƒ½å¤ŸçŸ¥æ™“é€šé“æ˜¯å¦ä¸ºè¯¸å¦‚è¯»å†™äº‹ä»¶åšå¥½å‡†å¤‡çš„ç»„ä»¶ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªchannelï¼Œä»è€Œç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚è¿™ä¸ªä¸å¤ªå¸¸ç”¨æ‰€ä»¥å°±æ²¡æœ‰ç»™å‡ºæµ‹è¯•ç”¨ä¾‹ã€‚</p><p>æ³¨æ„ï¼š<strong><em>å¯¹äºä¼šæŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µï¼Œå¼‚å¸¸ä¸€å®šè¦å¤„ç†ï¼Œä¸€èˆ¬å­çº¿ç¨‹å¼‚å¸¸ä¸èƒ½æŠ›å‡ºéè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ‰€ä»¥å­çº¿ç¨‹æˆ‘ä»¬éœ€è¦æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œç”¨äºç»™çˆ¶çº¿ç¨‹æ•è·ã€‚</em></strong></p><h5 id="2-1-2-interrupted"><a href="#2-1-2-interrupted" class="headerlink" title="2.1.2 interrupted()"></a>2.1.2 interrupted()</h5><p>interrupted()ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>æµ‹è¯•<strong><em>å½“å‰çº¿ç¨‹</em></strong>æ˜¯å¦è¢«ä¸­æ–­,çº¿ç¨‹ä¸­æ–­çŠ¶æ€å°†è¢«æ¸…é™¤ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¦‚æœå½“å‰æ–¹æ³•è¢«æˆåŠŸè°ƒç”¨ä¸¤æ¬¡ï¼Œåˆ™è¿”å›falseï¼ˆé™¤éå½“å‰çº¿ç¨‹åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ­¤æ–¹æ³•åç¬¬äºŒæ¬¡è°ƒç”¨æ­¤æ–¹æ³•å‰è¢«å†æ¬¡ä¸­æ–­ï¼‰ã€‚</li><li>çº¿ç¨‹ä¸­æ–­è¢«å¿½ç•¥ï¼Œå› ä¸ºåœ¨ä¸­æ–­æ—¶çº¿ç¨‹æ­»æ‰å°†è¢«æ­¤æ–¹æ³•åæ˜ è¿”å›falseã€‚(æˆ‘çš„ç†è§£)</li></ol><p>interrupted()ä¸åŒäºinterrupt(),æ­¤æ–¹æ³•ç”¨äºæµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¹¶æ¸…é™¤ä¸­æ–­çŠ¶æ€ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Thread thread = new InterruptThread();</span><br><span class="line">    thread.start();</span><br><span class="line">    SleepUtils.sleep(1);</span><br><span class="line">    thread.interrupt();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    static class InterruptThread extends Thread&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            int count = 0;</span><br><span class="line">            while(true)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                if(interrupted())&#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h5 id="2-1-3-isInterrupted"><a href="#2-1-3-isInterrupted" class="headerlink" title="2.1.3 isInterrupted()"></a>2.1.3 isInterrupted()</h5><p>isInterruptedè™½ç„¶ä¹Ÿæ˜¯æµ‹è¯•çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œä½†æ˜¯æ­¤æ–¹æ³•ä¸ä¼šæ›´æ”¹çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚</p><h3 id="3-ç»ˆæ­¢çº¿ç¨‹"><a href="#3-ç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="3. ç»ˆæ­¢çº¿ç¨‹"></a>3. ç»ˆæ­¢çº¿ç¨‹</h3><h4 id="3-1-è¿‡æœŸçš„suspend-ã€resume-å’Œstop"><a href="#3-1-è¿‡æœŸçš„suspend-ã€resume-å’Œstop" class="headerlink" title="3.1 è¿‡æœŸçš„suspend()ã€resume()å’Œstop()"></a>3.1 è¿‡æœŸçš„suspend()ã€resume()å’Œstop()</h4><p>åœ¨Java APIä¸­ï¼Œsuspend()ã€resume()å’Œstop()ä¸‰ä¸ªæ–¹æ³•æ˜¯è¿‡æœŸçš„ï¼Œä¸å»ºè®®ä½¿ç”¨çš„ã€‚<br>ä¸»è¦åŸå› æ˜¯ï¼šsuspend()åœ¨è°ƒç”¨åï¼Œçº¿ç¨‹ä¸æ˜¯æ”¾å·²ç»å æœ‰çš„èµ„æºæ¯”å¦‚è¯´é”ï¼Œè€Œæ˜¯å æœ‰ç€èµ„æºè¿›å…¥ç¡çœ ï¼Œè¿™æ ·å®¹æ˜“å¼•å‘æ­»é”çŠ¶æ€ã€‚stop()æ–¹æ³•åœ¨ç»ˆç»“ä¸€ä¸ªçº¿ç¨‹æ—¶ä¸ä¼šä¿è¯çº¿ç¨‹èµ„æºçš„é‡Šæ”¾ï¼Œå› æ­¤å¯¼è‡´çº¿ç¨‹å¤„äºä¸ç¡®å®šçš„çŠ¶æ€ä¸‹ã€‚</p><p><strong><em>sleepå’ŒsuspendåŒºåˆ«ï¼š</em></strong><br>ç›¸åŒç‚¹ï¼šsleepå’Œsuspendéƒ½ä¼šæŒæœ‰å æœ‰çš„èµ„æºä¸é‡Šæ”¾ã€‚<br>ä¸åŒç‚¹ï¼šsleepé˜»å¡ï¼ˆTIMED_WAITINGï¼‰åï¼Œç»è¿‡ä¸€æ®µæ—¶é—´è‡ªè¡Œæ¢å¤è¿è¡Œã€‚è€Œsuspendå¿…é¡»ä½¿ç”¨resume()æ˜¾ç¤ºçš„æ¢å¤ï¼Œå¦‚æœä¸ä½¿ç”¨resume()æˆ–è€…resume()å¤±è´¥ï¼Œå¾ˆå®¹æ˜“å¼•èµ·èµ„æºå ç”¨å¯¼è‡´çš„æ­»é”ã€‚</p><h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-javasecurity/" target="_blank" rel="noopener">Java å®‰å…¨æ¨¡å‹ä»‹ç»</a><br><a href="https://docs.oracle.com/javase/7/docs/api/" target="_blank" rel="noopener">Class Thread</a><br><a href="https://my.oschina.net/u/2500836/blog/1538667" target="_blank" rel="noopener">Javaçº¿ç¨‹(1)-Threadç±»æºç </a><br><a href="https://book.douban.com/subject/26591326/" target="_blank" rel="noopener">Javaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸Šç¯‡å¯¹&lt;a href=&quot;https://zhongyp.me/2018/03/16/concurrent/2017-03-16-Thread-brief/&quot;&gt;ä»€ä¹ˆæ˜¯çº¿ç¨‹&lt;/a&gt;åšäº†ç®€å•çš„ä»‹ç»,æœ¬ç¯‡ä¸»è¦æ˜¯ä»æ„é€ çº¿ç¨‹ã€ä¸­æ–­çº¿ç¨‹ã€ç»ˆæ­¢çº¿ç¨‹3ä¸ªæ–¹é¢äº†è§£çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=
      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="http://zhongyp.me/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„åšå®¢</title>
    <link href="http://zhongyp.me/2018/11/28/life/2018-11-29-1/"/>
    <id>http://zhongyp.me/2018/11/28/life/2018-11-29-1/</id>
    <published>2018-11-27T16:00:00.000Z</published>
    <updated>2018-11-29T08:52:39.944Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å°‘å¹´æ—¶ä»£å¯¹æœªæ¥ç”Ÿæ´»çš„æƒ³è±¡è™½ç„¶æœ¦èƒ§ï¼Œä½†å®é™…ä¸Šå´æœ‰ç€æé«˜çš„æœŸå¾…ã€‚ä½ æ€»è§‰å¾—ç°åœ¨åªæ˜¯æ´»ç€ï¼Œç­‰å¾…ç€ï¼Œç­‰å¾…ç€æŸä¸€åˆ»ä¼šé‡‘é¼“é½é¸£ï¼Œå…‰èŠ’å››å°„ï¼Œç„¶åï¼ŒçœŸæ­£çš„ç”Ÿæ´»å¼€å§‹äº†ã€‚ä½†æ—¥å¸¸ç”Ÿæ´»è‡ªæœ‰å®ƒè‡ªå·±ç¼“æ…¢è€Œå¹³é™çš„èŠ‚å¥ï¼Œå®ƒæ³¢æ¾œä¸å…´åœ°å‘å‰å¼¥æ¼«ï¼Œè¶Šè¿‡å²æœˆã€‚ç›´åˆ°ä½ éª¤ç„¶å‘ç°ï¼Œå¤§å¤šæ•°äººçš„ç”Ÿæ´»ä¸ä¼šæœ‰é‡‘é¼“é½é¸£çš„å¼€å§‹ï¼Œå¤§å¤šæ•°äººçš„ç”Ÿæ´»ï¼Œå°±æ˜¯ä¸€ç§æ°´æ»´çŸ³ç©¿çš„å•è°ƒå’Œå®é™ã€‚</strong></p><p>å¼€å§‹å†™åšå®¢ä¸€æ®µæ—¶é—´äº†ï¼Œåªæ˜¯æƒ³æ‰¾ä¸ªåœ°æ–¹è®°å½•ä¸‹è‡ªå·±çš„çœ‹è¿‡çš„ã€å­¦è¿‡çš„çŸ¥è¯†ï¼Œè®°å½•ä¸‹å­¦ä¹ çš„è¿‡ç¨‹ä¸­è‡ªå·±çš„æƒ³æ³•/æ„Ÿæ‚Ÿã€‚æ€è€ƒä¸­â€¦ğŸŒ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;å°‘å¹´æ—¶ä»£å¯¹æœªæ¥ç”Ÿæ´»çš„æƒ³è±¡è™½ç„¶æœ¦èƒ§ï¼Œä½†å®é™…ä¸Šå´æœ‰ç€æé«˜çš„æœŸå¾…ã€‚ä½ æ€»è§‰å¾—ç°åœ¨åªæ˜¯æ´»ç€ï¼Œç­‰å¾…ç€ï¼Œç­‰å¾…ç€æŸä¸€åˆ»ä¼šé‡‘é¼“é½é¸£ï¼Œå…‰èŠ’å››å°„ï¼Œç„¶åï¼ŒçœŸæ­£çš„ç”Ÿæ´»å¼€å§‹äº†ã€‚ä½†æ—¥å¸¸ç”Ÿæ´»è‡ªæœ‰å®ƒè‡ªå·±ç¼“æ…¢è€Œå¹³é™çš„èŠ‚å¥ï¼Œå®ƒæ³¢æ¾œä¸å…´åœ°å‘å‰å¼¥æ¼«ï¼Œè¶Šè¿‡å²æœˆã€‚ç›´åˆ°ä½ éª¤ç„¶å‘ç°ï¼Œå¤§å¤šæ•°äººçš„ç”Ÿæ´»ä¸ä¼šæœ‰é‡‘é¼“
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="http://zhongyp.me/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>åšå®¢å£°æ˜</title>
    <link href="http://zhongyp.me/2018/11/28/life/2018-11-29/"/>
    <id>http://zhongyp.me/2018/11/28/life/2018-11-29/</id>
    <published>2018-11-27T16:00:00.000Z</published>
    <updated>2018-11-29T08:49:19.431Z</updated>
    
    <content type="html"><![CDATA[<p>åšå®¢ä¸­çš„æ–‡ç« ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå‡ä¸ºåŸåˆ›ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„ï¼Œå¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼›å¿…é¡»åœ¨æ–‡ç« ä¸­ç»™å‡ºåŸæ–‡è¿æ¥ï¼›å¦åˆ™å¿…ç©¶æ³•å¾‹è´£ä»»ã€‚<br>åšå®¢ä¸­å¯èƒ½æœ‰äº›å†…å®¹æ‘˜å½•è‡³åˆ«äººçš„æ–‡ç« /åšå®¢/ä¹¦ï¼Œä»…ä¸ºä¸ªäººæ”¶è—ï¼Œåˆ†äº«çŸ¥è¯†ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åšä¸»è¿›è¡Œåˆ é™¤ã€‚ğŸ“§ï¼š<a href="mailto:zhongyp001@163.com" target="_blank" rel="noopener">zhongyp001@163.com</a>ï¼Œæ”¶åˆ°åä¸€å®šå°½å¿«åˆ é™¤ä¸æ‚¨çš„ç›¸å…³å†…å®¹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åšå®¢ä¸­çš„æ–‡ç« ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå‡ä¸ºåŸåˆ›ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„ï¼Œå¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼›å¿…é¡»åœ¨æ–‡ç« ä¸­ç»™å‡ºåŸæ–‡è¿æ¥ï¼›å¦åˆ™å¿…ç©¶æ³•å¾‹è´£ä»»ã€‚&lt;br&gt;åšå®¢ä¸­å¯èƒ½æœ‰äº›å†…å®¹æ‘˜å½•è‡³åˆ«äººçš„æ–‡ç« /åšå®¢/ä¹¦ï¼Œä»…ä¸ºä¸ªäººæ”¶è—ï¼Œåˆ†äº«çŸ¥è¯†ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åšä¸»è¿›è¡Œåˆ é™¤ã€‚ğŸ“§ï¼š&lt;a href=&quot;mailto
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="http://zhongyp.me/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹åŸºç¡€</title>
    <link href="http://zhongyp.me/2018/11/27/concurrent/2018-11-27-multithreads-basic/"/>
    <id>http://zhongyp.me/2018/11/27/concurrent/2018-11-27-multithreads-basic/</id>
    <published>2018-11-26T16:00:00.000Z</published>
    <updated>2018-12-01T08:31:57.500Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¤šçº¿ç¨‹åŸºç¡€"><a href="#å¤šçº¿ç¨‹åŸºç¡€" class="headerlink" title="å¤šçº¿ç¨‹åŸºç¡€"></a>å¤šçº¿ç¨‹åŸºç¡€</h1><h2 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h2><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><h3 id="åŠ é”æœºåˆ¶"><a href="#åŠ é”æœºåˆ¶" class="headerlink" title="åŠ é”æœºåˆ¶"></a>åŠ é”æœºåˆ¶</h3><h3 id="ç”¨é”æ¥ä¿æŠ¤çŠ¶æ€"><a href="#ç”¨é”æ¥ä¿æŠ¤çŠ¶æ€" class="headerlink" title="ç”¨é”æ¥ä¿æŠ¤çŠ¶æ€"></a>ç”¨é”æ¥ä¿æŠ¤çŠ¶æ€</h3><h3 id="æ´»è·ƒæ€§ä¸æ€§èƒ½"><a href="#æ´»è·ƒæ€§ä¸æ€§èƒ½" class="headerlink" title="æ´»è·ƒæ€§ä¸æ€§èƒ½"></a>æ´»è·ƒæ€§ä¸æ€§èƒ½</h3><h2 id="å¤šçº¿ç¨‹ä½¿ç”¨"><a href="#å¤šçº¿ç¨‹ä½¿ç”¨" class="headerlink" title="å¤šçº¿ç¨‹ä½¿ç”¨"></a>å¤šçº¿ç¨‹ä½¿ç”¨</h2><h3 id="çº¿ç¨‹åˆ›å»º"><a href="#çº¿ç¨‹åˆ›å»º" class="headerlink" title="çº¿ç¨‹åˆ›å»º"></a>çº¿ç¨‹åˆ›å»º</h3><h3 id="çº¿ç¨‹å¯åŠ¨ã€ç»ˆæ­¢ã€ä¸­æ–­ã€è¿”å›å€¼ã€è¶…æ—¶å¤„ç†"><a href="#çº¿ç¨‹å¯åŠ¨ã€ç»ˆæ­¢ã€ä¸­æ–­ã€è¿”å›å€¼ã€è¶…æ—¶å¤„ç†" class="headerlink" title="çº¿ç¨‹å¯åŠ¨ã€ç»ˆæ­¢ã€ä¸­æ–­ã€è¿”å›å€¼ã€è¶…æ—¶å¤„ç†"></a>çº¿ç¨‹å¯åŠ¨ã€ç»ˆæ­¢ã€ä¸­æ–­ã€è¿”å›å€¼ã€è¶…æ—¶å¤„ç†</h3><h2 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h2><h3 id="Javaå†…å­˜å¯è§æ€§"><a href="#Javaå†…å­˜å¯è§æ€§" class="headerlink" title="Javaå†…å­˜å¯è§æ€§"></a>Javaå†…å­˜å¯è§æ€§</h3><ul><li>synchronized å…³é”®å­—</li></ul><p>å³æœ‰synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ã€‚ç”±äºJavaçš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…ç½®é”ï¼Œå½“ç”¨æ­¤å…³é”®å­—ä¿®é¥°æ–¹æ³•æ—¶ï¼Œå†…ç½®é”ä¼šä¿æŠ¤æ•´ä¸ªæ–¹æ³•ã€‚åœ¨è°ƒç”¨è¯¥æ–¹æ³•å‰ï¼Œéœ€è¦è·å¾—å†…ç½®é”ï¼Œå¦åˆ™å°±å¤„äºé˜»å¡çŠ¶æ€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public synchronized void buy(int i)&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;æˆ‘ä¹°&quot; + i + &quot;ä¸ªè‹¹æœ&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¿®é¥°æ–¹æ³•ï¼Œsynchronizedå…³é”®å­—ä¹Ÿå¯ä»¥ä¿®é¥°ä»£ç å—ï¼Œæ ¹æ®ä¼ å…¥å¯¹è±¡çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºJavaå¯¹è±¡é”å’Œç±»é”ã€‚å¯¹è±¡é”æ˜¯ç”¨äºå¯¹è±¡å®ä¾‹æ–¹æ³•ï¼Œæˆ–è€…ä¸€ä¸ªå¯¹è±¡å®ä¾‹ä¸Šçš„ï¼Œç±»é”æ˜¯ç”¨äºç±»çš„é™æ€æ–¹æ³•æˆ–è€…ä¸€ä¸ªç±»çš„classå¯¹è±¡ä¸Šçš„ã€‚å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void test()&#123;</span><br><span class="line">    String a = &quot;a&quot;;// éšä¾¿ä¸€ä¸ªStringä¸å˜é‡</span><br><span class="line">    sychronized(a)&#123;// è¿™ä¸ªé”åªåœ¨æ–¹æ³•å†…ï¼ŒåŠ å…¥è¿™ä¸ªç±»ä¸­è¿˜æœ‰å…¶ä»–çš„å¯¹è±¡é”æ–¹æ³•ï¼Œåˆ™ä¸¤è€…äº’ä¸å½±å“</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(2000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">synchronized(this)&#123;// å¯¹è±¡é”ï¼Œå…¶ä¸­thisä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œä¸èƒ½æ˜¯é™æ€å˜é‡</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        Thread.sleep(2000);</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public synchronized void buy(int i)&#123;// å¯¹è±¡é”</span><br><span class="line">    </span><br><span class="line">    try &#123;</span><br><span class="line">        Thread.sleep(2000);</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">synchronized (Buy.class)&#123;//ç±»é”</span><br><span class="line">    try &#123;</span><br><span class="line">        Thread.sleep(2000);</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public static synchronized void test2()//ç±»é” </span><br><span class="line">&#123;  </span><br><span class="line">   try &#123;</span><br><span class="line">       Thread.sleep(2000);</span><br><span class="line">   &#125; catch (InterruptedException e) &#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ç‰¹æ®ŠåŸŸå˜é‡volatile</li></ul><p><a href="http://zhongyp.me/2018/01/04/Volatile/">volatileè¯¦è§£</a></p><ul><li>ä½¿ç”¨é‡å…¥é”Lock</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private int account = 100;</span><br><span class="line">//éœ€è¦å£°æ˜è¿™ä¸ªé”</span><br><span class="line">private Lock lock = new ReentrantLock();</span><br><span class="line">public int getAccount() &#123;</span><br><span class="line">    return account;</span><br><span class="line">&#125;</span><br><span class="line">//è¿™é‡Œä¸å†éœ€è¦synchronized </span><br><span class="line">public void save(int money) &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    try&#123;</span><br><span class="line">        account += money;</span><br><span class="line">    &#125;finally&#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait/notify"></a>wait/notify</h3><h3 id="ç®¡é“é€šä¿¡"><a href="#ç®¡é“é€šä¿¡" class="headerlink" title="ç®¡é“é€šä¿¡"></a>ç®¡é“é€šä¿¡</h3><h3 id="Thread-join"><a href="#Thread-join" class="headerlink" title="Thread.join"></a>Thread.join</h3><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å¤šçº¿ç¨‹åŸºç¡€&quot;&gt;&lt;a href=&quot;#å¤šçº¿ç¨‹åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;å¤šçº¿ç¨‹åŸºç¡€&quot;&gt;&lt;/a&gt;å¤šçº¿ç¨‹åŸºç¡€&lt;/h1&gt;&lt;h2 id=&quot;çº¿ç¨‹å®‰å…¨&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹å®‰å…¨&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹å®‰å…¨&quot;
      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="http://zhongyp.me/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Java Classæ–‡ä»¶ç»“æ„</title>
    <link href="http://zhongyp.me/2018/11/22/jvm/2018-11-22/"/>
    <id>http://zhongyp.me/2018/11/22/jvm/2018-11-22/</id>
    <published>2018-11-21T16:00:00.000Z</published>
    <updated>2018-11-22T12:16:57.451Z</updated>
    
    <content type="html"><![CDATA[<h2 id="classç»“æ„"><a href="#classç»“æ„" class="headerlink" title="classç»“æ„"></a>classç»“æ„</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4             magic;</span><br><span class="line">    u2             minor_version;</span><br><span class="line">    u2             major_version;</span><br><span class="line">    u2             constant_pool_count;</span><br><span class="line">    cp_info        constant_pool[constant_pool_count-1];</span><br><span class="line">    u2             access_flags;</span><br><span class="line">    u2             this_class;</span><br><span class="line">    u2             super_class;</span><br><span class="line">    u2             interfaces_count;</span><br><span class="line">    u2             interfaces[interfaces_count];</span><br><span class="line">    u2             fields_count;</span><br><span class="line">    field_info     fields[fields_count];</span><br><span class="line">    u2             methods_count;</span><br><span class="line">    method_info    methods[methods_count];</span><br><span class="line">    u2             attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="magic"><a href="#magic" class="headerlink" title="magic"></a>magic</h3><p>ç”¨æ¥è¯†åˆ«classæ–‡ä»¶ï¼Œå›ºå®šå€¼ï¼š0xCAFEBABEã€‚å…³äº0xCAFEBABEè¿˜æœ‰ä¸€ä¸ªæ•…äº‹<a href="https://leokongwq.github.io/2016/12/31/java-magic-0xCAFEBABE.html" target="_blank" rel="noopener">javaé­”æ³•ä¹‹0xCAFEBABE</a></p><h3 id="minor-version-major-version"><a href="#minor-version-major-version" class="headerlink" title="minor_version, major_version"></a>minor_version, major_version</h3><p>The values of the minor_version and major_version items are the minor and major version numbers of this class file. Together, a major and a minor version number determine the version of the class file format. If a class file has major version number M and minor version number m, we denote the version of its class file format as M.m. Thus, class file format versions may be ordered lexicographically, for example, 1.5 &lt; 2.0 &lt; 2.1.</p><p>A Java Virtual Machine implementation can support a class file format of version v if and only if v lies in some contiguous range Mi.0 â‰¤ v â‰¤ Mj.m. The release level of the Java SE platform to which a Java Virtual Machine implementation conforms is responsible for determining the range.</p><p>Oracleâ€™s Java Virtual Machine implementation in JDK release 1.0.2 supports class file format versions 45.0 through 45.3 inclusive. JDK releases 1.1.* support class file format versions in the range 45.0 through 45.65535 inclusive. For k â‰¥ 2, JDK release 1.k supports class file format versions in the range 45.0 through 44+k.0 inclusive.</p><h3 id="constant-pool-count"><a href="#constant-pool-count" class="headerlink" title="constant_pool_count"></a>constant_pool_count</h3><p>The value of the constant_pool_count item is equal to the number of entries in the constant_pool table plus one. A constant_pool index is considered valid if it is greater than zero and less than constant_pool_count, with the exception for constants of type long and double noted in Â§4.4.5.</p><h3 id="constant-pool"><a href="#constant-pool" class="headerlink" title="constant_pool[]"></a>constant_pool[]</h3><p>The constant_pool is a table of structures (Â§4.4) representing various string constants, class and interface names, field names, and other constants that are referred to within the ClassFile structure and its substructures. The format of each constant_pool table entry is indicated by its first â€œtagâ€ byte.</p><p>The constant_pool table is indexed from 1 to constant_pool_count-1.</p><h3 id="access-flags"><a href="#access-flags" class="headerlink" title="access_flags"></a>access_flags</h3><p>The value of the access_flags item is a mask of flags used to denote access permissions to and properties of this class or interface. The interpretation of each flag, when set, is as shown in Table 4.1.</p><p>Table 4.1. Class access and property modifiers</p><p>Flag Name    Value    Interpretation<br>ACC_PUBLIC    0x0001    Declared public; may be accessed from outside its package.<br>ACC_FINAL    0x0010    Declared final; no subclasses allowed.<br>ACC_SUPER    0x0020    Treat superclass methods specially when invoked by the invokespecial instruction.<br>ACC_INTERFACE    0x0200    Is an interface, not a class.<br>ACC_ABSTRACT    0x0400    Declared abstract; must not be instantiated.<br>ACC_SYNTHETIC    0x1000    Declared synthetic; not present in the source code.<br>ACC_ANNOTATION    0x2000    Declared as an annotation type.<br>ACC_ENUM    0x4000    Declared as an enum type.<br>A class may be marked with the ACC_SYNTHETIC flag to indicate that it was generated by a compiler and does not appear in source code.</p><p>The ACC_ENUM flag indicates that this class or its superclass is declared as an enumerated type.</p><p>An interface is distinguished by its ACC_INTERFACE flag being set. If its ACC_INTERFACE flag is not set, this class file defines a class, not an interface.</p><p>If the ACC_INTERFACE flag of this class file is set, its ACC_ABSTRACT flag must also be set (JLS Â§9.1.1.1). Such a class file must not have its ACC_FINAL, ACC_SUPER or ACC_ENUM flags set.</p><p>An annotation type must have its ACC_ANNOTATION flag set. If the ACC_ANNOTATION flag is set, the ACC_INTERFACE flag must be set as well. If the ACC_INTERFACE flag of this class file is not set, it may have any of the other flags in Table 4.1 set, except the ACC_ANNOTATION flag. However, such a class file cannot have both its ACC_FINAL and ACC_ABSTRACT flags set (JLS Â§8.1.1.2).</p><p>The ACC_SUPER flag indicates which of two alternative semantics is to be expressed by the invokespecial instruction (Â§invokespecial) if it appears in this class. Compilers to the instruction set of the Java Virtual Machine should set the ACC_SUPER flag.</p><p>The ACC_SUPER flag exists for backward compatibility with code compiled by older compilers for the Java programming language. In Oracleâ€™s JDK prior to release 1.0.2, the compiler generated ClassFile access_flags in which the flag now representing ACC_SUPER had no assigned meaning, and Oracleâ€™s Java Virtual Machine implementation ignored the flag if it was set.</p><p>All bits of the access_flags item not assigned in Table 4.1 are reserved for future use. They should be set to zero in generated class files and should be ignored by Java Virtual Machine implementations.</p><h3 id="this-class"><a href="#this-class" class="headerlink" title="this_class"></a>this_class</h3><p>The value of the this_class item must be a valid index into the constant_pool table. The constant_pool entry at that index must be a CONSTANT_Class_info structure (Â§4.4.1) representing the class or interface defined by this class file.</p><h3 id="super-class"><a href="#super-class" class="headerlink" title="super_class"></a>super_class</h3><p>For a class, the value of the super_class item either must be zero or must be a valid index into the constant_pool table. If the value of the super_class item is nonzero, the constant_pool entry at that index must be a CONSTANT_Class_info structure (Â§4.4.1) representing the direct superclass of the class defined by this class file. Neither the direct superclass nor any of its superclasses may have the ACC_FINAL flag set in the access_flags item of its ClassFile structure.</p><p>If the value of the super_class item is zero, then this class file must represent the class Object, the only class or interface without a direct superclass.</p><p>For an interface, the value of the super_class item must always be a valid index into the constant_pool table. The constant_pool entry at that index must be a CONSTANT_Class_info structure representing the class Object.</p><h3 id="interfaces-count"><a href="#interfaces-count" class="headerlink" title="interfaces_count"></a>interfaces_count</h3><p>The value of the interfaces_count item gives the number of direct superinterfaces of this class or interface type.</p><h3 id="interfaces"><a href="#interfaces" class="headerlink" title="interfaces[]"></a>interfaces[]</h3><p>Each value in the interfaces array must be a valid index into the constant_pool table. The constant_pool entry at each value of interfaces[i], where 0 â‰¤ i &lt; interfaces_count, must be a CONSTANT_Class_info structure (Â§4.4.1) representing an interface that is a direct superinterface of this class or interface type, in the left-to-right order given in the source for the type.</p><h3 id="fields-count"><a href="#fields-count" class="headerlink" title="fields_count"></a>fields_count</h3><p>The value of the fields_count item gives the number of field_info structures in the fields table. The field_info structures (Â§4.5) represent all fields, both class variables and instance variables, declared by this class or interface type.</p><h3 id="fields"><a href="#fields" class="headerlink" title="fields[]"></a>fields[]</h3><p>Each value in the fields table must be a field_info (Â§4.5) structure giving a complete description of a field in this class or interface. The fields table includes only those fields that are declared by this class or interface. It does not include items representing fields that are inherited from superclasses or superinterfaces.</p><h3 id="methods-count"><a href="#methods-count" class="headerlink" title="methods_count"></a>methods_count</h3><p>The value of the methods_count item gives the number of method_info structures in the methods table.</p><h3 id="methods"><a href="#methods" class="headerlink" title="methods[]"></a>methods[]</h3><p>Each value in the methods table must be a method_info (Â§4.6) structure giving a complete description of a method in this class or interface. If neither of the ACC_NATIVE and ACC_ABSTRACT flags are set in the access_flags item of a method_info structure, the Java Virtual Machine instructions implementing the method are also supplied.</p><p>The method_info structures represent all methods declared by this class or interface type, including instance methods, class methods, instance initialization methods (Â§2.9), and any class or interface initialization method (Â§2.9). The methods table does not include items representing methods that are inherited from superclasses or superinterfaces.</p><h3 id="attributes-count"><a href="#attributes-count" class="headerlink" title="attributes_count"></a>attributes_count</h3><p>The value of the attributes_count item gives the number of attributes (Â§4.7) in the attributes table of this class.</p><h3 id="attributes"><a href="#attributes" class="headerlink" title="attributes[]"></a>attributes[]</h3><p>Each value of the attributes table must be an attribute_info (Â§4.7) structure.</p><p>The attributes defined by this specification as appearing in the attributes table of a ClassFile structure are the InnerClasses (Â§4.7.6), EnclosingMethod (Â§4.7.7), Synthetic (Â§4.7.8), Signature (Â§4.7.9), SourceFile (Â§4.7.10), SourceDebugExtension (Â§4.7.11), Deprecated (Â§4.7.15), RuntimeVisibleAnnotations (Â§4.7.16), RuntimeInvisibleAnnotations (Â§4.7.17), and BootstrapMethods (Â§4.7.21) attributes.</p><p>If a Java Virtual Machine implementation recognizes class files whose version number is 49.0 or above, it must recognize and correctly read Signature (Â§4.7.9), RuntimeVisibleAnnotations (Â§4.7.16), and RuntimeInvisibleAnnotations (Â§4.7.17) attributes found in the attributes table of a ClassFile structure of a class file whose version number is 49.0 or above.</p><p>If a Java Virtual Machine implementation recognizes class files whose version number is 51.0 or above, it must recognize and correctly read BootstrapMethods (Â§4.7.21) attributes found in the attributes table of a ClassFile structure of a class file whose version number is 51.0 or above.</p><p>A Java Virtual Machine implementation is required to silently ignore any or all attributes in the attributes table of a ClassFile structure that it does not recognize. Attributes not defined in this specification are not allowed to affect the semantics of the class file, but only to provide additional descriptive information (Â§4.7.1).</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;classç»“æ„&quot;&gt;&lt;a href=&quot;#classç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;classç»“æ„&quot;&gt;&lt;/a&gt;classç»“æ„&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=
      
    
    </summary>
    
    
      <category term="JVM" scheme="http://zhongyp.me/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘çŸ¥è¯†æ¶æ„</title>
    <link href="http://zhongyp.me/2018/11/16/concurrent/2018-11-27-concurrency-structure/"/>
    <id>http://zhongyp.me/2018/11/16/concurrent/2018-11-27-concurrency-structure/</id>
    <published>2018-11-15T16:00:00.000Z</published>
    <updated>2018-12-04T06:03:49.953Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/media/concurrency.png" alt="Javaå¹¶å‘æ¶æ„å›¾"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/media/concurrency.png&quot; alt=&quot;Javaå¹¶å‘æ¶æ„å›¾&quot;&gt;&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="http://zhongyp.me/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Gitå¸¸ç”¨å‘½ä»¤æ€»ç»“</title>
    <link href="http://zhongyp.me/2018/10/23/utils/2018-10-23-git/"/>
    <id>http://zhongyp.me/2018/10/23/utils/2018-10-23-git/</id>
    <published>2018-10-22T16:00:00.000Z</published>
    <updated>2018-11-27T03:20:14.166Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><p>ç³»ç»Ÿç³»ç»Ÿæ€§çš„å­¦ä¹ Gitï¼Œè¯·ç§»æ­¥<a href="https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%85%B3%E4%BA%8E%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener">Gitä¸­æ–‡å­¦ä¹ æ–‡æ¡£</a>ï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯åˆ†ç±»è®°å½•ä¸€ä¸‹gitçš„å¸¸ç”¨å‘½ä»¤ã€‚<br><img src="/media/15403035072735.png" alt="Gitç‰ˆæœ¬æ§åˆ¶ç³»ç»ŸVCSåŸºæœ¬æ“ä½œæµç¨‹å›¾"></p><h2 id="å¸¸ç”¨å‘½ä»¤æ€»ç»“"><a href="#å¸¸ç”¨å‘½ä»¤æ€»ç»“" class="headerlink" title="å¸¸ç”¨å‘½ä»¤æ€»ç»“"></a>å¸¸ç”¨å‘½ä»¤æ€»ç»“</h2><h3 id="Gitåˆå§‹åŒ–"><a href="#Gitåˆå§‹åŒ–" class="headerlink" title="Gitåˆå§‹åŒ–"></a>Gitåˆå§‹åŒ–</h3><p><code>git init</code> å°†å½“å‰ç›®å½•å˜ä¸ºå¯ç®¡ç†çš„ä»“åº“<br><code>git clone</code> å…‹éš†ä¸€ä¸ªä»“åº“åˆ°æœ¬åœ°<br><code>git clone -b branch uri</code> å…‹éš†æŒ‡å®šbranchåˆ†æ”¯åˆ°æœ¬åœ°<br><code>git config user.name</code> æŸ¥çœ‹ç”¨æˆ·å<br><code>git config user.email</code> æŸ¥çœ‹é‚®ç®±</p><h3 id="è®¾ç½®ä¸é…ç½®"><a href="#è®¾ç½®ä¸é…ç½®" class="headerlink" title="è®¾ç½®ä¸é…ç½®"></a>è®¾ç½®ä¸é…ç½®</h3><p><code>git config -global user.name/email &quot;å‚æ•°&quot;</code> gitæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ï¼Œæ‰€ä»¥æ·»åŠ ç”¨æˆ·åå’Œé‚®ç®±ä½œä¸ºä¸€ä¸ªæ ‡è¯†<br><code>ssh -keygen -t rsa -C &quot;email&quot;</code> ç”Ÿæˆæœ¬åœ°ssh key</p><h3 id="æœ¬åœ°ç‰ˆæœ¬åº“"><a href="#æœ¬åœ°ç‰ˆæœ¬åº“" class="headerlink" title="æœ¬åœ°ç‰ˆæœ¬åº“"></a>æœ¬åœ°ç‰ˆæœ¬åº“</h3><p><code>git add &quot;filename.*&quot;</code> æ·»åŠ åˆ°æš‚å­˜åŒº<br><code>git commit -m &quot;filename.*&quot;</code> æäº¤åˆ°ä»“åº“<br><code>git commit --amend</code> å°è¯•é‡æ–°æäº¤,è¿™ä¸ªæ“ä½œéœ€è¦ç»„åˆæ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add file1 // å°†file1 æ·»åŠ è‡³ç¼“å­˜åŒº</span><br><span class="line">git commmit -m &quot;update files&quot; //æäº¤file1åˆ°æœ¬åœ°ä»“åº“,æäº¤å®Œå‘ç°å¿˜è®°file2æ²¡æœ‰æäº¤ï¼Œåˆ™ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œæäº¤file2å¹¶è¦†ç›–ä¹‹å‰çš„æäº¤ä¿¡æ¯ã€‚</span><br><span class="line">git add file2 // æ·»åŠ file2</span><br><span class="line">git commit -amend // å°è¯•é‡æ–°æäº¤commitä¿¡æ¯ï¼Œå¹¶è¦†ç›–æ‰ä¹‹å‰çš„æäº¤ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><code>git status</code> æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€<br><code>git diff filename.*</code> æŸ¥çœ‹ä¿®æ”¹äº†ä»€ä¹ˆ<br><code>git log</code> çœ‹çœ‹æ¯æ¬¡ä¿®æ”¹çš„æ—¥å¿—<br><code>git log --pretty=oneline</code> æ—¥å¿—æ˜¾ç¤ºä¸ºç¼©ç•¥ç‰ˆ<br>æ³¨ï¼š<code>git reset</code> ä¸åŠ <code>--hard</code>å‚æ•°å¯¹å½“å‰å·¥ä½œåŒºæ–‡ä»¶ä¸ä¼šæœ‰ä»»ä½•ä¿®æ”¹ï¼Œåªæ˜¯å¯¹ç¼“å­˜åŒºè¿›è¡Œæ“ä½œã€‚ä¸€æ—¦åŠ äº†å‚æ•°ï¼Œæ“ä½œä¸€å®šè¦æ…é‡ï¼Œå¦åˆ™ä½ å½“å‰å·¥ä½œåŒºä¸­çš„ä¿®æ”¹å°†ä¼šå…¨éƒ¨è¢«æ¸…é™¤ã€‚<br><code>git reset HEAD file</code> å°†fileé€€å›åˆ°å½“å‰ç‰ˆæœ¬ï¼ˆä»…ä»…æ˜¯å¯¹ç¼“å­˜åŒºè¿›è¡Œæ“ä½œï¼‰<br><code>git reset --hard HEAD^</code> é€€å›åˆ°ä¸Šä¸€ç‰ˆæœ¬<br><code>git reset --hard HEAD^^</code> é€€å›åˆ°å‰äºŒçš„ç‰ˆæœ¬<br><code>git reset --hard HEAD~100</code> é€€å›åˆ°å‰100ç‰ˆæœ¬<br><code>git reset --hard ç‰ˆæœ¬å·</code> é€€å›åˆ°ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬<br><code>git reflog</code> æŸ¥çœ‹ç‰ˆæœ¬å·å’Œä¸Šä¸€ä¸ªå‘½ä»¤ä¸€å—ç”¨æ•ˆæœæ¯”è¾ƒå¥½<br><code>git reset --mixed</code> å°†å½“å‰æ–‡ä»¶æ’¤å‡ºç¼“å­˜åŒºï¼Œä¿ç•™æ–‡ä»¶ä¿®æ”¹<br><code>git rm --cached file</code> åˆ é™¤ç¼“å­˜åŒºfile<br><code>git checkout -- file</code> æ¢å¤å·¥ä½œåŒºfileï¼ˆå–æ¶ˆå·¥ä½œåŒºæ–‡ä»¶çš„ä¿®æ”¹ï¼‰</p><h3 id="è¿œç¨‹ç‰ˆæœ¬åº“"><a href="#è¿œç¨‹ç‰ˆæœ¬åº“" class="headerlink" title="è¿œç¨‹ç‰ˆæœ¬åº“"></a>è¿œç¨‹ç‰ˆæœ¬åº“</h3><p><code>git remote add origin è¿œç¨‹gitåœ°å€</code> è¿æ¥<br><code>git push -u origin master</code> æŠŠæœ¬åœ°åº“åˆ†æ”¯masterå†…å®¹æ¨é€åˆ°è¿œç¨‹åº“ï¼ˆ-u å‘½ä»¤åœ¨ç¬¬ä¸€æ¬¡å…³è”æœ¬åœ°åº“å’Œè¿œç¨‹åº“æ—¶ä½¿ç”¨ï¼‰<br><code>git clone url</code> å…‹éš†è¿œç¨‹(url)åº“</p><h3 id="gitåˆ†æ”¯æ“ä½œ"><a href="#gitåˆ†æ”¯æ“ä½œ" class="headerlink" title="gitåˆ†æ”¯æ“ä½œ"></a>gitåˆ†æ”¯æ“ä½œ</h3><p>é¦–å…ˆmasterä¸»åˆ†æ”¯åº”è¯¥æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸å…è®¸åœ¨ä¸Šé¢å¹²æ´»ï¼Œå¹²æ´»ä¸€èˆ¬æƒ…å†µä¸‹åœ¨æ–°å»ºçš„devåˆ†æ”¯ä¸Šå¹²æ´»ï¼Œå¹²å®Œåï¼Œæ¯”å¦‚ä¸Šè¦å‘å¸ƒï¼Œæˆ–è€…è¯´devåˆ†æ”¯ä»£ç ç¨³å®šåå¯ä»¥åˆå¹¶åˆ°ä¸»åˆ†æ”¯masterä¸Šæ¥ã€‚</p><p><code>git branch</code> æŸ¥çœ‹åˆ†æ”¯<br><code>git checkout</code> åˆ‡æ¢åˆ†æ”¯<br><code>git checkout -b</code>  åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯<br><code>git merge</code> åˆå¹¶åˆ°å½“å‰åˆ†æ”¯<br><code>git branch -d</code>åˆ é™¤æŸåˆ†æ”¯<br><code>git merge --no-ff -m &quot;æ³¨é‡Š&quot;</code>åˆ†æ”¯åˆå¹¶åˆ†æ”¯ç¦ç”¨fast forward<br><code>git stash</code> å°†å½“å‰åˆ†æ”¯çš„å·¥ä½œç°åœºä¿ç•™ä¸‹æ¥<br><code>git stash list</code> æŸ¥çœ‹å·¥ä½œç°åœº<br><code>git stash apply</code> æ¢å¤å†…å®¹ä½†æ˜¯ä½ éœ€è¦git stash dropåˆ é™¤stash<br><code>git stash pop</code> æ¢å¤çš„åŒæ—¶æŠŠstashå†…å®¹ä¹Ÿåˆ é™¤<br><code>git remote</code> æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯<br><code>git remote -v</code> æŸ¥çœ‹è¿œç¨‹åº“çš„è¯¦ç»†ä¿¡æ¯<br><code>git push origin master</code> masterä¸ºæœ¬åœ°çš„åˆ†æ”¯åæ¨é€åˆ†æ”¯<br><code>git checkout -b dev origin/dev</code> devä¸ºåˆ†æ”¯åï¼Œåšå®Œå¼€å‘å<br><code>git push origin dev</code> æ¨é€åˆ°è¿œç¨‹åº“<br><code>git pull</code> æŠ“å–æœ€æ–°çš„æäº¤,å¹¶å°è¯•è‡ªåŠ¨åˆå¹¶åˆ°æœ¬åœ°å½“å‰æ‰€åœ¨çš„åˆ†æ”¯<br><code>git fetch</code> æŠ“å–æœ€æ–°çš„æäº¤ï¼Œä¸ä¼šè‡ªåŠ¨åˆå¹¶ï¼Œå¿…é¡»æ‰‹åŠ¨ã€‚<br><code>git rebase</code> å˜åŸº,å°†æäº¤åˆ°æŸä¸€åˆ†æ”¯ä¸Šçš„æ‰€æœ‰ä¿®æ”¹éƒ½ç§»è‡³å¦ä¸€åˆ†æ”¯ä¸Š<br><code>git rebase --continue</code> <strong><em>ç»§ç»­å˜åŸºæ“ä½œï¼Œä¸€èˆ¬ç”¨äºç¬¬ä¸€æ¬¡å˜åŸºå¤±è´¥åï¼Œè§£å†³å†²çªæ–‡ä»¶ï¼Œå°†å†²çªæ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜åŒºï¼Œä¸è¦æäº¤ï¼Œç„¶åå†æ‰§è¡Œæ­¤å‘½ä»¤ã€‚å¦‚æœæäº¤äº†ï¼Œæ‰§è¡Œ<code>git rebase --skip</code>å‘½ä»¤å–æ¶ˆrebaseçŠ¶æ€ã€‚</em></strong><br><code>git branch --set-upstream dev origin/dev</code> æŒ‡å®šæœ¬åœ°devåˆ†æ”¯ï¼ˆå·²ç»åˆ›å»ºçš„ï¼‰ä¸è¿œç¨‹origin/devåˆ†æ”¯çš„è¿æ¥<br><code>git branch -u origin/dev</code> æŒ‡å®šå½“å‰æ‰€åœ¨è¿æ¥è¿œç¨‹origin/devåˆ†æ”¯çš„è¿æ¥<br><code>git checkout --track origin/dev</code> åˆ›å»ºæ–°çš„devåˆ†æ”¯ï¼Œåˆ¶å®šè¿œç¨‹è¿æ¥origin/dev</p><p>æ³¨ï¼šå¦‚æœé¡ºç€ä¸€ä¸ªåˆ†æ”¯èµ°ä¸‹å»èƒ½å¤Ÿåˆ°è¾¾å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆGitåœ¨åˆå¹¶ä¸¤è€…çš„æ—¶å€™ï¼Œåªä¼šç®€å•çš„å°†æŒ‡é’ˆå‘å‰æ¨è¿›ï¼ˆæŒ‡é’ˆå³ç§»ï¼‰ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹çš„åˆå¹¶æ“ä½œæ²¡æœ‰éœ€è¦è§£å†³çš„åˆ†æ­§â€”â€”è¿™å°±å«åš â€œå¿«è¿›ï¼ˆfast-forwardï¼‰â€ã€‚</p><h3 id="å¤šäººåä½œ"><a href="#å¤šäººåä½œ" class="headerlink" title="å¤šäººåä½œ"></a>å¤šäººåä½œ</h3><ol><li>æ¯å¼€å‘ä¸€ä¸ªæ–°ç‰¹æ€§å¯ä»¥æ–°å»ºä¸€ä¸ªæœ¬åœ°ç‰¹æ€§åˆ†æ”¯ï¼Œå¼€å‘å®Œæˆååˆå¹¶åˆ°æœ¬åœ°ä¸»çº¿ã€‚</li><li>å¦‚æœä¸ä½¿ç”¨ç‰¹æ€§åˆ†æ”¯å¼€å‘å¯ä»¥ä½¿ç”¨<code>git stash</code>ä¿å­˜å½“å‰çš„å·¥ä½œç©ºé—´ã€‚</li><li>è¿œç¨‹ä»£ç å’Œæœ¬åœ°ä»£ç åˆå¹¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œ<code>git pull</code>å’Œ<code>git fetch</code>ï¼Œ<code>git pull</code>å‘½ä»¤ä¼šè‡ªåŠ¨åˆå¹¶è¿œç¨‹ä»£ç ï¼Œå†²çªåéœ€è¦è§£å†³å†²çªåæäº¤ã€‚<code>git fetch</code>ä¸è‡ªåŠ¨å’Œæœ¬åœ°ä»£ç åˆå¹¶ï¼Œéœ€è¦æ‰‹åŠ¨mergeã€‚</li><li>åœ¨åˆå¹¶æ—¶ï¼Œæ ¹æ®é¡¹ç›®æƒ…å†µä½¿ç”¨<a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA" target="_blank" rel="noopener">å˜åŸº</a>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿œç¨‹åº“ä¸ä¿ç•™æœ¬åœ°æ“ä½œå†å²ã€‚</li><li><strong><em>ä½¿ç”¨å˜åŸºåŸåˆ™</em></strong>ï¼šåªå¯¹å°šæœªæ¨é€æˆ–åˆ†äº«ç»™åˆ«äººçš„æœ¬åœ°ä¿®æ”¹æ‰§è¡Œå˜åŸºæ“ä½œæ¸…ç†å†å²ï¼Œä»ä¸å¯¹å·²æ¨é€è‡³åˆ«å¤„çš„æäº¤æ‰§è¡Œå˜åŸºæ“ä½œï¼Œè¿™æ ·ï¼Œä½ æ‰èƒ½äº«å—åˆ°ä¸¤ç§æ–¹å¼å¸¦æ¥çš„ä¾¿åˆ©ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Git&quot;&gt;&lt;a href=&quot;#Git&quot; class=&quot;headerlink&quot; title=&quot;Git&quot;&gt;&lt;/a&gt;Git&lt;/h2&gt;&lt;p&gt;ç³»ç»Ÿç³»ç»Ÿæ€§çš„å­¦ä¹ Gitï¼Œè¯·ç§»æ­¥&lt;a href=&quot;https://git-scm.com/book/zh/v2/%E8%B5%B7%E
      
    
    </summary>
    
    
      <category term="Utils" scheme="http://zhongyp.me/tags/Utils/"/>
    
  </entry>
  
  <entry>
    <title>Spring AOP</title>
    <link href="http://zhongyp.me/2018/10/03/spring/2018-09-28-AOP/"/>
    <id>http://zhongyp.me/2018/10/03/spring/2018-09-28-AOP/</id>
    <published>2018-10-02T16:00:00.000Z</published>
    <updated>2018-11-30T11:39:42.672Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h2><p>æœ¬ç¯‡æ–‡ç« ç¿»è¯‘è‡ª<a href="https://www.tutorialspoint.com/spring/aop_with_spring.htm" target="_blank" rel="noopener">AOP with Spring</a>ï¼Œä¸»è¦ä»‹ç»æ˜¯å…³äºAOPçš„æ¦‚å¿µã€‚</p><h3 id="Brief-introduction-ï¼ˆç®€ä»‹ï¼‰"><a href="#Brief-introduction-ï¼ˆç®€ä»‹ï¼‰" class="headerlink" title="Brief introduction ï¼ˆç®€ä»‹ï¼‰"></a>Brief introduction ï¼ˆç®€ä»‹ï¼‰</h3><p>One of the key components of Spring Framework is the Aspect oriented programming (AOP) framework. Aspect-Oriented Programming entails breaking down program logic into distinct parts called so-called concerns. The functions that span multiple points of an application are called cross-cutting concerns and these cross-cutting concerns are conceptually separate from the applicationâ€™s business logic. There are various common good examples of aspects like logging, auditing, declarative transactions, security, caching, etc.</p><p>The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the aspect. Dependency Injection helps you decouple your application objects from each other and AOP helps you decouple cross-cutting concerns from the objects that they affect. AOP is like triggers in programming languages such as Perl, .NET, Java, and others.</p><p>Spring AOP module provides interceptors to intercept an application. For example, when a method is executed, you can add extra functionality before or after the method execution.</p><p>ç¿»è¯‘ï¼š</p><p>AOPé¢å‘åˆ‡é¢ç¼–ç¨‹æ˜¯Springæ¡†æ¶ä¸­çš„æœ€å…³é”®çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚é¢å‘åˆ‡é¢ç¼–ç¨‹éœ€è¦æ‹†åˆ†ç¨‹åºé€»è¾‘åˆ°è¢«ç§°ä¸ºå…³æ³¨ç‚¹çš„ä¸åŒéƒ¨åˆ†ã€‚ä¸€ä¸ªåœ¨åº”ç”¨ç¨‹åºå†…è·¨è¶Šå¤šä¸ªç‚¹çš„æ–¹æ³•è¢«ç§°ä¸ºæ¨ªåˆ‡ç‚¹ï¼Œè¿™äº›æ¨ªåˆ‡ç‚¹å’Œåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘åœ¨æ¦‚å¿µä¸Šæ˜¯åˆ†å¼€çš„ã€‚ç›®å‰å·²ç»æœ‰å¾ˆå¤šåº”ç”¨åˆ‡é¢çš„ä¾‹å­ï¼Œæ¯”å¦‚æ—¥å¿—ï¼Œå®¡è®¡ï¼Œå£°æ˜å¼äº‹åŠ¡ï¼Œå®‰å…¨ï¼Œç¼“å­˜ç­‰ã€‚</p><p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæ¨¡å—åŒ–çš„å…³é”®å•å…ƒæ˜¯ç±»ï¼Œä½†æ˜¯åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œæ¨¡å—åŒ–å•å…ƒæ˜¯åˆ‡é¢ã€‚ä¾èµ–æ³¨å…¥å¸®åŠ©ä½ å°†åº”ç”¨ä¸­çš„å¯¹è±¡ç›¸äº’è§£è€¦ï¼ŒAOPå¸®åŠ©ä½ å°†æ¨ªåˆ‡ç‚¹ä»å®ƒä»¬ä½œç”¨çš„å¯¹è±¡ä¸­è§£è€¦ã€‚AOPå°±åƒæ˜¯Perl,.NET,Javaæˆ–è€…å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„è§¦å‘å™¨ã€‚</p><p>Spring AOPæ¨¡å—æä¾›æ‹¦æˆªåº”ç”¨çš„æ‹¦æˆªå™¨ã€‚ä¸¾ä¸ªğŸŒ°ï¼Œä½ å¯ä»¥åœ¨ä½ è¿è¡Œçš„æ–¹æ³•ä¹‹å‰æˆ–è€…ä¹‹åæ·»åŠ é¢å¤–çš„åŠŸèƒ½æˆ–è€…æ–¹æ³•ã€‚</p><h3 id="AOP-Terminologiesï¼ˆAOP-æœ¯è¯­ï¼‰"><a href="#AOP-Terminologiesï¼ˆAOP-æœ¯è¯­ï¼‰" class="headerlink" title="AOP Terminologiesï¼ˆAOP æœ¯è¯­ï¼‰"></a>AOP Terminologiesï¼ˆAOP æœ¯è¯­ï¼‰</h3><h4 id="Aspectï¼ˆåˆ‡é¢ï¼‰"><a href="#Aspectï¼ˆåˆ‡é¢ï¼‰" class="headerlink" title="Aspectï¼ˆåˆ‡é¢ï¼‰"></a>Aspectï¼ˆåˆ‡é¢ï¼‰</h4><p>This is a module which has a set of APIs providing cross-cutting requirements. For example, a logging module would be called AOP aspect for logging. An application can have any number of aspects depending on the requirement.</p><p>ç¿»è¯‘ï¼š Aspectä¸€ä¸ªæä¾›æ¨ªåˆ‡ï¼ˆcross-cuttingï¼‰APIsçš„æ¨¡å—ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ—¥å¿—æ¨¡å—è¢«ç§°ä¸ºAOP æ—¥å¿—åˆ‡é¢ã€‚ä¸€ä¸ªåº”ç”¨å¯ä»¥æ ¹æ®éœ€æ±‚æ‹¥æœ‰ä»»ä½•æ•°é‡çš„åˆ‡é¢ã€‚</p><h4 id="Join-pointï¼ˆè¿æ¥ç‚¹ï¼‰"><a href="#Join-pointï¼ˆè¿æ¥ç‚¹ï¼‰" class="headerlink" title="Join pointï¼ˆè¿æ¥ç‚¹ï¼‰"></a>Join pointï¼ˆè¿æ¥ç‚¹ï¼‰</h4><p>This represents a point in your application where you can plug-in the AOP aspect. You can also say, it is the actual place in the application where an action will be taken using Spring AOP framework.</p><p>ç¿»è¯‘ï¼š åœ¨åº”ç”¨ä¸­å¯ä»¥æ’å…¥AOPåˆ‡é¢çš„åœ°æ–¹å¯è¢«æŠ½è±¡ä¸ºä¸€ä¸ªç‚¹ã€‚ä½ ä¹Ÿå¯ä»¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨åº”ç”¨ä¸­å­˜åœ¨çš„åœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹å°†è¢«Spring AOP æ¡†æ¶æ‰§è¡Œä¸€äº›åŠ¨ä½œã€‚</p><p>Adviceï¼ˆé€šçŸ¥ï¼‰</p><p>This is the actual action to be taken either before or after the method execution. This is an actual piece of code that is invoked during the program execution by Spring AOP framework.</p><p>ç¿»è¯‘ï¼šAdviceæ˜¯ä¸€ä¸ªå®é™…çš„åŠ¨ä½œï¼Œå®ƒå°†åœ¨æ–¹æ³•æ‰§è¡Œå‰å’Œæ–¹æ³•æ‰§è¡Œåæ‰§è¡Œã€‚è¿™æ®µä»£ç é€šè¿‡Spring AOPæ¡†æ¶åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«è°ƒç”¨ã€‚</p><h4 id="Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰"><a href="#Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰" class="headerlink" title="Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰"></a>Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰</h4><p>This is a set of one or more join points where an advice should be executed. You can specify pointcuts using expressions or patterns as we will see in our AOP examples.</p><p>ç¿»è¯‘ï¼šPointcutæ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿æ¥ç‚¹çš„é›†åˆã€‚æ­£å¦‚æˆ‘ä»¬å°†åœ¨AOPä¾‹å­ä¸­çœ‹åˆ°çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼åˆ¶å®šä½ çš„åˆ‡å…¥ç‚¹ã€‚</p><h4 id="Introductionï¼ˆå¼•å…¥ï¼‰"><a href="#Introductionï¼ˆå¼•å…¥ï¼‰" class="headerlink" title="Introductionï¼ˆå¼•å…¥ï¼‰"></a>Introductionï¼ˆå¼•å…¥ï¼‰</h4><p>An introduction allows you to add new methods or attributes to the existing classes.</p><p>ç¿»è¯‘ï¼šå¼•å…¥å¯ä»¥å…è®¸ä½ æ·»åŠ æ–°çš„æ–¹æ³•æˆ–è€…å±æ€§åˆ°å·²ç»å­˜åœ¨çš„ç±»ä¸­ã€‚</p><h4 id="Target-object"><a href="#Target-object" class="headerlink" title="Target object"></a>Target object</h4><p>The object being advised by one or more aspects. This object will always be a proxied object, also referred to as the advised object.</p><p>ç¿»è¯‘ï¼šè¿™ä¸ªå¯¹è±¡è¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ‡é¢é€šçŸ¥ã€‚è¿™ä¸ªå¯¹è±¡ä¸€èˆ¬æ˜¯ä»£ç†å¯¹è±¡ï¼Œä½œä¸ºè¢«é€šçŸ¥å¯¹è±¡å¼•ç”¨ã€‚</p><h4 id="Weavingï¼ˆç»‡å…¥ï¼‰"><a href="#Weavingï¼ˆç»‡å…¥ï¼‰" class="headerlink" title="Weavingï¼ˆç»‡å…¥ï¼‰"></a>Weavingï¼ˆç»‡å…¥ï¼‰</h4><p>Weaving is the process of linking aspects with other application types or objects to create an advised object. This can be done at compile time, load time, or at runtime.</p><p>ç¿»è¯‘ï¼šç»‡å…¥æ˜¯é“¾æ¥åˆ‡é¢å’Œå…¶ä»–åº”ç”¨ç±»å‹æˆ–è€…å¯¹è±¡æ¥åˆ›å»ºé€šçŸ¥å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨ç¼–è¯‘ã€åŠ è½½æˆ–è€…æ‰§è¡ŒæœŸé—´è¿›è¡Œã€‚</p><h3 id="Types-of-Advice"><a href="#Types-of-Advice" class="headerlink" title="Types of Advice"></a>Types of Advice</h3><p>Spring aspects can work with five kinds of advice mentioned as follows.<br>ç¿»è¯‘ï¼šSpring åˆ‡é¢å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æåˆ°çš„äº”ç§advice</p><ul><li><p>before: Run advice before a method execution.</p></li><li><p>after: Run advice after a method execution.</p></li><li><p>after-returning: Run advice after the a method execution only if method completes successfully.</p></li><li><p>after-throwing: Run advice after the method execution only if method exits by throwing an exception.</p></li><li><p>around: Run advice before and after the advised method is invoked.</p></li></ul><h3 id="Custom-Aspects-Implementation-è‡ªå®šä¹‰æ¥å£å®ç°"><a href="#Custom-Aspects-Implementation-è‡ªå®šä¹‰æ¥å£å®ç°" class="headerlink" title="Custom Aspects Implementation(è‡ªå®šä¹‰æ¥å£å®ç°)"></a>Custom Aspects Implementation(è‡ªå®šä¹‰æ¥å£å®ç°)</h3><p>XML Schema basedï¼ˆåŸºäºXMLæ¨¡å¼ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http:www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http:www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xmlns:aop=&quot;http:www.springframework.org/schema/aop&quot;</span><br><span class="line">       xmlns:tx=&quot;http:www.springframework.org/schema/tx&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http:www.springframework.org/schema/beans</span><br><span class="line">        http:www.springframework.org/schema/beans/spring-beans-4.2.xsd</span><br><span class="line">        http:www.springframework.org/schema/aop</span><br><span class="line">        http:www.springframework.org/schema/aop/spring-aop-4.2.xsd&quot;&gt;</span><br><span class="line">    &lt;!-- ä¸šåŠ¡é€»è¾‘ç±»--AOPè¿æ¥ç‚¹ --&gt;</span><br><span class="line">    &lt;bean id=&quot;aopTest&quot; class=&quot;com.zhongyp.zen.service.aop.AOPTestService&quot; /&gt;</span><br><span class="line">    &lt;!--AOPåˆ‡é¢--&gt;</span><br><span class="line">    &lt;bean id=&quot;timeHandler&quot; class=&quot;com.zhongyp.zen.service.handler.TimeHandler&quot; /&gt;</span><br><span class="line">    &lt;!--AOPåˆ‡é¢--&gt;</span><br><span class="line">    &lt;bean id=&quot;printHandler&quot; class=&quot;com.zhongyp.zen.service.handler.PrintHandler&quot;&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;aop:aspectj-autoproxy /&gt;</span><br><span class="line">    &lt;aop:config&gt;</span><br><span class="line">        &lt;!-- pointcutåˆ‡å…¥ç‚¹ï¼ˆAOPè¿æ¥ç‚¹çš„é›†åˆï¼‰--&gt;</span><br><span class="line">        &lt;aop:pointcut id=&quot;pointcut&quot; expression=&quot;execution(* com.zhongyp.zen.service.*.*.*(..))&quot; /&gt;</span><br><span class="line">        &lt;!-- åˆ‡é¢ --&gt;</span><br><span class="line">        &lt;aop:aspect id=&quot;time&quot; ref=&quot;timeHandler&quot;&gt;</span><br><span class="line">            &lt;!-- AOP Advice --&gt;</span><br><span class="line">            &lt;aop:before method=&quot;printStartTime&quot; pointcut-ref=&quot;pointcut&quot; /&gt;</span><br><span class="line">            &lt;aop:after method=&quot;printEndTime&quot; pointcut-ref=&quot;pointcut&quot; /&gt;</span><br><span class="line">        &lt;/aop:aspect&gt;</span><br><span class="line">        &lt;aop:aspect id=&quot;print&quot; ref=&quot;printHandler&quot;&gt;</span><br><span class="line">            &lt;aop:after-returning method=&quot;printString&quot; pointcut-ref=&quot;pointcut&quot;&gt;&lt;/aop:after-returning&gt;</span><br><span class="line">        &lt;/aop:aspect&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>@AspectJ basedï¼ˆåŸºäºåˆ‡é¢æ³¨è§£ï¼‰</p><p>æ³¨è§£æ–¹å¼å¯ä»¥å°†ä¸Šè¿°xmlé…ç½®ä»¥æ³¨è§£çš„å½¢å¼é…ç½®ä¸€ä¸‹ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ç»™å‡ºä¸€ä¸ªæ ·ä¾‹ï¼Œå…¶ä»–çš„è¿˜éœ€è¯»è€…è‡ªå·±å®è·µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component(&quot;logHandler&quot;)</span><br><span class="line">public class LogHandler &#123;</span><br><span class="line">    @Pointcut(&quot;execution(* com.zhongyp.zen.service.*.*.*(..))&quot;)</span><br><span class="line">    private void hehe()&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    @Before(&quot;hehe()&quot;)</span><br><span class="line">    public void doBefore()&#123;</span><br><span class="line">        System.out.println(&quot;ä¸ºæ¯›å›½åº†è¦åŠ ç­ï¼ï¼ï¼ï¼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Spring-AOP&quot;&gt;&lt;a href=&quot;#Spring-AOP&quot; class=&quot;headerlink&quot; title=&quot;Spring AOP&quot;&gt;&lt;/a&gt;Spring AOP&lt;/h2&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« ç¿»è¯‘è‡ª&lt;a href=&quot;https://www.tutorialsp
      
    
    </summary>
    
    
      <category term="Spring" scheme="http://zhongyp.me/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>SQLä¼˜åŒ–</title>
    <link href="http://zhongyp.me/2018/04/02/mysql/2018-04-02-SQL/"/>
    <id>http://zhongyp.me/2018/04/02/mysql/2018-04-02-SQL/</id>
    <published>2018-04-01T16:00:00.000Z</published>
    <updated>2018-10-02T01:27:53.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¸¸ç”¨SQLæŠ€å·§"><a href="#å¸¸ç”¨SQLæŠ€å·§" class="headerlink" title="å¸¸ç”¨SQLæŠ€å·§"></a>å¸¸ç”¨SQLæŠ€å·§</h2><h3 id="1-1-æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ"><a href="#1-1-æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ" class="headerlink" title="1.1 æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ"></a>1.1 æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ</h3><p><code>select max(test_score),min(test_score) from student</code></p><h3 id="1-2-å·§ç”¨rand-rand-n-æå–éšæœºè¡Œ"><a href="#1-2-å·§ç”¨rand-rand-n-æå–éšæœºè¡Œ" class="headerlink" title="1.2 å·§ç”¨rand()/rand(n)æå–éšæœºè¡Œ"></a>1.2 å·§ç”¨rand()/rand(n)æå–éšæœºè¡Œ</h3><p><code>select * from table order by rand()</code></p><h3 id="1-3-group-byçš„with-rollupå­å¥åšç»Ÿè®¡"><a href="#1-3-group-byçš„with-rollupå­å¥åšç»Ÿè®¡" class="headerlink" title="1.3 group byçš„with rollupå­å¥åšç»Ÿè®¡"></a>1.3 group byçš„with rollupå­å¥åšç»Ÿè®¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">create table sales(</span><br><span class="line"></span><br><span class="line">year int not null,</span><br><span class="line">country varchar(20) not null,</span><br><span class="line">product varchar(32) not null,</span><br><span class="line">profit int</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into sales values(2004,&apos;china&apos;,&apos;tnt2004&apos;,2001);</span><br><span class="line">insert into sales values(2004,&apos;china&apos;,&apos;tnt2004&apos;,2002);</span><br><span class="line">insert into sales values(2004,&apos;china&apos;,&apos;tnt2004&apos;,2003);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2004);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2005);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2006);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2007);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2008);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2009);</span><br><span class="line">insert into sales values(2006,&apos;china&apos;,&apos;tnt2006&apos;,2010);</span><br><span class="line">insert into sales values(2006,&apos;china&apos;,&apos;tnt2006&apos;,2011);</span><br><span class="line">insert into sales values(2006,&apos;china&apos;,&apos;tnt2006&apos;,2012);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select year,sum(profit) from sales group by year;</span><br><span class="line"></span><br><span class="line">select year,sum(profit) from sales group by year with rollup;</span><br></pre></td></tr></table></figure><p>å½“ä½ ä½¿ç”¨ROLLUPæ—¶, ä½ ä¸èƒ½åŒæ—¶ä½¿ç”¨ORDER BYå­å¥è¿›è¡Œç»“æœæ’åºã€‚æ¢è¨€ä¹‹ï¼Œ ROLLUPå’ŒORDER BY æ˜¯äº’ç›¸æ’æ–¥çš„LIMIT ç”¨åœ¨ROLLUP åé¢ã€‚</p><h3 id="1-4-bit-group-functionsåšç»Ÿè®¡"><a href="#1-4-bit-group-functionsåšç»Ÿè®¡" class="headerlink" title="1.4 bit group functionsåšç»Ÿè®¡"></a>1.4 bit group functionsåšç»Ÿè®¡</h3><p>bit_count:ç”¨æ¥è®¡ç®—äºŒè¿›åˆ¶æ•°ä¸­åŒ…å«1çš„ä¸ªæ•°</p><p>bit_or:å°±æ˜¯å¯¹ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°è¿›è¡Œæˆ–è¿ç®—</p><p>bit_and:å°±æ˜¯å¯¹ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°è¿›è¡Œå¹¶è¿ç®—</p><h2 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h2><h3 id="é€šè¿‡show-statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚"><a href="#é€šè¿‡show-statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚" class="headerlink" title="é€šè¿‡show statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚"></a>é€šè¿‡show statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚</h3><p>é¦–å…ˆæˆ‘ä»¬äº†è§£mysqlæ•°æ®åº“çš„ä¸€äº›è¿è¡ŒçŠ¶æ€å¦‚ä½•æŸ¥è¯¢(æ¯”å¦‚æƒ³çŸ¥é“å½“å‰mysqlè¿è¡Œçš„æ—¶é—´/ä¸€å…±æ‰§è¡Œäº†å¤šå°‘æ¬¡select/update/delete.. / å½“å‰è¿æ¥)</p><p>show status</p><p>å¸¸ç”¨çš„:</p><p>show status like â€˜uptimeâ€™ ; </p><p>show stauts like â€˜com_selectâ€™  show status like â€˜com_insertâ€™ â€¦ç±»æ¨ update  delete</p><p>show sessionæˆ–global status like â€¦. å¦‚æœä½ ä¸å†™sessionæˆ–global,é»˜è®¤æ˜¯session ä¼šè¯ï¼ŒæŒ‡å–å‡ºå½“å‰çª—å£çš„æ‰§è¡Œï¼Œå¦‚æœä½ æƒ³çœ‹æ‰€æœ‰session,ä»mysql å¯åŠ¨åˆ°ç°åœ¨ï¼Œåˆ™åº”è¯¥ globalã€‚</p><p>show status like â€˜connectionsâ€™; </p><p>//æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ¬¡æ•°</p><p>show status like â€˜slow_queriesâ€™;</p><p>ä»¥ä¸‹å‡ ä¸ªå‚æ•°å¯¹Myisam å’ŒInnodb å­˜å‚¨å¼•æ“éƒ½è®¡æ•°ï¼š</p><ol><li><p>Com_select æ‰§è¡Œselect æ“ä½œçš„æ¬¡æ•°ï¼Œä¸€æ¬¡æŸ¥è¯¢åªç´¯åŠ 1ï¼›</p></li><li><p>Com_insert æ‰§è¡Œinsert æ“ä½œçš„æ¬¡æ•°ï¼Œå¯¹äºæ‰¹é‡æ’å…¥çš„insert æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ï¼›</p></li><li><p>Com_update æ‰§è¡Œupdate æ“ä½œçš„æ¬¡æ•°ï¼›</p></li><li><p>Com_delete æ‰§è¡Œdelete æ“ä½œçš„æ¬¡æ•°ï¼›</p></li></ol><p>ä»¥ä¸‹å‡ ä¸ªå‚æ•°æ˜¯é’ˆå¯¹Innodb å­˜å‚¨å¼•æ“è®¡æ•°çš„ï¼Œç´¯åŠ çš„ç®—æ³•ä¹Ÿç•¥æœ‰ä¸åŒï¼š</p><ol><li><p>Innodb_rows_read select æŸ¥è¯¢è¿”å›çš„è¡Œæ•°ï¼›</p></li><li><p>Innodb_rows_inserted æ‰§è¡ŒInsert æ“ä½œæ’å…¥çš„è¡Œæ•°ï¼›</p></li><li><p>Innodb_rows_updated æ‰§è¡Œupdate æ“ä½œæ›´æ–°çš„è¡Œæ•°ï¼›</p></li><li><p>Innodb_rows_deleted æ‰§è¡Œdelete æ“ä½œåˆ é™¤çš„è¡Œæ•°ï¼›</p></li></ol><p>å¯¹äºäº‹åŠ¡å‹çš„åº”ç”¨ï¼Œé€šè¿‡Com_commit å’ŒCom_rollback å¯ä»¥äº†è§£äº‹åŠ¡æäº¤å’Œå›æ»šçš„æƒ…å†µï¼Œå¯¹äºå›æ»šæ“ä½œéå¸¸é¢‘ç¹çš„æ•°æ®åº“ï¼Œå¯èƒ½æ„å‘³ç€åº”ç”¨ç¼–å†™å­˜åœ¨é—®é¢˜ã€‚</p><p>æ­¤å¤–ï¼Œä»¥ä¸‹å‡ ä¸ªå‚æ•°ä¾¿äºæˆ‘ä»¬äº†è§£æ•°æ®åº“çš„åŸºæœ¬æƒ…å†µï¼š</p><ol><li><p>Connections è¯•å›¾è¿æ¥Mysql æœåŠ¡å™¨çš„æ¬¡æ•°</p></li><li><p>Uptime æœåŠ¡å™¨å·¥ä½œæ—¶é—´</p></li><li><p>Slow_queries æ…¢æŸ¥è¯¢çš„æ¬¡æ•°</p></li></ol><h3 id="å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL"><a href="#å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL" class="headerlink" title="å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL"></a>å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL</h3><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL è¯­å¥ï¼š</p><ol><li><p>å¯ä»¥é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—å®šä½é‚£äº›æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„sql è¯­å¥ï¼Œç”¨â€“log-slowqueries[=file_name]é€‰é¡¹å¯åŠ¨æ—¶ï¼Œmysqld å†™ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_time ç§’çš„SQLè¯­å¥çš„æ—¥å¿—æ–‡ä»¶ã€‚å¯ä»¥é“¾æ¥åˆ°ç®¡ç†ç»´æŠ¤ä¸­çš„ç›¸å…³ç« èŠ‚ã€‚</p></li><li><p>æ…¢æŸ¥è¯¢æ—¥å¿—åœ¨æŸ¥è¯¢ç»“æŸä»¥åæ‰çºªå½•ï¼Œæ‰€ä»¥åœ¨åº”ç”¨åæ˜ æ‰§è¡Œæ•ˆç‡å‡ºç°é—®é¢˜çš„æ—¶å€™æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶ä¸èƒ½å®šä½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨show processlist å‘½ä»¤æŸ¥çœ‹å½“å‰MySQL åœ¨è¿›è¡Œçš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„çŠ¶æ€ï¼Œæ˜¯å¦é”è¡¨ç­‰ç­‰ï¼Œå¯ä»¥å®æ—¶çš„æŸ¥çœ‹SQL æ‰§è¡Œæƒ…å†µï¼ŒåŒæ—¶å¯¹ä¸€äº›é”è¡¨æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚</p></li></ol><h3 id="é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’"><a href="#é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’" class="headerlink" title="é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’"></a>é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’</h3><h4 id="select-typeï¼š-select-ç±»å‹"><a href="#select-typeï¼š-select-ç±»å‹" class="headerlink" title="select_typeï¼š select ç±»å‹"></a>select_typeï¼š select ç±»å‹</h4><p>Aï¼šsimpleï¼šè¡¨ç¤ºä¸éœ€è¦unionæ“ä½œæˆ–è€…ä¸åŒ…å«å­æŸ¥è¯¢çš„ç®€å•selectæŸ¥è¯¢ã€‚æœ‰è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¤–å±‚çš„æŸ¥è¯¢ä¸ºsimpleï¼Œä¸”åªæœ‰ä¸€ä¸ª</p><p>Bï¼šprimaryï¼šä¸€ä¸ªéœ€è¦unionæ“ä½œæˆ–è€…å«æœ‰å­æŸ¥è¯¢çš„selectï¼Œä½äºæœ€å¤–å±‚çš„å•ä½æŸ¥è¯¢çš„select_typeå³ä¸ºprimaryã€‚ä¸”åªæœ‰ä¸€ä¸ª</p><p>Cï¼šunionï¼šunionè¿æ¥çš„ä¸¤ä¸ªselectæŸ¥è¯¢ï¼Œç¬¬ä¸€ä¸ªæŸ¥è¯¢æ˜¯derviedæ´¾ç”Ÿè¡¨ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªè¡¨å¤–ï¼Œç¬¬äºŒä¸ªä»¥åçš„è¡¨select_typeéƒ½æ˜¯union</p><p>Dï¼šdependent unionï¼šä¸unionä¸€æ ·ï¼Œå‡ºç°åœ¨union æˆ–union allè¯­å¥ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæŸ¥è¯¢è¦å—åˆ°å¤–éƒ¨æŸ¥è¯¢çš„å½±å“</p><p>Eï¼šunion resultï¼šåŒ…å«unionçš„ç»“æœé›†ï¼Œåœ¨unionå’Œunion allè¯­å¥ä¸­,å› ä¸ºå®ƒä¸éœ€è¦å‚ä¸æŸ¥è¯¢ï¼Œæ‰€ä»¥idå­—æ®µä¸ºnull</p><p>Fï¼šsubqueryï¼šé™¤äº†fromå­—å¥ä¸­åŒ…å«çš„å­æŸ¥è¯¢å¤–ï¼Œå…¶ä»–åœ°æ–¹å‡ºç°çš„å­æŸ¥è¯¢éƒ½å¯èƒ½æ˜¯subquery</p><p>Gï¼šdependent subqueryï¼šä¸dependent unionç±»ä¼¼ï¼Œè¡¨ç¤ºè¿™ä¸ªsubqueryçš„æŸ¥è¯¢è¦å—åˆ°å¤–éƒ¨è¡¨æŸ¥è¯¢çš„å½±å“</p><p>Hï¼šderivedï¼šfromå­—å¥ä¸­å‡ºç°çš„å­æŸ¥è¯¢ï¼Œä¹Ÿå«åšæ´¾ç”Ÿè¡¨ï¼Œå…¶ä»–æ•°æ®åº“ä¸­å¯èƒ½å«åšå†…è”è§†å›¾æˆ–åµŒå¥—select</p><h4 id="tableï¼š-è¾“å‡ºç»“æœé›†çš„è¡¨"><a href="#tableï¼š-è¾“å‡ºç»“æœé›†çš„è¡¨" class="headerlink" title="tableï¼š è¾“å‡ºç»“æœé›†çš„è¡¨"></a>tableï¼š è¾“å‡ºç»“æœé›†çš„è¡¨</h4><p>æ˜¾ç¤ºçš„æŸ¥è¯¢è¡¨åï¼Œå¦‚æœæŸ¥è¯¢ä½¿ç”¨äº†åˆ«åï¼Œé‚£ä¹ˆè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯åˆ«åï¼Œå¦‚æœä¸æ¶‰åŠå¯¹æ•°æ®è¡¨çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™æ˜¾ç¤ºä¸ºnullï¼Œå¦‚æœæ˜¾ç¤ºä¸ºå°–æ‹¬å·æ‹¬èµ·æ¥çš„<derived n="">å°±è¡¨ç¤ºè¿™ä¸ªæ˜¯ä¸´æ—¶è¡¨ï¼Œåè¾¹çš„Nå°±æ˜¯æ‰§è¡Œè®¡åˆ’ä¸­çš„idï¼Œè¡¨ç¤ºç»“æœæ¥è‡ªäºè¿™ä¸ªæŸ¥è¯¢äº§ç”Ÿã€‚å¦‚æœæ˜¯å°–æ‹¬å·æ‹¬èµ·æ¥çš„<union m,n="">ï¼Œä¸<derived n="">ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œè¡¨ç¤ºè¿™ä¸ªç»“æœæ¥è‡ªäºunionæŸ¥è¯¢çš„idä¸ºM,Nçš„ç»“æœé›†ã€‚</derived></union></derived></p><h4 id="typeï¼š-è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹"><a href="#typeï¼š-è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹" class="headerlink" title="typeï¼š è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹"></a>typeï¼š è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹</h4><p>å½“è¡¨ä¸­ä»…æœ‰ä¸€è¡Œæ˜¯typeçš„å€¼ä¸ºsystemæ˜¯æœ€ä½³çš„è¿æ¥ç±»å‹ï¼›</p><p>å½“selectæ“ä½œä¸­ä½¿ç”¨ç´¢å¼•è¿›è¡Œè¡¨è¿æ¥æ—¶typeçš„å€¼ä¸ºrefï¼›</p><p>å½“selectçš„è¡¨è¿æ¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œç»å¸¸ä¼šçœ‹åˆ°typeçš„å€¼ä¸ºALLï¼Œè¡¨ç¤ºå¯¹è¯¥è¡¨è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘é€šè¿‡åˆ›å»ºç´¢å¼•æ¥æé«˜è¡¨è¿æ¥çš„æ•ˆç‡ã€‚</p><p>ä¾æ¬¡ä»å¥½åˆ°å·®ï¼šsystemï¼Œconstï¼Œeq_refï¼Œrefï¼Œfulltextï¼Œref_or_nullï¼Œunique_subqueryï¼Œindex_subqueryï¼Œrangeï¼Œindex_mergeï¼Œindexï¼ŒALLï¼Œé™¤äº†allä¹‹å¤–ï¼Œå…¶ä»–çš„typeéƒ½å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œé™¤äº†index_mergeä¹‹å¤–ï¼Œå…¶ä»–çš„typeåªå¯ä»¥ç”¨åˆ°ä¸€ä¸ªç´¢å¼•</p><p>Aï¼šsystemï¼šè¡¨ä¸­åªæœ‰ä¸€è¡Œæ•°æ®æˆ–è€…æ˜¯ç©ºè¡¨ï¼Œä¸”åªèƒ½ç”¨äºmyisamå’Œmemoryè¡¨ã€‚å¦‚æœæ˜¯Innodbå¼•æ“è¡¨ï¼Œtypeåˆ—åœ¨è¿™ä¸ªæƒ…å†µé€šå¸¸éƒ½æ˜¯allæˆ–è€…index</p><p>Bï¼šconstï¼šä½¿ç”¨å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ï¼Œè¿”å›è®°å½•ä¸€å®šæ˜¯1è¡Œè®°å½•çš„ç­‰å€¼whereæ¡ä»¶æ—¶ï¼Œé€šå¸¸typeæ˜¯constã€‚å…¶ä»–æ•°æ®åº“ä¹Ÿå«åšå”¯ä¸€ç´¢å¼•æ‰«æ</p><p>Cï¼šeq_refï¼šå‡ºç°åœ¨è¦è¿æ¥è¿‡ä¸ªè¡¨çš„æŸ¥è¯¢è®¡åˆ’ä¸­ï¼Œé©±åŠ¨è¡¨åªè¿”å›ä¸€è¡Œæ•°æ®ï¼Œä¸”è¿™è¡Œæ•°æ®æ˜¯ç¬¬äºŒä¸ªè¡¨çš„ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼Œä¸”å¿…é¡»ä¸ºnot nullï¼Œå”¯ä¸€ç´¢å¼•å’Œä¸»é”®æ˜¯å¤šåˆ—æ—¶ï¼Œåªæœ‰æ‰€æœ‰çš„åˆ—éƒ½ç”¨ä½œæ¯”è¾ƒæ—¶æ‰ä¼šå‡ºç°eq_ref</p><p>Dï¼šrefï¼šä¸åƒeq_refé‚£æ ·è¦æ±‚è¿æ¥é¡ºåºï¼Œä¹Ÿæ²¡æœ‰ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•çš„è¦æ±‚ï¼Œåªè¦ä½¿ç”¨ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ—¶å°±å¯èƒ½å‡ºç°ï¼Œå¸¸è§ä¸è¾…åŠ©ç´¢å¼•çš„ç­‰å€¼æŸ¥æ‰¾ã€‚æˆ–è€…å¤šåˆ—ä¸»é”®ã€å”¯ä¸€ç´¢å¼•ä¸­ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªåˆ—ä¹‹å¤–çš„åˆ—ä½œä¸ºç­‰å€¼æŸ¥æ‰¾ä¹Ÿä¼šå‡ºç°ï¼Œæ€»ä¹‹ï¼Œè¿”å›æ•°æ®ä¸å”¯ä¸€çš„ç­‰å€¼æŸ¥æ‰¾å°±å¯èƒ½å‡ºç°ã€‚</p><p>Eï¼šfulltextï¼šå…¨æ–‡ç´¢å¼•æ£€ç´¢ï¼Œè¦æ³¨æ„ï¼Œå…¨æ–‡ç´¢å¼•çš„ä¼˜å…ˆçº§å¾ˆé«˜ï¼Œè‹¥å…¨æ–‡ç´¢å¼•å’Œæ™®é€šç´¢å¼•åŒæ—¶å­˜åœ¨æ—¶ï¼Œmysqlä¸ç®¡ä»£ä»·ï¼Œä¼˜å…ˆé€‰æ‹©ä½¿ç”¨å…¨æ–‡ç´¢å¼•</p><p>Fï¼šref_or_nullï¼šä¸refæ–¹æ³•ç±»ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†nullå€¼çš„æ¯”è¾ƒã€‚å®é™…ç”¨çš„ä¸å¤šã€‚</p><p>Gï¼šunique_subqueryï¼šç”¨äºwhereä¸­çš„inå½¢å¼å­æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢è¿”å›ä¸é‡å¤å€¼å”¯ä¸€å€¼</p><p>Hï¼šindex_subqueryï¼šç”¨äºinå½¢å¼å­æŸ¥è¯¢ä½¿ç”¨åˆ°äº†è¾…åŠ©ç´¢å¼•æˆ–è€…inå¸¸æ•°åˆ—è¡¨ï¼Œå­æŸ¥è¯¢å¯èƒ½è¿”å›é‡å¤å€¼ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•å°†å­æŸ¥è¯¢å»é‡ã€‚</p><p>Iï¼šrangeï¼šç´¢å¼•èŒƒå›´æ‰«æï¼Œå¸¸è§äºä½¿ç”¨&gt;,&lt;,is null,between ,in ,likeç­‰è¿ç®—ç¬¦çš„æŸ¥è¯¢ä¸­ã€‚</p><p>Jï¼šindex_mergeï¼šè¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•ï¼Œæœ€åå–äº¤é›†æˆ–è€…å¹¶é›†ï¼Œå¸¸è§and ï¼Œorçš„æ¡ä»¶ä½¿ç”¨äº†ä¸åŒçš„ç´¢å¼•ï¼Œå®˜æ–¹æ’åºè¿™ä¸ªåœ¨ref_or_nullä¹‹åï¼Œä½†æ˜¯å®é™…ä¸Šç”±äºè¦è¯»å–æ‰€ä¸ªç´¢å¼•ï¼Œæ€§èƒ½å¯èƒ½å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸å¦‚range</p><p>Kï¼šindexï¼šç´¢å¼•å…¨è¡¨æ‰«æï¼ŒæŠŠç´¢å¼•ä»å¤´åˆ°å°¾æ‰«ä¸€éï¼Œå¸¸è§äºä½¿ç”¨ç´¢å¼•åˆ—å°±å¯ä»¥å¤„ç†ä¸éœ€è¦è¯»å–æ•°æ®æ–‡ä»¶çš„æŸ¥è¯¢ã€å¯ä»¥ä½¿ç”¨ç´¢å¼•æ’åºæˆ–è€…åˆ†ç»„çš„æŸ¥è¯¢ã€‚</p><p>Lï¼šallï¼šè¿™ä¸ªå°±æ˜¯å…¨è¡¨æ‰«ææ•°æ®æ–‡ä»¶ï¼Œç„¶åå†åœ¨serverå±‚è¿›è¡Œè¿‡æ»¤è¿”å›ç¬¦åˆè¦æ±‚çš„è®°å½•ã€‚</p><h4 id="possible-keysï¼š-è¡¨ç¤ºæŸ¥è¯¢æ—¶-å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—"><a href="#possible-keysï¼š-è¡¨ç¤ºæŸ¥è¯¢æ—¶-å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—" class="headerlink" title="possible_keysï¼š è¡¨ç¤ºæŸ¥è¯¢æ—¶,å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—."></a>possible_keysï¼š è¡¨ç¤ºæŸ¥è¯¢æ—¶,å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—.</h4><h4 id="keyï¼š-è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•"><a href="#keyï¼š-è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•" class="headerlink" title="keyï¼š è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•"></a>keyï¼š è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•</h4><h4 id="key-lenï¼š-ç´¢å¼•é•¿åº¦"><a href="#key-lenï¼š-ç´¢å¼•é•¿åº¦" class="headerlink" title="key_lenï¼š ç´¢å¼•é•¿åº¦"></a>key_lenï¼š ç´¢å¼•é•¿åº¦</h4><h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>å¦‚æœæ˜¯ä½¿ç”¨çš„å¸¸æ•°ç­‰å€¼æŸ¥è¯¢ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºconstï¼Œå¦‚æœæ˜¯è¿æ¥æŸ¥è¯¢ï¼Œè¢«é©±åŠ¨è¡¨çš„æ‰§è¡Œè®¡åˆ’è¿™é‡Œä¼šæ˜¾ç¤ºé©±åŠ¨è¡¨çš„å…³è”å­—æ®µï¼Œå¦‚æœæ˜¯æ¡ä»¶ä½¿ç”¨äº†è¡¨è¾¾å¼æˆ–è€…å‡½æ•°ï¼Œæˆ–è€…æ¡ä»¶åˆ—å‘ç”Ÿäº†å†…éƒ¨éšå¼è½¬æ¢ï¼Œè¿™é‡Œå¯èƒ½æ˜¾ç¤ºä¸ºfunc</p><h4 id="rowsï¼š-æ‰«æèŒƒå›´"><a href="#rowsï¼š-æ‰«æèŒƒå›´" class="headerlink" title="rowsï¼š æ‰«æèŒƒå›´"></a>rowsï¼š æ‰«æèŒƒå›´</h4><h4 id="Extraï¼š-æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°"><a href="#Extraï¼š-æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°" class="headerlink" title="Extraï¼š æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°"></a>Extraï¼š æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°</h4><p>Aï¼šdistinctï¼šåœ¨selectéƒ¨åˆ†ä½¿ç”¨äº†distincå…³é”®å­—</p><p>Bï¼šno tables usedï¼šä¸å¸¦fromå­—å¥çš„æŸ¥è¯¢æˆ–è€…From dualæŸ¥è¯¢</p><p>Cï¼šä½¿ç”¨not in()å½¢å¼å­æŸ¥è¯¢æˆ–not existsè¿ç®—ç¬¦çš„è¿æ¥æŸ¥è¯¢ï¼Œè¿™ç§å«åšåè¿æ¥ã€‚å³ï¼Œä¸€èˆ¬è¿æ¥æŸ¥è¯¢æ˜¯å…ˆæŸ¥è¯¢å†…è¡¨ï¼Œå†æŸ¥è¯¢å¤–è¡¨ï¼Œåè¿æ¥å°±æ˜¯å…ˆæŸ¥è¯¢å¤–è¡¨ï¼Œå†æŸ¥è¯¢å†…è¡¨ã€‚</p><p>Dï¼šusing filesortï¼šæ’åºæ—¶æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ä¸ªã€‚å¸¸è§äºorder byå’Œgroup byè¯­å¥ä¸­</p><p>Eï¼šusing indexï¼šæŸ¥è¯¢æ—¶ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›´æ¥é€šè¿‡ç´¢å¼•å°±å¯ä»¥è·å–æŸ¥è¯¢çš„æ•°æ®ã€‚</p><p>Fï¼šusing join bufferï¼ˆblock nested loopï¼‰ï¼Œusing join bufferï¼ˆbatched key accssï¼‰ï¼š5.6.xä¹‹åçš„ç‰ˆæœ¬ä¼˜åŒ–å…³è”æŸ¥è¯¢çš„BNLï¼ŒBKAç‰¹æ€§ã€‚ä¸»è¦æ˜¯å‡å°‘å†…è¡¨çš„å¾ªç¯æ•°é‡ä»¥åŠæ¯”è¾ƒé¡ºåºåœ°æ‰«ææŸ¥è¯¢ã€‚</p><p>Gï¼šusing sort_unionï¼Œusing_unionï¼Œusing intersectï¼Œusing sort_intersectionï¼š</p><p>using intersectï¼šè¡¨ç¤ºä½¿ç”¨andçš„å„ä¸ªç´¢å¼•çš„æ¡ä»¶æ—¶ï¼Œè¯¥ä¿¡æ¯è¡¨ç¤ºæ˜¯ä»å¤„ç†ç»“æœè·å–äº¤é›†</p><p>using unionï¼šè¡¨ç¤ºä½¿ç”¨orè¿æ¥å„ä¸ªä½¿ç”¨ç´¢å¼•çš„æ¡ä»¶æ—¶ï¼Œè¯¥ä¿¡æ¯è¡¨ç¤ºä»å¤„ç†ç»“æœè·å–å¹¶é›†</p><p>using sort_unionå’Œusing sort_intersectionï¼šä¸å‰é¢ä¸¤ä¸ªå¯¹åº”çš„ç±»ä¼¼ï¼Œåªæ˜¯ä»–ä»¬æ˜¯å‡ºç°åœ¨ç”¨andå’ŒoræŸ¥è¯¢ä¿¡æ¯é‡å¤§æ—¶ï¼Œå…ˆæŸ¥è¯¢ä¸»é”®ï¼Œç„¶åè¿›è¡Œæ’åºåˆå¹¶åï¼Œæ‰èƒ½è¯»å–è®°å½•å¹¶è¿”å›ã€‚</p><p>Hï¼šusing temporaryï¼šè¡¨ç¤ºä½¿ç”¨äº†ä¸´æ—¶è¡¨å­˜å‚¨ä¸­é—´ç»“æœã€‚ä¸´æ—¶è¡¨å¯ä»¥æ˜¯å†…å­˜ä¸´æ—¶è¡¨å’Œç£ç›˜ä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­çœ‹ä¸å‡ºæ¥ï¼Œéœ€è¦æŸ¥çœ‹statuså˜é‡ï¼Œused_tmp_tableï¼Œused_tmp_disk_tableæ‰èƒ½çœ‹å‡ºæ¥ã€‚</p><p>Iï¼šusing whereï¼šè¡¨ç¤ºå­˜å‚¨å¼•æ“è¿”å›çš„è®°å½•å¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œéœ€è¦åœ¨serverå±‚è¿›è¡Œè¿‡æ»¤ã€‚æŸ¥è¯¢æ¡ä»¶ä¸­åˆ†ä¸ºé™åˆ¶æ¡ä»¶å’Œæ£€æŸ¥æ¡ä»¶ï¼Œ5.6ä¹‹å‰ï¼Œå­˜å‚¨å¼•æ“åªèƒ½æ ¹æ®é™åˆ¶æ¡ä»¶æ‰«ææ•°æ®å¹¶è¿”å›ï¼Œç„¶åserverå±‚æ ¹æ®æ£€æŸ¥æ¡ä»¶è¿›è¡Œè¿‡æ»¤å†è¿”å›çœŸæ­£ç¬¦åˆæŸ¥è¯¢çš„æ•°æ®ã€‚5.6.xä¹‹åæ”¯æŒICPç‰¹æ€§ï¼Œå¯ä»¥æŠŠæ£€æŸ¥æ¡ä»¶ä¹Ÿä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚ï¼Œä¸ç¬¦åˆæ£€æŸ¥æ¡ä»¶å’Œé™åˆ¶æ¡ä»¶çš„æ•°æ®ï¼Œç›´æ¥ä¸è¯»å–ï¼Œè¿™æ ·å°±å¤§å¤§å‡å°‘äº†å­˜å‚¨å¼•æ“æ‰«æçš„è®°å½•æ•°é‡ã€‚extraåˆ—æ˜¾ç¤ºusing index condition</p><p>Jï¼šfirstmatch(tb_name)ï¼š5.6.xå¼€å§‹å¼•å…¥çš„ä¼˜åŒ–å­æŸ¥è¯¢çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œå¸¸è§äºwhereå­—å¥å«æœ‰in()ç±»å‹çš„å­æŸ¥è¯¢ã€‚å¦‚æœå†…è¡¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå°±å¯èƒ½å‡ºç°è¿™ä¸ª</p><p>Kï¼šloosescan(m..n)ï¼š5.6.xä¹‹åå¼•å…¥çš„ä¼˜åŒ–å­æŸ¥è¯¢çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œåœ¨in()ç±»å‹çš„å­æŸ¥è¯¢ä¸­ï¼Œå­æŸ¥è¯¢è¿”å›çš„å¯èƒ½æœ‰é‡å¤è®°å½•æ—¶ï¼Œå°±å¯èƒ½å‡ºç°è¿™ä¸ª</p><p>é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šæŸ¥è¯¢æ•°æ®å­—å…¸åº“ï¼Œæ‰§è¡Œè®¡åˆ’è¿‡ç¨‹ä¸­å°±å‘ç°ä¸å¯èƒ½å­˜åœ¨ç»“æœçš„ä¸€äº›æç¤ºä¿¡æ¯</p><h3 id="ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½"><a href="#ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½" class="headerlink" title="ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½"></a>ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½</h3><h3 id="ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»"><a href="#ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»" class="headerlink" title="ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»"></a>ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»</h3><p>myisam è¡¨çš„æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶æ˜¯è‡ªåŠ¨åˆ†å¼€çš„ï¼›innodb çš„æ•°æ®å’Œç´¢å¼•æ˜¯å­˜å‚¨åœ¨<br>åŒä¸€ä¸ªè¡¨ç©ºé—´é‡Œé¢ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶ç»„æˆã€‚<br>åˆ›å»ºç´¢å¼•è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE [UNIQUE|FULLTEXT|SPATIAL] INDEX index_name</span><br><span class="line">[USING index_type]</span><br><span class="line">ON tbl_name (index_col_name,...)</span><br><span class="line">index_col_name:</span><br><span class="line">col_name [(length)] [ASC | DESC]</span><br></pre></td></tr></table></figure><p>ç´¢å¼•çš„å­˜å‚¨ç±»å‹ç›®å‰åªæœ‰ä¸¤ç§ï¼ˆbtree å’Œhashï¼‰ï¼Œå…·ä½“å’Œè¡¨çš„æ¨¡å¼ç›¸å…³ï¼š</p><p>myisam btree</p><p>innodb btree</p><p>memory/heap hashï¼Œbtree</p><p>mysql ç›®å‰ä¸æ”¯æŒå‡½æ•°ç´¢å¼•ï¼Œåªèƒ½å¯¹åˆ—çš„å‰ä¸€éƒ¨åˆ†ï¼ˆlengthï¼‰è¿›è¡Œç´¢å¼•ï¼Œä¾‹ï¼š</p><p><code>create index ind_test on table1(name(5))</code></p><p>å¯¹äºchar å’Œvarchar åˆ—ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•å°†å¤§å¤§èŠ‚çœç©ºé—´ã€‚</p><h3 id="MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•"><a href="#MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•" class="headerlink" title="MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•"></a>MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•</h3><p>ç´¢å¼•ç”¨äºå¿«é€Ÿæ‰¾å‡ºåœ¨æŸä¸ªåˆ—ä¸­æœ‰ä¸€ç‰¹å®šå€¼çš„è¡Œã€‚å¯¹ç›¸å…³åˆ—ä½¿ç”¨ç´¢å¼•æ˜¯æé«˜SELECT æ“ä½œæ€§èƒ½çš„æœ€ä½³é€”å¾„ã€‚</p><p>æŸ¥è¯¢è¦ä½¿ç”¨ç´¢å¼•æœ€ä¸»è¦çš„æ¡ä»¶æ˜¯æŸ¥è¯¢æ¡ä»¶ä¸­éœ€è¦ä½¿ç”¨ç´¢å¼•å…³é”®å­—ï¼Œå¦‚æœæ˜¯å¤šåˆ—ç´¢å¼•ï¼Œé‚£ä¹ˆåªæœ‰æŸ¥è¯¢æ¡ä»¶ä½¿ç”¨äº†å¤šåˆ—å…³é”®å­—æœ€å·¦è¾¹çš„å‰ç¼€æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œå¦åˆ™å°†ä¸èƒ½ä½¿ç”¨ç´¢å¼•ã€‚</p><p>ä¸‹åˆ—æƒ…å†µä¸‹ï¼ŒMysql ä¸ä¼šä½¿ç”¨å·²æœ‰çš„ç´¢å¼•ï¼š</p><p>1.å¦‚æœmysql ä¼°è®¡ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ‰«ææ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ä¾‹å¦‚ï¼šå¦‚æœkey_part1å‡åŒ€åˆ†å¸ƒåœ¨1 å’Œ100 ä¹‹é—´ï¼Œä¸‹åˆ—æŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•å°±ä¸æ˜¯å¾ˆå¥½ï¼š</p><p><code>SELECT * FROM table_name where key_part1 &gt; 1 and key_part1 &lt; 90</code></p><p>2.å¦‚æœä½¿ç”¨heap è¡¨å¹¶ä¸”where æ¡ä»¶ä¸­ä¸ç”¨ï¼ç´¢å¼•åˆ—ï¼Œå…¶ä»–&gt; ã€&lt;ã€&gt;=ã€&lt;=å‡ä¸ä½¿ç”¨ç´¢å¼•ï¼›</p><p>3.å¦‚æœä¸æ˜¯ç´¢å¼•åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ï¼›</p><p>4.å¦‚æœlike æ˜¯ä»¥ï¼…å¼€å§‹ï¼›</p><p>5.å¯¹where åè¾¹æ¡ä»¶ä¸ºå­—ç¬¦ä¸²çš„ä¸€å®šè¦åŠ å¼•å·ï¼Œå­—ç¬¦ä¸²å¦‚æœä¸ºæ•°å­—mysql ä¼šè‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸ä½¿ç”¨ç´¢å¼•ã€‚</p><h3 id="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ</h3><p>å¦‚æœç´¢å¼•æ­£åœ¨å·¥ä½œï¼ŒHandler_read_key çš„å€¼å°†å¾ˆé«˜ï¼Œè¿™ä¸ªå€¼ä»£è¡¨äº†ä¸€ä¸ªè¡Œè¢«ç´¢å¼•å€¼è¯»çš„æ¬¡æ•°ï¼Œå¾ˆä½çš„å€¼è¡¨æ˜å¢åŠ ç´¢å¼•å¾—åˆ°çš„æ€§èƒ½æ”¹å–„ä¸é«˜ï¼Œå› ä¸ºç´¢å¼•å¹¶ä¸ç»å¸¸ä½¿ç”¨ã€‚</p><p>Handler_read_rnd_next çš„å€¼é«˜åˆ™æ„å‘³ç€æŸ¥è¯¢è¿è¡Œä½æ•ˆï¼Œå¹¶ä¸”åº”è¯¥å»ºç«‹ç´¢å¼•è¡¥æ•‘ã€‚è¿™ä¸ªå€¼çš„å«ä¹‰æ˜¯åœ¨æ•°æ®æ–‡ä»¶ä¸­è¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£è¿›è¡Œå¤§é‡çš„è¡¨æ‰«æï¼Œè¯¥å€¼è¾ƒé«˜ã€‚é€šå¸¸è¯´æ˜è¡¨ç´¢å¼•ä¸æ­£ç¡®æˆ–å†™å…¥çš„æŸ¥è¯¢æ²¡æœ‰åˆ©ç”¨ç´¢å¼•ã€‚</p><p><code>show status like &#39;Handler_read%&#39;;</code></p><h3 id="å®šæœŸåˆ†æè¡¨"><a href="#å®šæœŸåˆ†æè¡¨" class="headerlink" title="å®šæœŸåˆ†æè¡¨"></a>å®šæœŸåˆ†æè¡¨</h3><h4 id="ANALYZE-TABLE"><a href="#ANALYZE-TABLE" class="headerlink" title="ANALYZE TABLE"></a>ANALYZE TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</code></p><p>æœ¬è¯­å¥ç”¨äºåˆ†æå’Œå­˜å‚¨è¡¨çš„å…³é”®å­—åˆ†å¸ƒã€‚åœ¨åˆ†ææœŸé—´ï¼Œä½¿ç”¨ä¸€ä¸ªè¯»å–é”å®šå¯¹è¡¨è¿›è¡Œé”å®šã€‚è¿™å¯¹äºMyISAM, BDB å’ŒInnoDB è¡¨æœ‰ä½œç”¨ã€‚å¯¹äºMyISAM è¡¨ï¼Œæœ¬è¯­å¥ä¸ä½¿ç”¨myisamchk -a ç›¸å½“ã€‚</p><h4 id="CHECK-TABLE"><a href="#CHECK-TABLE" class="headerlink" title="CHECK TABLE"></a>CHECK TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>CHECK TABLE tbl_name [, tbl_name] ... [option] ...</code></p><p><code>option = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED}</code></p><p>æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨æ˜¯å¦æœ‰é”™è¯¯ã€‚CHECK TABLE å¯¹MyISAM å’ŒInnoDB è¡¨æœ‰ä½œç”¨ã€‚å¯¹äºMyISAM è¡¨ï¼Œå…³é”®å­—ç»Ÿè®¡æ•°æ®è¢«æ›´æ–°ã€‚</p><p>CHECK TABLE ä¹Ÿå¯ä»¥æ£€æŸ¥è§†å›¾æ˜¯å¦æœ‰é”™è¯¯ï¼Œæ¯”å¦‚åœ¨è§†å›¾å®šä¹‰ä¸­è¢«å¼•ç”¨çš„è¡¨å·²ä¸å­˜åœ¨ã€‚</p><h4 id="CHECKSUM-TABLE"><a href="#CHECKSUM-TABLE" class="headerlink" title="CHECKSUM TABLE"></a>CHECKSUM TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>CHECKSUM TABLE tbl_name [, tbl_name] ... [ QUICK | EXTENDED ]</code></p><p>æŠ¥å‘Šä¸€ä¸ªè¡¨æ ¡éªŒå’Œã€‚</p><h3 id="ä½¿ç”¨optimize-table"><a href="#ä½¿ç”¨optimize-table" class="headerlink" title="ä½¿ç”¨optimize table"></a>ä½¿ç”¨optimize table</h3><h4 id="OPTIMIZE-TABLE"><a href="#OPTIMIZE-TABLE" class="headerlink" title="OPTIMIZE TABLE"></a>OPTIMIZE TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</code></p><p>å¦‚æœå·²ç»åˆ é™¤äº†è¡¨çš„ä¸€å¤§éƒ¨åˆ†ï¼Œæˆ–è€…å¦‚æœæ‚¨å·²ç»å¯¹å«æœ‰å¯å˜é•¿åº¦è¡Œçš„è¡¨ï¼ˆå«æœ‰VARCHAR, BLOB æˆ–TEXT åˆ—çš„è¡¨ï¼‰è¿›è¡Œäº†å¾ˆå¤šæ›´æ”¹ï¼Œåˆ™åº”ä½¿ç”¨OPTIMIZE TABLEã€‚è¢«åˆ é™¤çš„è®°å½•è¢«ä¿æŒåœ¨é“¾æ¥æ¸…å•ä¸­ï¼Œåç»­çš„INSERT æ“ä½œä¼šé‡æ–°ä½¿ç”¨æ—§çš„è®°å½•ä½ç½®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨OPTIMIZE TABLE æ¥é‡æ–°åˆ©ç”¨æœªä½¿ç”¨çš„ç©ºé—´ï¼Œå¹¶æ•´ç†æ•°æ®æ–‡ä»¶çš„ç¢ç‰‡ã€‚</p><p>OPTIMIZE TABLE åªå¯¹MyISAM, BDB å’ŒInnoDB è¡¨èµ·ä½œç”¨ã€‚</p><h3 id="å¤§æ‰¹é‡æ’å…¥æ•°æ®"><a href="#å¤§æ‰¹é‡æ’å…¥æ•°æ®" class="headerlink" title="å¤§æ‰¹é‡æ’å…¥æ•°æ®"></a>å¤§æ‰¹é‡æ’å…¥æ•°æ®</h3><h4 id="å¯¹äºMyisam-ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚"><a href="#å¯¹äºMyisam-ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚" class="headerlink" title="å¯¹äºMyisam ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚"></a>å¯¹äºMyisam ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tblname DISABLE KEYS;</span><br><span class="line">loading the data</span><br><span class="line">ALTER TABLE tblname ENABLE KEYS;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå‘½ä»¤ç”¨æ¥æ‰“å¼€æˆ–è€…å…³é—­Myisam è¡¨éå”¯ä¸€ç´¢å¼•çš„æ›´æ–°ã€‚åœ¨å¯¼å…¥å¤§é‡çš„æ•°æ®åˆ°ä¸€ä¸ªéç©ºçš„Myisam è¡¨æ—¶ï¼Œé€šè¿‡è®¾ç½®è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚å¯¹äºå¯¼å…¥å¤§é‡æ•°æ®åˆ°ä¸€ä¸ªç©ºçš„Myisam è¡¨ï¼Œé»˜è®¤å°±æ˜¯å…ˆå¯¼å…¥æ•°æ®ç„¶åæ‰åˆ›å»ºç´¢å¼•çš„ï¼Œæ‰€ä»¥ä¸ç”¨è¿›è¡Œè®¾ç½®ã€‚</p><h4 id="è€Œå¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š"><a href="#è€Œå¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š" class="headerlink" title="è€Œå¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š"></a>è€Œå¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š</h4><p>a. å› ä¸ºInnodb ç±»å‹çš„è¡¨æ˜¯æŒ‰ç…§ä¸»é”®çš„é¡ºåºä¿å­˜çš„ï¼Œæ‰€ä»¥å°†å¯¼å…¥çš„æ•°æ®æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’åˆ—ï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¦‚æœInnodb è¡¨æ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªå†…éƒ¨åˆ—ä½œä¸ºä¸»é”®ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥ç»™è¡¨åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œå°†å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¼˜åŠ¿æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚</p><p>b. åœ¨å¯¼å…¥æ•°æ®å‰æ‰§è¡ŒSET UNIQUE_CHECKS=0ï¼Œå…³é—­å”¯ä¸€æ€§æ ¡éªŒï¼Œåœ¨å¯¼å…¥ç»“æŸåæ‰§è¡ŒSETUNIQUE_CHECKS=1ï¼Œæ¢å¤å”¯ä¸€æ€§æ ¡éªŒï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p><p>c. å¦‚æœåº”ç”¨ä½¿ç”¨è‡ªåŠ¨æäº¤çš„æ–¹å¼ï¼Œå»ºè®®åœ¨å¯¼å…¥å‰æ‰§è¡ŒSET AUTOCOMMIT=0ï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼Œå¯¼å…¥ç»“æŸåå†æ‰§è¡ŒSET AUTOCOMMIT=1ï¼Œæ‰“å¼€è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p><h3 id="ä¼˜åŒ–insertè¯­å¥"><a href="#ä¼˜åŒ–insertè¯­å¥" class="headerlink" title="ä¼˜åŒ–insertè¯­å¥"></a>ä¼˜åŒ–insertè¯­å¥</h3><p>å¦‚æœä½ åŒæ—¶ä»åŒä¸€å®¢æˆ·æ’å…¥å¾ˆå¤šè¡Œï¼Œä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„INSERT è¯­å¥ã€‚è¿™æ¯”ä½¿ç”¨åˆ†å¼€INSERT è¯­å¥å¿«(åœ¨ä¸€äº›æƒ…å†µä¸­å‡ å€)ã€‚</p><p><code>Insert into test values(1,2),(1,3),(1,4)â€¦</code></p><p>å¦‚æœä½ ä»ä¸åŒå®¢æˆ·æ’å…¥å¾ˆå¤šè¡Œï¼Œèƒ½é€šè¿‡ä½¿ç”¨INSERT DELAYED è¯­å¥å¾—åˆ°æ›´é«˜çš„é€Ÿåº¦ã€‚Delayed çš„å«ä¹‰æ˜¯è®©insert è¯­å¥é©¬ä¸Šæ‰§è¡Œï¼Œå…¶å®æ•°æ®éƒ½è¢«æ”¾åœ¨å†…å­˜çš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å†™å…¥ç£ç›˜ï¼›è¿™æ¯”æ¯æ¡è¯­å¥åˆ†åˆ«æ’å…¥è¦å¿«çš„å¤šï¼›LOW_PRIORITY åˆšå¥½ç›¸åï¼Œåœ¨æ‰€æœ‰å…¶ä»–ç”¨æˆ·å¯¹è¡¨çš„è¯»å†™å®Œåæ‰è¿›è¡Œæ’å…¥ã€‚</p><p><code>Insert delayed into test values(1,2),(1,3),(1,4)â€¦</code></p><p><code>Insert low_priority into test values(1,2),(1,3),(1,4)â€¦</code></p><p>å°†ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶åˆ†åœ¨ä¸åŒçš„ç£ç›˜ä¸Šå­˜æ”¾ï¼ˆåˆ©ç”¨å»ºè¡¨ä¸­çš„é€‰é¡¹ï¼‰ã€‚</p><p>å¦‚æœè¿›è¡Œæ‰¹é‡æ’å…¥ï¼Œå¯ä»¥å¢åŠ bulk_insert_buffer_size å˜é‡å€¼çš„æ–¹æ³•æ¥æé«˜é€Ÿåº¦ï¼Œä½†æ˜¯ï¼Œè¿™åªèƒ½å¯¹myisam è¡¨ä½¿ç”¨ã€‚</p><p>åœ¨my.cnfä¸­æ·»åŠ å¦‚ä¸‹è¯­å¥ï¼Œå°†insertè¯­å¥çš„é•¿åº¦è®¾ä¸ºæœ€å¤§ã€‚</p><p><code>Max_allowed_packet=1M</code></p><p><code>Net_buffer_length=2k</code></p><p>å½“ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶è£…è½½ä¸€ä¸ªè¡¨æ—¶ï¼Œä½¿ç”¨LOAD DATA INFILEã€‚è¿™é€šå¸¸æ¯”ä½¿ç”¨å¾ˆå¤šINSERT è¯­å¥å¿«20 å€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//æ•°æ®</span><br><span class="line"></span><br><span class="line">1669,Jim,Smith</span><br><span class="line">337,Mary,Jones</span><br><span class="line">2005,Linda,Black</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹è¯­å¥ï¼š</span><br><span class="line"></span><br><span class="line">load data infile &quot;/data/mysql/e.sql&quot; into table tablename fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure><p>æ ¹æ®åº”ç”¨æƒ…å†µä½¿ç”¨replace è¯­å¥ä»£æ›¿insertã€‚<code>replace low_priority into ta values(1,2);</code><br>replaceå…·å¤‡æ›¿æ¢æ‹¥æœ‰å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•é‡å¤æ•°æ®çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½¿ç”¨replaceintoæ’å…¥çš„æ•°æ®çš„å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•ä¸ä¹‹å‰çš„æ•°æ®æœ‰é‡å¤çš„æƒ…å†µï¼Œå°†ä¼šåˆ é™¤åŸå…ˆçš„æ•°æ®ï¼Œç„¶åå†è¿›è¡Œæ·»åŠ ã€‚</p><p>æ ¹æ®åº”ç”¨æƒ…å†µä½¿ç”¨ignore å…³é”®å­—å¿½ç•¥é‡å¤è®°å½•ã€‚<br><code>insert ignore into</code><br>å½“æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚å‡ºç°é”™è¯¯æ—¶ï¼Œå¦‚é‡å¤æ•°æ®ï¼Œå°†ä¸è¿”å›é”™è¯¯ï¼Œåªä»¥è­¦å‘Šå½¢å¼è¿”å›ã€‚æ‰€ä»¥ä½¿ç”¨ignoreè¯·ç¡®ä¿è¯­å¥æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œå¦åˆ™ä¹Ÿä¼šè¢«å¿½ç•¥æ‰ã€‚ä¾‹å¦‚ï¼š<code>INSERT IGNORE INTO books (name) VALUES (&#39;MySQL Manual&#39;)</code></p><h3 id="ä¼˜åŒ–group-byè¯­å¥"><a href="#ä¼˜åŒ–group-byè¯­å¥" class="headerlink" title="ä¼˜åŒ–group byè¯­å¥"></a>ä¼˜åŒ–group byè¯­å¥</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL æ’åºæ‰€æœ‰GROUP BY col1ï¼Œcol2ï¼Œâ€¦.ã€‚æŸ¥è¯¢çš„æ–¹æ³•å¦‚åŒåœ¨æŸ¥è¯¢ä¸­æŒ‡å®šORDER BY col1ï¼Œcol2ï¼Œâ€¦ã€‚å¦‚æœæ˜¾å¼åŒ…æ‹¬ä¸€ä¸ªåŒ…å«ç›¸åŒçš„åˆ—çš„ORDER BYå­å¥ï¼ŒMySQL å¯ä»¥æ¯«ä¸å‡é€Ÿåœ°å¯¹å®ƒè¿›è¡Œä¼˜åŒ–ï¼Œå°½ç®¡ä»ç„¶è¿›è¡Œæ’åºã€‚</p><p>å¦‚æœæŸ¥è¯¢åŒ…æ‹¬GROUP BY ä½†ä½ æƒ³è¦é¿å…æ’åºç»“æœçš„æ¶ˆè€—ï¼Œä½ å¯ä»¥æŒ‡å®šORDER BY NULLç¦æ­¢æ’åºã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">INSERT INTO foo</span><br><span class="line">SELECT a, COUNT(*) FROM bar GROUP BY a ORDER BY NULL;</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–order-byè¯­å¥"><a href="#ä¼˜åŒ–order-byè¯­å¥" class="headerlink" title="ä¼˜åŒ–order byè¯­å¥"></a>ä¼˜åŒ–order byè¯­å¥</h3><p>åœ¨æŸäº›æƒ…å†µä¸­ï¼ŒMySQL å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥æ»¡è¶³ORDER BY å­å¥ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„æ’åºã€‚where æ¡ä»¶å’Œorder by ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•ï¼Œå¹¶ä¸”order byçš„é¡ºåºå’Œç´¢å¼•é¡ºåºç›¸åŒï¼Œå¹¶ä¸”order byçš„å­—æ®µéƒ½æ˜¯å‡åºæˆ–è€…éƒ½æ˜¯é™åºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼šä¸‹åˆ—sql å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼š</span><br><span class="line">SELECT * FROM t1 ORDER BY key_part1,key_part2,... ;</span><br><span class="line">SELECT * FROM t1 WHERE key_part1=1 ORDER BY key_part1 DESC, key_part2</span><br><span class="line">DESC;</span><br><span class="line">SELECT * FROM t1 ORDER BY key_part1 DESC, key_part2 DESC;</span><br><span class="line">ä½†æ˜¯ä»¥ä¸‹æƒ…å†µä¸ä½¿ç”¨ç´¢å¼•ï¼š</span><br><span class="line">SELECT * FROM t1 ORDER BY key_part1 DESC, key_part2 ASC;</span><br><span class="line">--order by çš„å­—æ®µæ··åˆASC å’ŒDESC</span><br><span class="line">SELECT * FROM t1 WHERE key2=constant ORDER BY key1;</span><br><span class="line">--ç”¨äºæŸ¥è¯¢è¡Œçš„å…³é”®å­—ä¸ORDER BY ä¸­æ‰€ä½¿ç”¨çš„ä¸ç›¸åŒ</span><br><span class="line">SELECT * FROM t1 ORDER BY key1, key2;</span><br><span class="line">--å¯¹ä¸åŒçš„å…³é”®å­—ä½¿ç”¨ORDER BYã€‚</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–joinè¯­å¥"><a href="#ä¼˜åŒ–joinè¯­å¥" class="headerlink" title="ä¼˜åŒ–joinè¯­å¥"></a>ä¼˜åŒ–joinè¯­å¥</h3><p>Mysql4.1 å¼€å§‹æ”¯æŒSQL çš„å­æŸ¥è¯¢ã€‚è¿™ä¸ªæŠ€æœ¯å¯ä»¥ä½¿ç”¨SELECT è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„SQL æ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»ï¼Œå¹¶ä¸”å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢å¯ä»¥è¢«æ›´æœ‰æ•ˆç‡çš„è¿æ¥(JOIN)..æ›¿ä»£ã€‚</p><p>å‡è®¾æˆ‘ä»¬è¦å°†æ‰€æœ‰æ²¡æœ‰è®¢å•è®°å½•çš„ç”¨æˆ·å–å‡ºæ¥ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢å®Œæˆï¼š</p><p><code>SELECT * FROM customerinfo WHERE CustomerID NOT in (SELECT CustomerIDFROM salesinfo)</code></p><p>å¦‚æœä½¿ç”¨è¿æ¥(JOIN).. æ¥å®Œæˆè¿™ä¸ªæŸ¥è¯¢å·¥ä½œï¼Œé€Ÿåº¦å°†ä¼šå¿«å¾ˆå¤šã€‚å°¤å…¶æ˜¯å½“salesinfoè¡¨ä¸­å¯¹CustomerID å»ºæœ‰ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°†ä¼šæ›´å¥½ï¼ŒæŸ¥è¯¢å¦‚ä¸‹ï¼š</p><p><code>SELECT * FROM customerinfo LEFT JOIN salesinfoON customerinfo.CustomerID=salesinfo.CustomerID WHERE salesinfo.CustomerID IS NULL</code></p><p>è¿æ¥(JOIN).. ä¹‹æ‰€ä»¥æ›´æœ‰æ•ˆç‡ä¸€äº›ï¼Œæ˜¯å› ä¸ºMySQL ä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨æ¥å®Œæˆè¿™ä¸ªé€»è¾‘ä¸Šçš„éœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œã€‚</p><h3 id="mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶"><a href="#mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶" class="headerlink" title="mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶"></a>mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶</h3><p>å¯¹äºor å­å¥ï¼Œå¦‚æœè¦åˆ©ç”¨ç´¢å¼•ï¼Œåˆ™or ä¹‹é—´çš„æ¯ä¸ªæ¡ä»¶åˆ—éƒ½å¿…é¡»ç”¨åˆ°ç´¢å¼•ï¼›å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œåˆ™åº”è¯¥è€ƒè™‘å¢åŠ ç´¢å¼•ã€‚</p><h3 id="æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ"><a href="#æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ" class="headerlink" title="æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ"></a>æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ</h3><p>MySQL è¿˜å…è®¸æ”¹å˜è¯­å¥è°ƒåº¦çš„ä¼˜å…ˆçº§ï¼Œå®ƒå¯ä»¥ä½¿æ¥è‡ªå¤šä¸ªå®¢æˆ·ç«¯çš„æŸ¥è¯¢æ›´å¥½åœ°åä½œï¼Œè¿™æ ·å•ä¸ªå®¢æˆ·ç«¯å°±ä¸ä¼šç”±äºé”å®šè€Œç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚æ”¹å˜ä¼˜å…ˆçº§è¿˜å¯ä»¥ç¡®ä¿ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¢«å¤„ç†å¾—æ›´å¿«ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆåº”è¯¥ç¡®å®šåº”ç”¨çš„ç±»å‹ï¼Œåˆ¤æ–­åº”ç”¨æ˜¯ä»¥æŸ¥è¯¢ä¸ºä¸»è¿˜æ˜¯ä»¥æ›´æ–°ä¸ºä¸»çš„ï¼Œæ˜¯ç¡®ä¿æŸ¥è¯¢æ•ˆç‡è¿˜æ˜¯ç¡®ä¿æ›´æ–°çš„æ•ˆç‡ï¼Œå†³å®šæ˜¯æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æåˆ°çš„æ”¹å˜è°ƒåº¦ç­–ç•¥çš„æ–¹æ³•ä¸»è¦æ˜¯é’ˆå¯¹Myisam å­˜å‚¨å¼•æ“çš„ï¼Œå¯¹äºInnodb å­˜å‚¨å¼•æ“ï¼Œè¯­å¥çš„æ‰§è¡Œæ˜¯ç”±è·å¾—è¡Œé”çš„é¡ºåºå†³å®šçš„ã€‚</p><p>MySQL çš„é»˜è®¤çš„è°ƒåº¦ç­–ç•¥å¯ç”¨æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><p>å†™å…¥æ“ä½œä¼˜å…ˆäºè¯»å–æ“ä½œã€‚</p></li><li><p>å¯¹æŸå¼ æ•°æ®è¡¨çš„å†™å…¥æ“ä½œæŸä¸€æ—¶åˆ»åªèƒ½å‘ç”Ÿä¸€æ¬¡ï¼Œå†™å…¥è¯·æ±‚æŒ‰ç…§å®ƒä»¬åˆ°è¾¾çš„æ¬¡åºæ¥å¤„ç†ã€‚</p></li><li><p>å¯¹æŸå¼ æ•°æ®è¡¨çš„å¤šä¸ªè¯»å–æ“ä½œå¯ä»¥åŒæ—¶åœ°è¿›è¡Œã€‚</p></li></ol><p>MySQL æä¾›äº†å‡ ä¸ªè¯­å¥è°ƒèŠ‚ç¬¦ï¼Œå…è®¸ä½ ä¿®æ”¹å®ƒçš„è°ƒåº¦ç­–ç•¥ï¼š</p><ol><li><p>LOW_PRIORITYå…³é”®å­—åº”ç”¨äºDELETEã€INSERTã€LOAD DATAã€REPLACEå’ŒUPDATEã€‚</p></li><li><p>HIGH_PRIORITYå…³é”®å­—åº”ç”¨äºSELECTå’ŒINSERTè¯­å¥ã€‚</p></li><li><p>DELAYEDå…³é”®å­—åº”ç”¨äºINSERTå’ŒREPLACEè¯­å¥ã€‚</p></li></ol><p>å¦‚æœå†™å…¥æ“ä½œæ˜¯ä¸€ä¸ªLOW_PRIORITYï¼ˆä½ä¼˜å…ˆçº§ï¼‰è¯·æ±‚ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¸ä¼šè®¤ä¸ºå®ƒçš„ä¼˜å…ˆçº§é«˜äºè¯»å–æ“ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå†™å…¥è€…åœ¨ç­‰å¾…çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªè¯»å–è€…åˆ°è¾¾äº†ï¼Œé‚£ä¹ˆå°±å…è®¸ç¬¬äºŒä¸ªè¯»å–è€…æ’åˆ°å†™å…¥è€…ä¹‹å‰ã€‚åªæœ‰åœ¨æ²¡æœ‰å…¶å®ƒçš„è¯»å–è€…çš„æ—¶å€™ï¼Œæ‰å…è®¸å†™å…¥è€…å¼€å§‹æ“ä½œã€‚è¿™ç§è°ƒåº¦ä¿®æ”¹å¯èƒ½å­˜åœ¨LOW_PRIORITY å†™å…¥æ“ä½œæ°¸è¿œè¢«é˜»å¡çš„æƒ…å†µã€‚</p><p>SELECT æŸ¥è¯¢çš„HIGH_PRIORITYï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰å…³é”®å­—ä¹Ÿç±»ä¼¼ã€‚å®ƒå…è®¸SELECT æ’å…¥æ­£åœ¨ç­‰å¾…çš„å†™å…¥æ“ä½œä¹‹å‰ï¼Œå³ä½¿åœ¨æ­£å¸¸æƒ…å†µä¸‹å†™å…¥æ“ä½œçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚å¦å¤–ä¸€ç§å½±å“æ˜¯ï¼Œé«˜ä¼˜å…ˆçº§çš„SELECT åœ¨æ­£å¸¸çš„SELECT è¯­å¥ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºè¿™äº›è¯­å¥ä¼šè¢«å†™å…¥æ“ä½œé˜»å¡ã€‚</p><p>å¦‚æœä½ å¸Œæœ›æ‰€æœ‰æ”¯æŒLOW_PRIORITY é€‰é¡¹çš„è¯­å¥éƒ½é»˜è®¤åœ°æŒ‰ç…§ä½ä¼˜å…ˆçº§æ¥å¤„ç†ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨â€“low-priority-updates é€‰é¡¹æ¥å¯åŠ¨æœåŠ¡å™¨ã€‚é€šè¿‡ä½¿ç”¨INSERT HIGH_PRIORITY æ¥æŠŠINSERT è¯­å¥æé«˜åˆ°æ­£å¸¸çš„å†™å…¥ä¼˜å…ˆçº§ï¼Œå¯ä»¥æ¶ˆé™¤è¯¥é€‰é¡¹å¯¹å•ä¸ªINSERT è¯­å¥çš„å½±å“ã€‚</p><h3 id="ä½¿ç”¨SQLæç¤º"><a href="#ä½¿ç”¨SQLæç¤º" class="headerlink" title="ä½¿ç”¨SQLæç¤º"></a>ä½¿ç”¨SQLæç¤º</h3><p><code>SELECT SQL_BUFFER_RESULTS ...</code></p><p>å°†å¼ºåˆ¶MySQL ç”Ÿæˆä¸€ä¸ªä¸´æ—¶ç»“æœé›†ã€‚åªè¦æ‰€æœ‰ä¸´æ—¶ç»“æœé›†ç”Ÿæˆåï¼Œæ‰€æœ‰è¡¨ä¸Šçš„é”å®šå‡è¢«é‡Šæ”¾ã€‚è¿™èƒ½åœ¨é‡åˆ°è¡¨é”å®šé—®é¢˜æ—¶æˆ–è¦èŠ±å¾ˆé•¿æ—¶é—´å°†ç»“æœä¼ ç»™å®¢æˆ·ç«¯æ—¶æœ‰æ‰€å¸®åŠ©ã€‚</p><p>å½“å¤„ç†ä¸€ä¸ªä¼šè®©å®¢æˆ·ç«¯è€—è´¹ç‚¹æ—¶é—´æ‰èƒ½å¤„ç†çš„å¤§ç»“æœé›†æ—¶ï¼Œ å¯ä»¥è€ƒè™‘ä½¿ç”¨SQL_BUFFER_RESULT æç¤ºå­—ã€‚è¿™æ ·å¯ä»¥å‘Šè¯‰MySQL å°†ç»“æœé›†ä¿å­˜åœ¨ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å°½æ—©çš„é‡Šæ”¾å„ç§é”ã€‚</p><h4 id="USE-INDEX"><a href="#USE-INDEX" class="headerlink" title="USE INDEX"></a>USE INDEX</h4><p>åœ¨ä½ æŸ¥è¯¢è¯­å¥ä¸­è¡¨åçš„åé¢ï¼Œæ·»åŠ USE INDEX æ¥æä¾›ä½ å¸Œæœ›MySQ å»å‚è€ƒçš„ç´¢å¼•åˆ—è¡¨ï¼Œå°±å¯ä»¥è®©MySQL ä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ã€‚</p><p><code>Eg:SELECT * FROM mytable USE INDEX (mod_time, name) ...</code></p><h4 id="IGNORE-INDEX"><a href="#IGNORE-INDEX" class="headerlink" title="IGNORE INDEX"></a>IGNORE INDEX</h4><p>å¦‚æœä½ åªæ˜¯å•çº¯çš„æƒ³è®©MySQL å¿½ç•¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨IGNORE INDEX ä½œä¸ºHintã€‚</p><p><code>Eg:SELECT * FROM mytale IGNORE INDEX (priority) ...</code></p><h4 id="FORCE-INDEX"><a href="#FORCE-INDEX" class="headerlink" title="FORCE INDEX"></a>FORCE INDEX</h4><p>ä¸ºå¼ºåˆ¶MySQL ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ï¼Œå¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨FORCE INDEX ä½œä¸ºHintã€‚</p><p><code>Eg:SELECT * FROM mytable FORCE INDEX (mod_time) ...</code></p><h3 id="å…¶ä»–ä¼˜åŒ–æªæ–½"><a href="#å…¶ä»–ä¼˜åŒ–æªæ–½" class="headerlink" title="å…¶ä»–ä¼˜åŒ–æªæ–½"></a>å…¶ä»–ä¼˜åŒ–æªæ–½</h3><ol><li><p>ä½¿ç”¨æŒä¹…çš„è¿æ¥æ•°æ®åº“ä»¥é¿å…è¿æ¥å¼€é”€ã€‚</p></li><li><p>ç»å¸¸æ£€æŸ¥æ‰€æœ‰æŸ¥è¯¢ç¡®å®ä½¿ç”¨äº†å¿…è¦çš„ç´¢å¼•ã€‚</p></li><li><p>é¿å…åœ¨é¢‘ç¹æ›´æ–°çš„è¡¨ä¸Šæ‰§è¡Œå¤æ‚çš„SELECT æŸ¥è¯¢ï¼Œä»¥é¿å…ä¸é”å®šè¡¨æœ‰å…³çš„ç”±äºè¯»ã€å†™å†²çªå‘ç”Ÿçš„é—®é¢˜ã€‚</p></li><li><p>å¯¹äºæ²¡æœ‰åˆ é™¤çš„è¡Œæ“ä½œçš„MyISAM è¡¨ï¼Œæ’å…¥æ“ä½œå’ŒæŸ¥è¯¢æ“ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œå› ä¸ºæ²¡æœ‰åˆ é™¤æ“ä½œçš„è¡¨æŸ¥è¯¢æœŸé—´ä¸ä¼šé˜»å¡æ’å…¥æ“ä½œï¼å¯¹äºç¡®å®éœ€è¦æ‰§è¡Œåˆ é™¤æ“ä½œçš„è¡¨ï¼Œå°½é‡åœ¨ç©ºé—²æ—¶é—´è¿›è¡Œæ‰¹é‡åˆ é™¤æ“ä½œï¼Œé¿å…é˜»å¡å…¶ä»–æ“ä½œã€‚</p></li><li><p>å……åˆ†åˆ©ç”¨åˆ—æœ‰é»˜è®¤å€¼çš„äº‹å®ã€‚åªæœ‰å½“æ’å…¥çš„å€¼ä¸åŒäºé»˜è®¤å€¼æ—¶ï¼Œæ‰æ˜ç¡®åœ°æ’å…¥å€¼ã€‚è¿™å‡å°‘MySQL éœ€è¦åšçš„è¯­æ³•åˆ†æä»è€Œæé«˜æ’å…¥é€Ÿåº¦ã€‚</p></li><li><p>å¯¹ç»å¸¸è®¿é—®çš„å¯ä»¥é‡æ„çš„æ•°æ®ä½¿ç”¨å†…å­˜è¡¨ï¼Œå¯ä»¥æ˜¾è‘—æé«˜è®¿é—®çš„æ•ˆç‡ã€‚</p></li><li><p>é€šè¿‡å¤åˆ¶å¯ä»¥æé«˜æŸäº›æ“ä½œçš„æ€§èƒ½ã€‚å¯ä»¥åœ¨å¤åˆ¶æœåŠ¡å™¨ä¸­åˆ†å¸ƒå®¢æˆ·çš„æ£€ç´¢ä»¥å‡åˆ†è´Ÿè½½ã€‚ä¸ºäº†é˜²æ­¢å¤‡ä»½æœŸé—´å¯¹åº”ç”¨çš„å½±å“ï¼Œå¯ä»¥åœ¨å¤åˆ¶æœåŠ¡å™¨ä¸Šæ‰§è¡Œå¤‡ä»½æ“ä½œã€‚</p></li><li><p>è¡¨çš„å­—æ®µå°½é‡ä¸ä½¿ç”¨è‡ªå¢é•¿å˜é‡ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹è¯¥å­—æ®µçš„è‡ªå¢å¯èƒ½å¯¹æ•ˆç‡æœ‰æ¯”è¾ƒå¤§çš„å½±å“ï¼Œæ¨èé€šè¿‡åº”ç”¨æ¥å®ç°å­—æ®µçš„è‡ªå¢é•¿ã€‚</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å¸¸ç”¨SQLæŠ€å·§&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨SQLæŠ€å·§&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨SQLæŠ€å·§&quot;&gt;&lt;/a&gt;å¸¸ç”¨SQLæŠ€å·§&lt;/h2&gt;&lt;h3 id=&quot;1-1-æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ&quot;&gt;&lt;a href=&quot;#1-1-æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ&quot;
      
    
    </summary>
    
    
      <category term="MySQL" scheme="http://zhongyp.me/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>é«˜æ€§èƒ½MySQL -- æ‘˜è‡ªã€Šé«˜æ€§èƒ½MySQLç¬¬ä¸‰ç‰ˆã€‹</title>
    <link href="http://zhongyp.me/2018/04/02/mysql/2018-04-02-MySQL/"/>
    <id>http://zhongyp.me/2018/04/02/mysql/2018-04-02-MySQL/</id>
    <published>2018-04-01T16:00:00.000Z</published>
    <updated>2018-10-02T01:27:53.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•æ“ç¯‡"><a href="#å¼•æ“ç¯‡" class="headerlink" title="å¼•æ“ç¯‡"></a>å¼•æ“ç¯‡</h2><h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><ul><li><p>Myisamæ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå½“createåˆ›å»ºæ–°è¡¨æ—¶ï¼ŒæœªæŒ‡å®šæ–°è¡¨çš„å­˜å‚¨å¼•æ“æ—¶ï¼Œé»˜è®¤ä½¿ç”¨Myisamã€‚</p></li><li><p>æ¯ä¸ªMyISAMåœ¨ç£ç›˜ä¸Šå­˜å‚¨æˆä¸‰ä¸ªæ–‡ä»¶ã€‚æ–‡ä»¶åéƒ½å’Œè¡¨åç›¸åŒï¼Œæ‰©å±•ååˆ†åˆ«æ˜¯.frmï¼ˆå­˜å‚¨è¡¨å®šä¹‰ï¼‰ã€.MYD (MYDataï¼Œå­˜å‚¨æ•°æ®)ã€.MYI (MYIndexï¼Œå­˜å‚¨ç´¢å¼•)ã€‚æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶å¯ä»¥æ”¾ç½®åœ¨ä¸åŒçš„ç›®å½•ï¼Œå¹³å‡åˆ†å¸ƒioï¼Œè·å¾—æ›´å¿«çš„é€Ÿåº¦ã€‚</p></li><li><p>å®ƒæ˜¯åœ¨Webã€æ•°æ®ä»“å‚¨å’Œå…¶ä»–åº”ç”¨ç¯å¢ƒä¸‹æœ€å¸¸ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ä¹‹ä¸€ .</p></li></ul><h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><ul><li><p>InnoDB å­˜å‚¨å¼•æ“æä¾›äº†å…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹åŠ¡å®‰å…¨ã€‚ä½†æ˜¯å¯¹æ¯”Myisamçš„å­˜å‚¨å¼•æ“ï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº›å¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿ç•™æ•°æ®å’Œç´¢å¼•ã€‚</p></li><li><p>ç”¨äºäº‹åŠ¡å¤„ç†åº”ç”¨ç¨‹åºï¼Œå…·æœ‰ä¼—å¤šç‰¹æ€§ï¼ŒåŒ…æ‹¬ACID äº‹åŠ¡æ”¯æŒã€‚</p></li></ul><h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨RAM ä¸­ï¼Œåœ¨éœ€è¦å¿«é€ŸæŸ¥æ‰¾å¼•ç”¨å’Œå…¶ä»–ç±»ä¼¼æ•°æ®çš„ç¯å¢ƒä¸‹ï¼Œå¯æä¾›æå¿«çš„è®¿é—®ã€‚</p><table><br><tr></tr><br><tr></tr><br><tr><td>ç‰¹ç‚¹</td><td>Myisam</td><td> BDB</td><td> Memory</td> <td>InnoDB</td><td> Archive</td></tr><br><tr><td>å­˜å‚¨é™åˆ¶</td><td>æ²¡æœ‰</td><td>æ²¡æœ‰</td><td>æœ‰</td><td>64TB </td><td>æ²¡æœ‰</td></tr><br><tr><td>äº‹åŠ¡å®‰å…¨</td><td></td><td>æ”¯æŒ</td><td></td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>é”æœºåˆ¶</td><td>è¡¨é”</td><td>é¡µé”</td><td>è¡¨é”</td><td>è¡Œé”</td><td>è¡Œé”</td></tr><br><tr><td>B æ ‘ç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>å“ˆå¸Œç´¢å¼•</td><td></td><td></td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒ</td><td></td><td></td><td></td><td></td></tr><br><tr><td>é›†ç¾¤ç´¢å¼•</td><td></td><td></td><td></td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>æ•°æ®ç¼“å­˜</td><td></td><td></td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>ç´¢å¼•ç¼“å­˜</td><td>æ”¯æŒ</td><td></td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>æ•°æ®å¯å‹ç¼©</td><td>æ”¯æŒ</td><td></td><td></td><td></td><td>æ”¯æŒ</td></tr><br><tr><td>ç©ºé—´ä½¿ç”¨</td><td>ä½</td><td>ä½</td><td>N/A</td><td> é«˜</td><td>éå¸¸ä½</td></tr><br><tr><td>å†…å­˜ä½¿ç”¨</td><td>ä½</td><td>ä½</td><td>ä¸­ç­‰</td><td>é«˜</td><td>ä½</td></tr><br><tr><td>æ‰¹é‡æ’å…¥çš„é€Ÿåº¦</td><td>é«˜</td><td>é«˜</td><td>é«˜</td><td>ä½</td><td>éå¸¸é«˜</td></tr><br><tr><td>æ”¯æŒå¤–é”®</td><td></td><td></td><td></td><td>æ”¯æŒ</td><td></td></tr><br><tr></tr><br></table><h2 id="Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"><a href="#Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–" class="headerlink" title="Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"></a>Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–</h2><h3 id="æ•°æ®ç±»å‹ä¼˜åŒ–"><a href="#æ•°æ®ç±»å‹ä¼˜åŒ–" class="headerlink" title="æ•°æ®ç±»å‹ä¼˜åŒ–"></a>æ•°æ®ç±»å‹ä¼˜åŒ–</h3><ul><li><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨å¯ä»¥æ­£ç¡®å­˜å‚¨æ•°æ®çš„æœ€å°æ•°æ®ç±»å‹ã€‚</p></li><li><p>ç®€å•çš„æ•°æ®ç±»å‹é€šå¸¸éœ€è¦æ›´å°‘çš„CPUå‘¨æœŸã€‚</p></li><li><p>å°½é‡é¿å…ä½¿ç”¨NULLï¼ŒåŸå› æ˜¯ç”±äºNULLå¯èƒ½éœ€è¦å•ç‹¬çš„ä½ï¼ˆbitï¼‰å»å­˜å‚¨æˆ–è€…NULLä½¿å¾—ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡ã€å€¼æ¯”è¾ƒéƒ½æ›´ä¸ºå¤æ‚ã€‚</p></li></ul><h3 id="èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h3><ul><li><p>èŒƒå¼åŒ–çš„æ›´æ–°æ“ä½œä¼šæ¯”åèŒƒå¼åŒ–çš„å¿«ã€‚</p></li><li><p>å½“æ•°æ®è¾ƒå¥½èŒƒå¼åŒ–çš„æ—¶å€™ï¼Œåªæœ‰å¾ˆå°‘æˆ–è€…æ²¡æœ‰é‡å¤æ•°æ®ï¼Œæ‰€ä»¥åªéœ€è¦ä¿®æ”¹æ›´å°‘çš„æ•°æ®ã€‚</p></li><li><p>èŒƒå¼åŒ–çš„è¡¨é€šå¸¸æ›´å°ã€‚</p></li><li><p>å¾ˆå°‘æœ‰å†—ä½™æ•°æ®æ„å‘³ç€æ£€ç´¢åˆ—è¡¨æ•°æ®æ›´å°‘éœ€è¦distinctæˆ–è€…group byè¯­å¥ã€‚</p></li></ul><h3 id="åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h3><ul><li>åèŒƒå¼çš„schemaæ‰€æœ‰æ•°æ®éƒ½åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå¯ä»¥å¾ˆå¥½çš„é¿å…å…³è”ï¼Œè¿˜å¯ä»¥é¿å…éšæœºIO(å’Œå­˜å‚¨å¼•æ“æœ‰å…³)ã€‚</li></ul><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><ul><li><p>å°½å¯èƒ½é¿å…è¿‡åº¦è®¾è®¡ï¼Œä¾‹å¦‚ä¼šå¯¼è‡´å¤æ‚æŸ¥è¯¢çš„schemaè®¾è®¡ï¼Œæˆ–è€…æœ‰å¾ˆå¤šåˆ—çš„è¡¨çš„è®¾è®¡ã€‚</p></li><li><p>ä½¿ç”¨å°è€Œç®€å•çš„åˆé€‚æ•°æ®ç±»å‹ï¼Œé™¤éçœŸå®æ•°æ®æ¨¡å‹ä¸­ç¡®åˆ‡çš„éœ€è¦ï¼Œå¦åˆ™åº”å°½å¯èƒ½çš„é¿å…NULLå€¼ã€‚</p></li><li><p>å°½é‡ä½¿ç”¨ç›¸åŒçš„æ•°æ®ç±»å‹å­˜å‚¨ç›¸ä¼¼æˆ–è€…ç›¸å…³çš„å€¼ï¼Œå°¤å…¶æ˜¯åœ¨å…³è”æ¡ä»¶ä¸­è¦ä½¿ç”¨çš„åˆ—ã€‚</p></li><li><p>é¿å…ä½¿ç”¨MySQLå·²ç»é—å¼ƒçš„ç‰¹æ€§ï¼Œä¾‹å¦‚æµ®ç‚¹æ•°çš„ç²¾åº¦ï¼Œæˆ–è€…æ•´æ•°çš„æ˜¾ç¤ºå®½åº¦ã€‚</p></li><li><p>å°å¿ƒä½¿ç”¨ENUMå’ŒSETã€‚é¿å…ä½¿ç”¨BITã€‚</p></li></ul><h2 id="é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º"><a href="#é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º" class="headerlink" title="é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º"></a>é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º</h2><p>ç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜æ˜¯ä»¥ç£ç›˜å—ï¼ˆblockï¼‰ä¸ºåŸºæœ¬å•ä½çš„ï¼Œä½äºåŒä¸€ä¸ªç£ç›˜å—ä¸­çš„æ•°æ®ä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦ä»€ä¹ˆå–ä»€ä¹ˆã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“ä¸­æœ‰é¡µï¼ˆpageï¼‰çš„æ¦‚å¿µï¼Œé¡µæ˜¯å…¶ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚</p><h3 id="ç´¢å¼•åŸºç¡€"><a href="#ç´¢å¼•åŸºç¡€" class="headerlink" title="ç´¢å¼•åŸºç¡€"></a>ç´¢å¼•åŸºç¡€</h3><h4 id="B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰"><a href="#B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰" class="headerlink" title="B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰"></a>B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰</h4><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/b-tree.png?raw=true" alt="b-tree"></p><p>B-Tree é€šå¸¸æ„å‘³ç€æ‰€æœ‰çš„å€¼éƒ½æ˜¯æŒ‰ç…§é¡ºåºå­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå¶å­é¡µåˆ°æ ¹çš„è·ç¦»ç›¸åŒã€‚B-Treeç´¢å¼•èƒ½å¤ŸåŠ å¿«è®¿é—®æ•°æ®çš„é€Ÿåº¦ï¼Œå­˜å‚¨å¼•æ“ä¸éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«ææ¥è·å–éœ€è¦çš„æ•°æ®ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä»ç´¢å¼•çš„æ ¹èŠ‚ç‚¹å¼€å§‹è¿›è¡Œæœç´¢ã€‚æ ¹èŠ‚ç‚¹çš„æ§½ä¸­å­˜æ”¾æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå­˜å‚¨å¼•æ“æ ¹æ®è¿™äº›æŒ‡é’ˆå‘ä¸‹å±‚æŸ¥æ‰¾ã€‚æŒ‡é’ˆä¸­å®šä¹‰äº†å­èŠ‚ç‚¹é¡µä¸­å€¼çš„<br>ä¸Šé™å’Œä¸‹é™ã€‚æœ€ç»ˆæ‰¾åˆ°è¯¥å€¼æˆ–è€…ä¸å­˜åœ¨ã€‚</p><p>å¶å­èŠ‚ç‚¹æ¯”è¾ƒç‰¹æ®Šï¼Œä»–ä»¬æŒ‡å‘çš„æ˜¯è¢«ç´¢å¼•çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„èŠ‚ç‚¹é¡µã€‚</p><p>æ ‘çš„æ·±åº¦å’Œè¡¨çš„å¤§å°ç›´æ¥ç›¸å…³ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/b-tree1.png?raw=true" alt="b-tree"></p><p>å¯ä»¥ä½¿ç”¨B-Treeç´¢å¼•çš„æŸ¥è¯¢ç±»å‹ï¼š</p><p>å…¨å€¼åŒ¹é…ï¼šå…¨å€¼åŒ¹é…æŒ‡çš„æ˜¯å’Œç´¢å¼•çš„æ‰€æœ‰åˆ—è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚å‰é¢æåˆ°çš„ç´¢å¼•å¯ç”¨äºæŸ¥æ‰¾å§“åä¸ºCuba Allen 1960-01-01ã€‚</p><p>åŒ¹é…æœ€å·¦å‰ç¼€ï¼šå¯ç”¨äºæŸ¥æ‰¾ç´¢å¼•çš„ç¬¬ä¸€åˆ—ã€‚</p><p>åŒ¹é…åˆ—å‰ç¼€ï¼šä¹Ÿå¯ä»¥åŒ¹é…æŸä¸€åˆ—çš„å€¼çš„å¼€å¤´éƒ¨åˆ†ã€‚</p><p>åŒ¹é…èŒƒå›´å€¼ï¼šéµå¾ªæœ€å·¦å‰ç¼€çš„å‰æä¸‹ï¼ŒèŒƒå›´æŸ¥æ‰¾ã€‚</p><p>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—ï¼šå¯ç”¨äºæŸ¥æ‰¾æ‰€æœ‰å§“ä¸ºAllen,å¹¶ä¸”åå­—æ˜¯å­—æ¯Kå¼€å¤´çš„äººã€‚</p><p>åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼šB-Treeé€šå¸¸å¯ä»¥æ”¯æŒâ€œåªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢â€ï¼Œå³æŸ¥è¯¢åªéœ€è¦è®¿é—®ç´¢å¼•ï¼Œè€Œæ— éœ€è®¿é—®æ•°æ®è¡Œã€‚</p><p>B-Treeä½¿ç”¨é™åˆ¶ï¼š</p><p>å¿…é¡»éµå¾ªæœ€å·¦åŸåˆ™ã€‚</p><p>å¦‚æœæŸ¥è¯¢ä¸­æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™å…¶å³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥æ‰¾ã€‚</p><h4 id="B-Treeç´¢å¼•"><a href="#B-Treeç´¢å¼•" class="headerlink" title="B+Treeç´¢å¼•"></a>B+Treeç´¢å¼•</h4><p>B+Treeæ˜¯åœ¨B-TreeåŸºç¡€ä¸Šçš„ä¸€ç§ä¼˜åŒ–ï¼Œä½¿å…¶æ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼ŒInnoDBå­˜å‚¨å¼•æ“å°±æ˜¯ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</p><p>åœ¨B-treeçš„åŸºç¡€ä¸Šï¼Œä¸ºå¶å­èŠ‚ç‚¹å¢åŠ é“¾è¡¨æŒ‡é’ˆï¼Œè€Œä¸”æ‰€æœ‰çš„å…³é”®å­—éƒ½åœ¨å¶å­èŠ‚ç‚¹ä¸­å‡ºç°ï¼Œä¸”æ•°æ®åªå­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚éå¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä»…ä½œä¸ºå¶å­èŠ‚ç‚¹çš„ç´¢å¼•ã€‚</p><h4 id="hashç´¢å¼•"><a href="#hashç´¢å¼•" class="headerlink" title="hashç´¢å¼•"></a>hashç´¢å¼•</h4><p>å“ˆå¸Œç´¢å¼•åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚å¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œå­˜å‚¨å¼•æ“éƒ½ä¼šå¯¹æ‰€æœ‰çš„ç´¢å¼•åˆ—è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼Œå“ˆå¸Œç æ˜¯ä¸€ä¸ªè¾ƒå°çš„å€¼ï¼Œå¹¶ä¸”ä¸åŒé”®å€¼çš„è¡Œè®¡ç®—å‡ºæ¥çš„å“ˆå¸Œç ä¹Ÿä¸ä¸€æ ·ã€‚å“ˆå¸Œç å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼ŒåŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆã€‚</p><p>åœ¨MySQLä¸­ï¼Œåªæœ‰Memoryå¼•æ“æ˜¾å¼æ”¯æŒå“ˆå¸Œç´¢å¼•ä¸”æ”¯æŒéå”¯ä¸€å“ˆå¸Œç´¢å¼•çš„ã€‚</p><p>å“ˆå¸Œç´¢å¼•æ¯ä¸ªæ§½ç‚¹ç¼–å·æ˜¯æœ‰åºçš„ã€‚</p><p>å“ˆå¸Œç´¢å¼•ä½¿ç”¨é™åˆ¶ï¼š</p><p>å“ˆå¸Œç´¢å¼•åªåŒ…å«å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆï¼Œè€Œä¸å­˜å‚¨å­—æ®µå€¼ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­çš„å€¼æ¥é¿å…è¯»å–è¡Œã€‚</p><p>å“ˆå¸Œç´¢å¼•å¹¶ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥æ— æ³•ç”¨äºæ’åºã€‚</p><p>å“ˆå¸Œç´¢å¼•ä¹Ÿä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—çš„åŒ¹é…æŸ¥æ‰¾ï¼Œå› ä¸ºå“ˆå¸Œç´¢å¼•å§‹ç»ˆæ˜¯ä½¿ç”¨ç´¢å¼•åˆ—çš„å…¨éƒ¨å†…å®¹æ¥è®¡ç®—å“ˆå¸Œå€¼çš„ã€‚</p><p>å“ˆå¸Œç´¢å¼•æ”¯æŒç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢ï¼ŒåŒ…æ‹¬=ã€in()ã€&lt;=&gt;ä¹Ÿä¸æ”¯æŒä»»ä½•èŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚WHERE price &gt; 100ã€‚</p><p>è®¿é—®å“ˆå¸Œç´¢å¼•çš„æ•°æ®éå¸¸å¿«ï¼Œé™¤éæœ‰å¾ˆå¤šå“ˆå¸Œå†²çªã€‚</p><p>å¦‚æœå“ˆå¸Œå†²çªå¾ˆå¤šçš„è¯ï¼Œä¸€äº›ç´¢å¼•ç»´æŠ¤æ“ä½œçš„ä»£ä»·ä¹Ÿä¼šå¾ˆé«˜ã€‚</p><p>é™¤äº†Memoryå¼•æ“å¤–ï¼ŒNDBé›†ç¾¤å¼•æ“ä¹Ÿæ”¯æŒå”¯ä¸€å“ˆå¸Œç´¢å¼•ï¼Œä¸”åœ¨NDBé›†ç¾¤å¼•æ“ä¸­ä½œç”¨éå¸¸ç‰¹æ®Šã€‚</p><p>InnoDBå¼•æ“æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å«â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€ã€‚å½“InnoDBå¼•æ“æ³¨æ„åˆ°æŸäº›ç´¢å¼•å€¼è¢«ä½¿ç”¨çš„éå¸¸é¢‘ç¹æ—¶ï¼Œä»–ä¼šåœ¨å†…å­˜ä¸­åŸºäºB-Treeç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·å°±è®©B-Treeç´¢å¼•ä¹Ÿå…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¿«é€Ÿå“ˆå¸ŒæŸ¥æ‰¾ã€‚</p><h4 id="å…¨æ–‡ç´¢å¼•"><a href="#å…¨æ–‡ç´¢å¼•" class="headerlink" title="å…¨æ–‡ç´¢å¼•"></a>å…¨æ–‡ç´¢å¼•</h4><p>å…¨æ–‡ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹ç´¢å¼•ï¼Œå®ƒæŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒç´¢å¼•ä¸­çš„å€¼ã€‚é€‚ç”¨äºMATCH AGINSTæ“ä½œï¼Œè€Œä¸æ˜¯æ™®é€šçš„WHEREæ¡ä»¶æ“ä½œã€‚</p><h3 id="ç´¢å¼•çš„ä¼˜ç‚¹"><a href="#ç´¢å¼•çš„ä¼˜ç‚¹" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç‚¹"></a>ç´¢å¼•çš„ä¼˜ç‚¹</h3><ul><li><p>ç´¢å¼•å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</p></li><li><p>ç´¢å¼•å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ã€‚</p></li><li><p>ç´¢å¼•å¯ä»¥å°†éšæœºIOå˜ä¸ºé¡ºåºIOã€‚</p></li></ul><h3 id="é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"><a href="#é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥" class="headerlink" title="é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"></a>é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥</h3><h4 id="ç‹¬ç«‹çš„åˆ—"><a href="#ç‹¬ç«‹çš„åˆ—" class="headerlink" title="ç‹¬ç«‹çš„åˆ—"></a>ç‹¬ç«‹çš„åˆ—</h4><p>ç‹¬ç«‹çš„åˆ—æ˜¯æŒ‡ç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ã€‚æˆ‘ä»¬åº”è¯¥ç®€åŒ–WHEREæ¡ä»¶çš„ä¹ æƒ¯ï¼Œå§‹ç»ˆå°†ç´¢å¼•åˆ—å•ç‹¬æ”¾åœ¨æ¯”è¾ƒç¬¦å·çš„ä¸€ä¾§ã€‚</p><p>ä¾‹å¦‚ï¼š<code>select actor_id from sakila.actor where actor_id + 1 = 4</code></p><h4 id="å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§"><a href="#å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§" class="headerlink" title="å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§"></a>å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§</h4><p>é—®é¢˜ï¼š æœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©ç´¢å¼•å˜çš„å¤§ä¸”æ…¢ã€‚</p><p>é€šå¸¸å¯ä»¥ç´¢å¼•å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚ä½†ä¼šé™ä½ç´¢å¼•çš„é€‰æ‹©æ€§ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹å¯¹äºBlobã€textæˆ–è€…å¾ˆé•¿çš„varchar()ç±»å‹çš„åˆ—ï¼Œå¿…é¡»ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå› ä¸ºMySQLä¸å…è®¸ç´¢å¼•è¿™äº›åˆ—çš„å®Œæ•´é•¿åº¦ã€‚</p><p>å‰ç¼€çš„åŸºæ•°åº”è¯¥æ¥è¿‘äºå®Œæ•´åˆ—çš„åŸºæ•°ã€‚</p><h4 id="å¤šç´¢å¼•åˆ—"><a href="#å¤šç´¢å¼•åˆ—" class="headerlink" title="å¤šç´¢å¼•åˆ—"></a>å¤šç´¢å¼•åˆ—</h4><p>åœ¨å¤šä¸ªåˆ—ä¸Šå»ºç«‹ç‹¬ç«‹çš„å•åˆ—ç´¢å¼•å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸èƒ½æé«˜MySQLçš„æŸ¥è¯¢æ€§èƒ½ã€‚</p><h4 id="é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"><a href="#é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº" class="headerlink" title="é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"></a>é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº</h4><p>å¤šåˆ—ç´¢å¼•çš„åˆ—é¡ºåºç»å…¸æ³•åˆ™ï¼šå½“ä¸éœ€è¦è€ƒè™‘æ’åºå’Œåˆ†ç»„æ—¶ï¼Œå°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åˆ°ç´¢å¼•æœ€å‰åˆ—ã€‚å¤§éƒ½æƒ…å†µä¸‹æ˜¯é€‚ç”¨çš„ï¼Œä¹Ÿéœ€è¦æ ¹æ®ä¸šåŠ¡å»è€ƒè™‘ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚</p><p>éœ€è¦è€ƒè™‘å“ªäº›è¿è¡Œé¢‘ç‡æœ€é«˜çš„æŸ¥è¯¢æ¥è°ƒæ•´ç´¢å¼•åˆ—çš„é¡ºåºï¼Œè®©è¿™ç§æƒ…å†µä¸‹ç´¢å¼•çš„é€‰æ‹©æ€§æœ€é«˜ã€‚</p><h4 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h4><p>èšç°‡ç´¢å¼•å¹¶ä¸æ˜¯ä¸€ç§å•çº¯çš„ç´¢å¼•ç±»å‹ï¼Œè€Œæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ã€‚å…·ä½“ç»†èŠ‚ä¾èµ–å…¶å®ç°æ–¹å¼ï¼Œä½†InnoDBçš„èšç°‡ç´¢å¼•å®é™…ä¸Šåœ¨åŒä¸€ä¸ªç»“æ„ä¸­ä¿å­˜äº†B-Treeç´¢å¼•å’Œæ•°æ®è¡Œã€‚</p><p>å½“è¡¨æœ‰èšç°‡ç´¢å¼•æ—¶ï¼Œå®ƒçš„æ•°æ®è¡Œå®é™…å­˜æ”¾åœ¨ç´¢å¼•çš„å¶å­é¡µä¸­ã€‚æœ¯è¯­â€œèšç°‡â€æ ‡è¯†æ•°æ®è¡Œå’Œç›¸é‚»çš„é”®å€¼ç´§å‡‘çš„å­˜å‚¨åœ¨ä¸€èµ·ã€‚å› ä¸ºæ— æ³•åŒæ—¶æŠŠæ•°æ®è¡Œå­˜æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p><p>ç”±äºæ˜¯å­˜å‚¨å¼•æ“è‡ªå·±å®ç°èšç°‡ç´¢å¼•ï¼Œå› æ­¤ä¸æ˜¯æ¯ä¸ªå¼•æ“éƒ½æ”¯æŒèšç°‡ç´¢å¼•ã€‚</p><p>å¶å­é¡µåŒ…å«äº†è¡Œçš„å…¨éƒ¨æ•°æ®ï¼Œä½†æ˜¯èŠ‚ç‚¹é¡µåªåŒ…å«äº†ç´¢å¼•åˆ—ã€‚InnoDBå°†é€šè¿‡ä¸»é”®èšé›†æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´å›¾ä¸­çš„â€œè¢«ç´¢å¼•åˆ—â€å°±æ˜¯ä¸»é”®åˆ—ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/clusterindex.png?raw=true" alt="cluster-index"></p><p>æ³¨ï¼š å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼ŒInnoDBä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ã€‚InnoDBåªèšé›†åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ã€‚åŒ…å«ç›¸é‚»é”®å€¼çš„é¡µé¢å¯èƒ½ä¼šç›¸è·ç”šè¿œã€‚</p><p>èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>å¯ä»¥æŠŠç›¸å…³æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚å®ç°ç”µå­é‚®ç®±æ—¶ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·IDæ¥èšé›†æ•°æ®ï¼Œè¿™æ ·åªéœ€è¦ä»ç£ç›˜è¯»å–å°‘é‡çš„æ•°æ®é¡µå°±èƒ½è·å–æŸä¸ªç”¨æˆ·çš„å…¨éƒ¨é‚®ä»¶ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨èšç°‡ç´¢å¼•ï¼Œåˆ™æ¯å°é‚®ä»¶éƒ½å¯èƒ½å¯¼è‡´ä¸€æ¬¡ç£ç›˜IOã€‚</p></li><li><p>æ•°æ®è®¿é—®æ›´å¿«ã€‚èšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB-Treeä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®é€šå¸¸æ¯”åœ¨éèšç°‡ç´¢å¼•æŸ¥æ‰¾çš„è¦å¿«ã€‚</p></li><li><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æçš„æŸ¥è¯¢å¯ä»¥ç›´æ¥ä½¿ç”¨é¡µèŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼ã€‚</p></li></ul><p>èšç°‡ç´¢å¼•ç¼ºç‚¹ï¼š</p><ul><li><p>èšç°‡ç´¢å¼•æœ€å¤§é™åº¦çš„æé«˜äº†IOå¯†é›†å‹åº”ç”¨çš„æ€§èƒ½ï¼Œä½†å¦‚æœæ•°æ®å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œåˆ™è®¿é—®çš„é¡ºåºå°±æ²¡æœ‰é‚£ä¹ˆé‡è¦äº†ï¼Œèšç°‡ç´¢å¼•ä¹Ÿå°±æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ¿äº†ã€‚</p></li><li><p>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–æ’å…¥é¡ºåºã€‚æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯åŠ è½½æ•°æ®åˆ°InnoDBè¡¨ä¸­é€Ÿåº¦æœ€å¿«çš„æ–¹å¼ã€‚ä½†å¦‚æœä¸æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºåŠ è½½æ•°æ®ï¼Œé‚£ä¹ˆåœ¨åŠ è½½å®Œæˆåæœ€å¥½ä½¿ç”¨optimize tableå‘½ä»¤é‡æ–°ç»„ç»‡ä¸€ä¸‹è¡¨ã€‚</p></li><li><p>æ›´æ–°èšç°‡ç´¢å¼•åˆ—çš„ä»£ä»·å¾ˆé«˜ï¼Œå› ä¸ºä¼šå¼ºåˆ¶InnoDBå°†æ¯ä¸ªè¢«åŠ¨æ›´æ–°çš„è¡Œç§»åŠ¨åˆ°æ–°çš„ä½ç½®ã€‚</p></li><li><p>åŸºäºèšç°‡ç´¢å¼•çš„è¡¨åœ¨æ’å…¥æ–°è¡Œï¼Œæˆ–è€…ä¸»é”®è¢«æ›´æ–°å¯¼è‡´éœ€è¦ç§»åŠ¨è¡Œçš„æ—¶å€™ï¼Œå¯èƒ½é¢ä¸´â€œé¡µåˆ†è£‚â€çš„é—®é¢˜ã€‚å½“è¡Œçš„ä¸»é”®å€¼è¦æ±‚å¿…é¡»å°†è¿™ä¸€è¡Œæ’å…¥åˆ°æŸä¸ªå·²æ»¡çš„é¡µä¸­æ—¶ï¼Œå­˜å‚¨å¼•æ“ä¼šå°†è¯¥é¡µåˆ†è£‚æˆä¸¤ä¸ªé¡µé¢æ¥å®¹çº³æ”¹è¡Œï¼Œè¿™å°±æ˜¯ä¸€æ¬¡é¡µåˆ†è£‚æ“ä½œã€‚é¡µåˆ†è£‚ä¼šå¯¼è‡´è¡¨å ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚</p></li><li><p>èšç°‡ç´¢å¼•å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢ï¼Œå°¤å…¶æ˜¯è¡Œæ¯”è¾ƒç¨€ç–ï¼Œæˆ–è€…ç”±äºé¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­çš„æ—¶å€™ã€‚</p></li><li><p>äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰å¯èƒ½æ¯”æƒ³è±¡çš„è¦æ›´å¤§ï¼Œå› ä¸ºåœ¨äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«äº†å¼•ç”¨è¡Œçš„ä¸»é”®åˆ—ã€‚</p></li><li><p>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¿å­˜çš„ä¸æ˜¯æŒ‡å‘è¡Œçš„ç‰©ç†ä½ç½®çš„æŒ‡é’ˆï¼Œè€Œæ˜¯è¡Œçš„ä¸»é”®å€¼ã€‚è¿™æ„å‘³ç€é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥æ‰¾è¡Œï¼Œå­˜å‚¨å¼•æ“éœ€è¦æ‰¾åˆ°äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è·å¾—å¯¹åº”çš„ä¸»é”®å€¼ï¼Œç„¶åæ ¹æ®è¿™ä¸ªå€¼å»èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å¯¹åº”çš„è¡Œã€‚å¯¹äºInnoDBï¼Œè‡ªé€‚åº”æ€§å“ˆå¸Œç´¢å¼•èƒ½å¤Ÿå‡å°‘è¿™æ ·é‡å¤çš„å·¥ä½œã€‚</p></li></ul><h4 id="InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”"><a href="#InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”" class="headerlink" title="InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”"></a>InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”</h4><p>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„æ•°æ®åˆ†å¸ƒæœ‰åŒºåˆ«ï¼Œä»¥åŠå¯¹åº”çš„ä¸»é”®ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•çš„æ•°æ®åˆ†å¸ƒä¹Ÿæœ‰åŒºåˆ«ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table    layout_test&#123;</span><br><span class="line">col1 int not null,</span><br><span class="line">col2 int not null,</span><br><span class="line">primary key(col1),</span><br><span class="line">key(col2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾è¯¥è¡¨ä¸»é”®å–å€¼1-10000ï¼ŒæŒ‰ç…§éšæœºé¡ºåºæ’å…¥å¹¶ä½¿ç”¨OPTIMIZE TABLEå‘½ä»¤åšäº†ä¼˜åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œæ•°æ®åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨å·²ç»åšåˆ°æœ€ä¼˜ï¼Œä½†è¡Œçš„é¡ºåºæ˜¯éšæœºçš„ã€‚</p><p>åˆ—col2çš„å€¼æ˜¯ä»1-100çš„éšæœºå€¼ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šé‡å¤çš„å€¼ã€‚</p><p>MyISAMæ•°æ®ï¼ˆéèšç°‡ï¼‰åˆ†å¸ƒï¼š</p><p>MyISAMæŒ‰ç…§æ•°æ®æ’å…¥é¡ºåºå­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><p>åœ¨è¡Œçš„æ—è¾¹æ˜¾ç¤ºè¡Œå·ï¼Œä»0å¼€å§‹é€’å¢ã€‚å› ä¸ºè¡Œæ˜¯å®šé•¿çš„ï¼Œæ‰€ä»¥MyISAMå¯ä»¥ä»è¡¨çš„å¼€å¤´è·³è¿‡æ‰€éœ€çš„å­—èŠ‚æ‰¾åˆ°éœ€è¦çš„è¡Œã€‚</p><p>è¿™ç§åˆ†å¸ƒæ–¹å¼å®¹æ˜“åˆ›å»ºç´¢å¼•ã€‚</p><p>æ•°æ®åˆ†å¸ƒï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/myisam.png?raw=true" alt="æ•°æ®åˆ†å¸ƒ"></p><p>ä¸»é”®åˆ†å¸ƒï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/myisamcol.png?raw=true" alt="è¡¨çš„ä¸»é”®"></p><p>col2åˆ—ç´¢å¼•åˆ†å¸ƒï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/myisamkey.png?raw=true" alt="col2åˆ—ç´¢å¼•åˆ†å¸ƒ"></p><p>InnoDBæ•°æ®ï¼ˆèšç°‡ï¼‰åˆ†å¸ƒï¼š</p><p>InnoDBæ”¯æŒèšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥ä½¿ç”¨éå¸¸ä¸åŒçš„æ–¹å¼å­˜å‚¨åŒæ ·çš„æ•°æ®ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/innodbkey.png?raw=true" alt="ä¸»é”®åˆ†å¸ƒ"></p><p>è¯¥å›¾æ˜¾ç¤ºäº†æ•´ä¸ªè¡¨ï¼Œè€Œä¸æ˜¯åªæœ‰ç´¢å¼•ã€‚åœ¨InnoDBä¸­ï¼Œèšç°‡ç´¢å¼•å°±æ˜¯è¡¨ï¼Œæ‰€ä»¥ä¸åƒMyISAMé‚£æ ·éœ€è¦ç‹¬ç«‹çš„å­˜å‚¨ã€‚</p><p>èšç°‡ç´¢å¼•çš„æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸»é”®å€¼ã€äº‹åŠ¡IDã€ç”¨äºäº‹åŠ¡å’ŒMVCCçš„å›æ»šæŒ‡é’ˆä»¥åŠæ‰€æœ‰çš„å‰©ä½™åˆ—ã€‚å¦‚æœä¸»é”®æ˜¯ä¸€ä¸ªåˆ—å‰ç¼€ç´¢å¼•ï¼ŒInnoDBä¹Ÿä¼šåŒ…å«å®Œæ•´çš„ä¸»é”®åˆ—å’Œå‰©ä¸‹çš„å…¶ä»–åˆ—ã€‚</p><p>InnoDBäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ä¸æ˜¯â€œè¡ŒæŒ‡é’ˆâ€ï¼Œè€Œæ˜¯ä¸»é”®å€¼ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºæŒ‡å‘è¡Œçš„â€œæŒ‡é’ˆâ€ã€‚åˆ©ï¼šå‡å°‘äº†å½“å‡ºç°è¡Œç§»åŠ¨æˆ–è€…æ•°æ®é¡µåˆ†è£‚æ—¶äºŒçº§ç´¢å¼•çš„ç»´æŠ¤å·¥ä½œã€‚å¼Šï¼šä½¿ç”¨ä¸»é”®å€¼å½“åšæŒ‡é’ˆä¼šè®©äºŒçº§ç´¢å¼•å ç”¨æ›´å¤šçš„ç©ºé—´ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/innodb.png?raw=true" alt="ç´¢å¼•åˆ†å¸ƒ"></p><p>ä¸Šå›¾æ˜¾ç¤ºäº†ç¤ºä¾‹è¡¨col2çš„ç´¢å¼•ï¼Œæ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«äº†ç´¢å¼•åˆ—ï¼ˆcol2ï¼‰,ç´§æ¥ç€æ˜¯ä¸»é”®å€¼ï¼ˆcol1ï¼‰ã€‚</p><p>è¯¥å›¾å±•ç¤ºäº†B-Treeçš„å¶å­èŠ‚ç‚¹ç»“æ„ï¼ŒInnoDBçš„éå¶å­èŠ‚ç‚¹åŒ…å«äº†ç´¢å¼•åˆ—å’Œä¸€ä¸ªæŒ‡å‘ä¸‹çº§èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆä¸‹ä¸€çº§èŠ‚ç‚¹å¯ä»¥æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¶å­èŠ‚ç‚¹ï¼‰ã€‚è¿™å¯¹èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•éƒ½é€‚ç”¨ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/innodba.png?raw=true" alt="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"></p><h4 id="InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ"><a href="#InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ" class="headerlink" title="InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ"></a>InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ</h4><p>å¦‚æœæ­£åœ¨ä½¿ç”¨InnoDBè¡¨å¹¶ä¸”å¹¶æ²¡æœ‰ä»€ä¹ˆæ•°æ®éœ€è¦èšé›†ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªä»£ç†é”®ä½œä¸ºä¸»é”®ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨AUTO_INCREMENTè‡ªå¢åˆ—ã€‚è¿™æ ·å¯ä»¥ä¿è¯æ•°æ®æŒ‰é¡ºåºå†™å…¥ï¼Œå¯¹äºæ ¹æ®ä¸»é”®åšå…³è”æ“ä½œçš„æ€§èƒ½ä¹Ÿä¼šæ›´å¥½ã€‚</p><p>æœ€å¥½é¿å…éšæœºï¼ˆä¸è¿ç»­ä¸”å€¼åˆ†å¸ƒèŒƒå›´éå¸¸å¤§ï¼‰èšç°‡ç´¢å¼•ï¼Œç‰¹åˆ«å¯¹IOå¯†é›†å‹åº”ç”¨ã€‚ä»æ€§èƒ½è€ƒè™‘ï¼Œä½¿ç”¨UUIDä½œä¸ºèšç°‡ç´¢å¼•ï¼Œä½¿å¾—èšç°‡ç´¢å¼•çš„æ’å…¥å˜çš„å®Œå…¨éšæœºï¼Œä½¿å¾—æ•°æ®æ²¡æœ‰ä»»ä½•èšé›†ç‰¹æ€§ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/clustersort.png?raw=true" alt="èšç°‡ç´¢å¼•æ’å…¥é¡ºåºçš„ç´¢å¼•å€¼"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå› ä¸ºä¸»é”®çš„å€¼æ˜¯é¡ºåºçš„ï¼Œæ‰€ä»¥InnoDBæŠŠæ¯ä¸€æ¡çºªå¾‹éƒ½å­˜å‚¨åœ¨ä¸Šä¸€æ¡çºªå¾‹åé¢ã€‚å½“è¾¾åˆ°é¡µçš„æœ€å¤§å¡«å……å› å­æ—¶ï¼Œä¸‹ä¸€æ¡è®°å½•å°±ä¼šå†™å…¥æ–°çš„é¡µä¸­ï¼Œä¸€æ—¦æ•°æ®æŒ‰ç…§è¿™ç§é¡ºåºçš„æ–¹å¼åŠ è½½ï¼Œä¸»é”®é¡µå°±ä¼šè¿‘ä¼¼äºè¢«é¡ºåºçš„è®°å½•å¡«æ»¡ã€‚</p><p>èšç°‡ç´¢å¼•é¡ºåºæ’å…¥ç¼ºç‚¹ï¼š</p><ul><li><p>å¯¹äºé«˜å¹¶å‘å·¥ä½œè´Ÿè½½ï¼Œåœ¨InnoDBä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥å¯èƒ½ä¼šé€ æˆæ˜æ˜¾çš„äº‰ç”¨ï¼ˆä¸»é”®å¼•èµ·é—´éš™é”ç«äº‰ï¼‰ã€‚</p></li><li><p>å¦ä¸€ä¸ªçƒ­ç‚¹æ˜¯AUTO_INCREMENTé”æœºåˆ¶ï¼Œå¦‚æœé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡æ–°è®¾è®¡è¡¨æˆ–è€…åº”ç”¨ï¼Œæˆ–è€…ä¿®æ”¹innodb_autoinc_lock_modeé…ç½®ã€‚</p></li></ul><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/clusternosort.png?raw=true" alt="éèšç°‡ç´¢å¼•æ’å…¥é¡ºåºçš„ç´¢å¼•å€¼"></p><p>éèšç°‡ç´¢å¼•å› ä¸ºæ–°è¡Œçš„ä¸»é”®å€¼ä¸ä¸€å®šæ¯”ä¹‹å‰æ’å…¥çš„å¤§ï¼Œæ‰€ä»¥InnoDBæ— æ³•ç®€å•çš„æ€»æ˜¯æŠŠæ–°è¡Œæ’å…¥åˆ°ç´¢å¼•çš„æœ€åï¼Œè€Œæ˜¯éœ€è¦ä¸ºæ–°çš„è¡Œå¯»æ‰¾éœ€è¦çš„ä½ç½®â€”é€šå¸¸æ˜¯å·²æœ‰æ•°æ®çš„ä¸­é—´ä½ç½®â€”å¹¶ä¸”åˆ†é…ç©ºé—´ã€‚è¿˜ä¼šå¢åŠ å¾ˆå¤šé¢å¤–çš„å·¥ä½œï¼Œå¹¶å¯¼è‡´æ•°æ®åˆ†å¸ƒä¸å¤Ÿä¼˜åŒ–ã€‚</p><p>éèšç°‡ç´¢å¼•æ’å…¥ç¼ºç‚¹ï¼š</p><ul><li><p>å†™å…¥çš„ç›®æ ‡é¡µå¯èƒ½å·²ç»åˆ·åˆ°ç£ç›˜ä¸Šå¹¶ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œæˆ–è€…è¿˜æ²¡æœ‰è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼ŒInnoDBåœ¨æ’å…¥ä¹‹å‰ä¸å¾—ä¸å…ˆæ‰¾åˆ°å¹¶ä»ç£ç›˜è¯»å–ç›®æ ‡é¡µåˆ°å†…å­˜ä¸­ã€‚è¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„éšæœºIOã€‚</p></li><li><p>å› ä¸ºå†™å…¥æ˜¯ä¹±åºçš„ï¼ŒInnoDBä¸å¾—ä¸é¢‘ç¹çš„åšé¡µåˆ†è£‚æ“ä½œï¼Œä»¥ä¾¿æ–°çš„è¡Œåˆ†é…ç©ºé—´ã€‚é¡µåˆ†è£‚ä¼šå¯¼è‡´ç§»åŠ¨å¤§é‡æ•°æ®ï¼Œä¸€æ¬¡æ’å…¥æœ€å°‘éœ€è¦ä¿®æ”¹ä¸‰ä¸ªé¡µè€Œä¸æ˜¯ä¸€ä¸ªé¡µã€‚</p></li><li><p>ç”±äºé¢‘ç¹çš„é¡µåˆ†è£‚ï¼Œé¡µä¼šå˜çš„ç¨€ç–å¹¶è¢«ä¸è§„åˆ™çš„å¡«å……ï¼Œæ‰€ä»¥æœ€ç»ˆä¼šæœ‰æ•°æ®ç¢ç‰‡ã€‚</p></li></ul><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h4><p>é€šå¸¸å¤§å®¶ä¼šæ ¹æ®æŸ¥è¯¢çš„whereæ¡ä»¶æ¥åˆ›å»ºç´¢å¼•ï¼Œä¸è¿‡è¿™åªæ˜¯ä¼˜åŒ–ç´¢å¼•çš„ä¸€ä¸ªæ–¹é¢ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢å­—æ®µçš„å€¼æˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œè¦†ç›–ç´¢å¼•â€ã€‚</p><p>è¦†ç›–ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>ç´¢å¼•æ¡ç›®é€šå¸¸è¿œå°äºæ•°æ®è¡Œå¤§å°ï¼Œæ‰€ä»¥å¦‚æœåªéœ€è¦è¯»å–ç´¢å¼•ï¼Œé‚£MySQLå°±ä¼šæå¤§çš„å‡å°‘æ•°æ®è®¿é—®é‡ã€‚è¿™å¯¹ç¼“å­˜çš„è´Ÿè½½éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹å“åº”æ—¶é—´å¤§éƒ¨åˆ†èŠ±è´¹åœ¨æ•°æ®æ‹·è´ä¸Šã€‚è¦†ç›–ç´¢å¼•å¯¹IOå¯†é›†å‹åº”ç”¨ä¹Ÿæœ‰å¸®åŠ©ï¼Œå› ä¸ºç´¢å¼•æ¯”æ•°æ®æ›´å°ï¼Œæ›´å®¹æ˜“å…¨éƒ¨æ”¾å…¥å†…å­˜ä¸­ï¼ˆMyISAMå‹ç¼©ç´¢å¼•ä»¥å˜å¾—æ›´å°ï¼‰ã€‚</p></li><li><p>å› ä¸ºç´¢å¼•æ˜¯æŒ‰ç…§åˆ—å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å¯¹äºIOå¯†é›†å‹çš„èŒƒå›´æŸ¥è¯¢ä¼šæ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œæ•°æ®çš„IOè¦å°‘çš„å¤šã€‚ï¼ˆMyISAMå’ŒPercona XtraDBï¼Œç”šè‡³å¯ä»¥é€šè¿‡OPTIMIZEå‘½ä»¤ä½¿å¾—ç´¢å¼•å®Œå…¨é¡ºåºæ’åˆ—ï¼Œè¿™æ ·ç®€å•çš„èŒƒå›´æŸ¥è¯¢èƒ½ä½¿ç”¨å®Œå…¨é¡ºåºçš„ç´¢å¼•è®¿é—®ï¼‰</p></li><li><p>ä¸€äº›å­˜å‚¨å¼•æ“å¦‚MyISAMåœ¨å†…å­˜ä¸­åªç¼“å­˜ç´¢å¼•ï¼Œæ•°æ®åˆ™ä¾èµ–äºæ“ä½œç³»ç»Ÿæ¥ç¼“å­˜ï¼Œå› æ­¤è¦è®¿é—®æ•°æ®éœ€è¦ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ã€‚</p></li><li><p>ç”±äºInnoDBçš„èšç°‡ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•å¯¹InnoDBè¡¨ç‰¹åˆ«æœ‰ç”¨ã€‚InnoDBçš„äºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜äº†è¡Œçš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥å¦‚æœäºŒçº§ä¸»é”®èƒ½å¤Ÿè¦†ç›–æŸ¥è¯¢ï¼Œåˆ™å¯ä»¥é¿å…å¯¹ä¸»é”®ç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚</p></li></ul><p>ä¸æ˜¯æ‰€æœ‰çš„ç´¢å¼•éƒ½å¯ä»¥æˆä¸ºè¦†ç›–ç´¢å¼•ã€‚è¦†ç›–ç´¢å¼•å¿…é¡»è¦å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œè€Œå“ˆå¸Œç´¢å¼•ã€ç©ºé—´ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•ç­‰éƒ½ä¸å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œæ‰€ä»¥MySQLåªèƒ½ä½¿ç”¨B-Treeåšç´¢å¼•è¦†ç›–ã€‚</p><p>å½“å‘èµ·ä¸€ä¸ªç´¢å¼•è¦†ç›–æŸ¥è¯¢æ—¶ï¼Œåœ¨Explainçš„Extraåˆ—å¯ä»¥çœ‹åˆ°â€œUsing indexâ€çš„ä¿¡æ¯ï¼ˆExtraåˆ—çš„Using indexå’Œtypeåˆ—çš„inxexææ··æ·†ï¼Œå…¶å®ä¸¤è€…æˆ‘å®Œå…¨ä¸åŒï¼Œtypeåˆ—æ ‡è¯†æŸ¥è¯¢è®¿é—®æ•°æ®æ–¹å¼ï¼Œä¹Ÿç§°ä¹‹ä¸ºjoin typeï¼‰ã€‚</p><p>ç´¢å¼•è¦†ç›–æŸ¥è¯¢å¯èƒ½è¿˜æœ‰å¾ˆå¤šé™·é˜±å¯èƒ½å¯¼è‡´æ— æ³•å®ç°ä¼˜åŒ–ã€‚MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šåœ¨æ‰§è¡ŒæŸ¥è¯¢å‰åˆ¤æ–­æ˜¯å¦æœ‰ä¸€ä¸ªç´¢å¼•èƒ½è¿›è¡Œè¦†ç›–ã€‚å‡è®¾ç´¢å¼•è¦†ç›–äº†WHEREæ¡ä»¶ä¸­çš„å­—æ®µï¼Œä½†ä¸æ˜¯æ•´ä¸ªæŸ¥è¯¢æ¶‰åŠçš„å­—æ®µã€‚å¦‚æœæ¡ä»¶ä¸ºå‡ï¼ŒMySQL5.5å’Œæ›´æ—©ç‰ˆæœ¬ä¹Ÿæ€»æ˜¯ä¼šå›è¡¨è·å–æ•°æ®è¡Œï¼Œå°½ç®¡å¹¶ä¸éœ€è¦è¿™ä¸€è¡Œä¸”æœ€ç»ˆä¹Ÿä¼šè¢«è¿‡æ»¤æ‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">explain select * from products where actor=&apos;scan carrey&apos; and title like &apos;%APOLLO%&apos; --è¿™æ¡è¯­å¥ä½¿ç”¨çš„æ˜¯Extra:using where</span><br></pre></td></tr></table></figure><p>åŸå› ï¼š</p><ul><li><p>æ²¡æœ‰ä»»ä½•ç´¢å¼•èƒ½å¤Ÿè¦†ç›–è¿™ä¸ªæŸ¥è¯¢ã€‚å› ä¸ºæŸ¥è¯¢ä»è¡¨ä¸­é€‰æ‹©äº†æ‰€æœ‰åˆ—ï¼Œè€Œæ²¡æœ‰ä»»ä½•ç´¢å¼•è¦†ç›–äº†æ‰€æœ‰çš„åˆ—ã€‚MySQLå­˜åœ¨å¦ä¸€ä¸ªé€”å¾„ï¼šWHEREæ¡ä»¶ä¸­çš„åˆ—æ˜¯æœ‰ç´¢å¼•å¯ä»¥è¦†ç›–çš„ï¼Œå› æ­¤MySQLå¯ä»¥ä½¿ç”¨è¯¥ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„actorå¹¶æ£€æŸ¥titleæ˜¯å¦åŒ¹é…ï¼Œè¿‡æ»¤ä¹‹åå†è¯»å–éœ€è¦çš„æ•°æ®è¡Œã€‚</p></li><li><p>MySQLä¸èƒ½å†ç´¢å¼•ä¸­æ‰§è¡ŒLIKEæ“ä½œã€‚è¿™æ˜¯åº•å±‚å­˜å‚¨å¼•æ“APIçš„é™åˆ¶ï¼ŒMySQL5.5å’Œæ›´æ—©ç‰ˆæœ¬ä¸­åªå…è®¸åœ¨ç´¢å¼•ä¸­åšç®€å•æ¯”è¾ƒæ“ä½œã€‚MySQLèƒ½åœ¨ç´¢å¼•ä¸­åšæœ€å·¦å‰ç¼€åŒ¹é…çš„LIKEæŸ¥è¯¢ï¼Œå­˜å‚¨å¼•æ“å°±æ— æ³•æ¯”è¾ƒåŒ¹é…ã€‚MySQLæœåŠ¡å™¨åªèƒ½æå–æ•°æ®è¡Œçš„å€¼è€Œä¸æ˜¯ç´¢å¼•å€¼æ¥åšæ¯”è¾ƒã€‚</p></li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>å…ˆå°†ç´¢å¼•æ‰©å±•è‡³3ä¸ªï¼ˆartistï¼Œtitleï¼Œprod_idï¼‰,ç„¶åæŒ‰ç…§å¦‚ä¸‹æ–¹å¼é‡å†™æŸ¥è¯¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">explain select * from products join(select prob_id from products where actor=&apos;sean carrey&apos; and title like &apos;%APOLLO%&apos;) as t1 on(t1.prod_id=products.prod_id)</span><br></pre></td></tr></table></figure><p>Extra: using where;using index</p><p>æˆ‘ä»¬æŠŠè¿™ç§æ–¹å¼å«åšå»¶è¿Ÿå…³è”ï¼Œå› ä¸ºå»¶è¿Ÿäº†å¯¹åˆ—çš„è®¿é—®ã€‚åœ¨æŸ¥è¯¢çš„ç¬¬ä¸€é˜¶æ®µMySQLå¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œåœ¨FROMå­å¥çš„å­æŸ¥è¯¢ä¸­æ‰¾åˆ°åŒ¹é…çš„prod_id,ç„¶åæ ¹æ®è¿™äº›prop_idå€¼åœ¨å¤–å±‚æŸ¥è¯¢åŒ¹é…è·å–éœ€è¦çš„æ‰€æœ‰åˆ—å€¼ã€‚è™½ç„¶æ— æ³•ä½¿ç”¨ç´¢å¼•è¦†ç›–æ•´ä¸ªæŸ¥è¯¢ï¼Œä½†æ€»ç®—æ¯”å®Œå…¨æ— æ³•åˆ©ç”¨ç´¢å¼•è¦†ç›–çš„å¥½ã€‚</p><p>è¿™æ ·çš„ä¼˜åŒ–æ•ˆæœå–å†³äºWHEREæ¡ä»¶åŒ¹é…è¿”å›çš„è¡Œæ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾productsæœ‰100wè¡Œæ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªSQLåœ¨ä¸åŒçš„ä¸‰ä¸ªåœºæ™¯ä¸­æµ‹è¯•ã€‚</p><ol><li><p>sean carrey å‡ºæ¼”äº†3wéƒ¨ä½œå“ï¼Œ2wéƒ¨æ ‡é¢˜ä¸­åŒ…å«Apolloã€‚</p></li><li><p>sean carrey å‡ºæ¼”äº†3wéƒ¨ä½œå“ï¼Œ40éƒ¨æ ‡é¢˜ä¸­åŒ…å«Apolloã€‚</p></li><li><p>sean carrey å‡ºæ¼”äº†50éƒ¨ä½œå“ï¼Œ10éƒ¨æ ‡é¢˜ä¸­åŒ…å«Apolloã€‚</p></li></ol><p>æµ‹è¯•ç»“æœï¼š</p><table><br><br><tr><td>åºå·</td><td>åŸæŸ¥è¯¢</td><td>ä¼˜åŒ–å</td></tr><br><tr><td>1</td><td>5</td><td>5</td></tr><br><tr><td>2</td><td>7</td><td>35</td></tr><br><tr><td>3</td><td>2400</td><td>2000</td></tr><br><br></table><p>ç»“æœåˆ†æï¼š</p><p>å®ä¾‹1ä¸­ï¼ŒæŸ¥è¯¢è¿”å›äº†ä¸€ä¸ªå¾ˆå¤§çš„ç»“æœé›†ï¼Œå› æ­¤çœ‹ä¸åˆ°ä¼˜åŒ–ç»“æœã€‚å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨è¯»å–å’Œå‘é€æ•°æ®ä¸Šäº†ã€‚</p><p>å®ä¾‹2ä¸­ï¼Œç»è¿‡ç´¢å¼•è¿‡æ»¤ï¼Œå°¤å…¶ç¬¬äºŒä¸ªæ¡ä»¶è¿‡æ»¤ååªè¿”å›å¾ˆå°‘çš„ç»“æœé›†ï¼Œä¼˜åŒ–æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œä¼˜åŒ–æŸ¥è¯¢çš„æ•ˆç‡ä¸»è¦å¾—ç›Šäºåªéœ€è¦è¯»å–40è¡Œå®Œæ•´çš„æ•°æ®è¡Œã€‚</p><p>å®ä¾‹3ä¸­ï¼Œæ˜¾ç¤ºäº†å­æŸ¥è¯¢æ•ˆç‡åè€Œä¸‹é™çš„æƒ…å†µã€‚å› ä¸ºç´¢å¼•è¿‡æ»¤ç¬¦åˆç¬¬ä¸€ä¸ªæ¡ä»¶çš„ç»“æœé›†å·²ç»å¾ˆå°ï¼Œæ‰€ä»¥å­æŸ¥è¯¢å¸¦æ¥çš„æˆæœ¬åè€Œæ¯”ä»è¡¨ä¸­ç›´æ¥æå–å®Œæ•´è¡Œæ›´é«˜ã€‚</p><h4 id="ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"><a href="#ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº" class="headerlink" title="ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"></a>ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº</h4><p>MySQLæœ‰ä¸¤ç§æ–¹å¼ç”Ÿæˆæœ‰åºçš„ç»“æœï¼šé€šè¿‡æ’åºæ“ä½œã€‚æŒ‰ç´¢å¼•é¡ºåºæ‰«æã€‚</p><p>å¦‚æœexplainå‡ºæ¥çš„typeåˆ—çš„å€¼ä¸ºindexï¼Œåˆ™è¯´æ˜MySQLä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åºã€‚</p><p>æ‰«æç´¢å¼•æœ¬èº«æ˜¯å¾ˆå¿«çš„ï¼Œå› ä¸ºåªéœ€è¦ä»ä¸€æ¡ç´¢å¼•çºªå¾‹ç§»åŠ¨åˆ°ç´§æ¥ç€çš„ä¸‹ä¸€æ¡è®°å½•ã€‚ä½†å¦‚æœç´¢å¼•ä¸èƒ½è¦†ç›–æŸ¥è¯¢æ‰€éœ€çš„å…¨éƒ¨åˆ—ï¼Œé‚£å°±ä¸å¾—ä¸æ²¡æ‰«æä¸€æ¡ç´¢å¼•è®°å½•å°±éƒ½å›è¡¨æŸ¥è¯¢ä¸€æ¬¡å¯¹åº”çš„è¡Œã€‚è¿™åŸºæœ¬ä¸Šéƒ½æ˜¯éšæœºIOï¼Œå› æ­¤æŒ‰ç´¢å¼•é¡ºåºè¯»å–æ•°æ®çš„é€Ÿåº¦é€šå¸¸è¦æ¯”é¡ºåºçš„å…¨è¡¨æ‰«ææ…¢ï¼Œå°¤å…¶æ˜¯åœ¨IOå¯†é›†å‹çš„å·¥ä½œè´Ÿè½½æ—¶ã€‚</p><p>MySQLå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç´¢å¼•æ—¢æ»¡è¶³æ’åºï¼Œåˆæ»¡è¶³æŸ¥æ‰¾è¡Œã€‚</p><p>åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’Œ order byå­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘éƒ½ä¸€æ ·æ—¶ï¼ŒMySQLæ‰èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åºã€‚å¦‚æœæŸ¥è¯¢éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œåˆ™åªæœ‰å½“order byå­å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€ä¸ªè¡¨æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºã€‚order byå­å¥å’ŒæŸ¥æ‰¾å‹æŸ¥è¯¢çš„é™åˆ¶æ˜¯ä¸€æ ·çš„ï¼šéœ€è¦æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼Œå¦åˆ™MySQLéƒ½éœ€æ‰§è¡Œæ’åºæ“ä½œï¼Œè€Œæ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºã€‚</p><p>æœ‰ä¸€ç§æƒ…å†µä¸‹ order byå­å¥å¯ä»¥ä¸æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼Œå°±æ˜¯å‰å¯¼åˆ—ä¸ºå¸¸é‡çš„æ—¶å€™ã€‚å¦‚æœWHEREå­å¥æˆ–è€…JOINå­å¥ä¸­å¯¹è¿™äº›åˆ—æŒ‡å®šäº†å¸¸é‡ï¼Œå°±å¯ä»¥å¼¥è¡¥ç´¢å¼•çš„ä¸è¶³ã€‚</p><p>ä¾‹å¦‚ï¼šè¡¨rentalåœ¨åˆ—(rental_date,inventory_id,customer_id)ä¸Šæœ‰åä¸ºrental_dateçš„ç´¢å¼•ã€‚</p><p>å»ºè¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table rental(</span><br><span class="line">    primary key(rental_id),</span><br><span class="line">    unique key rental_date(rental_date,inventory_id,customer_id),</span><br><span class="line">    key idx_fk_inventory_id(inventory_id),</span><br><span class="line">    key idx_fk_customer(customer_id),</span><br><span class="line">    key idx_fk_staff_id(staff_id),</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ’åºï¼š</p><p><code>explain select rental_id,staff_id from sakila.rental where rental_date=&#39;2005-05-25&#39; order by inventory_id, customer_id</code></p><p>å³æ—¶order by å­å¥ä¸æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼Œä¹Ÿå¯ä»¥ç”¨äºæŸ¥è¯¢æ’åºï¼Œè¿™æ˜¯å› ä¸ºç´¢å¼•çš„ç¬¬ä¸€åˆ—è¢«æŒ‡å®šä¸ºä¸€ä¸ªå¸¸æ•°ã€‚</p><p>ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•æ’åºï¼Œæ˜¯å› ä¸ºæŸ¥è¯¢ä¸ºç´¢å¼•çš„ç¬¬ä¸€åˆ—æä¾›äº†å¸¸é‡æ¡ä»¶ï¼Œè€Œä½¿ç”¨ç¬¬äºŒåˆ—è¿›è¡Œæ’åºï¼Œå°†ä¸¤åˆ—ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†ç´¢å¼•çš„æœ€å·¦å‰ç¼€,æ€»çš„æ¥è¯´åªè¦æŸ¥è¯¢æ»¡è¶³æœ€å·¦å‰ç¼€å³å¯æ’åºï¼š</p><p><code>where rental_date=&#39;2005-05-05&#39; order by inventory_id desc</code></p><p>ä¸‹é¢æ˜¯ä¸€äº›ä¸èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢ï¼š</p><ul><li><p>è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨äº†ä¸¤ç§ä¸åŒçš„æ’åºæ–¹å‘ï¼Œä½†ç´¢å¼•åˆ—éƒ½æ˜¯æ­£åºæ’åºçš„ï¼š</p><p><code>where rental_date =&#39;2005-05-25&#39; order by inventory_id desc,customer_id asc</code></p></li></ul><ul><li><p>è¿™ä¸ªæŸ¥è¯¢çš„order by å­å¥ä¸­å¼•ç”¨äº†ä¸€ä¸ªä¸åœ¨ç´¢å¼•ä¸­çš„åˆ—ï¼š</p><p><code>where rental_date =&#39;2005-05-25&#39; order by inventory_id,staff_id</code></p></li><li><p>è¿™ä¸ªæŸ¥è¯¢çš„whereå’Œorder byä¸­çš„åˆ—æ— æ³•ç»„åˆæˆç´¢å¼•çš„æœ€å·¦å‰ç¼€ï¼š</p><p><code>where rental_date =&#39;2005-05-25&#39; order by customer_id</code></p></li><li><p>è¿™ä¸ªæŸ¥è¯¢åœ¨ç´¢å¼•åˆ—çš„ç¬¬ä¸€åˆ—ä¸Šæ˜¯èŒƒå›´æ¡ä»¶ï¼Œæ‰€ä»¥MySQLæ— æ³•ä½¿ç”¨ç´¢å¼•çš„å…¶ä½™åˆ—ï¼š</p></li></ul><p><code>where rental_date &gt; &#39;2005-05-25 order by ...</code> </p><ul><li>è¿™ä¸ªæŸ¥è¯¢åœ¨inventory_idä¸Šæœ‰å¤šä¸ªç­‰äºæ¡ä»¶ï¼Œå¯¹äºæ’åºæ¥è¯´ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§èŒƒå›´æŸ¥è¯¢ï¼š</li></ul><p><code>where rental_date=&#39;2015-05-25&#39; and inventory_id in(1,2) order by customer_id</code></p><p>ä¸‹é¢è¿™ä¸ªä¾‹å­ç†è®ºä¸Šæ˜¯å¯ä»¥ä½¿ç”¨ç´¢å¼•è¿›è¡Œå…³è”æ’åºçš„ï¼Œä½†ç”±äºä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æ—¶å°†film_actorè¡¨å½“åšå…³è”çš„ç¬¬äºŒå¼ è¡¨ï¼Œæ‰€ä»¥å®é™…ä¸Šæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼š</p><p><code>explain select actor_id,title from sakila.film_actor inner join sakila.film using(film_id) order by actor_id</code></p><p>ä½¿ç”¨ç´¢å¼•æ’åºåšæ’åºçš„ä¸€ä¸ªé‡è¦çš„ç”¨æ³•æ˜¯å½“æŸ¥è¯¢åŒæ—¶æœ‰order byå’Œlimitå­å¥çš„æ—¶å€™ã€‚</p><h4 id="å‹ç¼©ç´¢å¼•"><a href="#å‹ç¼©ç´¢å¼•" class="headerlink" title="å‹ç¼©ç´¢å¼•"></a>å‹ç¼©ç´¢å¼•</h4><p>MyISAMä½¿ç”¨å‰ç¼€å‹ç¼©æ¥å‡å°‘ç´¢å¼•çš„å¤§å°ï¼Œä»è€Œè®©æ›´å¤šçš„ç´¢å¼•å¯ä»¥æ”¾å…¥åˆ°å†…å­˜ä¸­ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹èƒ½æå¤§çš„æé«˜æ€§èƒ½ã€‚é»˜è®¤åªå‹ç¼©å­—ç¬¦ä¸²ï¼Œä½†é€šè¿‡å‚æ•°è®¾ç½®ä¹Ÿå¯ä»¥å¯¹æ•´æ•°è¿›è¡Œå‹ç¼©ã€‚</p><p>MyISAMçš„å‹ç¼©æ–¹æ³•æ˜¯ï¼šå…ˆå®Œå…¨ä¿å­˜ç´¢å¼•å—çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç„¶åå°†å…¶ä»–å€¼å’Œç¬¬ä¸€ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒå¾—åˆ°ç›¸åŒçš„å‰ç¼€çš„å­—èŠ‚æ•°å’Œå‰©ä½™çš„ä¸åŒåç¼€éƒ¨åˆ†ï¼ŒæŠŠè¿™éƒ¨åˆ†å­˜å‚¨èµ·æ¥å³å¯ã€‚</p><p>å‹ç¼©å—ä½¿ç”¨æ›´å°‘çš„æ—¶é—´ï¼Œä»£ä»·æ˜¯æŸäº›æ“ä½œå¯èƒ½æ›´æ…¢ã€‚å› ä¸ºæ¯ä¸ªå€¼çš„å‹ç¼©å‰ç¼€éƒ½ä¾èµ–å‰é¢çš„å€¼ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾è€Œåªèƒ½ä»å¤´å¼€å§‹ã€‚æ­£åºå¿«ï¼Œå€’åºæ…¢ã€‚</p><p>ä½¿ç”¨pack_keysæ¥æ§åˆ¶ç´¢å¼•å‹ç¼©çš„æ–¹å¼ã€‚</p><h4 id="å†—ä½™å’Œé‡å¤çš„ç´¢å¼•"><a href="#å†—ä½™å’Œé‡å¤çš„ç´¢å¼•" class="headerlink" title="å†—ä½™å’Œé‡å¤çš„ç´¢å¼•"></a>å†—ä½™å’Œé‡å¤çš„ç´¢å¼•</h4><p>MySQLå…è®¸åœ¨ç›¸åŒåˆ—ä¸Šåˆ›å»ºå¤šä¸ªç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦å•ç‹¬ç»´æŠ¤é‡å¤çš„ç´¢å¼•ï¼Œå¹¶ä¸”ä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿéœ€è¦é€ä¸ªçš„è¿›è¡Œè€ƒè™‘ï¼Œå½±å“æ€§èƒ½ã€‚</p><p>é‡å¤ç´¢å¼•æ˜¯æŒ‡åœ¨ç›¸åŒåˆ—ä¸ŠæŒ‰ç…§ç›¸åŒçš„é¡ºåºåˆ›å»ºçš„ç›¸åŒç±»å‹çš„ç´¢å¼•ã€‚</p><p>é”™è¯¯ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">create table test(</span><br><span class="line"> id int not null primary key,</span><br><span class="line"> a int not null,</span><br><span class="line"> b int not null,</span><br><span class="line"> unique(id),</span><br><span class="line"> index(id)</span><br><span class="line">)engine=InnoDB;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å…¶å®ç»™idåˆ›å»ºäº†3æ¡ç´¢å¼•ï¼ŒMySQLçš„å”¯ä¸€é™åˆ¶å’Œä¸»é”®é™åˆ¶éƒ½æ˜¯é€šè¿‡ç´¢å¼•å®ç°çš„ã€‚</p><p>é€šå¸¸æ²¡æœ‰ç†ç”±åœ¨åŒä¸€åˆ—ä¸Šåˆ›å»ºå¤šæ¡ç´¢å¼•ï¼Œé™¤éåœ¨åŒä¸€åˆ—ä¸Šåˆ›å»ºä¸åŒç±»å‹çš„ç´¢å¼•æ¥æ»¡è¶³æŸ¥è¯¢éœ€æ±‚ã€‚ä¾‹å¦‚keyï¼ˆidï¼‰å’Œfulltext keyï¼ˆidï¼‰å°±æ˜¯ä¸¤ç§ç±»å‹çš„ç´¢å¼•ã€‚</p><p>å†—ä½™å’Œé‡å¤æœ‰äº›ä¸åŒï¼Œå¦‚æœåˆ›å»ºäº†ç´¢å¼•ï¼ˆA,Bï¼‰ï¼Œå†åˆ›å»ºï¼ˆAï¼‰ï¼Œåˆ™ï¼ˆAï¼‰å°±æ˜¯å†—ä½™çš„ã€‚è¿™ç§å†—ä½™åªæ˜¯å¯¹B-Treeæ¥è¯´çš„ã€‚å¦å¤–ï¼Œå…¶ä»–ä¸åŒç±»å‹çš„ç´¢å¼•ï¼ˆå“ˆå¸Œç´¢å¼•æˆ–è€…å…¨æ–‡ç´¢å¼•ï¼‰ä¹Ÿä¸ä¼šæ˜¯B-Treeç´¢å¼•çš„å†—ä½™ç´¢å¼•ï¼Œè€Œæ— è®ºè¦†ç›–çš„ç´¢å¼•åˆ—æ˜¯ä»€ä¹ˆã€‚</p><p>å†—ä½™ç´¢å¼•é€šå¸¸å‘ç”Ÿåœ¨ä¸ºè¡¨æ·»åŠ æ–°ç´¢å¼•çš„æ—¶å€™ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸éœ€è¦å†—ä½™ç´¢å¼•ï¼Œåº”è¯¥å°½é‡æ‰©å±•å·²ç»æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ã€‚æœ‰æ—¶å€™å‡ºäºæ€§èƒ½é—®é¢˜ä¹Ÿè€ƒè™‘å†—ä½™ç´¢å¼•ï¼Œå› ä¸ºæ‰©å±•å·²æœ‰çš„ç´¢å¼•ä¼šå¯¼è‡´å…¶å˜çš„å¤ªå¤§ï¼Œä»è€Œå½±å“å…¶ä»–ä½¿ç”¨è¯¥ç´¢å¼•çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p><h4 id="æœªä½¿ç”¨çš„ç´¢å¼•"><a href="#æœªä½¿ç”¨çš„ç´¢å¼•" class="headerlink" title="æœªä½¿ç”¨çš„ç´¢å¼•"></a>æœªä½¿ç”¨çš„ç´¢å¼•</h4><p>é™¤äº†å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼Œå¯èƒ½è¿˜ä¼šæœ‰ä¸€äº›æœåŠ¡å™¨æ°¸è¿œä¸ç”¨çš„ç´¢å¼•ã€‚å»ºè®®åˆ é™¤ã€‚</p><p>æœ€ç®€å•æœ‰æ•ˆçš„åŠæ³•æ˜¯åœ¨Percona Serveræˆ–è€…MariaDBä¸­å…ˆæ‰“å¼€userstatesæœåŠ¡å™¨å˜é‡ï¼Œç„¶åè®©æœåŠ¡å™¨æ­£å¸¸è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå†é€šè¿‡æŸ¥è¯¢Information_schema.index_statisticså°±èƒ½æŸ¥åˆ°æ¯ä¸ªç´¢å¼•çš„ä½¿ç”¨é¢‘ç‡ã€‚</p><p>è¿˜å¯ä»¥ä½¿ç”¨Percona Toolkitä¸­çš„pt-index-usageï¼Œè¯¥å·¥å…·å¯ä»¥è¯»å–æŸ¥è¯¢æ—¥å¿—ï¼Œå¹¶å¯¹æ—¥å¿—ä¸­çš„æ¯æ¡æŸ¥è¯¢è¿›è¡Œexplainæ“ä½œï¼Œç„¶åæ‰“å°å‡ºå…³äºç´¢å¼•å’ŒæŸ¥è¯¢çš„æŠ¥å‘Šã€‚</p><h4 id="ç´¢å¼•å’Œé”"><a href="#ç´¢å¼•å’Œé”" class="headerlink" title="ç´¢å¼•å’Œé”"></a>ç´¢å¼•å’Œé”</h4><p>ç´¢å¼•å¯ä»¥è®©æŸ¥è¯¢é”å®šæ›´å°‘çš„è¡Œã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>InnoDBçš„è¡Œé”æ•ˆç‡å¾ˆé«˜ï¼Œå†…å­˜ä½¿ç”¨ä¹Ÿå¾ˆå°‘ï¼Œä½†æ˜¯é”å®šè¡Œçš„æ—¶å€™ä»ç„¶ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚</p></li><li><p>é”å®šè¶…è¿‡éœ€è¦çš„è¡Œä¼šå¢åŠ é”äº‰ç”¨å¹¶å‡å°‘å¹¶å‘æ€§ã€‚</p></li></ul><p>InnoDBåªæœ‰åœ¨è®¿é—®è¡Œçš„æ—¶å€™æ‰ä¼šå¯¹å…¶åŠ é”ï¼Œè€Œç´¢å¼•èƒ½å¤Ÿå‡å°‘InnoDBè®¿é—®è¡Œæ•°ï¼Œä»è€Œå‡å°‘é”çš„æ•°é‡ã€‚åªæœ‰å½“InnoDBåœ¨å­˜å‚¨å¼•æ“å±‚èƒ½å¤Ÿè¿‡æ»¤æ‰€æœ‰ä¸éœ€è¦çš„è¡Œæ—¶æ‰æœ‰æ•ˆã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">set autocommmit = 0;</span><br><span class="line">begin;</span><br><span class="line">select actor_id from sakila.actor where actor_id &lt; 5 and actor_id &lt;&gt; 1 for update;</span><br></pre></td></tr></table></figure><table><tr><td>actor_id</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr></table><p>è¿™æ¡æŸ¥è¯¢ä»…ä»…ä¼šè¿”å›2-4è¡Œæ•°æ®ï¼Œä½†æ˜¯å®é™…ä¸Šè·å–äº†1-4è¡Œä¹‹é—´çš„è¡Œçš„æ’å®ƒé”ã€‚é”ä½ç¬¬ä¸€è¡Œæ˜¯å› ä¸ºMySQLä¸ºè¯¥æŸ¥è¯¢é€‰æ‹©çš„æ‰§è¡Œè®¡åˆ’æ˜¯ç´¢å¼•èŒƒå›´æ‰«æï¼š</p><table><br>    <tr><td>id</td><td>select_type</td><td>table</td><td>type</td><td>key</td><td>Extra</td></tr><br>    <tr><td>1</td><td>SIMPLE</td><td>actor</td><td>range</td><td>PRIMARY</td><td>Using where;Using index</td></tr><br><br></table><p>é—®é¢˜ï¼šå¦‚æœä¸èƒ½ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾å’Œé”å®šè¡Œçš„è¯é—®é¢˜å¯èƒ½ä¼šæ›´ç³Ÿç³•ï¼ŒMySQLä¼šåšå…¨è¡¨æ‰«æå¹¶é”ä½æ‰€æœ‰çš„è¡Œã€‚</p><p>InnoDBåœ¨äºŒçº§ç´¢å¼•ä¸Šä½¿ç”¨å…±äº«é”ï¼Œä½†è®¿é—®ä¸»é”®ç´¢å¼•éœ€è¦æ’ä»–é”ã€‚è¿™æ¶ˆé™¤äº†ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”ä½¿å¾—<code>select for update</code> æ¯”<code>lock in share mode</code>æˆ–éé”å®šæŸ¥è¯¢è¦æ…¢çš„å¤šã€‚</p><h3 id="ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ "><a href="#ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ " class="headerlink" title="ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ "></a>ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ </h3><h3 id="ç»´æŠ¤ç´¢å¼•å’Œè¡¨"><a href="#ç»´æŠ¤ç´¢å¼•å’Œè¡¨" class="headerlink" title="ç»´æŠ¤ç´¢å¼•å’Œè¡¨"></a>ç»´æŠ¤ç´¢å¼•å’Œè¡¨</h3><p>ç»´æŠ¤è¡¨æœ‰3ä¸ªç›®çš„ï¼šæ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨ï¼Œç»´æŠ¤å‡†ç¡®çš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ï¼Œå‡å°‘ç¢ç‰‡ã€‚</p><h4 id="æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨"><a href="#æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨" class="headerlink" title="æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨"></a>æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨</h4><p>è¡¨æŸåï¼ˆcorruptionï¼‰æ˜¯ä»¶å¾ˆç³Ÿç³•çš„äº‹æƒ…ã€‚å¯¹äºMyISAMï¼Œè¡¨æŸåé€šå¸¸æ˜¯ç³»ç»Ÿå´©æºƒå¯¼è‡´çš„ã€‚</p><p>æŸåçš„ç´¢å¼•ä¼šå¯¼è‡´æŸ¥è¯¢è¿”å›é”™è¯¯çš„ç»“æœæˆ–è€…è«é¡»æœ‰çš„ä¸»é”®å†²çªç­‰é—®é¢˜ï¼Œä¸¥é‡æ—¶ç”šè‡³è¿˜ä¼šå¯¼è‡´æ•°æ®åº“çš„å´©æºƒã€‚</p><p>ä¿®å¤ï¼š</p><ul><li><p>check tableï¼Œèƒ½æ‰¾å‡ºå¤§å¤šæ•°è¡¨å’Œç´¢å¼•é”™è¯¯ã€‚æœ‰äº›å­˜å‚¨å¼•æ“ä¸æ”¯æŒè¯¥å‘½ä»¤ã€‚</p></li><li><p>repair tableï¼Œå’Œcheckç±»ä¼¼ã€‚</p></li><li><p>alter table innodb_tbl engine=innodbï¼Œä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“ä¸ºå½“å‰å¼•æ“é‡å»ºè¡¨ã€‚</p></li><li><p>ç¦»çº¿å·¥å…·myisamchk</p></li><li><p>å°†æ•°æ®å¯¼å‡ºåœ¨é‡æ–°å¯¼å…¥ã€‚</p></li><li><p>å¦‚æœæŸåçš„æ˜¯è¡Œæ•°æ®æˆ–è€…ç³»ç»ŸåŒºåŸŸï¼Œä»¥ä¸ŠåŠæ³•æ— æ•ˆã€‚</p></li><li><p>å¦‚æœæŸåç³»ç»ŸåŒºåŸŸæˆ–è€…è¡Œæ•°æ®ï¼Œå¯ä»¥ä»å¤‡ä»½ä¸­æ¢å¤è¡¨ï¼Œæˆ–è€…å°è¯•ä»æŸåçš„æ•°æ®æ–‡ä»¶ä¸­å°½å¯èƒ½çš„æ¢å¤æ•°æ®ã€‚</p></li></ul><p>å¦‚æœInnoDBå¼•æ“çš„è¡¨å‡ºç°æŸåï¼Œé‚£ä¹ˆä¸€å®šæ˜¯å‘ç”Ÿäº†ä¸¥é‡çš„é”™è¯¯ï¼Œéœ€è¦ç«‹åˆ»è°ƒæŸ¥åŸå› ã€‚å…·ä½“ç»†èŠ‚å¯ä»¥æŸ¥çœ‹MySQLæ‰‹å†Œã€‚</p><h4 id="æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯"><a href="#æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯"></a>æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯</h4><h4 id="å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡"><a href="#å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡" class="headerlink" title="å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡"></a>å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡</h4><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸‰ä¸ªåŸåˆ™ï¼š</p><ul><li><p>å•è¡Œè®¿é—®æ—¶å¾ˆæ…¢çš„ã€‚æœ€å¥½è¯»å–å—ä¸­èƒ½åŒ…å«å°½å¯èƒ½å¤šçš„æ‰€éœ€è¦çš„è¡Œã€‚ä½¿ç”¨ç´¢å¼•å¯ä»¥åˆ›å»ºä½ç½®å¼•ç”¨ä»¥æå‡æ•ˆç‡ã€‚</p></li><li><p>æŒ‰é¡ºåºè®¿é—®èŒƒå›´æ•°æ®æ˜¯å¾ˆå¿«çš„ï¼Œè¿™æœ‰ä¸¤ä¸ªåŸå› ã€‚ç¬¬ä¸€ã€é¡ºåºIOä¸éœ€è¦å¤šæ¬¡ç£ç›˜å¯»é“ï¼Œæ‰€ä»¥æ¯”éšæœºIOå¿«å¾ˆå¤šã€‚ç¬¬äºŒã€å¦‚æœæœåŠ¡å™¨èƒ½å¤ŸæŒ‰éœ€è¦é¡ºåºè¯»å–æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦é¢å¤–çš„æ’åºæ“ä½œï¼Œå¹¶ä¸”group byæŸ¥è¯¢ä¹Ÿæ— éœ€å†åšæ’åºå’Œå°†è¡ŒæŒ‰ç»„è¿›è¡Œèšåˆè®¡ç®—äº†ã€‚</p></li><li><p>ç´¢å¼•è¦†ç›–æŸ¥è¯¢æ˜¯å¾ˆå¿«çš„ã€‚</p></li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å»ºè®®æŒ‰å“åº”æ—¶é—´æ¥å¯¹æŸ¥è¯¢è¿›è¡Œåˆ†æã€‚</p><p>å¦‚æœä¸€ä¸ªæŸ¥è¯¢æ— æ³•ä»æ‰€æœ‰å¯èƒ½çš„ç´¢å¼•ä¸­è·ç›Šï¼Œåˆ™åº”è¯¥çœ‹çœ‹æ˜¯å¦å¯ä»¥åˆ›å»ºä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•æ¥æå‡æ€§èƒ½ã€‚</p><h2 id="å‰–æMySQLæŸ¥è¯¢"><a href="#å‰–æMySQLæŸ¥è¯¢" class="headerlink" title="å‰–æMySQLæŸ¥è¯¢"></a>å‰–æMySQLæŸ¥è¯¢</h2><p>å¯¹æŸ¥è¯¢è¿›è¡Œæ€§èƒ½å‰–ææœ‰ä¸¤ç§æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å„è‡ªçš„é—®é¢˜ã€‚</p><h3 id="å‰–ææœåŠ¡å™¨è´Ÿè½½"><a href="#å‰–ææœåŠ¡å™¨è´Ÿè½½" class="headerlink" title="å‰–ææœåŠ¡å™¨è´Ÿè½½"></a>å‰–ææœåŠ¡å™¨è´Ÿè½½</h3><p>æœåŠ¡å™¨ç«¯å¯ä»¥æœ‰æ•ˆçš„å®¡è®¡æ•ˆç‡ä½ä¸‹çš„æŸ¥è¯¢ã€‚</p><h4 id="æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­"><a href="#æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­" class="headerlink" title="æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­"></a>æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­</h4><p>æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ä¸€ç§è½»é‡è€Œä¸”åŠŸèƒ½å…¨é¢çš„æ€§èƒ½å‰–æå·¥å…·ï¼Œæ˜¯ä¼˜åŒ–æœåŠ¡å™¨æŸ¥è¯¢çš„åˆ©å™¨ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹é’ˆå¯¹æ¯ä¸ªé“¾æ¥çš„long_query_timeçš„é˜ˆå€¼æ¥æ•è·æ‰€ä»¥çš„æŸ¥è¯¢ã€‚</p><p>é€šç”¨æ—¥å¿—åœ¨æŸ¥è¯¢è¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶è¿›è¡Œè®°å½•ï¼Œæ‰€ä»¥ä¸åŒ…å«å“åº”æ—¶é—´å’Œæ‰§è¡Œè®¡åˆ’ç­‰é‡è¦ä¿¡æ¯ã€‚æ—¥å¿—ä¿¡æ¯è®°å½•åˆ°æ•°æ®åº“è¡¨ä¸­ã€‚</p><h4 id="åˆ†ææŸ¥è¯¢æ—¥å¿—"><a href="#åˆ†ææŸ¥è¯¢æ—¥å¿—" class="headerlink" title="åˆ†ææŸ¥è¯¢æ—¥å¿—"></a>åˆ†ææŸ¥è¯¢æ—¥å¿—</h4><p>å·¥å…·ï¼špt-query-digest</p><p>å‰–ææŠ¥å‘Šï¼š<br><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/digest1.png?raw=true" alt="æŸ¥è¯¢æ—¥å¿—"></p><p>è¯¦ç»†æŠ¥å‘Šï¼š<br><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/digest2.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><h3 id="å‰–æå•æ¡æŸ¥è¯¢"><a href="#å‰–æå•æ¡æŸ¥è¯¢" class="headerlink" title="å‰–æå•æ¡æŸ¥è¯¢"></a>å‰–æå•æ¡æŸ¥è¯¢</h3><h4 id="show-profile"><a href="#show-profile" class="headerlink" title="show profile"></a>show profile</h4><p>show profileå‘½ä»¤æ˜¯åœ¨5.1ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ï¼Œé»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡<code>set profiling=1</code>åŠ¨æ€çš„ä¿®æ”¹ã€‚è¿™ä¸ªåŠŸèƒ½æœ‰ä¸€å®šçš„ä½œç”¨ï¼Œå°†æ¥èƒ½ä¼šè¢«Performance Schemaæ‰€å–ä»£ã€‚</p><p>ä¸‹é¢æ˜¯å¯¹ä¸€ä¸ªè§†å›¾çš„å‰–æç»“æœï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/profiling1.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/profiling2.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/profiling3.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>å‰–ææŠ¥å‘Šç»™å‡ºæŸ¥è¯¢æ‰§è¡Œæ¯ä¸ªæ­¥éª¤èŠ±è´¹çš„æ—¶é—´ï¼Œçœ‹ç»“æœæ— æ³•å¿«é€Ÿç¡®å®šå“ªä¸ªæ­¥éª¤èŠ±è´¹æ—¶é—´æœ€å¤šï¼Œå› ä¸ºè¾“å‡ºæ˜¯æŒ‰ç…§æ‰§è¡Œé¡ºåºæ’åºï¼Œè€Œä¸æ˜¯èŠ±è´¹çš„æ—¶é—´æ’åºçš„ã€‚å¦‚æœä¸ä½¿ç”¨show profileå‘½ä»¤ã€‚è¿˜å¯ä»¥ç›´æ¥æŸ¥è¯¢information_schemaä¸­å¯¹åº”çš„è¡¨ï¼ŒæŒ‰ç…§æ ¼å¼åŒ–è¾“å‡ºã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/information_schema.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>æ•ˆæœæ¯”çœ‹show profileè¾“å‡ºçš„ç»“æœå¥½å¾ˆå¤šï¼Œå¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°å“ªäº›æ­¥éª¤èŠ±è´¹æ—¶é•¿è¾ƒé•¿ã€‚</p><h2 id="æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"><a href="#æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"></a>æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</h2><h3 id="æŸ¥è¯¢æ…¢çš„åŸå› "><a href="#æŸ¥è¯¢æ…¢çš„åŸå› " class="headerlink" title="æŸ¥è¯¢æ…¢çš„åŸå› "></a>æŸ¥è¯¢æ…¢çš„åŸå› </h3><p>æŸ¥è¯¢æœ€é‡è¦çš„æ˜¯å“åº”æ—¶é—´ï¼Œå¦‚æœè¦ä¼˜åŒ–æŸ¥è¯¢ï¼Œå®é™…ä¸Šè¦ä¼˜åŒ–å…¶å­ä»»åŠ¡ï¼Œè¦ä¹ˆæ¶ˆé™¤å…¶ä¸­ä¸€äº›å­ä»»åŠ¡ï¼Œè¦ä¹ˆå‡å°‘å­ä»»åŠ¡çš„æ‰§è¡Œæ¬¡æ•°ï¼Œè¦ä¹ˆè®©å­ä»»åŠ¡è¿è¡Œæ›´å¿«ã€‚</p><p>MySQLæ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼ŒæŸ¥è¯¢éœ€è¦åœ¨ä¸åŒçš„åœ°æ–¹èŠ±è´¹æ—¶é—´ï¼Œå¦‚ç½‘ç»œã€cpuã€ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯å’Œæ‰§è¡Œè®¡åˆ’ã€é”ç­‰å¾…ç­‰ã€‚åœ¨æ¯ä¸€ä¸ªæ¶ˆè€—å¤§é‡æ—¶é—´çš„æŸ¥è¯¢æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½èƒ½çœ‹åˆ°ä¸€äº›ä¸å¿…è¦çš„é¢å¤–æ“ä½œã€æŸäº›æ“ä½œè¢«é¢å¤–çš„æ‰§è¡Œäº†å¾ˆå¤šæ¬¡ã€æŸäº›æ“ä½œæ‰§è¡Œçš„å¤ªæ…¢ç­‰ã€‚</p><p>ä¼˜åŒ–æŸ¥è¯¢çš„ç›®çš„å°±æ˜¯å‡å°‘å’Œæ¶ˆé™¤è¿™äº›æ“ä½œæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p><h3 id="æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®"><a href="#æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®" class="headerlink" title="æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®"></a>æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®</h3><p>æŸ¥è¯¢æ€§èƒ½ä½ä¸‹æœ€åŸºæœ¬çš„åŸå› æ˜¯è®¿é—®çš„æ•°æ®å¤ªå¤šã€‚æŸäº›æŸ¥è¯¢ä¸å¯é¿å…çš„éœ€è¦ç­›é€‰å¤§é‡æ•°æ®ï¼Œå¤§éƒ¨åˆ†æŸ¥è¯¢éƒ½å¯ä»¥é€šè¿‡å‡å°‘è®¿é—®çš„æ•°æ®é‡çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚å¯¹äºä½æ•ˆæŸ¥è¯¢å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤åˆ†æï¼š</p><ul><li><p>1.ç¡®è®¤åº”ç”¨ç¨‹åºæ˜¯å¦æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®ã€‚å¦‚è®¿é—®è¿‡å¤šçš„è¡Œæˆ–è€…åˆ—ã€‚</p></li><li><p>2.ç¡®å®šMySQLæœåŠ¡å™¨å±‚æ˜¯å¦åœ¨åˆ†æå¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®è¡Œã€‚</p></li></ul><h4 id="æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®"><a href="#æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®" class="headerlink" title="æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®"></a>æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®</h4><ul><li><p>æŸ¥è¯¢ä¸éœ€è¦çš„è®°å½•</p></li><li><p>å¤šè¡¨å…³è”è¿”å›å…¨éƒ¨çš„åˆ—</p></li><li><p>æ€»æ˜¯å–å‡ºå…¨éƒ¨çš„åˆ—</p></li><li><p>é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®</p></li></ul><h4 id="MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•"><a href="#MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•" class="headerlink" title="MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•"></a>MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•</h4><p>åœ¨ç¡®å®šæŸ¥è¯¢åªè¿”å›éœ€è¦çš„æ•°æ®ä»¥åï¼Œæœ€ç®€å•çš„è¡¡é‡æŸ¥è¯¢å¼€é”€çš„ä¸‰ä¸ªæŒ‡æ ‡å¦‚ä¸‹ï¼š</p><ul><li><p>å“åº”æ—¶é—´</p></li><li><p>æ‰«æçš„è¡Œæ•°</p></li><li><p>è¿”å›çš„è¡Œæ•°</p></li></ul><p>å“åº”æ—¶é—´ï¼šå“åº”æ—¶é—´åªæ˜¯ä¸€ä¸ªè¡¨é¢ä¸Šçš„å€¼ã€‚å“åº”æ—¶é—´æ˜¯æœåŠ¡æ—¶é—´å’Œæ’é˜Ÿæ—¶é—´ã€‚æœåŠ¡æ—¶é—´æŒ‡æ•°æ®åº“å¤„ç†è¿™ä¸ªæ—¶é—´èŠ±è´¹çš„æ—¶é—´ã€‚æ’é˜Ÿæ—¶é—´æŒ‡æœåŠ¡å™¨å› ä¸ºç­‰å¾…æŸäº›èµ„æºè€Œæ²¡æœ‰çœŸæ­£æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶é—´ã€‚</p><p>å¿«é€Ÿä¸Šé™ä¼°è®¡ï¼šäº†è§£æŸ¥è¯¢éœ€è¦å“ªäº›ç´¢å¼•ä»¥åŠå®ƒçš„æ‰§è¡Œè®¡åˆ’æ˜¯ä»€ä¹ˆï¼Œç„¶åè®¡ç®—å¤§æ¦‚éœ€è¦å¤šå°‘ä¸ªé¡ºåºå’ŒéšæœºIOï¼Œå†ç”¨å…¶ä¹˜ä»¥åœ¨å…·ä½“ç¡¬ä»¶æ¡ä»¶ä¸‹ä¸€æ¬¡IOçš„æ¶ˆè€—æ—¶é—´ã€‚</p><p>æ‰«æçš„è¡Œæ•°å’Œè¿”å›çš„è¡Œæ•°ï¼š åˆ†ææŸ¥è¯¢æ—¶ï¼ŒæŸ¥çœ‹æ‰«æçš„è¡Œæ•°ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åæ˜ å‡ºè¯¥æŸ¥è¯¢æ‰¾åˆ°éœ€è¦çš„æ•°æ®çš„æ•ˆç‡é«˜ä¸é«˜ã€‚</p><p>æ‰«æçš„è¡Œæ•°å’Œè®¿é—®ç±»å‹ï¼šåœ¨explainè¯­å¥ä¸­çš„typeåˆ—åæ˜ äº†è®¿é—®ç±»å‹ã€‚è®¿é—®ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œä»å…¨è¡¨æ‰«æåˆ°ç´¢å¼•æ‰«æã€èŒƒå›´æ‰«æã€å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€å¸¸æ•°å¼•ç”¨ç­‰ã€‚ä»æ…¢åˆ°å¿«ï¼Œæ‰«æçš„è¡Œæ•°ä»å°åˆ°å¤§ã€‚</p><p>å¦‚æœæŸ¥è¯¢æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„è®¿é—®ç±»å‹ï¼Œé‚£ä¹ˆè§£å†³çš„æœ€å¥½åŠæ³•é€šå¸¸æ˜¯å¢åŠ ä¸€ä¸ªåˆé€‚çš„ç´¢å¼•ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p><code>select * from sakila.film_actor where film_id = 1;</code></p><p>è¿™ä¸ªæŸ¥è¯¢è¿”å›10è¡Œæ•°æ®ï¼Œä»explainçš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒMySQLåœ¨ç´¢å¼•idx_fk_film_idä¸Šä½¿ç”¨äº†refè®¿é—®ç±»å‹æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/ref.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>explainçš„ç»“æœä¹Ÿæ˜¾ç¤ºMySQLé¢„ä¼°éœ€è¦è®¿é—®10è¡Œæ•°æ®ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨è®¤ä¸ºè¿™ç§è®¿é—®ç±»å‹å¯ä»¥é«˜æ•ˆçš„å®ŒæˆæŸ¥è¯¢ã€‚å¦‚æœæˆ‘ä»¬åˆ é™¤ç´¢å¼•å†æ¥è¿è¡Œï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/where.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>æ­£å¦‚æˆ‘ä»¬é¢„æ–™çš„ï¼ŒæŸ¥è¯¢å˜æˆå…¨è¡¨æ‰«æï¼ŒMySQLé¢„ä¼°ä¼šæ‰«æ5073æ¡è®°å½•æ¥å®ŒæˆæŸ¥è¯¢ã€‚</p><p>ä¸€èˆ¬MySQLä½¿ç”¨å¦‚ä¸‹ä¸‰ç§æ–¹å¼åº”ç”¨WHEREæ¡ä»¶ï¼Œä»å¥½åˆ°åä¾æ¬¡æ˜¯ï¼š</p><ul><li><p>åœ¨ç´¢å¼•ä¸­ä½¿ç”¨WHEREæ¡ä»¶æ¥è¿‡æ»¤ä¸åŒ¹é…çš„è®°å½•ã€‚è¿™æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®Œæˆçš„ã€‚</p></li><li><p>ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼ˆExtra:using indexï¼‰æ¥è¿”å›è®°å½•ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿‡æ»¤ä¸éœ€è¦çš„è®°å½•å¹¶è¿”å›å‘½ä¸­çš„ç»“æœã€‚è¿™æ˜¯åœ¨MySQLæœåŠ¡å™¨å±‚å®Œæˆçš„ï¼Œä½†æ— éœ€å†å›è¡¨æŸ¥è¯¢è®°å½•ã€‚</p></li><li><p>ä»æ•°æ®è¡¨ä¸­è¿”å›æ•°æ®ï¼ˆExtra:using whereï¼‰ï¼Œç„¶åè¿‡æ»¤ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚è¿™æ˜¯åœ¨æœåŠ¡å™¨å±‚å®Œæˆçš„ï¼ŒMySQLéœ€è¦ä»æ•°æ®è¡¨ä¸­è¯»å‡ºæ¥ç„¶åå†è¿›è¡Œè¿‡æ»¤ã€‚</p></li></ul><p>è™½ç„¶ä¾‹å­è¯´æ˜äº†å¥½çš„ç´¢å¼•å¤šä¹ˆé‡è¦ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯è¯´å¢åŠ äº†ç´¢å¼•å°±èƒ½è®©æ‰«æçš„è¡Œæ•°ç­‰äºè¿”å›çš„è¡Œæ•°ã€‚ä¾‹å¦‚ä½¿ç”¨èšåˆå‡½æ•°çš„æŸ¥è¯¢ï¼š</p><p><code>select actor_id,count(*) from sakila.film_actor group by actor_id</code></p><p>è¿™ä¸ªä¾‹å­æ²¡æœ‰ä»€ä¹ˆç´¢å¼•èƒ½å¤Ÿè®©è¿™æ ·çš„æŸ¥è¯¢å‡å°‘éœ€è¦æ‰«æçš„è¡Œæ•°ã€‚</p><p>é€šå¸¸å¦‚æœå‘ç°æŸ¥è¯¢éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®ä½†åªè¿”å›å°‘æ•°çš„è¡Œï¼Œé‚£ä¹ˆé€šå¸¸å¯ä»¥å°è¯•ä½¿ç”¨ä¸‹é¢çš„æŠ€å·§å»ä¼˜åŒ–ï¼š</p><ul><li><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æï¼ŒæŠŠæ‰€æœ‰éœ€è¦çš„åˆ—æ”¾åˆ°ç´¢å¼•ä¸­ï¼Œè¿™æ ·å­˜å‚¨å¼•æ“æ— éœ€å›è¡¨è·å–å¯¹åº”è¡Œå°±å¯ä»¥è¿”å›ç»“æœäº†ã€‚</p></li><li><p>æ”¹å˜åº“è¡¨ç»“æ„ã€‚ä¾‹å¦‚ä½¿ç”¨å•ç‹¬çš„æ±‡æ€»è¡¨ã€‚</p></li><li><p>é‡å†™å¤æ‚çš„æŸ¥è¯¢ï¼Œè®©MySQLä¼˜åŒ–å™¨èƒ½å¤Ÿä»¥æ›´ä¼˜åŒ–çš„æ–¹å¼æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ã€‚</p></li></ul><h3 id="é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”"><a href="#é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”" class="headerlink" title="é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”"></a>é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”</h3><h4 id="ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢"><a href="#ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢" class="headerlink" title="ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢"></a>ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢</h4><h4 id="åˆ‡åˆ†æŸ¥è¯¢"><a href="#åˆ‡åˆ†æŸ¥è¯¢" class="headerlink" title="åˆ‡åˆ†æŸ¥è¯¢"></a>åˆ‡åˆ†æŸ¥è¯¢</h4><p>å°†å¤§æŸ¥è¯¢åˆ†ä¸ºå°æŸ¥è¯¢ï¼Œæ¯ä¸ªæŸ¥è¯¢åŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼Œåªå®Œæˆä¸€å°éƒ¨åˆ†ï¼Œæ¯æ¬¡è¿”å›ä¸€å°éƒ¨åˆ†æŸ¥è¯¢ç»“æœã€‚åˆ é™¤æ—§æ•°æ®å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­</p><h4 id="åˆ†è§£å…³è”æŸ¥è¯¢"><a href="#åˆ†è§£å…³è”æŸ¥è¯¢" class="headerlink" title="åˆ†è§£å…³è”æŸ¥è¯¢"></a>åˆ†è§£å…³è”æŸ¥è¯¢</h4><p>å¯¹æ¯ä¸€ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡å•è¡¨æŸ¥è¯¢ï¼Œç„¶åå°†ç»“æœåœ¨åº”ç”¨ç¨‹åºä¸­å…³è”ã€‚</p><p>åˆ†è§£å…³è”æŸ¥è¯¢çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>è®©ç¼“å­˜æ•ˆç‡è·Ÿé«˜ã€‚</p></li><li><p>æ‰§è¡Œå•ä¸ªæŸ¥è¯¢å¯ä»¥å‡å°‘é”çš„ç«äº‰ã€‚</p></li><li><p>åšåº”ç”¨å±‚å…³è”ï¼Œå¯ä»¥æ›´å¥½çš„å¯¹æ•°æ®åº“æ‹†åˆ†ï¼Œæ›´å®¹æ˜“åšåˆ°ï¼Œé«˜æ€§èƒ½å¯æ‰©å±•ã€‚</p></li><li><p>æŸ¥è¯¢æ•ˆç‡æœ¬èº«æ•ˆç‡ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€æå‡ã€‚</p></li><li><p>å¯ä»¥å‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚</p></li><li><p>è¿™æ ·åšç›¸å½“äºåœ¨åº”ç”¨ä¸­å®ç°äº†å“ˆå¸Œå…³è”è€Œä¸æ˜¯MySQLçš„åµŒå¥—å¾ªç¯å…³è”ã€‚</p></li></ul><h3 id="æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"><a href="#æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€" class="headerlink" title="æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"></a>æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€</h3><p>æŸ¥è¯¢æ‰§è¡Œè·¯å¾„ï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/process.png?raw=true" alt="æŸ¥è¯¢æ‰§è¡Œè·¯å¾„"></p><h3 id="MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§"><a href="#MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§" class="headerlink" title="MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§"></a>MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§</h3><h3 id="æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º"><a href="#æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º"></a>æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º</h3><h3 id="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"><a href="#ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"></a>ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢</h3><h3 id="æ¡ˆä¾‹å­¦ä¹ "><a href="#æ¡ˆä¾‹å­¦ä¹ " class="headerlink" title="æ¡ˆä¾‹å­¦ä¹ "></a>æ¡ˆä¾‹å­¦ä¹ </h3><h2 id="MySQLçš„é«˜çº§ç‰¹æ€§"><a href="#MySQLçš„é«˜çº§ç‰¹æ€§" class="headerlink" title="MySQLçš„é«˜çº§ç‰¹æ€§"></a>MySQLçš„é«˜çº§ç‰¹æ€§</h2><ul><li><p>åˆ†åŒºè¡¨</p></li><li><p>è§†å›¾</p></li><li><p>å¤–é”®çº¦æŸ</p></li><li><p>MySQLå†…éƒ¨å­˜å‚¨ä»£ç </p></li><li><p>æ¸¸æ ‡</p></li><li><p>ç»‘å®šå˜é‡</p></li><li><p>ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</p></li><li><p>æ’ä»¶</p></li><li><p>å­—ç¬¦é›†å’Œæ ¡å¯¹</p></li><li><p>å…¨æ–‡ç´¢å¼•</p></li><li><p>åˆ†å¸ƒå¼ï¼ˆXAï¼‰äº‹åŠ¡</p></li><li><p>æŸ¥è¯¢ç¼“å­˜</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å¼•æ“ç¯‡&quot;&gt;&lt;a href=&quot;#å¼•æ“ç¯‡&quot; class=&quot;headerlink&quot; title=&quot;å¼•æ“ç¯‡&quot;&gt;&lt;/a&gt;å¼•æ“ç¯‡&lt;/h2&gt;&lt;h3 id=&quot;MyISAM&quot;&gt;&lt;a href=&quot;#MyISAM&quot; class=&quot;headerlink&quot; title=&quot;MyISAM&quot;&gt;&lt;
      
    
    </summary>
    
    
      <category term="MySQL" scheme="http://zhongyp.me/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>é—­é”å’Œæ …æ </title>
    <link href="http://zhongyp.me/2018/03/29/concurrent/2018-03-29-Latch-CyclicBarrier/"/>
    <id>http://zhongyp.me/2018/03/29/concurrent/2018-03-29-Latch-CyclicBarrier/</id>
    <published>2018-03-28T16:00:00.000Z</published>
    <updated>2018-11-10T10:00:04.504Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—­é”"><a href="#é—­é”" class="headerlink" title="é—­é”"></a>é—­é”</h2><p>é—­é”ï¼ˆLatchï¼‰ï¼šä¸€ç§åŒæ­¥æ–¹æ³•ï¼Œå¯ä»¥å»¶è¿Ÿçº¿ç¨‹çš„è¿›åº¦ç›´åˆ°çº¿ç¨‹åˆ°è¾¾æŸä¸ªç»ˆç‚¹çŠ¶æ€ã€‚é€šä¿—çš„è®²å°±æ˜¯ï¼Œä¸€ä¸ªé—­é”ç›¸å½“äºä¸€æ‰‡å¤§é—¨ï¼Œåœ¨å¤§é—¨æ‰“å¼€ä¹‹å‰æ‰€æœ‰çº¿ç¨‹éƒ½è¢«é˜»æ–­ï¼Œä¸€æ—¦å¤§é—¨æ‰“å¼€æ‰€æœ‰çº¿ç¨‹éƒ½å°†é€šè¿‡ï¼Œä½†æ˜¯ä¸€æ—¦å¤§é—¨æ‰“å¼€ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½é€šè¿‡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªé—­é”çš„çŠ¶æ€å°±å¤±æ•ˆäº†ï¼Œé—¨çš„çŠ¶æ€ä¹Ÿå°±ä¸èƒ½å˜äº†ï¼Œåªèƒ½æ˜¯æ‰“å¼€çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´é—­é”çš„çŠ¶æ€æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒç¡®ä¿åœ¨é—­é”æ‰“å¼€ä¹‹å‰æ‰€æœ‰ç‰¹å®šçš„æ´»åŠ¨éƒ½éœ€è¦åœ¨é—­é”æ‰“å¼€ä¹‹åæ‰èƒ½å®Œæˆã€‚</p><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>ç¡®ä¿æŸä¸ªè®¡ç®—åœ¨å…¶éœ€è¦çš„æ‰€æœ‰èµ„æºéƒ½è¢«åˆå§‹åŒ–ä¹‹åæ‰ç»§ç»­æ‰§è¡Œã€‚äºŒå…ƒé—­é”ï¼ˆåŒ…æ‹¬ä¸¤ä¸ªçŠ¶æ€ï¼‰å¯ä»¥ç”¨æ¥è¡¨ç¤ºâ€œèµ„æºRå·²ç»è¢«åˆå§‹åŒ–â€ï¼Œè€Œæ‰€æœ‰éœ€è¦Rçš„æ“ä½œéƒ½å¿…é¡»å…ˆåœ¨è¿™ä¸ªé—­é”ä¸Šç­‰å¾…ã€‚</p></li><li><p>ç¡®ä¿æŸä¸ªæœåŠ¡åœ¨å…¶ä¾èµ–çš„æ‰€æœ‰å…¶ä»–æœåŠ¡éƒ½å·²ç»å¯åŠ¨ä¹‹åæ‰å¯åŠ¨ã€‚</p></li><li><p>ç­‰å¾…ç›´åˆ°æŸä¸ªæ“ä½œçš„æ‰€æœ‰å‚ä¸è€…éƒ½å°±ç»ªåœ¨ç»§ç»­æ‰§è¡Œã€‚ï¼ˆä¾‹å¦‚ï¼šå¤šäººæ¸¸æˆä¸­éœ€è¦æ‰€æœ‰ç©å®¶å‡†å¤‡æ‰èƒ½å¼€å§‹ï¼‰</p></li></ul><p>CountDownLatchæ˜¯JDK 5+é‡Œé¢é—­é”çš„ä¸€ä¸ªå®ç°ï¼Œå…è®¸ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‘ç”Ÿã€‚CountDownLatchæœ‰ä¸€ä¸ªæ­£æ•°è®¡æ•°å™¨ï¼ŒcountDownæ–¹æ³•å¯¹è®¡æ•°å™¨åšå‡æ“ä½œï¼Œawaitæ–¹æ³•ç­‰å¾…è®¡æ•°å™¨è¾¾åˆ°0ã€‚æ‰€æœ‰awaitçš„çº¿ç¨‹éƒ½ä¼šé˜»å¡ç›´åˆ°è®¡æ•°å™¨ä¸º0æˆ–è€…ç­‰å¾…çº¿ç¨‹ä¸­æ–­æˆ–è€…è¶…æ—¶ã€‚</p><p><a href="https://github.com/zhongyp/Demo/tree/master/src/main/java/com/zhongyp/thread/latchcyclicbarrier" target="_blank" rel="noopener">çœ‹æºç å®ä¾‹ç‚¹æˆ‘ï¼</a></p><h2 id="æ …æ "><a href="#æ …æ " class="headerlink" title="æ …æ "></a>æ …æ </h2><p>æ …æ ç±»ä¼¼äºé—­é”ï¼Œå®ƒèƒ½é˜»å¡ä¸€ç»„çº¿ç¨‹ç›´åˆ°æŸä¸ªäº‹ä»¶å‘ç”Ÿã€‚ æ …æ ä¸é—­é”çš„å…³é”®åŒºåˆ«åœ¨äºï¼Œæ‰€æœ‰çš„çº¿ç¨‹å¿…é¡»åŒæ—¶åˆ°è¾¾æ …æ ä½ç½®ï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚é—­é”ç”¨äºç­‰å¾…äº‹ä»¶ï¼Œè€Œæ …æ ç”¨äºç­‰å¾…å…¶ä»–çº¿ç¨‹ã€‚<br>åœºæ™¯ï¼š åº”ç”¨ä¸€äº›åè®®ï¼Œæ¯”å¦‚å‡ ä¸ªå®¶åº­æˆå‘˜å†³å®šåœ¨æŸä¸ªåœ°æ–¹é›†åˆï¼Œæ‰€æœ‰äººåœ¨6ï¼š00åœ¨æŸåœ°é›†åˆï¼Œåˆ°äº†ä»¥åè¦ç­‰å¾…å…¶ä»–äººï¼Œä¹‹åæ‰èƒ½è®¨è®ºå»å“ªé‡Œåƒé¥­ã€‚ å¹¶è¡Œè¿­ä»£ï¼Œå°†ä¸€ä¸ªé—®é¢˜åˆ†æˆå¾ˆå¤šå­é—®é¢˜ï¼Œå½“ä¸€ç³»åˆ—çš„å­é—®é¢˜éƒ½è§£å†³ä¹‹åï¼ˆæ‰€æœ‰å­é—®é¢˜çº¿ç¨‹éƒ½å·²ç»awaitï¼ˆï¼‰ï¼‰ï¼Œæ­¤æ—¶å°†æ …æ æ‰“å¼€ï¼Œæ‰€æœ‰å­é—®é¢˜çº¿ç¨‹è¢«é‡Šæ”¾ï¼Œè€Œæ …æ ä½ç½®å¯ä»¥ç•™ç€ä¸‹æ¬¡ä½¿ç”¨ã€‚</p><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://blog.csdn.net/yujin753/article/details/46125283" target="_blank" rel="noopener">å‚è€ƒåŸæ–‡</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—­é”&quot;&gt;&lt;a href=&quot;#é—­é”&quot; class=&quot;headerlink&quot; title=&quot;é—­é”&quot;&gt;&lt;/a&gt;é—­é”&lt;/h2&gt;&lt;p&gt;é—­é”ï¼ˆLatchï¼‰ï¼šä¸€ç§åŒæ­¥æ–¹æ³•ï¼Œå¯ä»¥å»¶è¿Ÿçº¿ç¨‹çš„è¿›åº¦ç›´åˆ°çº¿ç¨‹åˆ°è¾¾æŸä¸ªç»ˆç‚¹çŠ¶æ€ã€‚é€šä¿—çš„è®²å°±æ˜¯ï¼Œä¸€ä¸ªé—­é”ç›¸å½“äºä¸€æ‰‡å¤§é—¨ï¼Œåœ¨å¤§é—¨æ‰“å¼€ä¹‹å‰æ‰€æœ‰çº¿ç¨‹éƒ½
      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="http://zhongyp.me/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Callableã€Futureã€FutureTask</title>
    <link href="http://zhongyp.me/2018/03/29/concurrent/2018-03-29-Callable/"/>
    <id>http://zhongyp.me/2018/03/29/concurrent/2018-03-29-Callable/</id>
    <published>2018-03-28T16:00:00.000Z</published>
    <updated>2018-10-02T01:27:53.323Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h2><p>Callableæ¥å£ç±»ä¼¼äºRunnableï¼Œä¸¤è€…éƒ½æ˜¯ä¸ºé‚£äº›å…¶å®ä¾‹å¯èƒ½è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ç±»è®¾è®¡çš„ï¼Œæ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚ä½†æ˜¯Runnableä¸è¡Œã€‚</p><p>Callableéœ€è¦ä¾èµ–FutureTaskï¼Œç”¨äºæ¥æ”¶è¿ç®—ç»“æœã€‚ä¸€ä¸ªäº§ç”Ÿç»“æœï¼Œä¸€ä¸ªæ‹¿åˆ°ç»“æœã€‚FutureTaskæ˜¯Futureæ¥å£çš„å®ç°ç±»ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œé—­é”ï¼ˆï¼‰ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/Callable.png?raw=true" alt="ç±»å›¾"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Callable&quot;&gt;&lt;a href=&quot;#Callable&quot; class=&quot;headerlink&quot; title=&quot;Callable&quot;&gt;&lt;/a&gt;Callable&lt;/h2&gt;&lt;p&gt;Callableæ¥å£ç±»ä¼¼äºRunnableï¼Œä¸¤è€…éƒ½æ˜¯ä¸ºé‚£äº›å…¶å®ä¾‹å¯èƒ½è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ç±»è®¾è®¡
      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="http://zhongyp.me/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Javaç±»åŠ è½½å’ŒåŒäº²å§”æ´¾æœºåˆ¶</title>
    <link href="http://zhongyp.me/2018/03/28/jvm/2018-03-28-Classloader/"/>
    <id>http://zhongyp.me/2018/03/28/jvm/2018-03-28-Classloader/</id>
    <published>2018-03-27T16:00:00.000Z</published>
    <updated>2018-10-27T03:30:00.056Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMç±»åŠ è½½æœºåˆ¶"><a href="#JVMç±»åŠ è½½æœºåˆ¶" class="headerlink" title="JVMç±»åŠ è½½æœºåˆ¶"></a>JVMç±»åŠ è½½æœºåˆ¶</h2><p>â€¢å…¨ç›˜è´Ÿè´£ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æŸä¸ªClassæ—¶ï¼Œè¯¥Classæ‰€ä¾èµ–çš„å’Œå¼•ç”¨çš„å…¶ä»–Classä¹Ÿå°†ç”±è¯¥ç±»åŠ è½½å™¨è´Ÿè´£è½½å…¥ï¼Œé™¤éæ˜¾ç¤ºä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»åŠ è½½å™¨æ¥è½½å…¥</p><p>â€¢çˆ¶ç±»å§”æ‰˜ï¼Œå…ˆè®©çˆ¶ç±»åŠ è½½å™¨è¯•å›¾åŠ è½½è¯¥ç±»ï¼Œåªæœ‰åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶æ‰å°è¯•ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­åŠ è½½è¯¥ç±»</p><p>â€¢ç¼“å­˜æœºåˆ¶ï¼Œç¼“å­˜æœºåˆ¶å°†ä¼šä¿è¯æ‰€æœ‰åŠ è½½è¿‡çš„Classéƒ½ä¼šè¢«ç¼“å­˜ï¼Œå½“ç¨‹åºä¸­éœ€è¦ä½¿ç”¨æŸä¸ªClassæ—¶ï¼Œç±»åŠ è½½å™¨å…ˆä»ç¼“å­˜åŒºå¯»æ‰¾è¯¥Classï¼Œåªæœ‰ç¼“å­˜åŒºä¸å­˜åœ¨ï¼Œç³»ç»Ÿæ‰ä¼šè¯»å–è¯¥ç±»å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢æˆClasså¯¹è±¡ï¼Œå­˜å…¥ç¼“å­˜åŒºã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¿®æ”¹äº†Classåï¼Œå¿…é¡»é‡å¯JVMï¼Œç¨‹åºçš„ä¿®æ”¹æ‰ä¼šç”Ÿæ•ˆ</p><p>ç±»çš„åŠ è½½æŒ‡çš„æ˜¯å°†ç±»çš„.classæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œç„¶ååœ¨å †åŒºåˆ›å»ºä¸€ä¸ªjava.lang.Classå¯¹è±¡ï¼Œç”¨æ¥å°è£…ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ã€‚ç±»çš„åŠ è½½çš„æœ€ç»ˆäº§å“æ˜¯ä½äºå †åŒºä¸­çš„Classå¯¹è±¡ï¼ŒClasså¯¹è±¡å°è£…äº†ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å‘Javaç¨‹åºå‘˜æä¾›äº†è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ã€‚</p><p>åŠ è½½.classæ–‡ä»¶çš„æ–¹å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â€“ ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½</span><br><span class="line">â€“ é€šè¿‡ç½‘ç»œä¸‹è½½.classæ–‡ä»¶</span><br><span class="line">â€“ ä»zipï¼Œjarç­‰å½’æ¡£æ–‡ä»¶ä¸­åŠ è½½.classæ–‡ä»¶</span><br><span class="line">â€“ ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå–.classæ–‡ä»¶</span><br><span class="line">â€“ å°†Javaæºæ–‡ä»¶åŠ¨æ€ç¼–è¯‘ä¸º.classæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç±»åŠ è½½çš„è¿‡ç¨‹åŒ…æ‹¬äº†åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–äº”ä¸ªé˜¶æ®µã€‚åœ¨è¿™äº”ä¸ªé˜¶æ®µä¸­ï¼ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡å’Œåˆå§‹åŒ–è¿™å››ä¸ªé˜¶æ®µå‘ç”Ÿçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œè€Œè§£æé˜¶æ®µåˆ™ä¸ä¸€å®šï¼Œå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆä¹Ÿæˆä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®šï¼‰ã€‚å¦å¤–æ³¨æ„è¿™é‡Œçš„å‡ ä¸ªé˜¶æ®µæ˜¯æŒ‰é¡ºåºå¼€å§‹ï¼Œè€Œä¸æ˜¯æŒ‰é¡ºåºè¿›è¡Œæˆ–å®Œæˆï¼Œå› ä¸ºè¿™äº›é˜¶æ®µé€šå¸¸éƒ½æ˜¯äº’ç›¸äº¤å‰åœ°æ··åˆè¿›è¡Œçš„ï¼Œé€šå¸¸åœ¨ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨æˆ–æ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µã€‚</p><ul><li>åŠ è½½ï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®</li></ul><p>åŠ è½½æ—¶ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨åŠ è½½é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š</p><p>1ã€é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å…¶å®šä¹‰çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</p><p>2ã€å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</p><p>3ã€åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</p><p>ç›¸å¯¹äºç±»åŠ è½½çš„å…¶ä»–é˜¶æ®µè€Œè¨€ï¼ŒåŠ è½½é˜¶æ®µï¼ˆå‡†ç¡®åœ°è¯´ï¼Œæ˜¯åŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œå› ä¸ºå¼€å‘äººå‘˜æ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ã€‚</p><p>åŠ è½½é˜¶æ®µå®Œæˆåï¼Œè™šæ‹Ÿæœºå¤–éƒ¨çš„ äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€éœ€çš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œè€Œä¸”åœ¨Javaå †ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼Œè¿™æ ·ä¾¿å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è®¿é—®æ–¹æ³•åŒºä¸­çš„è¿™äº›æ•°æ®ã€‚åŠ è½½ååœ¨å¸¸é‡æ± å­˜å‚¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p><ul><li>éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§</li></ul><p>éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š</p><p>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥0xCAFEBABEå¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹ã€‚</p><p>å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ã€‚</p><p>å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚</p><p>ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚</p><p>éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨-Xverifynoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚</p><ul><li>å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</li></ul><p>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><p>1ã€è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨Javaå †ä¸­ã€‚</p><p>2ã€è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚0ã€0Lã€nullã€falseç­‰ï¼‰ï¼Œè€Œä¸æ˜¯è¢«åœ¨Javaä»£ç ä¸­è¢«æ˜¾å¼åœ°èµ‹äºˆçš„å€¼ã€‚</p><p>å‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼špublic static int value = 3ï¼›</p><p>é‚£ä¹ˆå˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0ï¼Œè€Œä¸æ˜¯3ï¼Œå› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•Javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º3çš„putstaticæŒ‡ä»¤æ˜¯åœ¨ç¨‹åºç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨<clinit>()æ–¹æ³•ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º3çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚</clinit></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">è¿™é‡Œè¿˜éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š</span><br><span class="line"></span><br><span class="line">å¯¹åŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œå¯¹äºç±»å˜é‡ï¼ˆstaticï¼‰å’Œå…¨å±€å˜é‡ï¼Œå¦‚æœä¸æ˜¾å¼åœ°å¯¹å…¶èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œåˆ™ç³»ç»Ÿä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œè€Œå¯¹äºå±€éƒ¨å˜é‡æ¥è¯´ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ã€‚</span><br><span class="line"></span><br><span class="line">static int d;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">    int c;</span><br><span class="line">    System.out.println(d + &quot; &quot; + c);//då¯ä»¥ç¼–è¯‘ä¸æŠ¥é”™ï¼ŒcæŠ¥é”™ã€‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¯¹äºåŒæ—¶è¢«staticå’Œfinalä¿®é¥°çš„å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™å°±ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ï¼›è€Œåªè¢«finalä¿®é¥°çš„å¸¸é‡åˆ™æ—¢å¯ä»¥åœ¨å£°æ˜æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»åˆå§‹åŒ–æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œæ€»ä¹‹ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤é›¶å€¼ã€‚</span><br><span class="line"></span><br><span class="line">å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹referenceæ¥è¯´ï¼Œå¦‚æ•°ç»„å¼•ç”¨ã€å¯¹è±¡å¼•ç”¨ç­‰ï¼Œå¦‚æœæ²¡æœ‰å¯¹å…¶è¿›è¡Œæ˜¾å¼åœ°èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œå³nullã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœåœ¨æ•°ç»„åˆå§‹åŒ–æ—¶æ²¡æœ‰å¯¹æ•°ç»„ä¸­çš„å„å…ƒç´ èµ‹å€¼ï¼Œé‚£ä¹ˆå…¶ä¸­çš„å…ƒç´ å°†æ ¹æ®å¯¹åº”çš„æ•°æ®ç±»å‹è€Œè¢«èµ‹äºˆé»˜è®¤çš„é›¶å€¼ã€‚</span><br></pre></td></tr></table></figure><p>3ã€å¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨ä¸­å­˜åœ¨ConstantValueå±æ€§ï¼Œå³åŒæ—¶è¢«finalå’Œstaticä¿®é¥°ï¼Œé‚£ä¹ˆåœ¨å‡†å¤‡é˜¶æ®µå˜é‡valueå°±ä¼šè¢«åˆå§‹åŒ–ä¸ºConstValueå±æ€§æ‰€æŒ‡å®šçš„å€¼ã€‚</p><p>å‡è®¾ä¸Šé¢çš„ç±»å˜é‡valueè¢«å®šä¹‰ä¸ºï¼š public static final int value = 3ï¼›</p><p>ç¼–è¯‘æ—¶Javacå°†ä¼šä¸ºvalueç”ŸæˆConstantValueå±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ®ConstantValueçš„è®¾ç½®å°†valueèµ‹å€¼ä¸º3ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºstatic finalå¸¸é‡åœ¨ç¼–è¯‘æœŸå°±å°†å…¶ç»“æœæ”¾å…¥äº†è°ƒç”¨å®ƒçš„ç±»çš„å¸¸é‡æ± ä¸­</p><ul><li>è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li></ul><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚</p><p>ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</p><ul><li>åˆå§‹åŒ–ï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVMè´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨Javaä¸­å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹å€¼è®¾å®šæœ‰ä¸¤ç§æ–¹å¼ï¼š</li></ul><p>â‘ å£°æ˜ç±»å˜é‡æ˜¯æŒ‡å®šåˆå§‹å€¼</p><p>â‘¡ä½¿ç”¨é™æ€ä»£ç å—ä¸ºç±»å˜é‡æŒ‡å®šåˆå§‹å€¼</p><p>JVMåˆå§‹åŒ–æ­¥éª¤</p><p>1ã€å‡å¦‚è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½å’Œè¿æ¥ï¼Œåˆ™ç¨‹åºå…ˆåŠ è½½å¹¶è¿æ¥è¯¥ç±»</p><p>2ã€å‡å¦‚è¯¥ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±»</p><p>3ã€å‡å¦‚ç±»ä¸­æœ‰åˆå§‹åŒ–è¯­å¥ï¼Œåˆ™ç³»ç»Ÿä¾æ¬¡æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥</p><p>ç±»åˆå§‹åŒ–æ—¶æœºï¼šåªæœ‰å½“å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼Œç±»çš„ä¸»åŠ¨ä½¿ç”¨åŒ…æ‹¬ä»¥ä¸‹å…­ç§ï¼š</p><p>â€“ åˆ›å»ºç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯newçš„æ–¹å¼</p><p>â€“ è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</p><p>â€“ è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</p><p>â€“ åå°„ï¼ˆå¦‚Class.forName(â€œcom.shengsiyuan.Testâ€)ï¼‰</p><p>â€“ åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±»ï¼Œåˆ™å…¶çˆ¶ç±»ä¹Ÿä¼šè¢«åˆå§‹åŒ–</p><p>â€“ Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»ï¼ˆJava Testï¼‰ï¼Œç›´æ¥ä½¿ç”¨java.exeå‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»</p><p>åœ¨å¦‚ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼ŒJavaè™šæ‹Ÿæœºå°†ç»“æŸç”Ÿå‘½å‘¨æœŸ</p><p>â€“ æ‰§è¡Œäº†System.exit()æ–¹æ³•</p><p>â€“ ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ</p><p>â€“ ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢</p><p>â€“ ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´Javaè™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢</p><h2 id="Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹"><a href="#Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹"></a>Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹</h2><p>newä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæ ¹æ®newçš„å‚æ•°åœ¨å¸¸é‡æ± ä¸­å®šä½ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¯´æ˜ç±»æœªè¢«åŠ è½½ï¼Œåˆ™è¿›è¡Œç±»åŠ è½½ç­‰ç­‰ä¸Šé¢5ä¸ªæ­¥éª¤ã€‚</p><h2 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h2><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œæµç¨‹æ˜¯ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡å‘ä¸Šï¼Œå› æ­¤ï¼Œæ‰€æœ‰çš„ç±»åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥è¢«ä¼ é€’åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åœ¨å®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»æ—¶ï¼Œå³æ— æ³•å®Œæˆè¯¥åŠ è½½ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¯¥ç±»ã€‚</p><p>è¿‡ç¨‹ï¼š</p><p>1ã€å½“AppClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ExtClassLoaderå»å®Œæˆã€‚</p><p>2ã€å½“ExtClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¹Ÿä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™BootStrapClassLoaderå»å®Œæˆã€‚</p><p>3ã€å¦‚æœBootStrapClassLoaderåŠ è½½å¤±è´¥ï¼ˆä¾‹å¦‚åœ¨$JAVA_HOME/jre/libé‡ŒæœªæŸ¥æ‰¾åˆ°è¯¥classï¼‰ï¼Œä¼šä½¿ç”¨ExtClassLoaderæ¥å°è¯•åŠ è½½ï¼›</p><p>4ã€è‹¥ExtClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šä½¿ç”¨AppClassLoaderæ¥åŠ è½½ï¼Œå¦‚æœAppClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ClassNotFoundExceptionã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹æ„ä¹‰ï¼š</p><p>-ç³»ç»Ÿç±»é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä»½åŒæ ·çš„å­—èŠ‚ç </p><p>-ä¿è¯Javaç¨‹åºå®‰å…¨ç¨³å®šè¿è¡Œ</p><h2 id="Javaç±»åŠ è½½å™¨"><a href="#Javaç±»åŠ è½½å™¨" class="headerlink" title="Javaç±»åŠ è½½å™¨"></a>Javaç±»åŠ è½½å™¨</h2><p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼šBootstrap ClassLoaderï¼Œè´Ÿè´£åŠ è½½å­˜æ”¾åœ¨JDK\jre\lib(JDKä»£è¡¨JDKçš„å®‰è£…ç›®å½•ï¼Œä¸‹åŒ)ä¸‹ï¼Œæˆ–è¢«-Xbootclasspathå‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”èƒ½è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“ï¼ˆå¦‚rt.jarï¼Œæ‰€æœ‰çš„java.*å¼€å¤´çš„ç±»å‡è¢«Bootstrap ClassLoaderåŠ è½½ï¼‰ã€‚å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨çš„ã€‚</p><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼šExtension ClassLoaderï¼Œè¯¥åŠ è½½å™¨ç”±sun.misc.Launcher$ExtClassLoaderå®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½DK\jre\lib\extç›®å½•ä¸­ï¼Œæˆ–è€…ç”±java.ext.dirsç³»ç»Ÿå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼ˆå¦‚javax.*å¼€å¤´çš„ç±»ï¼‰ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚</p><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼šApplication ClassLoaderï¼Œè¯¥ç±»åŠ è½½å™¨ç”±sun.misc.Launcher$AppClassLoaderæ¥å®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰æ‰€æŒ‡å®šçš„ç±»ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</p><p>åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±è¿™ä¸‰ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆè¿›è¡ŒåŠ è½½çš„ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚å› ä¸ºJVMè‡ªå¸¦çš„ClassLoaderåªæ˜¯æ‡‚å¾—ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½æ ‡å‡†çš„java classæ–‡ä»¶ï¼Œå› æ­¤å¦‚æœç¼–å†™äº†è‡ªå·±çš„ClassLoaderï¼Œä¾¿å¯ä»¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š</p><p>1ï¼‰åœ¨æ‰§è¡Œéç½®ä¿¡ä»£ç ä¹‹å‰ï¼Œè‡ªåŠ¨éªŒè¯æ•°å­—ç­¾åã€‚</p><p>2ï¼‰åŠ¨æ€åœ°åˆ›å»ºç¬¦åˆç”¨æˆ·ç‰¹å®šéœ€è¦çš„å®šåˆ¶åŒ–æ„å»ºç±»ã€‚</p><p>3ï¼‰ä»ç‰¹å®šçš„åœºæ‰€å–å¾—java classï¼Œä¾‹å¦‚æ•°æ®åº“ä¸­å’Œç½‘ç»œä¸­ã€‚</p><p>ç±»åŠ è½½æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><p>1ã€å‘½ä»¤è¡Œå¯åŠ¨åº”ç”¨æ—¶å€™ç”±JVMåˆå§‹åŒ–åŠ è½½</p><p>2ã€é€šè¿‡Class.forName()æ–¹æ³•åŠ¨æ€åŠ è½½</p><p>3ã€é€šè¿‡ClassLoader.loadClass()æ–¹æ³•åŠ¨æ€åŠ è½½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ClassLoader loader = HelloWorld.class.getClassLoader();</span><br><span class="line">System.out.println(loader);</span><br><span class="line">//ä½¿ç”¨ClassLoader.loadClass()æ¥åŠ è½½ç±»ï¼Œä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–å—</span><br><span class="line">loader.loadClass(&quot;Test2&quot;);</span><br><span class="line">//ä½¿ç”¨Class.forName()æ¥åŠ è½½ç±»ï¼Œé»˜è®¤ä¼šæ‰§è¡Œåˆå§‹åŒ–å—</span><br><span class="line">//                Class.forName(&quot;Test2&quot;);</span><br><span class="line">//ä½¿ç”¨Class.forName()æ¥åŠ è½½ç±»ï¼Œå¹¶æŒ‡å®šClassLoaderï¼Œåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œé™æ€å—</span><br><span class="line">//                Class.forName(&quot;Test2&quot;, false, loader);</span><br><span class="line"></span><br><span class="line">public class Test2 &#123;</span><br><span class="line">        static &#123;</span><br><span class="line">                System.out.println(&quot;é™æ€åˆå§‹åŒ–å—æ‰§è¡Œäº†ï¼&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ä½†æ˜¯ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚æ¯”å¦‚åº”ç”¨æ˜¯é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“ Java ç±»çš„å­—èŠ‚ç ï¼Œä¸ºä¿è¯å®‰å…¨æ€§ï¼Œè¿™äº›å­—èŠ‚ç ç»è¿‡äº†åŠ å¯†å¤„ç†ï¼Œè¿™æ—¶ç³»ç»Ÿç±»åŠ è½½å™¨å°±æ— æ³•å¯¹å…¶è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·åˆ™éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°ã€‚è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬éƒ½æ˜¯ç»§æ‰¿è‡ª ClassLoader ç±»ï¼Œä»ä¸Šé¢å¯¹ loadClass æ–¹æ³•æ¥åˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬åªéœ€è¦é‡å†™ findClass æ–¹æ³•å³å¯ã€‚</p><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/ityouknow/p/5603287.html" target="_blank" rel="noopener">å°Šé‡åŸåˆ›</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;JVMç±»åŠ è½½æœºåˆ¶&quot;&gt;&lt;a href=&quot;#JVMç±»åŠ è½½æœºåˆ¶&quot; class=&quot;headerlink&quot; title=&quot;JVMç±»åŠ è½½æœºåˆ¶&quot;&gt;&lt;/a&gt;JVMç±»åŠ è½½æœºåˆ¶&lt;/h2&gt;&lt;p&gt;â€¢å…¨ç›˜è´Ÿè´£ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æŸä¸ªClassæ—¶ï¼Œè¯¥Classæ‰€ä¾èµ–çš„å’Œå¼•ç”¨çš„å…¶ä»–Clas
      
    
    </summary>
    
    
      <category term="JVM" scheme="http://zhongyp.me/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JVM</title>
    <link href="http://zhongyp.me/2018/03/27/jvm/2018-03-27-JVM/"/>
    <id>http://zhongyp.me/2018/03/27/jvm/2018-03-27-JVM/</id>
    <published>2018-03-26T16:00:00.000Z</published>
    <updated>2018-11-28T06:33:29.864Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶"><a href="#1-JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶" class="headerlink" title="1. JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶"></a>1. JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶</h2><h3 id="1-1-è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#1-1-è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="1.1 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>1.1 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h3><h4 id="1-1-1-ç¨‹åºè®¡æ•°å™¨ï¼ˆPC-Registerï¼‰"><a href="#1-1-1-ç¨‹åºè®¡æ•°å™¨ï¼ˆPC-Registerï¼‰" class="headerlink" title="1.1.1 ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰"></a>1.1.1 ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰</h4><ul><li>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£é‡Šå™¨çš„ä½œç”¨æ˜¯é€šè¿‡æ”¹å˜è®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li><li>å¦‚æœå½“å‰æ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•ï¼Œåˆ™è¿™ä¸ªè®¡æ•°å™¨ä¸ºç©ºã€‚</li><li>Javaè™šæ‹Ÿæœºä¸­<strong><em>å”¯ä¸€</em></strong>æ²¡æœ‰OOMçš„åŒºåŸŸã€‚</li></ul><h4 id="1-1-2-Javaè™šæ‹Ÿæœºæ ˆ-ï¼ˆJVM-Stackï¼‰"><a href="#1-1-2-Javaè™šæ‹Ÿæœºæ ˆ-ï¼ˆJVM-Stackï¼‰" class="headerlink" title="1.1.2 Javaè™šæ‹Ÿæœºæ ˆ ï¼ˆJVM Stackï¼‰"></a>1.1.2 Javaè™šæ‹Ÿæœºæ ˆ ï¼ˆJVM Stackï¼‰</h4><ul><li>è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚</li><li><strong><em>æ¯ä¸ªæ–¹æ³•è¿è¡Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§</em></strong>ï¼Œå­˜å‚¨å±€éƒ¨å˜é‡è¡¨(Local Variable Table)ï¼Œæ“ä½œæ ˆ(Operation Stack)ï¼Œæ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</li><li><strong><em>åœ¨ç¼–è¯‘æœŸåˆ†é…</em></strong>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾å„ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ç±»å‹å’ŒreturnAddress(æŒ‡å‘ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€)ã€‚</li><li>å¦‚æœè¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºæœ€å¤§å¯ç”¨æ ˆæ·±åº¦æ—¶ï¼Œç³»ç»Ÿå°±ä¼šæŠ›å‡ºStackOverflowErroré”™è¯¯ã€‚</li><li>å¦‚æœè™šæ‹ŸæœºåŠ¨æ€æ‰©å±•æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„çš„å†…å­˜æ—¶ä¼šæŠ›å‡ºOOMå¼‚å¸¸ã€‚å¤§éƒ¨åˆ†è™šæ‹Ÿæœºéƒ½å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å›ºå®šé•¿åº¦è™šæ‹Ÿæœºæ ˆã€‚</li></ul><h4 id="1-1-3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰"><a href="#1-1-3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰" class="headerlink" title="1.1.3 æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰"></a>1.1.3 æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h4><ul><li>è™šæ‹Ÿæœºæ ˆä¸ºæ‰§è¡ŒJavaæ–¹æ³•æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºNativeæ–¹æ³•æœåŠ¡ã€‚</li><li>ä¼šå‡ºç°OOMæˆ–è€…StackOverflowErrorï¼ŒåŸå› å’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼ã€‚</li></ul><h4 id="1-1-4-Javaå †ï¼ˆHeapï¼‰"><a href="#1-1-4-Javaå †ï¼ˆHeapï¼‰" class="headerlink" title="1.1.4 Javaå †ï¼ˆHeapï¼‰"></a>1.1.4 Javaå †ï¼ˆHeapï¼‰</h4><ul><li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œä¸ºäº†å­˜å‚¨æ‰€æœ‰å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚</li></ul><h4 id="1-1-5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰"><a href="#1-1-5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰" class="headerlink" title="1.1.5 æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰"></a>1.1.5 æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</h4><ul><li>åˆ«åï¼šâ€œæ°¸ä¹…ä»£â€œã€â€éå †ï¼Œå„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œ<strong><em>å­˜å‚¨è™šæ‹Ÿæœºå·²åŠ è½½çš„ç±»ä¿¡æ¯ï¼Œé™æ€å˜é‡ã€å¸¸é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç æ•°æ®</em></strong>ã€‚é»˜è®¤æœ€å°ä¸º16MBï¼Œæœ€å¤§ä¸º64MBï¼Œå¯ä»¥é€šè¿‡-XX:PermSizeå’Œ-XX:MaxPermSize å‚æ•°é™åˆ¶æ–¹æ³•åŒºå¤§å°ã€‚</li><li>Java8ä¸­ï¼Œå·²ç»å½»åº•æ²¡æœ‰äº†æ°¸ä¹…ä»£ï¼Œå°†æ–¹æ³•åŒºç›´æ¥æ”¾åœ¨ä¸€ä¸ªä¸å †ä¸ç›¸è¿çš„æœ¬åœ°å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸè¢«å«åšå…ƒç©ºé—´ã€‚</li></ul><h4 id="1-1-6-è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime-Constant-Poolï¼‰"><a href="#1-1-6-è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime-Constant-Poolï¼‰" class="headerlink" title="1.1.6 è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰"></a>1.1.6 è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</h4><ul><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼šjdk1.6åŠä¹‹å‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸­çš„ä¸»è¦å†…å®¹æ¥è‡ªäºJVMå¯¹Classçš„åŠ è½½ã€‚Java7ä¸­å·²ç»å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰ç§»é™¤ï¼Œåœ¨Java å †ï¼ˆHeapï¼‰ä¸­å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li><li><strong><em>ç±»åŠ è½½å</em></strong>å­˜å‚¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å¸¸é‡ï¼ˆå„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰ã€‚åŸºæœ¬æ•°æ®ç±»å‹ä¸å«å¸¸é‡ï¼Œå¯è¢«ä¿®æ”¹ï¼ŒStringå’Œfinalä¿®é¥°çš„æ‰æ˜¯ã€‚å­—é¢é‡ç›¸å½“äºJavaè¯­è¨€å±‚é¢å¸¸é‡çš„æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ï¼Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬äº†å¦‚ä¸‹ä¸‰ç§ç±»å‹çš„å¸¸é‡ï¼šç±»å’Œæ¥å£çš„å…¨é™å®šåã€å­—æ®µåç§°å’Œæè¿°ç¬¦ã€æ–¹æ³•åç§°å’Œæè¿°ç¬¦ã€‚</li><li>ç”±äºè¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºç§»åŠ¨åˆ°å †ï¼Œæ‰€ä»¥jdk1.6å’Œjdk1.7å¯¹äºå¸¸é‡æ± çš„ä½¿ç”¨è¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ï¼Œ<a href="https://tech.meituan.com/in_depth_understanding_string_intern.html" target="_blank" rel="noopener">æ·±å…¥è§£æString#intern</a></li></ul><h4 id="1-1-7-ç›´æ¥å†…å­˜-Direct-Memory"><a href="#1-1-7-ç›´æ¥å†…å­˜-Direct-Memory" class="headerlink" title="1.1.7 ç›´æ¥å†…å­˜(Direct Memory)"></a>1.1.7 ç›´æ¥å†…å­˜(Direct Memory)</h4><ul><li>å †å¤–å†…å­˜ï¼ŒJVMè™šæ‹Ÿæœºå„ä¸ªåŒºåŸŸå†…å­˜æ€»å’Œå¤§äºæœºå™¨ç‰©ç†å†…å­˜å¯èƒ½ä¼šå¯¼è‡´OOMã€‚</li></ul><h3 id="1-2-å¯¹è±¡çŠ¶æ€ç®—æ³•"><a href="#1-2-å¯¹è±¡çŠ¶æ€ç®—æ³•" class="headerlink" title="1.2 å¯¹è±¡çŠ¶æ€ç®—æ³•"></a>1.2 å¯¹è±¡çŠ¶æ€ç®—æ³•</h3><ul><li><p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼š å¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨çš„é—®é¢˜ï¼Œå†…å­˜æ³„éœ²ã€‚</p></li><li><p>è·Ÿæœç´¢ç®—æ³•ï¼šé€šè¿‡ä¸€ç³»åˆ—åä¸ºâ€œGC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢çš„è·¯å¾„æˆä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootæ²¡æœ‰ä¸€ä¸ªå¼•ç”¨æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚</p></li></ul><p>æ³¨ï¼š1. GCå¯¹è±¡åŒ…æ‹¬ï¼šè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œæ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œæ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­JNIã€‚2. è·Ÿæœç´¢ç®—æ³•ä¸­ï¼Œæ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡å¹¶ééæ­»ä¸å¯ï¼Œè¿˜æœ‰ç»å†ä¸¤æ¬¡æ ‡è®°ï¼Œç¬¬ä¸€æ¬¡å‘ç°æ²¡æœ‰å¼•ç”¨ï¼Œåˆ™è¿›è¡Œæ ‡è®°ï¼Œå¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œå½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•æˆ–finalize()å·²ç»è¢«è°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚</p><h4 id="1-2-1-å›æ”¶æ–¹æ³•åŒº"><a href="#1-2-1-å›æ”¶æ–¹æ³•åŒº" class="headerlink" title="1.2.1 å›æ”¶æ–¹æ³•åŒº"></a>1.2.1 å›æ”¶æ–¹æ³•åŒº</h4><p>æ–¹æ³•åŒºä¸»è¦å›æ”¶åºŸå¼ƒå˜é‡å’Œæ— ç”¨çš„ç±»ã€‚æ— ç”¨çš„ç±»ï¼šè¯¥ç±»æ‰€æœ‰å®ä¾‹éƒ½å·²è¢«å›æ”¶ï¼ŒåŠ è½½è¯¥ç±»çš„ClassLoaderè¢«å›æ”¶ï¼Œè¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚åªæœ‰åŒæ—¶æ»¡è¶³æ— ç”¨çš„ç±»çš„ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰<strong><em>å¯ä»¥</em></strong>è¢«å›æ”¶ã€‚åå°„ã€åŠ¨æ€ä»£ç†ã€CGLibç­‰bytecodeæ¡†æ¶åœºæ™¯ä»¥åŠé¢‘ç¹å®šä¹‰ClassLoaderçš„åœºæ™¯éƒ½éœ€è¦å…·å¤‡å¸è½½åŠŸèƒ½ï¼Œä»¥ä¿è¯æ°¸ä¹…ä»£ä¸ä¼šæº¢å‡ºã€‚</p><h3 id="1-3-åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#1-3-åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="1.3 åƒåœ¾æ”¶é›†ç®—æ³•"></a>1.3 åƒåœ¾æ”¶é›†ç®—æ³•</h3><ul><li><p>æ ‡è®°æ¸…é™¤ç®—æ³•ï¼š æ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚æ•ˆç‡é—®é¢˜ï¼Œç©ºé—´é—®é¢˜ï¼ˆå†…å­˜ç¢ç‰‡ï¼‰ã€‚</p></li><li><p>å¤åˆ¶ç®—æ³•ï¼š æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•å›æ”¶ï¼Œç”±äºæ–°ç”Ÿä»£98%çš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦1:1çš„æ¯”ä¾‹åˆ’åˆ†å†…å­˜ç©ºé—´ï¼ˆHotspoté»˜è®¤8:1ï¼‰ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€ä¸ªSurvivorã€‚å½“å›æ”¶æ—¶ï¼Œå°†Edenå’ŒSurvivorä¸­è¿˜å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§çš„æ‹·è´åˆ°å¦ä¸€å—çš„Survivorä¸Šã€‚æœ€åæ¸…ç†æ‰Edenå’Œåˆšæ‰ä½¿ç”¨è¿‡çš„Survivorã€‚å½“Survivorç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œéœ€è¦ä¾èµ–å…¶ä»–çš„è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆHandle Promotionï¼‰ã€‚åˆ†é…æ‹…ä¿ï¼šå¦‚æœSurvivorç©ºé—´æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾ä¸Šæ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°†ç›´æ¥é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶è¿›å…¥è€å¹´ä»£ã€‚</p></li><li><p>æ ‡è®°-æ•´ç†ç®—æ³•ï¼šè®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚è€å¹´ä»£å¸¸ç”¨çš„ç®—æ³•ã€‚</p></li><li><p>åˆ†ä»£æ”¶é›†ç®—æ³•ï¼š æ ¹æ®å¯¹è±¡çš„å­˜æ´»å‘¨æœŸä¸åŒï¼Œå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œæ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p></li></ul><h3 id="1-4-åƒåœ¾æ”¶é›†å™¨"><a href="#1-4-åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="1.4 åƒåœ¾æ”¶é›†å™¨"></a>1.4 åƒåœ¾æ”¶é›†å™¨</h3><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/gc.jpg?raw=true" alt="åƒåœ¾å›æ”¶å™¨"></p><p>å¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜ä»–ä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚</p><ol><li><p>Serial</p><p> å¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£çš„å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œç®€å•é«˜æ•ˆï¼Œstop the worldã€‚</p></li><li><p>ParNew</p><p> å¤åˆ¶ç®—æ³•ï¼ŒSerialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œstop the worldã€‚é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚</p></li><li><p>Parallel Scavenge</p><p> æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œ, stop the worldã€‚ç›®æ ‡è¾¾åˆ°å¯æ§åˆ¶çš„ååé‡ã€‚è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/CPUæ¶ˆè€—æ€»æ—¶å¸¸=ååé‡ã€‚è¯¥æ”¶é›†å™¨æä¾›ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´çš„-XX:MaxGCPauseMillså‚æ•°åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„-XX:GCTimeRatioå‚æ•°ã€‚MaxGCPauseMillså‚æ•°å…è®¸çš„å€¼æ˜¯ä¸€ä¸ªå¤§äº0çš„æ¯«ç§’æ•°ï¼Œæ”¶é›†å™¨å°†å°½åŠ›ä¿è¯å†…å­˜å›æ”¶èŠ±è´¹çš„æ—¶é—´ä¸è¶…è¿‡è®¾å®šå€¼ã€‚GCTimeRatioå‚æ•°çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªå¤§äº0çš„æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œç›¸å½“äºååé‡çš„å€’æ•°ã€‚é™¤äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ª-XX:+UseAdaptiveSizePolicyå€¼å¾—å…³æ³¨ã€‚æ‰“å¼€è¿™ä¸ªå‚æ•°åï¼Œä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°ã€‚è™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡è¿™ç§æ–¹å¼ç§°ä¸ºGCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰</p></li><li><p>Serial Old</p><p> Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œstop the worldã€‚ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š1. åœ¨JDK1.5åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureçš„æ—¶å€™ç”¨ã€‚</p></li><li><p>Parallel Old</p><p> Parallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œstop the worldã€‚</p></li><li><p>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨</p></li></ol><p>æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œé‡è§†æœåŠ¡å“åº”é€Ÿåº¦ï¼Œæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°ã€‚ç¬¬ä¸€æ¬¾å¹¶å‘æ”¶é›†å™¨ï¼Œå¯ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼šåˆå§‹æ ‡è®°(CMS initial mark)ã€å¹¶å‘æ ‡è®°(CMS concurrent mark)ã€é‡æ–°æ ‡è®°(CMS remark)ã€å¹¶å‘æ¸…é™¤(CMS concurrent sweep)ã€‚åˆå§‹å’Œé‡æ–°stop the worldã€‚åˆå§‹æ ‡è®°åªæ˜¯æ ‡è®°GCRootsèƒ½ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œå¹¶å‘æ ‡è®°è¿›è¡ŒGCROOTs Tracingçš„è¿‡ç¨‹ã€‚é‡æ–°æ ‡è®°ä¸ºäº†ä¿®å¤å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚<br>ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚<br>ç¼ºç‚¹ï¼š1. å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿï¼Œè§£å†³æ–¹æ¡ˆï¼Œå‡å°‘GCçº¿ç¨‹çš„ç‹¬å æ—¶é—´ã€‚2. æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€‚CMSè¿è¡ŒæœŸé—´ï¼Œç”¨æˆ·çº¿ç¨‹äº§ç”Ÿçš„åƒåœ¾ä¸ºæµ®åŠ¨åƒåœ¾ï¼ŒCMSæ— æ³•åœ¨æœ¬æ¬¡æ”¶é›†ä¸­ä¸ªæ¸…ç†è¿™äº›æµ®åŠ¨åƒåœ¾ã€‚å¦‚æœCMSè¿è¡ŒæœŸé—´ï¼Œå†…å­˜æ— æ³•æ»¡è¶³ç”¨æˆ·çº¿ç¨‹è¦æ±‚ï¼Œå°±ä¼šå‡ºç°Concurrent Mode Failureå¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´å¦ä¸€ä¸ªFullGCäº§ç”Ÿï¼Œå¯åŠ¨é¢„å¤‡æ–¹æ¡ˆ Serial Oldã€‚3. äº§ç”Ÿå¤§é‡çš„ç©ºé—´ç¢ç‰‡ã€‚</p><ol start="7"><li><p>G1æ”¶é›†å™¨</p><p> æ ‡è®°æ•´ç†ç®—æ³•å®ç°ï¼Œç²¾ç¡®çš„æ§åˆ¶åœé¡¿ï¼ŒæŒ‡å®šä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸è¶…è¿‡Næ¯«ç§’ã€‚G1å°†æ•´ä¸ªJavaå †ï¼ˆè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£ï¼‰åˆ’åˆ†å¤šä¸ªå¤§å°å›ºå®šçš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œå¹¶ä¸”è¿½è¸ªè¿™äº›åŒºåŸŸé‡Œé¢çš„åƒåœ¾å †ç§¯ç¨‹åº¦ã€‚åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åŒºåŸŸã€‚</p></li></ol><h3 id="1-5-å†…å­˜åˆ†é…ä¸å›æ”¶"><a href="#1-5-å†…å­˜åˆ†é…ä¸å›æ”¶" class="headerlink" title="1.5 å†…å­˜åˆ†é…ä¸å›æ”¶"></a>1.5 å†…å­˜åˆ†é…ä¸å›æ”¶</h3><p>å¯¹è±¡åœ¨Edenä¸­åˆ†é…å†…å­˜ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ã€‚MinorGCã€‚</p><pre><code>MinorGC: æ–°ç”Ÿä»£åƒåœ¾å›æ”¶çš„åŠ¨ä½œï¼Œé¢‘ç¹ä¸”é€Ÿåº¦å¿«ã€‚MajorGCï¼ˆFullGCï¼‰: æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œæ…¢ï¼Œæ¸…ç†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼ŒCMS</code></pre><p>å¤§å¯¹è±¡æŒ‡éœ€è¦å¤§é‡è¿ç»­ç©ºé—´çš„Javaå¯¹è±¡ã€‚å…¸å‹å°±æ˜¯å¾ˆé•¿çš„å­—ç¬¦ä¸²å’Œæ•°ç»„ã€‚ç›´æ¥è¿›å…¥è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨EdenåŠSurvivorä¸­å¤§é‡å¤åˆ¶æ‹·è´ã€‚</p><p>é•¿æœŸç”Ÿæ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚å¯¹è±¡å¹´é¾„è®¡æ•°å™¨ï¼Œæ¯ä¸€æ¬¡MinorGCå¢é•¿1å²ã€‚é»˜è®¤15å²è¿›å…¥è€å¹´ä»£ã€‚</p><p>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­ï¼Œå¦‚æœåœ¨Survivorç©ºé—´ä¸­ï¼Œç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„æ®µçš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</p><p>ç©ºé—´æ‹…ä¿åˆ†é…ï¼Œæ¯æ¬¡MinorGC,æ£€æµ‹å‡çº§åˆ°è€å¹´ä»£çš„å¤§å°æ˜¯å¦å¤§äºè€å¹´ä»£çš„ç©ºé—´ï¼Œå¦‚æœå¤§äºï¼Œåˆ™è¿›è¡ŒFullGCã€‚</p><h2 id="2-JDKå‘½ä»¤è¡Œå·¥å…·-æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†"><a href="#2-JDKå‘½ä»¤è¡Œå·¥å…·-æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†" class="headerlink" title="2. JDKå‘½ä»¤è¡Œå·¥å…· æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†"></a>2. JDKå‘½ä»¤è¡Œå·¥å…· æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†</h2><h3 id="2-1-jps"><a href="#2-1-jps" class="headerlink" title="2.1 jps"></a>2.1 jps</h3><p>è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µå·¥å…·ã€‚ æ˜¾ç¤ºå½“å‰æ‰€æœ‰javaè¿›ç¨‹pidçš„å‘½ä»¤ã€‚</p><p>-l è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯JaråŒ…ï¼Œè¾“å‡ºJarè·¯å¾„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -l</span><br><span class="line">5696 com.intellij.rt.execution.application.AppMain</span><br><span class="line">944 org.jetbrains.idea.maven.server.RemoteMavenServer</span><br><span class="line">4488</span><br><span class="line">1900 org.jetbrains.jps.cmdline.Launcher</span><br><span class="line">7244 sun.tools.jps.Jps</span><br></pre></td></tr></table></figure><p>-v è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶JVMå‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -v</span><br><span class="line">5696 AppMain -Didea.launcher.port=7534 -Didea.launcher.bin.path=F:\Program Files\intellij IDEA\bin -Dfile.encoding=UTF-8</span><br><span class="line">944 RemoteMavenServer -Djava.awt.headless=true -Didea.version==2016.2.5 -Xmx768m -Didea.maven.embedder.version=3.0.5 -Dfile.encoding=GBK</span><br><span class="line">1656 Jps -Denv.class.path=.;C:\Program Files\Java\jdk1.8.0_161\lib\dt.jar;C:\Program Files\Java\jdk1.8.0_161\lib\tools.jar; -Dapplication.home=C:\Program Files\Java\jdk1.8.0_161 -Xms8m</span><br><span class="line">4488  -Xms128m -Xmx750m -XX:ReservedCodeCacheSize=240m -XX:+UseConcMarkSweepGC -XX:SoftRefLRUPolicyMSPerMB=50 -ea -Dsun.io.useCanonCaches=false -Djava.net.preferIPv4Stack=true -XX:+HeapDumpOnOutOfMemoryError -XX:-OmitStackTraceInFastThrow -Djb.vmOptionsFile=F:\Program Files\intellij IDEA\bin\idea64.exe.v</span><br><span class="line">moptions -Xbootclasspath/a:F:\Program Files\intellij IDEA\lib\boot.jar -Didea.paths.selector=IntelliJIdea2016.2 -Didea.jre.check=true -XX:ErrorFile=C:\Users\zhongyp\java_error_in_idea_%p.log -XX:HeapDumpPath=C:\Users\zhongyp\java_error_in_idea.hprof</span><br><span class="line">1900 Launcher -Xmx700m -Djava.awt.headless=true -Djava.endorsed.dirs=&quot;&quot; -Djdt.compiler.useSingleThread=true -Dpreload.project.path=E:/demo -Dpreload.config.path=C:/Users/zhongyp/.IntelliJIdea2016.2/config/options -Dcompile.parallel=false -Drebuild.on.dependency.change=true -Djava.net.preferIPv4Stack=true</span><br><span class="line"> -Dio.netty.initialSeedUniquifier=-1505227146882843300 -Dfile.encoding=GBK -Djps.file.types.component.name=FileTypeManager -Duser.language=zh -Duser.country=CN -Didea.paths.selector=IntelliJIdea2016.2 -Didea.home.path=F:\Program Files\intellij IDEA -Didea.config.path=C:\Users\zhongyp\.IntelliJIdea2016.2\</span><br><span class="line">config -Didea.plugins.path=C:\Users\zhongyp\.IntelliJIdea2016.2\config\plugins -Djps.log.dir=C:/Users/zhongyp/.IntelliJIdea2016.2/system/log/build-log -Djps.fallback.jdk.home=C:/Program Files/Java/jdk1.8.0_161/jre -Djps.fallback.jdk.version=1.8.0_161 -Djava.io.tmpdir=C:/Users/zhongyp/.IntelliJIdea2016.2/</span><br><span class="line">system/compile-server/_temp_ -Dkotlin.incremental.compilation.experimental=true -Dkotlin.daemon.enabled -Dkotlin.daemon.cli</span><br></pre></td></tr></table></figure><p>-q åªè¾“å‡ºLVMIDï¼Œçœç•¥ä¸»ç±»çš„åç§°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -q</span><br><span class="line">5696</span><br><span class="line">8912</span><br><span class="line">944</span><br><span class="line">4488</span><br><span class="line">1900</span><br></pre></td></tr></table></figure><p>-m è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ä¼ é€’ç»™ä¸»ç±»main()å‡½æ•°çš„å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -m</span><br><span class="line">5696 AppMain com.zhongyp.Test</span><br><span class="line">944 RemoteMavenServer</span><br><span class="line">10484 Jps -m</span><br><span class="line">4488</span><br><span class="line">1900 Launcher F:/Program Files/intellij IDEA/lib/log4j.jar;F:/Program Files/intellij IDEA/lib/jps-builders.jar;F:/Program Files/intellij IDEA/lib/netty-all-4.1.1.Final.jar;F:/Program Files/intellij IDEA/lib/annotations.jar;F:/Program Files/intellij IDEA/lib/rt/jps-plugin-system.jar;F:/Program Files/intel</span><br><span class="line">lij IDEA/lib/jgoodies-forms.jar;F:/Program Files/intellij IDEA/lib/util.jar;F:/Program Files/intellij IDEA/lib/trove4j.jar;F:/Program Files/intellij IDEA/lib/jna.jar;F:/Program Files/intellij IDEA/lib/resources_en.jar;F:/Program Files/intellij IDEA/lib/oromatcher.jar;F:/Program Files/intellij IDEA/lib/id</span><br><span class="line">ea_rt.jar;F:/Program Files/intellij IDEA/lib/openapi.jar;F:/Program Files/intellij IDEA/lib/javac2.jar;F:/Program Files/intellij IDEA/lib/snappy-in-java-0.5.1.jar;F:/Program Files/intellij IDEA/lib/jna-platform.jar;F:/Program Files/intellij IDEA/lib/forms_rt.jar;F:/Program Files/intellij IDEA/lib/jdom.ja</span><br><span class="line">r;F:/Program Files/intellij IDEA/lib/asm-all.jar;F:/Program Files/intellij IDEA/lib/jps-</span><br></pre></td></tr></table></figure><h3 id="2-2-jstat"><a href="#2-2-jstat" class="headerlink" title="2.2 jstat"></a>2.2 jstat</h3><p> è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·ï¼Œç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ã€‚å¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»åŠ è½½ã€å†…å­˜ã€åƒåœ¾å›æ”¶ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚è¿è¡ŒæœŸå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-classï¼šç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠç±»è£…è½½æ‰€è€—æ—¶é—´ã€‚</span><br><span class="line"></span><br><span class="line">-gcï¼šç›‘è§†JAVAå †çŠ¶å†µï¼ŒåŒ…æ‹¬EdenåŒºã€ä¸¤ä¸ªSurvivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ï¼ŒGCå·²ç”¨æ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ï¼›</span><br><span class="line"></span><br><span class="line">-gccapacityï¼šç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨ javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-gcutilï¼šç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä¾¿è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”ï¼›</span><br><span class="line"></span><br><span class="line">-gccauseï¼šä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´ ä¸€æ¬¡GCäº§ç”Ÿçš„åŸå› ï¼›</span><br><span class="line"></span><br><span class="line">-gcnewï¼šç›‘è§†æ–°ç”Ÿä»£GCçŠ¶æ€ï¼›</span><br><span class="line"></span><br><span class="line">-gcnewcapacityï¼šç›‘è§†å†…å®¹ä¸-gcnewåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºæœ€è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-gcoldï¼šç›‘è§†è€å¹´ä»£GCçŠ¶å†µï¼›</span><br><span class="line"></span><br><span class="line">-gcoldcapacityï¼šç›‘è§†å†…å®¹ä¸-gcoldåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-gcpermcapacityï¼šç›‘è§†æ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-compilerï¼šè¾“å…¥JITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ï¼Œè€—æ—¶ç­‰ä¿¡æ¯ï¼›</span><br><span class="line"></span><br><span class="line">-printcompilationï¼šè¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³•ï¼›</span><br></pre></td></tr></table></figure><h3 id="2-3-jinfo"><a href="#2-3-jinfo" class="headerlink" title="2.3 jinfo"></a>2.3 jinfo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-flag &lt;name&gt; ï¼šå¯æŸ¥çœ‹è™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„å‚æ•°åˆ—è¡¨ã€‚</span><br><span class="line">-flag [+|-]&lt;name&gt;ï¼šè®¾ç½®æˆ–å–æ¶ˆVMå‚æ•°</span><br><span class="line">-flag &lt;name&gt;=&lt;value&gt;ï¼šç»™VMå‚æ•°è®¾ç½®æ–°å€¼</span><br><span class="line">-flagsï¼šå¯æŸ¥çœ‹æ‰€æœ‰VMå‚æ•°ï¼›</span><br><span class="line">-syspropsï¼šæŸ¥çœ‹javaç³»ç»Ÿå‚æ•°;</span><br><span class="line">&lt;no option&gt;ï¼šè¡¨ç¤ºåœ¨ä¸ç»™å®šä»»ä½•é€‰é¡¹æ—¶ï¼Œæ‰“å°å‡ºä»¥ä¸Šæ‰€æœ‰çš„VMå‚æ•°</span><br></pre></td></tr></table></figure><p> å®æ—¶çš„æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºçš„å„é¡¹å‚æ•°ã€‚</p><h3 id="2-4-jmap"><a href="#2-4-jmap" class="headerlink" title="2.4 jmap"></a>2.4 jmap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-dumpï¼šç”Ÿæˆjavaå †è½¬å‚¨å¿«ç…§ï¼Œæ ¼å¼ä¸ºï¼š-dump[live, ] format=b, file=&lt;filename&gt;,å…¶ä¸­liveå­å‚æ•°è¯´æ˜æ˜¯å¦åªdumpå‡ºå­˜æ´»å¯¹è±¡ï¼›</span><br><span class="line"></span><br><span class="line">-finalizerinfoï¼šæ˜¾ç¤ºåœ¨F-QueuiK ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeæ–¹æ³•çš„å¯¹è±¡ã€‚åªåœ¨Linux/Solariså¹³å°ä¸‹æœ‰æ•ˆï¼›</span><br><span class="line"></span><br><span class="line">-heapï¼šæ˜¾ç¤ºjavaå †è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ä½¿ç”¨å“ªç§å›æ”¶å™¨ã€å‚æ•°é…ç½®ã€åˆ†ä»£çŠ¶å†µç­‰ã€‚åªåœ¨Linux/Solariså¹³å°ä¸‹æœ‰æ•ˆï¼›</span><br><span class="line"></span><br><span class="line">-histoï¼šæ˜¾ç¤ºå †ä¸­å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡ï¼›</span><br><span class="line"></span><br><span class="line">-permstatï¼šä»¥ClassLoaderä¸ºç»Ÿè®¡å£å¾„æ˜¾ç¤ºæ°¸ä¹…ä»£å†…å­˜çŠ¶æ€ï¼Œåªåœ¨Linux/Solariså¹³å°æœ‰æ•ˆï¼›</span><br><span class="line"></span><br><span class="line">-Fï¼šå½“è™šæ‹Ÿæœºè¿›ç¨‹å¯¹-dumpé€‰é¡¹æ²¡æœ‰å“åº”æ—¶ï¼Œå¯ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¼ºåˆ¶ç”Ÿæˆdumpå¿«ç…§ï¼Œåªåœ¨Linux/Solariså¹³å°æœ‰æ•ˆ</span><br></pre></td></tr></table></figure><p> Javaå†…å­˜æ˜ åƒå·¥å…·ã€‚ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢finalize()æ‰§è¡Œé˜Ÿåˆ—ï¼ŒJavaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jmap -dump:format=b,file=D:\test.bin 2768</span><br><span class="line">Dumping heap to D:\test.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure><h3 id="2-5-jhat"><a href="#2-5-jhat" class="headerlink" title="2.5 jhat"></a>2.5 jhat</h3><p><code>jhat D:\test.bin</code></p><p> åˆ†æjmapç”Ÿæˆçš„å †è½¬å‚¨å¿«ç…§ï¼Œåœ¨æµè§ˆå™¨æŸ¥çœ‹ã€‚</p><h3 id="2-6-jstack"><a href="#2-6-jstack" class="headerlink" title="2.6 jstack"></a>2.6 jstack</h3><p> ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆå¿«ç…§çš„ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ã€‚</p><p>-F    å½“æ­£å¸¸è¾“å‡ºçš„è¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</p><p>-l    é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</p><p>-m    å¦‚æœè°ƒç”¨åˆ°æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºc/c++çš„å †æ ˆ</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">//        Thread t1 = new Worker(1);</span><br><span class="line">//</span><br><span class="line">//</span><br><span class="line">//        t1.start();</span><br><span class="line">        final A a = new A();</span><br><span class="line">        final B b = new B();</span><br><span class="line"></span><br><span class="line">        new Thread()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run()&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    sleep(3000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                a.getBLock(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line"></span><br><span class="line">        new Thread()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run()&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    sleep(3000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                b.getALock(a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class A &#123;</span><br><span class="line"></span><br><span class="line">    public synchronized void getBLock(B b)&#123;</span><br><span class="line"></span><br><span class="line">        b.getALock(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B&#123;</span><br><span class="line"></span><br><span class="line">    public synchronized void getALock(A a)&#123;</span><br><span class="line">        a.getBLock(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -m</span><br><span class="line">1904 AppMain com.zhongyp.Test</span><br><span class="line">944 RemoteMavenServer</span><br><span class="line">11540 Jps -m</span><br><span class="line">13204 Launcher F:/Program Files/intellij IDEA/lib/log4j.jar;F:/Program Files/intellij IDEA/lib/jps-builders.jar;F:/Program Files/intellij IDEA/lib/netty-all-4.1.1.Final.jar;F:/Program Files/intellij IDEA/lib/annotations.jar;F:/Program Files/intellij IDEA/lib/rt/jps-plugin-system.jar;F:/Program Files/inte</span><br><span class="line">llij IDEA/lib/jgoodies-forms.jar;F:/Program Files/intellij IDEA/lib/util.jar;F:/Program Files/intellij IDEA/lib/trove4j.jar;F:/Program Files/intellij IDEA/lib/jna.jar;F:/Program Files/intellij IDEA/lib/resources_en.jar;F:/Program Files/intellij IDEA/lib/oromatcher.jar;F:/Program Files/intellij IDEA/lib/i</span><br><span class="line">dea_rt.jar;F:/Program Files/intellij IDEA/lib/openapi.jar;F:/Program Files/intellij IDEA/lib/javac2.jar;F:/Program Files/intellij IDEA/lib/snappy-in-java-0.5.1.jar;F:/Program Files/intellij IDEA/lib/jna-platform.jar;F:/Program Files/intellij IDEA/lib/forms_rt.jar;F:/Program Files/intellij IDEA/lib/jdom.j</span><br><span class="line">ar;F:/Program Files/intellij IDEA/lib/asm-all.jar;F:/Program Files/intellij IDEA/lib/jps-</span><br><span class="line">4488</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jstack -F 1904</span><br><span class="line">Attaching to process ID 1904, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.161-b12</span><br><span class="line">Deadlock Detection:</span><br><span class="line"></span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line"></span><br><span class="line">&quot;Thread-0&quot;:</span><br><span class="line">  waiting to lock Monitor@0x00000000193ce108 (Object@0x00000000d6129700, a com/zhongyp/B),</span><br><span class="line">  which is held by &quot;Thread-1&quot;</span><br><span class="line">&quot;Thread-1&quot;:</span><br><span class="line">  waiting to lock Monitor@0x00000000193cb878 (Object@0x00000000d6127d20, a com/zhongyp/A),</span><br><span class="line">  which is held by &quot;Thread-0&quot;</span><br><span class="line"></span><br><span class="line">Found a total of 1 deadlock.</span><br><span class="line"></span><br><span class="line">Thread 1: (state = BLOCKED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 18: (state = BLOCKED)</span><br><span class="line"> - com.zhongyp.A.getBLock(com.zhongyp.B) @bci=0, line=51 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.B.getALock(com.zhongyp.A) @bci=2, line=59 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.Test$2.run() @bci=18, line=38 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 17: (state = BLOCKED)</span><br><span class="line"> - com.zhongyp.B.getALock(com.zhongyp.A) @bci=0, line=59 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.A.getBLock(com.zhongyp.B) @bci=2, line=51 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.Test$1.run() @bci=18, line=26 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 16: (state = IN_NATIVE)</span><br><span class="line"> - java.net.DualStackPlainSocketImpl.accept0(int, java.net.InetSocketAddress[]) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.net.DualStackPlainSocketImpl.socketAccept(java.net.SocketImpl) @bci=37, line=131 (Interpreted frame)</span><br><span class="line"> - java.net.AbstractPlainSocketImpl.accept(java.net.SocketImpl) @bci=7, line=409 (Interpreted frame)</span><br><span class="line"> - java.net.PlainSocketImpl.accept(java.net.SocketImpl) @bci=42, line=199 (Interpreted frame)</span><br><span class="line"> - java.net.ServerSocket.implAccept(java.net.Socket) @bci=60, line=545 (Interpreted frame)</span><br><span class="line"> - java.net.ServerSocket.accept() @bci=48, line=513 (Interpreted frame)</span><br><span class="line"> - com.intellij.rt.execution.application.AppMain$1.run() @bci=13, line=79 (Interpreted frame)</span><br><span class="line"> - java.lang.Thread.run() @bci=11, line=748 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 10: (state = BLOCKED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 9: (state = BLOCKED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 8: (state = BLOCKED)</span><br><span class="line"> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.ReferenceQueue.remove(long) @bci=59, line=143 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.ReferenceQueue.remove() @bci=2, line=164 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.Finalizer$FinalizerThread.run() @bci=36, line=209 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 7: (state = BLOCKED)</span><br><span class="line"> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.lang.Object.wait() @bci=2, line=502 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.Reference.tryHandlePending(boolean) @bci=54, line=191 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.Reference$ReferenceHandler.run() @bci=1, line=153 (Interpreted frame)</span><br></pre></td></tr></table></figure><h2 id="3-JDKå¯è§†åŒ–å·¥å…·"><a href="#3-JDKå¯è§†åŒ–å·¥å…·" class="headerlink" title="3. JDKå¯è§†åŒ–å·¥å…·"></a>3. JDKå¯è§†åŒ–å·¥å…·</h2><p>JConsole: Javaç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°ã€‚åŸºäºJMXçš„å¯è§†åŒ–ç›‘è§†å’Œç®¡ç†å·¥å…·ã€‚ç›‘è§†Javaå †å’Œæ°¸ä¹…ä»£çš„çš„å˜åŒ–è¶‹åŠ¿ã€‚</p><p>VisualVM: å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·ã€‚</p><h2 id="4-JVMè°ƒä¼˜æ¡ˆä¾‹"><a href="#4-JVMè°ƒä¼˜æ¡ˆä¾‹" class="headerlink" title="4. JVMè°ƒä¼˜æ¡ˆä¾‹"></a>4. JVMè°ƒä¼˜æ¡ˆä¾‹</h2><h3 id="4-1-é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥"><a href="#4-1-é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥" class="headerlink" title="4.1 é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥"></a>4.1 é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥</h3><p>ä½¿ç”¨64ä½JDKå¤§å†…å­˜ã€‚</p><p>é—®é¢˜ï¼š1.å†…å­˜å›æ”¶å¯¼è‡´é•¿æ—¶é—´åœé¡¿ã€‚2.64ä½JDKçš„æ€§èƒ½æµ‹è¯•ç»“æœæ™®éä½äº32ä½JDKã€‚3.éœ€è¦ä¿è¯ç¨‹åºè¶³å¤Ÿç¨³å®šï¼Œè¿™ç§åº”ç”¨å¦‚æœäº§ç”Ÿå †æº¢å‡ºå‡ ä¹å°±æ— æ³•äº§ç”Ÿå †è½¬å‚¨å¿«ç…§ã€‚4. ç›¸åŒç¨‹åº64ä½JDKä¸­æ¶ˆè€—å†…å­˜ä¸€èˆ¬æ¯”32ä½å¤§ï¼Œè¿™æ˜¯ç”±äºæŒ‡é’ˆè†¨èƒ€å’Œæ•°æ®ç±»å‹å¯¹å…¶è¡¥ç™½å¯¼è‡´çš„ã€‚</p><p>ä½¿ç”¨è‹¥å¹²ä¸ª32ä½è™šæ‹Ÿæœºå»ºç«‹é€»è¾‘é›†ç¾¤æ¥åˆ©ç”¨é›†ç¾¤èµ„æºã€‚</p><p>é—®é¢˜ï¼š1.å°½é‡é¿å…èŠ‚ç‚¹ç«äº‰å…¨å±€èµ„æºï¼Œå¦‚å¹¶å‘å†™æ“ä½œå¯¼è‡´IOå¼‚å¸¸ã€‚2.å¾ˆéš¾é«˜æ•ˆç‡çš„åˆ©ç”¨æŸäº›èµ„æºæ± ï¼Œæ¯”å¦‚è¿æ¥æ± ï¼Œå¯¼è‡´ä¸€äº›èŠ‚ç‚¹æ»¡äº†ï¼Œå…¶ä»–çš„è¿˜ä¸ºé›¶ã€‚3.å„ä¸ªèŠ‚ç‚¹ä»ç„¶ä¸å¯é¿å…çš„å—åˆ°32ä½çš„é™åˆ¶ï¼ˆ2GBï¼‰ã€‚4.å¤§é‡ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„åº”ç”¨ï¼Œæ”¹ä¸ºé›†ä¸­å¼çš„ç¼“å­˜ã€‚</p><h3 id="4-2-é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º"><a href="#4-2-é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º" class="headerlink" title="4.2 é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º"></a>4.2 é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º</h3><h3 id="4-3-å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯"><a href="#4-3-å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯" class="headerlink" title="4.3 å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯"></a>4.3 å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯</h3><h3 id="4-4-å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢"><a href="#4-4-å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢" class="headerlink" title="4.4 å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢"></a>4.4 å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢</h3><h2 id="5-javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹"><a href="#5-javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹" class="headerlink" title="5. javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹"></a>5. javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹</h2><h3 id="5-1-javaå†…å­˜æ¨¡å‹"><a href="#5-1-javaå†…å­˜æ¨¡å‹" class="headerlink" title="5.1 javaå†…å­˜æ¨¡å‹"></a>5.1 javaå†…å­˜æ¨¡å‹</h3><h4 id="5-1-1-ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"><a href="#5-1-1-ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜" class="headerlink" title="5.1.1 ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"></a>5.1.1 ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜</h4><p>Javaå†…å­˜æ¨¡å‹çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚</p><p>æ³¨ï¼š è¿™é‡Œè¯´çš„å˜é‡åŒ…æ‹¬äº†å®ä¾‹å˜é‡ã€é™æ€å­—æ®µå’Œæ„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ ï¼Œä½†ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡ä¸æ–¹æ³•å‚æ•°ï¼Œå› ä¸ºåè€…æ˜¯çº¿ç¨‹ç§æœ‰ï¼Œä¸ä¼šè¢«å…±äº«ï¼Œè‡ªç„¶å°±ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚</p><h2 id="6-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"><a href="#6-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–" class="headerlink" title="6. çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"></a>6. çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–</h2><p>çº¿ç¨‹å®‰å…¨çš„å®šä¹‰ï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–çš„åè°ƒæ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æ—¶çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h3 id="6-1-çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"><a href="#6-1-çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="headerlink" title="6.1 çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"></a>6.1 çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</h3><h4 id="6-1-1-äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰"><a href="#6-1-1-äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰" class="headerlink" title="6.1.1 äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰"></a>6.1.1 äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰</h4><p>æ‚²è§‚é”ã€‚</p><p>sychronized å’Œ ReentrantLockã€‚</p><h4 id="6-1-2-éé˜»å¡åŒæ­¥"><a href="#6-1-2-éé˜»å¡åŒæ­¥" class="headerlink" title="6.1.2 éé˜»å¡åŒæ­¥"></a>6.1.2 éé˜»å¡åŒæ­¥</h4><p>ä¹è§‚é”ï¼ŒCASã€‚</p><p>AtomicIntegerç­‰</p><h4 id="6-1-3-æ— åŒæ­¥æ–¹æ¡ˆ"><a href="#6-1-3-æ— åŒæ­¥æ–¹æ¡ˆ" class="headerlink" title="6.1.3 æ— åŒæ­¥æ–¹æ¡ˆ"></a>6.1.3 æ— åŒæ­¥æ–¹æ¡ˆ</h4><ul><li><p>å¯é‡å…¥ä»£ç ï¼šå¯ä»¥åœ¨ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ»ä¸­æ–­å®ƒï¼Œè½¬è€Œå»æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼Œè€Œåœ¨æ§åˆ¶æƒè¿”å›åï¼ŒåŸæ¥çš„ç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚åˆ¤æ–­ä»£ç æ˜¯å¦å…·å¤‡å¯é‡å…¥æ€§ï¼šå¦‚æœä¸€ä¸ªæ–¹æ³•ï¼Œä»–çš„è¿”å›ç»“æœæ˜¯å¯ä»¥é¢„æµ‹çš„ï¼Œåªè¦è¾“å…¥äº†ç›¸åŒçš„æ•°æ®ï¼Œå°±éƒ½èƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œé‚£å®ƒå°±æ»¡è¶³å¯é‡å…¥æ€§çš„è¦æ±‚ã€‚</p></li><li><p>çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼šå¦‚æœä¸€æ®µä»£ç ä¸­æ‰€éœ€è¦çš„æ•°æ®å¿…é¡»ä¸å…¶ä»–ä»£ç å…±äº«ï¼Œé‚£å°±çœ‹çœ‹è¿™äº›å…±äº«æ•°æ®çš„ä»£ç æ˜¯å¦èƒ½ä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼ŸThreadLocalï¼ˆä¸å…±äº«ï¼‰ã€‚volatile(å…±äº«)ã€‚</p></li></ul><h3 id="6-2-é”ä¼˜åŒ–"><a href="#6-2-é”ä¼˜åŒ–" class="headerlink" title="6.2 é”ä¼˜åŒ–"></a>6.2 é”ä¼˜åŒ–</h3><h4 id="6-2-1-è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”"><a href="#6-2-1-è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”" class="headerlink" title="6.2.1 è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”"></a>6.2.1 è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”</h4><h4 id="6-2-2-é”æ¶ˆé™¤"><a href="#6-2-2-é”æ¶ˆé™¤" class="headerlink" title="6.2.2 é”æ¶ˆé™¤"></a>6.2.2 é”æ¶ˆé™¤</h4><h4 id="6-2-3-é”ç²—åŒ–"><a href="#6-2-3-é”ç²—åŒ–" class="headerlink" title="6.2.3 é”ç²—åŒ–"></a>6.2.3 é”ç²—åŒ–</h4><h4 id="6-2-4-è½»é‡çº§é”"><a href="#6-2-4-è½»é‡çº§é”" class="headerlink" title="6.2.4 è½»é‡çº§é”"></a>6.2.4 è½»é‡çº§é”</h4><h4 id="6-2-5-åå‘é”"><a href="#6-2-5-åå‘é”" class="headerlink" title="6.2.5 åå‘é”"></a>6.2.5 åå‘é”</h4><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶&quot;&gt;&lt;a href=&quot;#1-JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶&quot; class=&quot;headerlink&quot; title=&quot;1. JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶&quot;&gt;&lt;/a&gt;1. JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶&lt;/h2&gt;&lt;h3 id=&quot;1-1-è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ&quot;&gt;&lt;a
      
    
    </summary>
    
    
      <category term="JVM" scheme="http://zhongyp.me/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>Javaåå°„å’ŒåŠ¨æ€ä»£ç†</title>
    <link href="http://zhongyp.me/2018/03/18/java/2018-03-18-JavaReflection/"/>
    <id>http://zhongyp.me/2018/03/18/java/2018-03-18-JavaReflection/</id>
    <published>2018-03-17T16:00:00.000Z</published>
    <updated>2018-10-02T01:27:53.330Z</updated>
    
    <content type="html"><![CDATA[<p>è¦æƒ³ç†è§£åå°„çš„åŸç†ï¼Œé¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯ç±»å‹ä¿¡æ¯ã€‚Javaè®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶è¯†åˆ«å¯¹è±¡å’Œç±»çš„ä¿¡æ¯ï¼Œä¸»è¦æœ‰2ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ä¼ ç»Ÿçš„RTTIï¼Œå®ƒå‡å®šæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å·²ç»çŸ¥é“äº†æ‰€æœ‰çš„ç±»å‹ä¿¡æ¯ï¼›å¦ä¸€ç§æ˜¯åå°„æœºåˆ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å‘ç°å’Œä½¿ç”¨ç±»çš„ä¿¡æ¯ã€‚</p><h2 id="CLASS-å¯¹è±¡"><a href="#CLASS-å¯¹è±¡" class="headerlink" title="CLASS å¯¹è±¡"></a>CLASS å¯¹è±¡</h2><p>æ¯ä¸ªç±»éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„Classå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜åœ¨.classæ–‡ä»¶ã€‚æ‰€æœ‰ç±»éƒ½æ˜¯åœ¨å¯¹å…¶ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ï¼ŒåŠ¨æ€åŠ è½½åˆ°JVMçš„ï¼Œå½“ç¨‹åºåˆ›å»ºä¸€ä¸ªå¯¹ç±»çš„é™æ€æˆå‘˜çš„å¼•ç”¨æ—¶ï¼Œå°±ä¼šåŠ è½½è¿™ä¸ªç±»ã€‚Classå¯¹è±¡ä»…åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šåŠ è½½ï¼Œstaticåˆå§‹åŒ–æ˜¯åœ¨ç±»åŠ è½½æ—¶è¿›è¡Œçš„ã€‚</p><p>ç±»åŠ è½½å™¨é¦–å…ˆä¼šæ£€æŸ¥è¿™ä¸ªç±»çš„Classå¯¹è±¡æ˜¯å¦å·²è¢«åŠ è½½è¿‡ï¼Œå¦‚æœå°šæœªåŠ è½½ï¼Œé»˜è®¤çš„ç±»åŠ è½½å™¨å°±ä¼šæ ¹æ®ç±»åæŸ¥æ‰¾å¯¹åº”çš„.classæ–‡ä»¶ã€‚</p><p>æƒ³åœ¨è¿è¡Œæ—¶ä½¿ç”¨ç±»å‹ä¿¡æ¯ï¼Œå¿…é¡»è·å–å¯¹è±¡(æ¯”å¦‚ç±»Baseå¯¹è±¡)çš„Classå¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿ç”¨åŠŸèƒ½Class.forName(â€œBaseâ€)å¯ä»¥å®ç°è¯¥ç›®çš„ï¼Œæˆ–è€…ä½¿ç”¨base.classã€‚æ³¨æ„ï¼Œæœ‰ä¸€ç‚¹å¾ˆæœ‰è¶£ï¼Œä½¿ç”¨åŠŸèƒ½â€.classâ€æ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ï¼Œä½¿ç”¨forName()ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ã€‚ä¸ºäº†ä½¿ç”¨ç±»è€Œåšçš„å‡†å¤‡å·¥ä½œä¸€èˆ¬æœ‰ä»¥ä¸‹3ä¸ªæ­¥éª¤ï¼š</p><ul><li><p>åŠ è½½ï¼šç”±ç±»åŠ è½½å™¨å®Œæˆï¼Œæ‰¾åˆ°å¯¹åº”çš„å­—èŠ‚ç ï¼Œåˆ›å»ºä¸€ä¸ªClasså¯¹è±¡</p></li><li><p>é“¾æ¥ï¼šéªŒè¯ç±»ä¸­çš„å­—èŠ‚ç ï¼Œä¸ºé™æ€åŸŸåˆ†é…ç©ºé—´</p></li><li><p>åˆå§‹åŒ–ï¼šå¦‚æœè¯¥ç±»æœ‰è¶…ç±»ï¼Œåˆ™å¯¹å…¶åˆå§‹åŒ–ï¼Œæ‰§è¡Œé™æ€åˆå§‹åŒ–å™¨å’Œé™æ€åˆå§‹åŒ–å—</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Base &#123;</span><br><span class="line">    static int num = 1;</span><br><span class="line">    </span><br><span class="line">    static &#123;</span><br><span class="line">        System.out.println(&quot;Base &quot; + num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // ä¸ä¼šåˆå§‹åŒ–é™æ€å—</span><br><span class="line">        Class clazz1 = Base.class;</span><br><span class="line">        System.out.println(&quot;------&quot;);</span><br><span class="line">        // ä¼šåˆå§‹åŒ–</span><br><span class="line">        Class clazz2 = Class.forName(&quot;zzz.Base&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><p>å¦‚æœä¸çŸ¥é“æŸä¸ªå¯¹è±¡çš„ç¡®åˆ‡ç±»å‹ï¼ŒRTTIå¯ä»¥å‘Šè¯‰ä½ ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå‰æï¼šè¿™ä¸ªç±»å‹åœ¨ç¼–è¯‘æ—¶å¿…é¡»å·²çŸ¥ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨RTTIæ¥è¯†åˆ«å®ƒã€‚Classç±»ä¸java.lang.reflectç±»åº“ä¸€èµ·å¯¹åå°„è¿›è¡Œäº†æ”¯æŒï¼Œè¯¥ç±»åº“åŒ…å«Fieldã€Methodå’ŒConstructorç±»ï¼Œè¿™äº›ç±»çš„å¯¹è±¡ç”±JVMåœ¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œç”¨ä»¥è¡¨ç¤ºæœªçŸ¥ç±»é‡Œå¯¹åº”çš„æˆå‘˜ã€‚è¿™æ ·çš„è¯å°±å¯ä»¥ä½¿ç”¨Contructoråˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œç”¨get()å’Œset()æ–¹æ³•è·å–å’Œä¿®æ”¹ç±»ä¸­ä¸Fieldå¯¹è±¡å…³è”çš„å­—æ®µï¼Œç”¨invoke()æ–¹æ³•è°ƒç”¨ä¸Methodå¯¹è±¡å…³è”çš„æ–¹æ³•ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥è°ƒç”¨getFields()ã€getMethods()å’ŒgetConstructors()ç­‰è®¸å¤šä¾¿åˆ©çš„æ–¹æ³•ï¼Œä»¥è¿”å›è¡¨ç¤ºå­—æ®µã€æ–¹æ³•ã€ä»¥åŠæ„é€ å™¨å¯¹è±¡çš„æ•°ç»„ï¼Œè¿™æ ·ï¼Œå¯¹è±¡ä¿¡æ¯å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«å®Œå…¨ç¡®å®šä¸‹æ¥ï¼Œè€Œåœ¨ç¼–è¯‘æ—¶ä¸éœ€è¦çŸ¥é“å…³äºç±»çš„ä»»ä½•äº‹æƒ…ã€‚</p><p>åå°„æœºåˆ¶å¹¶æ²¡æœ‰ä»€ä¹ˆç¥å¥‡ä¹‹å¤„ï¼Œå½“é€šè¿‡åå°„ä¸ä¸€ä¸ªæœªçŸ¥ç±»å‹çš„å¯¹è±¡æ‰“äº¤é“æ—¶ï¼ŒJVMåªæ˜¯ç®€å•åœ°æ£€æŸ¥è¿™ä¸ªå¯¹è±¡ï¼Œçœ‹å®ƒå±äºå“ªä¸ªç‰¹å®šçš„ç±»ã€‚å› æ­¤ï¼Œé‚£ä¸ªç±»çš„.classå¯¹äºJVMæ¥è¯´å¿…é¡»æ˜¯å¯è·å–çš„ï¼Œè¦ä¹ˆåœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œè¦ä¹ˆä»ç½‘ç»œè·å–ã€‚æ‰€ä»¥å¯¹äºRTTIå’Œåå°„ä¹‹é—´çš„çœŸæ­£åŒºåˆ«åªåœ¨äºï¼š</p><ul><li><p>RTTIï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶</p></li><li><p>åå°„ï¼Œè¿è¡Œæ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String args[]) throws ClassNotFoundException, InvocationTargetException, IllegalAccessException, NoSuchMethodException &#123;</span><br><span class="line"></span><br><span class="line">        Test test =  new Test();</span><br><span class="line">    </span><br><span class="line">        Class clazz = Class.forName(&quot;com.zhongyp.advanced.proxy.Test&quot;);</span><br><span class="line">        Constructor[] constructors = clazz.getConstructors();</span><br><span class="line">        for(Constructor str:constructors)&#123;</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method[] method = clazz.getDeclaredMethods();</span><br><span class="line">        for(Method method1:method)&#123;</span><br><span class="line">            System.out.println(method1);</span><br><span class="line">        &#125;</span><br><span class="line">        Method method1 = clazz.getMethod(&quot;go&quot;, null);</span><br><span class="line">        method1.invoke(test,null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">class Test&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Test()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    private void test()&#123;&#125;</span><br><span class="line">    public void go()&#123;</span><br><span class="line">        System.out.println(&quot;go&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void gogogo()&#123;</span><br><span class="line">        System.out.println(&quot;gogogo&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><p>ä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†æä¾›é¢å¤–æˆ–ä¸åŒçš„æ“ä½œï¼Œè€Œæ’å…¥çš„ç”¨æ¥æ›¿ä»£â€å®é™…â€å¯¹è±¡çš„å¯¹è±¡ï¼Œè¿™äº›æ“ä½œæ¶‰åŠåˆ°ä¸â€å®é™…â€å¯¹è±¡çš„é€šä¿¡ï¼Œå› æ­¤ä»£ç†é€šå¸¸å……å½“ä¸­é—´äººè§’è‰²ã€‚Javaçš„åŠ¨æ€ä»£ç†æ¯”ä»£ç†çš„æ€æƒ³æ›´å‰è¿›äº†ä¸€æ­¥ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°åˆ›å»ºå¹¶ä»£ç†å¹¶åŠ¨æ€åœ°å¤„ç†å¯¹æ‰€ä»£ç†æ–¹æ³•çš„è°ƒç”¨ã€‚åœ¨åŠ¨æ€ä»£ç†ä¸Šæ‰€åšçš„æ‰€æœ‰è°ƒç”¨éƒ½ä¼šè¢«é‡å®šå‘åˆ°å•ä¸€çš„è°ƒç”¨å¤„ç†å™¨ä¸Šï¼Œå®ƒçš„å·¥ä½œæ˜¯æ­ç¤ºè°ƒç”¨çš„ç±»å‹å¹¶ç¡®å®šç›¸åº”çš„ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">interface TestService&#123;</span><br><span class="line"></span><br><span class="line">    void test();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TestServiceImpl implements TestService&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        System.out.println(&quot;æˆ‘è¦å¼€å§‹æµ‹è¯•å•¦&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyInvokeHandler implements InvocationHandler&#123;</span><br><span class="line"></span><br><span class="line">    Object obj;</span><br><span class="line">    public MyInvokeHandler(Object obj)&#123;</span><br><span class="line">        this.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        return method.invoke(obj,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line"></span><br><span class="line">        TestServiceImpl testService = new TestServiceImpl();</span><br><span class="line"></span><br><span class="line">        MyInvokeHandler myInvokeHandler = new MyInvokeHandler(testService);</span><br><span class="line"></span><br><span class="line">        TestService proxy = (TestService) Proxy.newProxyInstance(TestService.class.getClassLoader(),new Class[]&#123;TestService.class&#125;,myInvokeHandler);</span><br><span class="line"></span><br><span class="line">        proxy.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¦æƒ³ç†è§£åå°„çš„åŸç†ï¼Œé¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯ç±»å‹ä¿¡æ¯ã€‚Javaè®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶è¯†åˆ«å¯¹è±¡å’Œç±»çš„ä¿¡æ¯ï¼Œä¸»è¦æœ‰2ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ä¼ ç»Ÿçš„RTTIï¼Œå®ƒå‡å®šæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å·²ç»çŸ¥é“äº†æ‰€æœ‰çš„ç±»å‹ä¿¡æ¯ï¼›å¦ä¸€ç§æ˜¯åå°„æœºåˆ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å‘ç°å’Œä½¿ç”¨ç±»çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;CLASS-å¯¹è±¡&quot;&gt;&lt;
      
    
    </summary>
    
    
      <category term="Java" scheme="http://zhongyp.me/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®å­˜å‚¨-Springäº‹åŠ¡</title>
    <link href="http://zhongyp.me/2018/03/17/spring/2018-03-17-Spring-Transaction/"/>
    <id>http://zhongyp.me/2018/03/17/spring/2018-03-17-Spring-Transaction/</id>
    <published>2018-03-16T16:00:00.000Z</published>
    <updated>2018-11-10T09:56:10.327Z</updated>
    
    <content type="html"><![CDATA[<h2 id="äº‹åŠ¡ä¼ æ’­ç‰¹æ€§"><a href="#äº‹åŠ¡ä¼ æ’­ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡ä¼ æ’­ç‰¹æ€§"></a>äº‹åŠ¡ä¼ æ’­ç‰¹æ€§</h2><p><a href="https://github.com/zhongyp/Demo" target="_blank" rel="noopener">æºç å®ä¾‹</a></p><h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><h2 id="Spring-äº‹åŠ¡"><a href="#Spring-äº‹åŠ¡" class="headerlink" title="Spring äº‹åŠ¡"></a>Spring äº‹åŠ¡</h2><p>äº‹åŠ¡åŸæœ¬æ˜¯æ•°æ®åº“ä¸­çš„æ¦‚å¿µï¼Œåœ¨ Dao å±‚ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéœ€è¦å°†äº‹åŠ¡æå‡åˆ°ä¸šåŠ¡å±‚ï¼Œå³ Service å±‚ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨äº‹åŠ¡çš„ç‰¹æ€§æ¥ç®¡ç†å…·ä½“çš„ä¸šåŠ¡ã€‚  </p><p>åœ¨ Spring ä¸­é€šå¸¸å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥å®ç°å¯¹äº‹åŠ¡çš„ç®¡ç†ï¼š </p><ol><li><p>ä½¿ç”¨ Spring çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡ </p></li><li><p>ä½¿ç”¨ Spring çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡ </p></li><li><p>ä½¿ç”¨ AspectJ çš„ AOP é…ç½®ç®¡ç†äº‹åŠ¡ </p></li></ol><p>Spring çš„äº‹åŠ¡ç®¡ç†ï¼Œä¸»è¦ç”¨åˆ°ä¸¤ä¸ªäº‹åŠ¡ç›¸å…³çš„æ¥å£ã€‚</p><p> <img src="https://github.com/zhongyp/jekyll.github.io/blob/master/styles/images/article/transaction.jpg?raw=true" alt="Springäº‹åŠ¡æ¥å£"></p><h2 id="äº‹åŠ¡ç®¡ç†å™¨æ¥å£"><a href="#äº‹åŠ¡ç®¡ç†å™¨æ¥å£" class="headerlink" title="äº‹åŠ¡ç®¡ç†å™¨æ¥å£"></a>äº‹åŠ¡ç®¡ç†å™¨æ¥å£</h2><p>äº‹åŠ¡ç®¡ç†å™¨æ˜¯ PlatformTransactionManager æ¥å£å¯¹è±¡ã€‚å…¶ä¸»è¦ç”¨äºå®Œæˆäº‹åŠ¡çš„æäº¤ã€å›æ»šï¼ŒåŠè·å–äº‹åŠ¡çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Public interface PlatformTransactionManager()...&#123;  </span><br><span class="line">// ç”±TransactionDefinitionå¾—åˆ°TransactionStatuså¯¹è±¡</span><br><span class="line">TransactionStatus getTransaction(TransactionDefinition definition) throws TransactionException; </span><br><span class="line">// æäº¤</span><br><span class="line">Void commit(TransactionStatus status) throws TransactionException;  </span><br><span class="line">// å›æ»š</span><br><span class="line">Void rollback(TransactionStatus status) throws TransactionException;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A) å¸¸ç”¨çš„ä¸¤ä¸ªå®ç°ç±»ï¼ŒPlatformTransactionManager æ¥å£æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å®ç°ç±»ï¼š  ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</p><ul><li>DataSourceTransactionManagerï¼šä½¿ç”¨ JDBC æˆ– iBatis  è¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨ã€‚  </li></ul><p>å¦‚æœåº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨JDBCæ¥è¿›è¡ŒæŒä¹…åŒ–ï¼ŒDataSourceTransactionManagerä¼šä¸ºä½ å¤„ç†äº‹åŠ¡è¾¹ç•Œã€‚ä¸ºäº†ä½¿ç”¨DataSourceTransactionManagerï¼Œä½ éœ€è¦ä½¿ç”¨å¦‚ä¸‹çš„XMLå°†å…¶è£…é…åˆ°åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡å®šä¹‰ä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼ŒDataSourceTransactionManageræ˜¯é€šè¿‡è°ƒç”¨java.sql.Connectionæ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œåè€…æ˜¯é€šè¿‡DataSourceè·å–åˆ°çš„ã€‚é€šè¿‡è°ƒç”¨è¿æ¥çš„commit()æ–¹æ³•æ¥æäº¤äº‹åŠ¡ï¼ŒåŒæ ·ï¼Œäº‹åŠ¡å¤±è´¥åˆ™é€šè¿‡è°ƒç”¨rollback()æ–¹æ³•è¿›è¡Œå›æ»šã€‚</p><p>ã€€ã€€</p><ul><li>HibernateTransactionManagerï¼šä½¿ç”¨ Hibernate è¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨ã€‚ </li></ul><p>å¦‚æœåº”ç”¨ç¨‹åºçš„æŒä¹…åŒ–æ˜¯é€šè¿‡Hibernateå®ç°çš„ï¼Œé‚£ä¹ˆä½ éœ€è¦ä½¿ç”¨HibernateTransactionManagerã€‚å¯¹äºHibernate3ï¼Œéœ€è¦åœ¨Springä¸Šä¸‹æ–‡å®šä¹‰ä¸­æ·»åŠ å¦‚ä¸‹çš„<bean>å£°æ˜ï¼š</bean></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.hibernate3.HibernateTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>sessionFactoryå±æ€§éœ€è¦è£…é…ä¸€ä¸ªHibernateçš„sessionå·¥å‚ï¼ŒHibernateTransactionManagerçš„å®ç°ç»†èŠ‚æ˜¯å®ƒå°†äº‹åŠ¡ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™org.hibernate.Transactionå¯¹è±¡ï¼Œè€Œåè€…æ˜¯ä»Hibernate Sessionä¸­è·å–åˆ°çš„ã€‚å½“äº‹åŠ¡æˆåŠŸå®Œæˆæ—¶ï¼ŒHibernateTransactionManagerå°†ä¼šè°ƒç”¨Transactionå¯¹è±¡çš„commit()æ–¹æ³•ï¼Œåä¹‹ï¼Œå°†ä¼šè°ƒç”¨rollback()æ–¹æ³•ã€‚</p><p>B) PlatformTransactionManagerå…¶ä»–å®ç°ç±»</p><p>Springäº‹åŠ¡ç®¡ç†çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ä¸ºä¸åŒçš„äº‹åŠ¡APIæä¾›ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¦‚JTA(äº‹åŠ¡)ã€JPA(æŒä¹…åŒ–)ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªå¹³å°æ¡†æ¶å®ç°äº‹åŠ¡ç®¡ç†çš„æœºåˆ¶ã€‚</p><ul><li>JavaæŒä¹…åŒ–APIäº‹åŠ¡ï¼ˆJPAï¼‰</li></ul><p>Hibernateå¤šå¹´æ¥ä¸€ç›´æ˜¯äº‹å®ä¸Šçš„JavaæŒä¹…åŒ–æ ‡å‡†ï¼Œä½†æ˜¯ç°åœ¨JavaæŒä¹…åŒ–APIä½œä¸ºçœŸæ­£çš„JavaæŒä¹…åŒ–æ ‡å‡†è¿›å…¥å¤§å®¶çš„è§†é‡ã€‚å¦‚æœä½ è®¡åˆ’ä½¿ç”¨JPAçš„è¯ï¼Œé‚£ä½ éœ€è¦ä½¿ç”¨Springçš„JpaTransactionManageræ¥å¤„ç†äº‹åŠ¡ã€‚ä½ éœ€è¦åœ¨Springä¸­è¿™æ ·é…ç½®JpaTransactionManagerï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>JpaTransactionManageråªéœ€è¦è£…é…ä¸€ä¸ªJPAå®ä½“ç®¡ç†å·¥å‚ï¼ˆjavax.persistence.EntityManagerFactoryæ¥å£çš„ä»»æ„å®ç°ï¼‰ã€‚JpaTransactionManagerå°†ä¸ç”±å·¥å‚æ‰€äº§ç”Ÿçš„JPA EntityManageråˆä½œæ¥æ„å»ºäº‹åŠ¡ã€‚</p><ul><li>JavaåŸç”ŸAPIäº‹åŠ¡(JTA)</li></ul><p>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ä»¥ä¸Šæ‰€è¿°çš„äº‹åŠ¡ç®¡ç†ï¼Œæˆ–è€…æ˜¯è·¨è¶Šäº†å¤šä¸ªäº‹åŠ¡ç®¡ç†æºï¼ˆæ¯”å¦‚ä¸¤ä¸ªæˆ–è€…æ˜¯å¤šä¸ªä¸åŒçš„æ•°æ®æºï¼‰ï¼Œä½ å°±éœ€è¦ä½¿ç”¨JtaTransactionManagerï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;transactionManagerName&quot; value=&quot;java:/TransactionManager&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>JtaTransactionManagerå°†äº‹åŠ¡ç®¡ç†çš„è´£ä»»å§”æ‰˜ç»™javax.transaction.UserTransactionå’Œjavax.transaction.TransactionManagerå¯¹è±¡ï¼Œå…¶ä¸­äº‹åŠ¡æˆåŠŸå®Œæˆé€šè¿‡UserTransaction.commit()æ–¹æ³•æäº¤ï¼Œäº‹åŠ¡å¤±è´¥é€šè¿‡UserTransaction.rollback()æ–¹æ³•å›æ»šã€‚</p><p>C) Spring çš„å›æ»šæ–¹å¼ ã€€ã€€</p><ul><li>Spring äº‹åŠ¡çš„é»˜è®¤å›æ»šæ–¹å¼æ˜¯ï¼šå‘ç”Ÿè¿è¡Œæ—¶å¼‚å¸¸æ—¶å›æ»šï¼Œå‘ç”Ÿå—æŸ¥å¼‚å¸¸æ—¶æäº¤ã€‚ä¸è¿‡ï¼Œå¯¹äºå—æŸ¥å¼‚å¸¸ï¼Œç¨‹åºå‘˜ä¹Ÿå¯ä»¥æ‰‹å·¥è®¾ç½®å…¶å›æ»šæ–¹å¼ã€‚</li></ul><h2 id="äº‹åŠ¡å®šä¹‰æ¥å£"><a href="#äº‹åŠ¡å®šä¹‰æ¥å£" class="headerlink" title="äº‹åŠ¡å®šä¹‰æ¥å£"></a>äº‹åŠ¡å®šä¹‰æ¥å£</h2><p>äº‹åŠ¡å®šä¹‰æ¥å£ TransactionDefinition ä¸­å®šä¹‰äº†äº‹åŠ¡æè¿°ç›¸å…³çš„ä¸‰ç±»å¸¸é‡ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«ã€äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€äº‹åŠ¡é»˜è®¤è¶…æ—¶æ—¶é™ï¼ŒåŠå¯¹å®ƒä»¬çš„æ“ä½œã€‚</p><p>A) å®šä¹‰äº†äº”ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«å¸¸é‡,è¿™äº›å¸¸é‡å‡æ˜¯ä»¥ ISOLATION_å¼€å¤´ã€‚å³å½¢å¦‚ ISOLATION_XXXï¼š ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ </p><ul><li>DEFAULTï¼šé‡‡ç”¨DBé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚MySqlçš„é»˜è®¤ä¸ºREPEATABLE_READï¼›  Oracleé»˜è®¤ä¸º READ_COMMITTEDã€‚ ã€€ã€€</li><li>READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ã€‚æœªè§£å†³ä»»ä½•å¹¶å‘é—®é¢˜ã€‚ ã€€ã€€</li><li>READ_COMMITTEDï¼šè¯»å·²æäº¤ã€‚è§£å†³è„è¯»ï¼Œå­˜åœ¨ä¸å¯é‡å¤è¯»ä¸å¹»è¯»ã€‚  ã€€ã€€</li><li>REPEATABLE_READï¼šå¯é‡å¤è¯»ã€‚è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œå­˜åœ¨å¹»è¯»  ã€€ã€€</li><li>SERIALIZABLEï¼šä¸²è¡ŒåŒ–ã€‚ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚</li></ul><p>B) å®šä¹‰äº†ä¸ƒä¸ªäº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¸¸é‡ï¼Œæ‰€è°“äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯æŒ‡ï¼Œå¤„äºä¸åŒäº‹åŠ¡ä¸­çš„æ–¹æ³•åœ¨ç›¸äº’è°ƒç”¨æ—¶ï¼Œæ‰§è¡ŒæœŸé—´äº‹åŠ¡çš„ç»´æŠ¤æƒ…å†µã€‚å¦‚ï¼ŒA äº‹åŠ¡ä¸­çš„æ–¹æ³• doSome()è°ƒç”¨ B äº‹åŠ¡ä¸­çš„æ–¹æ³• doOther()ï¼Œåœ¨è°ƒç”¨æ‰§è¡ŒæœŸé—´äº‹åŠ¡çš„ç»´æŠ¤æƒ…å†µï¼Œå°±ç§°ä¸ºäº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯åŠ åœ¨æ–¹æ³•ä¸Šçš„ã€‚äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¸¸é‡éƒ½æ˜¯ä»¥ PROPAGATION_  å¼€å¤´ï¼Œå½¢å¦‚ PROPAGATION_XXXã€‚  ã€€ã€€</p><ul><li>REQUIREDï¼šæŒ‡å®šçš„æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡å†…æ‰§è¡Œã€‚è‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­ï¼›è‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚è¿™ç§ä¼ æ’­è¡Œä¸ºæ˜¯æœ€å¸¸è§çš„é€‰æ‹©ï¼Œä¹Ÿæ˜¯Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚å¦‚è¯¥ä¼ æ’­è¡Œä¸ºåŠ åœ¨ doOther()æ–¹æ³•ä¸Šã€‚è‹¥ doSome()æ–¹æ³•åœ¨æ‰§è¡Œæ—¶å°±æ˜¯åœ¨äº‹åŠ¡å†…çš„ï¼Œåˆ™ doOther()æ–¹æ³•çš„æ‰§è¡Œä¹ŸåŠ å…¥åˆ°è¯¥äº‹åŠ¡å†…æ‰§è¡Œã€‚è‹¥ doSome()æ–¹æ³•æ²¡æœ‰åœ¨äº‹åŠ¡å†…æ‰§è¡Œï¼Œåˆ™ doOther()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œã€‚ã€€ã€€</li><li><p>SUPPORTSï¼šæŒ‡å®šçš„æ–¹æ³•æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œä½†è‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚ </p></li><li><p>MANDATORYï¼šæŒ‡å®šçš„æ–¹æ³•å¿…é¡»åœ¨å½“å‰äº‹åŠ¡å†…æ‰§è¡Œï¼Œè‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>REQUIRES_NEWï¼šæ€»æ˜¯æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ï¼Œç›´åˆ°æ–°äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p></li><li><p>NOT_SUPPORTEDï¼šæŒ‡å®šçš„æ–¹æ³•ä¸èƒ½åœ¨äº‹åŠ¡ç¯å¢ƒä¸­æ‰§è¡Œï¼Œè‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</p></li><li><p>NEVERï¼šæŒ‡å®šçš„æ–¹æ³•ä¸èƒ½åœ¨äº‹åŠ¡ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œè‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>NESTEDï¼šæŒ‡å®šçš„æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡å†…æ‰§è¡Œã€‚è‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼›è‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚åµŒå¥—äº‹åŠ¡åœ¨å¤–éƒ¨äº‹åŠ¡æäº¤åï¼Œæ‰çœŸæ­£çš„æäº¤ã€‚</p></li></ul><p>C) å®šä¹‰äº†é»˜è®¤äº‹åŠ¡è¶…æ—¶æ—¶é™ </p><ul><li><p>å¸¸é‡ TIMEOUT_DEFAULT å®šä¹‰äº†äº‹åŠ¡åº•å±‚é»˜è®¤çš„è¶…æ—¶æ—¶é™ï¼ŒåŠä¸æ”¯æŒäº‹åŠ¡è¶…æ—¶æ—¶é™è®¾ç½®çš„ none å€¼ã€‚ </p></li><li><p>æ³¨æ„ï¼Œäº‹åŠ¡çš„è¶…æ—¶æ—¶é™èµ·ä½œç”¨çš„æ¡ä»¶æ¯”è¾ƒå¤šï¼Œä¸”è¶…æ—¶çš„æ—¶é—´è®¡ç®—ç‚¹è¾ƒå¤æ‚ã€‚æ‰€ä»¥ï¼Œè¯¥å€¼ä¸€èˆ¬å°±ä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p></li></ul><h2 id="Spring-çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡"><a href="#Spring-çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡" class="headerlink" title="Spring çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡"></a>Spring çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†Œæ•°æ®æºï¼šC3P0æ•°æ®æº --&gt;</span><br><span class="line">    &lt;bean id=&quot;myDataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒJDBCå±æ€§æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒDao --&gt;</span><br><span class="line">    &lt;bean id=&quot;accountDao&quot; class=&quot;com.tongji.dao.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;stockDao&quot; class=&quot;com.tongji.dao.StockDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†ŒService --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockService&quot; class=&quot;com.tongji.service.StockProcessServiceImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;stockDao&quot; ref=&quot;stockDao&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;    </span><br><span class="line">    </span><br><span class="line">    &lt;!-- äº‹åŠ¡ --&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span><br><span class="line">    &lt;bean id=&quot;myTxManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- ç”Ÿæˆäº‹åŠ¡ä»£ç† --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockServiceProxy&quot; class=&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;transactionManager&quot; ref=&quot;myTxManager&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;target&quot; ref=&quot;stockService&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;transactionAttributes&quot;&gt;</span><br><span class="line">            &lt;props&gt;</span><br><span class="line">                &lt;prop key=&quot;open*&quot;&gt;ISOLATION_DEFAULT,PROPAGATION_REQUIRED&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=&quot;buyStock&quot;&gt;ISOLATION_DEFAULT,PROPAGATION_REQUIRED,-StockException&lt;/prop&gt;</span><br><span class="line">            &lt;/props&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h2 id="Spring-çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡"><a href="#Spring-çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡" class="headerlink" title="Spring çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡"></a>Spring çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡</h2><p>æ³¨ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@Transactional è‹¥ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œåªèƒ½ç”¨äº public æ–¹æ³•ä¸Šã€‚å¯¹äºå…¶ä»–épublic æ–¹æ³•ï¼Œå¦‚æœåŠ ä¸Šäº†æ³¨è§£@Transactionalï¼Œè™½ç„¶ Spring ä¸ä¼šæŠ¥é”™ï¼Œä½†ä¸ä¼šå°†æŒ‡å®šäº‹åŠ¡ç»‡å…¥åˆ°è¯¥æ–¹æ³•ä¸­ã€‚å› ä¸º Spring ä¼šå¿½ç•¥æ‰æ‰€æœ‰é public æ–¹æ³•ä¸Šçš„@Transaction æ³¨è§£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">        xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; </span><br><span class="line">        xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">        http://www.springframework.org/schema/tx </span><br><span class="line">        http://www.springframework.org/schema/tx/spring-tx.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†Œæ•°æ®æºï¼šC3P0æ•°æ®æº --&gt;</span><br><span class="line">    &lt;bean id=&quot;myDataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒJDBCå±æ€§æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒDao --&gt;</span><br><span class="line">    &lt;bean id=&quot;accountDao&quot; class=&quot;com.tongji.dao.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;stockDao&quot; class=&quot;com.tongji.dao.StockDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†ŒService --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockService&quot; class=&quot;com.tongji.service.StockProcessServiceImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;stockDao&quot; ref=&quot;stockDao&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;    </span><br><span class="line">    </span><br><span class="line">    &lt;!-- äº‹åŠ¡ --&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span><br><span class="line">    &lt;bean id=&quot;myTxManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- å¼€å¯æ³¨è§£é©±åŠ¨ --&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager=&quot;myTxManager&quot;/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Override</span><br><span class="line">@Transactional(isolation=Isolation.DEFAULT, propagation=Propagation.REQUIRED)</span><br><span class="line">public void openAccount(String aname, double money) &#123;</span><br><span class="line">    accountDao.insertAccount(aname, money);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">@Transactional(isolation=Isolation.DEFAULT, propagation=Propagation.REQUIRED)</span><br><span class="line">public void openStock(String sname, int amount) &#123;</span><br><span class="line">    stockDao.insertStock(sname, amount);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">@Transactional(isolation=Isolation.DEFAULT, propagation=Propagation.REQUIRED, rollbackFor=StockException.class)</span><br><span class="line">public void buyStock(String aname, double money, String sname, int amount) throws StockException &#123;</span><br><span class="line">    boolean isBuy = true;</span><br><span class="line">    accountDao.updateAccount(aname, money, isBuy);</span><br><span class="line">    if (true) &#123;</span><br><span class="line">        throw new StockException(&quot;è´­ä¹°è‚¡ç¥¨å¼‚å¸¸&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    stockDao.updateStock(sname, amount, isBuy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring-ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡"><a href="#Spring-ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡" class="headerlink" title="Spring ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡"></a>Spring ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡</h2><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/styles/images/article/aop-3.jpg?raw=true" alt="aop3"></p><p>AOPæœ¯è¯­ï¼š</p><ul><li><p>è¿æ¥ç‚¹ï¼ˆjoinpointï¼‰ä½ å¯ä»¥åˆ‡å…¥çš„æ–¹æ³•ï¼ˆæ³¨æ„æ˜¯å¯ä»¥ï¼‰ã€‚</p></li><li><p>åˆ‡ç‚¹ï¼ˆpointcutï¼‰æ˜¯ä½ åˆ‡å…¥çš„æ–¹æ³•ã€‚</p></li><li><p>å¢å¼ºï¼ˆadviceï¼‰å¾€åˆ‡ç‚¹é‡Œé¢å¢åŠ å…¶ä»–ç‰¹æ®Šçš„ä¸œè¥¿ï¼Œæ¯”å¦‚äº‹åŠ¡ä¼ æ’­ã€‚</p></li><li><p>ç›®æ ‡å¯¹è±¡ï¼ˆtargetï¼‰å¼•å…¥ä¸­æ‰€æåˆ°çš„ç›®æ ‡ç±»ï¼Œä¹Ÿå°±æ˜¯è¦è¢«é€šçŸ¥çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»–å¯ä»¥åœ¨æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œè¢«å’±ä»¬ç»‡å…¥åˆ‡é¢ã€‚è€Œè‡ªå·±ä¸“æ³¨äºä¸šåŠ¡æœ¬èº«çš„é€»è¾‘ã€‚</p></li><li><p>å¼•ä»‹ï¼ˆintroductionï¼‰å…è®¸æˆ‘ä»¬å‘ç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•å±æ€§ã€‚</p></li><li><p>ç»‡å…¥ï¼ˆweavingï¼‰ æŠŠåˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚æœ‰3ç§æ–¹å¼ï¼Œspringé‡‡ç”¨çš„æ˜¯è¿è¡Œæ—¶ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿è¡Œæ—¶ï¼Œåé¢è§£é‡Šã€‚</p></li><li><p>ä»£ç†ï¼ˆproxyï¼‰å®ç°æ•´å¥—aopæœºåˆ¶çš„ï¼Œéƒ½æ˜¯é€šè¿‡ä»£ç†ã€‚</p></li><li><p>åˆ‡é¢ï¼ˆaspectï¼‰åˆ‡é¢æ˜¯é€šçŸ¥å’Œåˆ‡å…¥ç‚¹çš„ç»“åˆ,å°±æ˜¯å®šä¹‰äº†é€šçŸ¥çš„ç±»ã€‚ç°åœ¨å‘ç°äº†å§ï¼Œæ²¡è¿æ¥ç‚¹ä»€ä¹ˆäº‹æƒ…ï¼Œè¿æ¥ç‚¹å°±æ˜¯ä¸ºäº†è®©ä½ å¥½ç†è§£åˆ‡ç‚¹ï¼Œæå‡ºæ¥çš„ï¼Œæ˜ç™½è¿™ä¸ªæ¦‚å¿µå°±è¡Œäº†ã€‚é€šçŸ¥è¯´æ˜äº†å¹²ä»€ä¹ˆå’Œä»€ä¹ˆæ—¶å€™å¹²ï¼ˆä»€ä¹ˆæ—¶å€™é€šè¿‡æ–¹æ³•åä¸­çš„before,afterï¼Œaroundç­‰å°±èƒ½çŸ¥é“ï¼‰ï¼Œè€Œåˆ‡å…¥ç‚¹è¯´æ˜äº†åœ¨å“ªå¹²ï¼ˆæŒ‡å®šåˆ°åº•æ˜¯å“ªä¸ªæ–¹æ³•ï¼‰ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ‡é¢å®šä¹‰ã€‚</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">        xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; </span><br><span class="line">        xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">        http://www.springframework.org/schema/tx </span><br><span class="line">        http://www.springframework.org/schema/tx/spring-tx.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†Œæ•°æ®æºï¼šC3P0æ•°æ®æº --&gt;</span><br><span class="line">    &lt;bean id=&quot;myDataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒJDBCå±æ€§æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒDao --&gt;</span><br><span class="line">    &lt;bean id=&quot;accountDao&quot; class=&quot;com.tongji.dao.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;stockDao&quot; class=&quot;com.tongji.dao.StockDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†ŒService --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockService&quot; class=&quot;com.tongji.service.StockProcessServiceImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;stockDao&quot; ref=&quot;stockDao&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;    </span><br><span class="line">    </span><br><span class="line">    &lt;!-- äº‹åŠ¡ --&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span><br><span class="line">    &lt;bean id=&quot;myTxManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡é€šçŸ¥ --&gt;</span><br><span class="line">    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;myTxManager&quot;&gt;</span><br><span class="line">        &lt;tx:attributes&gt;</span><br><span class="line">            &lt;!-- æŒ‡å®šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•ä¸Šåº”ç”¨çš„äº‹åŠ¡å±æ€§ --&gt;</span><br><span class="line">            &lt;tx:method name=&quot;open*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot;/&gt;</span><br><span class="line">            &lt;tx:method name=&quot;buyStock&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;StockException&quot;/&gt;</span><br><span class="line">        &lt;/tx:attributes&gt;</span><br><span class="line">    &lt;/tx:advice&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- AOPé…ç½® --&gt;</span><br><span class="line">    &lt;aop:config proxy-target-class=&quot;true&quot;&gt;//è¡¨ç¤ºä½¿ç”¨CGLibåŠ¨æ€ä»£ç†æŠ€æœ¯ç»‡å…¥å¢å¼ºã€‚è®¾ç½®ä¸ºfalseæ—¶ï¼Œè¡¨ç¤ºä½¿ç”¨jdkåŠ¨æ€ä»£ç†ç»‡å…¥å¢å¼ºï¼Œå¦‚æœç›®æ ‡ç±»æ²¡æœ‰å£°æ˜æ¥å£ï¼Œåˆ™springå°†è‡ªåŠ¨ä½¿ç”¨CGLibåŠ¨æ€ä»£ç†ã€‚</span><br><span class="line">        &lt;!-- æŒ‡å®šåˆ‡å…¥ç‚¹ --&gt;</span><br><span class="line">        &lt;aop:pointcut expression=&quot;execution(* *..service.*.*(..))&quot; id=&quot;stockPointCut&quot;/&gt;//è¿™é‡Œè®¾ç½®åˆ‡å…¥ç‚¹ï¼Œexpressionè®¾ç½®åˆ‡é¢æ¤å…¥çš„åˆ‡å…¥ç‚¹çš„æ–¹æ³•åœ°å€</span><br><span class="line">        &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;stockPointCut&quot;/&gt;// åŠ å…¥äº‹åŠ¡ä¼ æ’­ç‰¹æ€§</span><br><span class="line">        &lt;aop:aspect ref=&quot;stockService&quot;&gt;//å®šä¹‰ä¸€ä¸ªåˆ‡é¢</span><br><span class="line">         </span><br><span class="line">        </span><br><span class="line">        --&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/qjjazry/p/6366204.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;äº‹åŠ¡ä¼ æ’­ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#äº‹åŠ¡ä¼ æ’­ç‰¹æ€§&quot; class=&quot;headerlink&quot; title=&quot;äº‹åŠ¡ä¼ æ’­ç‰¹æ€§&quot;&gt;&lt;/a&gt;äº‹åŠ¡ä¼ æ’­ç‰¹æ€§&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/zhongyp/Demo&quot; target=&quot;_bla
      
    
    </summary>
    
    
      <category term="æ•°æ®å­˜å‚¨" scheme="http://zhongyp.me/tags/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
  </entry>
  
  <entry>
    <title>ThreadLocal</title>
    <link href="http://zhongyp.me/2018/03/16/concurrent/2018-03-16-ThreadLocal/"/>
    <id>http://zhongyp.me/2018/03/16/concurrent/2018-03-16-ThreadLocal/</id>
    <published>2018-03-15T16:00:00.000Z</published>
    <updated>2018-10-02T01:27:53.323Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ThreadLocalåŸºæœ¬åŸç†"><a href="#ThreadLocalåŸºæœ¬åŸç†" class="headerlink" title="ThreadLocalåŸºæœ¬åŸç†"></a>ThreadLocalåŸºæœ¬åŸç†</h2><h3 id="ThreadLocalçš„ä½œç”¨"><a href="#ThreadLocalçš„ä½œç”¨" class="headerlink" title="ThreadLocalçš„ä½œç”¨"></a>ThreadLocalçš„ä½œç”¨</h3><p>ThreadLocalæä¾›æœ¬åœ°çº¿ç¨‹å˜é‡ã€‚</p><h3 id="ThreadLocalç¤ºä¾‹"><a href="#ThreadLocalç¤ºä¾‹" class="headerlink" title="ThreadLocalç¤ºä¾‹"></a>ThreadLocalç¤ºä¾‹</h3><p>é‚£ThreadLocalæ˜¯æ€æ ·ç»™æœ¬åœ°çº¿ç¨‹æä¾›çº¿ç¨‹å˜é‡çš„å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„ç¤ºä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">        final ThreadLocal threadLocal = new ThreadLocal();</span><br><span class="line">        Thread thread1 = new Thread()&#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void run()&#123;</span><br><span class="line">                threadLocal.set(&quot;a&quot;);</span><br><span class="line">                System.out.println(threadLocal.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Thread thread2 = new Thread()&#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void run()&#123;</span><br><span class="line">                threadLocal.set(&quot;b&quot;);</span><br><span class="line">                System.out.println(threadLocal.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Thread thread3 = new Thread()&#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void run()&#123;</span><br><span class="line">                threadLocal.set(&quot;c&quot;);</span><br><span class="line">                System.out.println(threadLocal.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        </span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç»“æœè¾“å‡ºï¼š<br>a<br>b<br>c</p><p>ä»£ç ç¤ºä¾‹è§£è¯»ï¼š</p><p>1.é¦–å…ˆå£°æ˜ä¸€ä¸ªThreadLocalå˜é‡</p><p>2.åœ¨æ¯ä¸ªçº¿ç¨‹å†…ï¼Œé€šè¿‡threadLocal.set()çš„æ–¹æ³•ä¸ºå½“å‰çº¿ç¨‹æä¾›çº¿ç¨‹å˜é‡ï¼Œset()æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void set(T value) &#123;</span><br><span class="line">    Thread t = Thread.currentThread();// è·å–å½“å‰çº¿ç¨‹</span><br><span class="line">    ThreadLocalMap map = getMap(t);// é€šè¿‡getMap è·å– Threadå¯¹è±¡çš„threadlocal.ThreadLocalMap</span><br><span class="line">    if (map != null)</span><br><span class="line">        map.set(this, value);// ä»¥this(ThreadLocalæœ¬èº«)ä¸ºKey,å‚æ•°valueä¸ºå€¼è¿›è¡Œä¿å­˜</span><br><span class="line">    else</span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ThreadLocal æ˜¯ä¸€ä¸ªå’ŒThreadæ— å…³çš„å¯¹è±¡ï¼Œå¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå·¥å…·ï¼Œå¦‚æœéœ€è¦ç»™çº¿ç¨‹æä¾›çº¿ç¨‹å˜é‡ï¼Œå°±ç”¨ThreadLocalçš„set()æ–¹æ³•ç»™çº¿ç¨‹æä¾›å˜é‡ã€‚</p><p>æ³¨ï¼šThreadLocalåœ¨å½“å‰çº¿ç¨‹å†…éƒ½å¯ç”¨ï¼Œä¸å±€é™äºå½“å‰æ–¹æ³•å†…ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ThreadLocalåŸºæœ¬åŸç†&quot;&gt;&lt;a href=&quot;#ThreadLocalåŸºæœ¬åŸç†&quot; class=&quot;headerlink&quot; title=&quot;ThreadLocalåŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt;ThreadLocalåŸºæœ¬åŸç†&lt;/h2&gt;&lt;h3 id=&quot;ThreadLocalçš„ä½œ
      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="http://zhongyp.me/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>çº¿ç¨‹ç®€ä»‹</title>
    <link href="http://zhongyp.me/2018/03/16/concurrent/2017-03-16-thread-brief/"/>
    <id>http://zhongyp.me/2018/03/16/concurrent/2017-03-16-thread-brief/</id>
    <published>2018-03-15T16:00:00.000Z</published>
    <updated>2018-12-04T11:05:36.841Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çº¿ç¨‹ç®€ä»‹"><a href="#çº¿ç¨‹ç®€ä»‹" class="headerlink" title="çº¿ç¨‹ç®€ä»‹"></a>çº¿ç¨‹ç®€ä»‹</h2><h3 id="1-ä»€ä¹ˆæ˜¯çº¿ç¨‹"><a href="#1-ä»€ä¹ˆæ˜¯çº¿ç¨‹" class="headerlink" title="1. ä»€ä¹ˆæ˜¯çº¿ç¨‹"></a>1. ä»€ä¹ˆæ˜¯çº¿ç¨‹</h3><p>ç°ä»£æ“ä½œç³»ç»Ÿåœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ã€‚æ¯”å¦‚ä½ ç°åœ¨ç”¨çš„æµè§ˆå™¨ï¼Œç³»ç»Ÿå°±ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªç”šè‡³å¤šä¸ªè¿›ç¨‹ã€‚<strong><em>å¼•å…¥è¿›ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„ä½¿æ“ä½œç³»ç»Ÿå¹¶å‘æ‰§è¡Œç¨‹åºã€‚æ¥æé«˜èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ï¼Œå¢åŠ å¹¶å‘ç¨‹åº¦ã€‚</em></strong><br>çº¿ç¨‹æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿè°ƒåº¦çš„åŸºæœ¬å•å…ƒï¼Œæ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„é€»è¾‘æµï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒï¼Œä¹Ÿå«è½»é‡çº§è¿›ç¨‹ï¼ˆLight Weight Processï¼‰ï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºCPUçš„æ‰§è¡Œå•å…ƒã€‚ä¸€ä¸ªç¨‹åºä½œä¸ºä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œï¼Œç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè€Œä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªå¤„ç†å™¨æ ¸å¿ƒä¸Šã€‚<strong><em>å¼•å…¥çº¿ç¨‹ï¼Œåˆ™æ˜¯ä¸ºäº†å‡å°ç¨‹åºåœ¨å¹¶å‘æ‰§è¡Œæ—¶æ‰€ä»˜å‡ºçš„æ—¶ç©ºå¼€é”€ï¼Œæé«˜æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚çº¿ç¨‹ä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼ˆä»£ç ï¼Œæ•°æ®ã€å †ã€å…±äº«åº“ã€æ–‡ä»¶ï¼‰ï¼Œåªæ‹¥æœ‰è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æºï¼ˆçº¿ç¨‹ID, æ ˆï¼Œæ ˆæŒ‡é’ˆï¼Œç¨‹åºè®¡æ•°å™¨ã€é€šç”¨ç›®çš„å¯„å­˜å™¨å’Œæ¡ä»¶ç ï¼‰ã€‚</em></strong><br>çº¿ç¨‹æ˜¯è°ƒåº¦çš„æŠ½è±¡ã€‚<strong><em>Javaä¸­å°†çº¿ç¨‹çš„æ‰§è¡Œå’Œæ‰§è¡Œå¯¹è±¡æŠ½è±¡å¼€æ¥ï¼ŒJDKåŒ…ä¸­æ‰§è¡Œçš„æœ‰Threadç±»ï¼ŒExecutoræ¡†æ¶ï¼Œå¯æ‰§è¡Œç›®æ ‡æœ‰Runaableï¼ŒCallableã€‚</em></strong></p><h4 id="1-1-çº¿ç¨‹çš„ä¼˜ç‚¹"><a href="#1-1-çº¿ç¨‹çš„ä¼˜ç‚¹" class="headerlink" title="1.1 çº¿ç¨‹çš„ä¼˜ç‚¹"></a>1.1 çº¿ç¨‹çš„ä¼˜ç‚¹</h4><ol><li>å¤šå¤„ç†å™¨ä½¿ç”¨ï¼š æé«˜èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ã€‚</li></ol><h4 id="1-2-çº¿ç¨‹çš„é£é™©"><a href="#1-2-çº¿ç¨‹çš„é£é™©" class="headerlink" title="1.2 çº¿ç¨‹çš„é£é™©"></a>1.2 çº¿ç¨‹çš„é£é™©</h4><ol><li>å®‰å…¨é£é™©ï¼šå¯¹äºå…±äº«å˜é‡çš„è®¿é—®ã€æ“ä½œå®¹æ˜“é€ æˆå®‰å…¨é£é™©ã€‚</li><li>æ´»è·ƒåº¦é£é™©ï¼šæ­»é”å¼•å‘æ´»åŠ¨åº¦å¤±è´¥ã€‚</li><li>æ€§èƒ½é£é™©ï¼šçº¿ç¨‹ä¹‹é—´é¢‘ç¹è°ƒåº¦å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´å·¨å¤§çš„ç³»ç»Ÿå¼€é”€ã€‚</li></ol><h3 id="2-çº¿ç¨‹çš„çŠ¶æ€"><a href="#2-çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="2. çº¿ç¨‹çš„çŠ¶æ€"></a>2. çº¿ç¨‹çš„çŠ¶æ€</h3><p><img src="/media/ThreadStatus.png" alt="ThreadStatus"><br><a href="#çº¿ç¨‹ç®€ä»‹">å›¾ç‰‡æ¥è‡ªï¼šJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯-</a></p><ul><li>æ–°å»º(NEW)ï¼šç”¨newå…³é”®å­—å’ŒThreadç±»æˆ–å…¶å­ç±»å»ºç«‹ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åï¼Œè¯¥çº¿ç¨‹å¯¹è±¡å°±å¤„äºæ–°ç”ŸçŠ¶æ€ã€‚å¤„äºæ–°ç”ŸçŠ¶æ€çš„çº¿ç¨‹æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡è°ƒç”¨startæ–¹æ³•è¿›å…¥å°±ç»ªçŠ¶æ€ï¼ˆREADYï¼‰ã€‚</li></ul><p><strong><em>æ³¨æ„ï¼šä¸èƒ½å¯¹å·²ç»å¯åŠ¨çš„çº¿ç¨‹å†æ¬¡è°ƒç”¨start()æ–¹æ³•ï¼Œå¦åˆ™ä¼šå‡ºç°Java.lang.IllegalThreadStateExceptionå¼‚å¸¸ã€‚</em></strong></p><ul><li><p>è¿è¡ŒçŠ¶æ€(RUNNABLE)ï¼šJavaçº¿ç¨‹å°†æ“ä½œç³»ç»Ÿä¸­çš„å°±ç»ªå’Œè¿è¡Œä¸¤ç§çŠ¶æ€ç¬¼ç»Ÿçš„ç§°ä½œâ€œè¿è¡Œä¸­â€ã€‚</p></li><li><p>å°±ç»ª(READY)ï¼šå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹å·²ç»å…·å¤‡äº†è¿è¡Œæ¡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰åˆ†é…åˆ°CPUï¼Œå¤„äºçº¿ç¨‹å°±ç»ªé˜Ÿåˆ—ï¼ˆå°½ç®¡æ˜¯é‡‡ç”¨é˜Ÿåˆ—å½¢å¼ï¼Œäº‹å®ä¸Šï¼ŒæŠŠå®ƒç§°ä¸ºå¯è¿è¡Œæ± è€Œä¸æ˜¯å¯è¿è¡Œé˜Ÿåˆ—ã€‚å› ä¸ºcpuçš„è°ƒåº¦ä¸ä¸€å®šæ˜¯æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥è°ƒåº¦çš„ï¼‰ï¼Œç­‰å¾…ç³»ç»Ÿä¸ºå…¶åˆ†é…CPUã€‚ç­‰å¾…çŠ¶æ€å¹¶ä¸æ˜¯æ‰§è¡ŒçŠ¶æ€ï¼Œå½“ç³»ç»Ÿé€‰å®šä¸€ä¸ªç­‰å¾…æ‰§è¡Œçš„Threadå¯¹è±¡åï¼Œå®ƒå°±ä¼šä»ç­‰å¾…æ‰§è¡ŒçŠ¶æ€è¿›å…¥æ‰§è¡ŒçŠ¶æ€ï¼Œç³»ç»ŸæŒ‘é€‰çš„åŠ¨ä½œç§°ä¹‹ä¸ºâ€œcpuè°ƒåº¦â€ã€‚ä¸€æ—¦è·å¾—CPUï¼Œçº¿ç¨‹å°±è¿›å…¥è¿è¡ŒçŠ¶æ€å¹¶è‡ªåŠ¨è°ƒç”¨è‡ªå·±çš„runæ–¹æ³•ã€‚ä¹Ÿå¯ä»¥å¯¹åœ¨è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨yield()æ–¹æ³•ï¼Œå®ƒå°±ä¼šè®©å‡ºcpuèµ„æºï¼Œå†æ¬¡å˜ä¸ºå°±ç»ªçŠ¶æ€ã€‚</p></li><li><p>è¿è¡Œ(RUNNING)ï¼šå¤„äºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹æœ€ä¸ºå¤æ‚ï¼Œå®ƒå¯ä»¥å˜ä¸ºé˜»å¡çŠ¶æ€ã€å°±ç»ªçŠ¶æ€å’Œæ­»äº¡çŠ¶æ€ã€‚</p></li><li><p>ç­‰å¾…çŠ¶æ€(WAITING)ï¼šè¡¨ç¤ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€è¡¨ç¤ºå½“å‰çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹ä½œå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œï¼ˆé€šçŸ¥æˆ–ä¸­æ–­ï¼‰ã€‚</p></li><li><p>è¶…æ—¶ç­‰å¾…çŠ¶æ€(TIME_WAITING)ï¼šè¯¥çŠ¶æ€ä¸åŒäºWAITINGï¼Œå®ƒæ˜¯å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´è‡ªè¡Œè¿”å›çš„ã€‚</p></li><li><p>é˜»å¡(BLOCKED)ï¼š<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.State.html" target="_blank" rel="noopener">javase7 docs</a>å…³äºBLOCKEDçš„æè¿°ï¼šThread state for a thread blocked waiting for a monitor lock. A thread in the blocked state is waiting for a monitor lock to enter a synchronized block/method or reenter a synchronized block/method after calling Object.wait.ç¿»è¯‘ï¼šé˜»å¡çº¿ç¨‹æ˜¯ç­‰å¾…è·å–åŒæ­¥ç›‘è§†å™¨é”çš„çº¿ç¨‹ã€‚çº¿ç¨‹ç­‰å¾…è·å–åŒæ­¥ç›‘è§†å™¨é”è¿›å…¥åŒæ­¥ä»£ç å—/æ–¹æ³•,æˆ–è€…è°ƒç”¨Object.waitæ–¹æ³•å,è¢«å”¤é†’åç­‰å¾…è·å–åŒæ­¥ç›‘è§†å™¨é”,<strong><em>é‡å…¥</em></strong>åŒæ­¥ä»£ç å—/æ–¹æ³•ã€‚</p></li><li><p>æ­»äº¡(DEAD)ï¼šå½“çº¿ç¨‹çš„run()æ–¹æ³•æ‰§è¡Œå®Œï¼Œæˆ–è€…è¢«å¼ºåˆ¶æ€§åœ°ç»ˆæ­¢ï¼Œå°±è®¤ä¸ºå®ƒæ­»å»ã€‚è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ä¹Ÿè®¸æ˜¯æ´»çš„ï¼Œä½†æ˜¯ï¼Œå®ƒå·²ç»ä¸æ˜¯ä¸€ä¸ªå•ç‹¬æ‰§è¡Œçš„çº¿ç¨‹ã€‚çº¿ç¨‹ä¸€æ—¦æ­»äº¡ï¼Œå°±ä¸èƒ½å¤ç”Ÿã€‚ å¦‚æœåœ¨ä¸€ä¸ªæ­»å»çš„çº¿ç¨‹ä¸Šè°ƒç”¨start()æ–¹æ³•ï¼Œä¼šæŠ›å‡ºjava.lang.IllegalThreadStateExceptionå¼‚å¸¸ã€‚</p></li></ul><h3 id="3-çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#3-çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="3. çº¿ç¨‹ä¼˜å…ˆçº§"></a>3. çº¿ç¨‹ä¼˜å…ˆçº§</h3><p>æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§çš„å±æ€§ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹å¯ä»¥è·å¾—è¾ƒå¤šçš„æ‰§è¡Œæœºä¼šï¼Œè€Œä¼˜å…ˆçº§ä½çš„çº¿ç¨‹åˆ™è·å¾—è¾ƒå°‘çš„æ‰§è¡Œæœºä¼šã€‚ä¸çº¿ç¨‹ä¼‘çœ ç±»ä¼¼ï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§ä»ç„¶æ— æ³•ä¿éšœçº¿ç¨‹çš„æ‰§è¡Œæ¬¡åºã€‚åªä¸è¿‡ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è·å–CPUèµ„æºçš„æ¦‚ç‡è¾ƒå¤§ï¼Œä¼˜å…ˆçº§ä½çš„ä¹Ÿå¹¶éæ²¡æœºä¼šæ‰§è¡Œã€‚</p><p>æ¯ä¸ªçº¿ç¨‹é»˜è®¤çš„ä¼˜å…ˆçº§éƒ½ä¸åˆ›å»ºå®ƒçš„çˆ¶çº¿ç¨‹å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œmainçº¿ç¨‹å…·æœ‰æ™®é€šä¼˜å…ˆçº§ã€‚</p><p><strong><em>æ³¨ï¼šè™½ç„¶Javaæä¾›äº†10ä¸ªä¼˜å…ˆçº§åˆ«ï¼Œä½†è¿™äº›ä¼˜å…ˆçº§åˆ«éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚ä¸åŒçš„æ“ä½œç³»ç»Ÿçš„ä¼˜å…ˆçº§å¹¶ä¸ç›¸åŒï¼Œè€Œä¸”ä¹Ÿä¸èƒ½å¾ˆå¥½çš„å’ŒJavaçš„10ä¸ªä¼˜å…ˆçº§åˆ«å¯¹åº”ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä½¿ç”¨MAX_PRIORITYã€MIN_PRIORITYå’ŒNORM_PRIORITYä¸‰ä¸ªé™æ€å¸¸é‡æ¥è®¾å®šä¼˜å…ˆçº§ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ç¨‹åºæœ€å¥½çš„å¯ç§»æ¤æ€§ã€‚</em></strong></p><h3 id="4-Daemonçº¿ç¨‹"><a href="#4-Daemonçº¿ç¨‹" class="headerlink" title="4. Daemonçº¿ç¨‹"></a>4. Daemonçº¿ç¨‹</h3><p>Daemonçº¿ç¨‹æ˜¯ä¸€ç§æ”¯æŒå‹çº¿ç¨‹ï¼Œå› ä¸ºå®ƒä¸»è¦è¢«ç”¨åšç¨‹åºä¸­åå°è°ƒåº¦åŠæ”¯æŒæ€§å·¥ä½œã€‚<br><strong><em> æ³¨æ„ï¼šæ„å»ºDaemonçº¿ç¨‹æ—¶ï¼Œä¸èƒ½ä¾é finallyå—ä¸­çš„å†…å®¹æ¥ç¡®ä¿æ‰§è¡Œå…³é—­æˆ–æ¸…ç†èµ„æºçš„é€»è¾‘ã€‚</em></strong></p><p>å®ˆæŠ¤çº¿ç¨‹ä½¿ç”¨çš„æƒ…å†µè¾ƒå°‘ï¼Œä½†å¹¶éæ— ç”¨ï¼Œä¸¾ä¾‹æ¥è¯´ï¼ŒJVMçš„åƒåœ¾å›æ”¶ã€å†…å­˜ç®¡ç†ç­‰çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚è¿˜æœ‰å°±æ˜¯åœ¨åšæ•°æ®åº“åº”ç”¨æ—¶å€™ï¼Œä½¿ç”¨çš„æ•°æ®åº“è¿æ¥æ± ï¼Œè¿æ¥æ± æœ¬èº«ä¹ŸåŒ…å«ç€å¾ˆå¤šåå°çº¿ç¨‹ï¼Œç›‘æ§è¿æ¥ä¸ªæ•°ã€è¶…æ—¶æ—¶é—´ã€çŠ¶æ€ç­‰ç­‰ã€‚è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„æ–¹æ³•setDaemon(true)ï¼Œåˆ™å¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚å®ˆæŠ¤çº¿ç¨‹çš„ç”¨é€”ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â€¢ å®ˆæŠ¤çº¿ç¨‹é€šå¸¸ç”¨äºæ‰§è¡Œä¸€äº›åå°ä½œä¸šï¼Œä¾‹å¦‚åœ¨ä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œåœ¨æ–‡å­—ç¼–è¾‘å™¨é‡Œåšè‡ªåŠ¨è¯­æ³•æ£€æŸ¥ã€è‡ªåŠ¨ä¿å­˜ç­‰åŠŸèƒ½ã€‚</span><br><span class="line">â€¢ Javaçš„åƒåœ¾å›æ”¶ä¹Ÿæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚å®ˆæŠ¤çº¿çš„å¥½å¤„å°±æ˜¯ä½ ä¸éœ€è¦å…³å¿ƒå®ƒçš„ç»“æŸé—®é¢˜ã€‚ä¾‹å¦‚ä½ åœ¨ä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œçš„æ—¶å€™å¸Œæœ›æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œå¦‚æœå°†è¿™ä¸ªæ’­æ”¾èƒŒæ™¯éŸ³ä¹çš„çº¿ç¨‹è®¾å®šä¸ºéå®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·è¯·æ±‚é€€å‡ºçš„æ—¶å€™ï¼Œä¸ä»…è¦é€€å‡ºä¸»çº¿ç¨‹ï¼Œè¿˜è¦é€šçŸ¥æ’­æ”¾èƒŒæ™¯éŸ³ä¹çš„çº¿ç¨‹é€€å‡ºï¼›å¦‚æœè®¾å®šä¸ºå®ˆæŠ¤çº¿ç¨‹åˆ™ä¸éœ€è¦äº†ã€‚</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line">    * å°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç”¨æˆ·çº¿ç¨‹ã€‚å½“æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼ŒJava è™šæ‹Ÿæœºé€€å‡ºã€‚</span><br><span class="line">    * è¯¥æ–¹æ³•å¿…é¡»åœ¨å¯åŠ¨çº¿ç¨‹å‰è°ƒç”¨ã€‚</span><br><span class="line">    * è¯¥æ–¹æ³•é¦–å…ˆè°ƒç”¨è¯¥çº¿ç¨‹çš„ checkAccess æ–¹æ³•ï¼Œä¸”ä¸å¸¦ä»»ä½•å‚æ•°ã€‚</span><br><span class="line">    * è¿™å¯èƒ½æŠ›å‡º SecurityExceptionï¼ˆåœ¨å½“å‰çº¿ç¨‹ä¸­ï¼‰ã€‚   </span><br><span class="line">    *   å‚æ•°ï¼š</span><br><span class="line">    *      on - å¦‚æœä¸º trueï¼Œåˆ™å°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚    </span><br><span class="line">    *   æŠ›å‡ºï¼š    </span><br><span class="line">    *     IllegalThreadStateException - å¦‚æœè¯¥çº¿ç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚    </span><br><span class="line">    *     SecurityException - å¦‚æœå½“å‰çº¿ç¨‹æ— æ³•ä¿®æ”¹è¯¥çº¿ç¨‹ã€‚</span><br><span class="line">    */</span><br><span class="line">    </span><br><span class="line">public final void setDaemon(boolean on)</span><br></pre></td></tr></table></figure><h3 id="5-å¼•ç”¨"><a href="#5-å¼•ç”¨" class="headerlink" title="5. å¼•ç”¨"></a>5. å¼•ç”¨</h3><p><a href="https://www.cnblogs.com/snow-flower/p/6114765.html" target="_blank" rel="noopener">Javaå¤šçº¿ç¨‹è¯¦è§£</a><br><a href="https://book.douban.com/subject/26591326/" target="_blank" rel="noopener">Javaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯</a><br><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.State.html" target="_blank" rel="noopener">javase7 docs</a><br><a href="https://my.oschina.net/u/2500836/blog/1538667" target="_blank" rel="noopener">Javaçº¿ç¨‹ï¼ˆ1ï¼‰-è¯»Threadç±»æºç </a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;çº¿ç¨‹ç®€ä»‹&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹ç®€ä»‹&quot;&gt;&lt;/a&gt;çº¿ç¨‹ç®€ä»‹&lt;/h2&gt;&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯çº¿ç¨‹&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯çº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;1. 
      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="http://zhongyp.me/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Javaå€¼ä¼ é€’</title>
    <link href="http://zhongyp.me/2018/03/10/java/2018-03-10-JavaPara/"/>
    <id>http://zhongyp.me/2018/03/10/java/2018-03-10-JavaPara/</id>
    <published>2018-03-09T16:00:00.000Z</published>
    <updated>2018-10-02T01:27:53.330Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨æ•´ç†ä¸€äº›ä¹‹å‰çš„åšå®¢ï¼Œå‘ç°å…³äºJavaå€¼ä¼ é€’çš„é—®é¢˜è¿˜æ˜¯æœ‰äº›æ¨¡ç³Šï¼Œåœ¨æ­¤å†æ•´ç†ä¸€ä¸‹ã€‚</p><p>å¯¹äºJavaçš„å€¼ä¼ é€’ï¼Œå¹¶ä¸æƒ³C++ä¸€æ ·å¯ä»¥ç”±è‡ªå·±æŒæ§ï¼Œä¸è¿‡ç†è§£Javaçš„å€¼ä¼ é€’åæ„Ÿè§‰æ¯”C++ç®€å•ã€‚</p><p><b style="color: red">å¯èƒ½ç†è§£ä¸å¤ªå¯¹ï¼Œæ¬¢è¿å¤§å®¶åŠ æˆ‘qqæ‰“æˆ‘è„¸ï¼Œè°¢è°¢ï¼ï¼ï¼ï¼ˆQQ:879376937ï¼‰</b></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> public static void main(String[] args) &#123;</span><br><span class="line">        int a = 1;</span><br><span class="line">        int[] b = &#123;1&#125;;</span><br><span class="line">        StringBuilder sb = new StringBuilder(&quot;22&quot;);</span><br><span class="line">        change(sb);</span><br><span class="line">        System.out.print(sb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void change(int a)&#123;</span><br><span class="line">        a=10;// ä¸èµ·ä½œç”¨</span><br><span class="line">    &#125;</span><br><span class="line">    public static void change(int[] b)&#123;</span><br><span class="line">        b[0]=10;// èµ·ä½œç”¨</span><br><span class="line">    &#125;</span><br><span class="line">    public static void change(StringBuilder sb)&#123;</span><br><span class="line">//        sb.append(&quot;3&quot;);// èµ·ä½œç”¨</span><br><span class="line">        StringBuilder sb1 = new StringBuilder(&quot;232&quot;);</span><br><span class="line">        sb=sb1;// ä¸èµ·ä½œç”¨</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­æˆ‘ç”¨äº†intå¸¸é‡ï¼Œæ•°ç»„ï¼ŒStringBuilderå¯¹è±¡ä¸‰ç§å‚æ•°å€¼ä½œä¸ºJavaå‚æ•°è¿›è¡Œä¼ é€’ï¼Œæ€»çš„æ¥è¯´è¿™ä¸‰ç§å‚æ•°å€¼ä»å®è§‚ä¸Šæ¥è¯´æ€§è´¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¯¹ä¼ é€’å¯¹è±¡çš„å¼•ç”¨å¤åˆ¶ï¼Œä¾‹å¦‚a, mainæ–¹æ³•å®šä¹‰çš„aæ˜¯å¯¹å¸¸é‡æ± ä¸­1çš„å¼•ç”¨ï¼Œchange(int a)ä¸­çš„aæ˜¯å¯¹mainæ–¹æ³•açš„å¼•ç”¨ï¼Œè¿™é‡Œä¸€å®šè¦æ˜ç™½è¿™ä¸¤ä¸ªaæ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ”¹changeä¸­açš„å€¼ï¼Œå®è´¨ä¸Šæ˜¯æŠŠchangeæ–¹æ³•ä¸­açš„å¼•ç”¨ä»å¯¹mainæ–¹æ³•ä¸­açš„å¼•ç”¨æ”¹ä¸ºå¼•ç”¨å¸¸é‡æ± ä¸Šçš„10ï¼Œæ‰€ä»¥main æ–¹æ³•ä¸­çš„aå€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p>å¯¹äºbå’Œsbå¯¹è±¡å‚æ•°ä¼ é€’ï¼Œå…¶å®è´¨aå¯¹è±¡ä¸€æ ·ï¼Œéƒ½æ˜¯å¯¹mainæ–¹æ³•ä¸­çš„bå’Œsbå¯¹è±¡çš„å¼•ç”¨ã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨b[0]èµ‹å€¼æ—¶ï¼Œå› ä¸ºchangeæ–¹æ³•ä¸­çš„bå¼•ç”¨main æ–¹æ³•ä¸­çš„bå¯¹è±¡ï¼Œæ‰€ä»¥changeä¸­çš„b[0]æ²¡æœ‰åŠæ³•èµ‹å€¼ï¼Œåªèƒ½äº¤ç»™mainæ–¹æ³•ä¸­çš„bå»èµ‹å€¼ï¼Œè¿™æ ·æ›´æ”¹çš„å°±æ˜¯mainä¸­bå¯¹è±¡æ‰€å¼•ç”¨çš„æ•°ç»„å®ä¾‹ï¼Œæ‰€ä»¥èµ·äº†ä½œç”¨ã€‚</p><p>changeæ–¹æ³•ä¸­sbåœ¨appendèµ‹å€¼æ—¶å’Œb[0]èµ‹å€¼çš„æƒ…å†µä¸€æ ·ã€‚</p><p>sb=sb1,è¿™ç§æƒ…å†µæ˜¯å’Œaå¯¹è±¡é‡æ–°èµ‹å€¼ç±»ä¼¼ï¼Œä¸è¿‡ä¸å†æ˜¯å¸¸é‡æ± ä¸­çš„å¸¸æ•°å¯¹è±¡10ï¼Œè€Œæ˜¯StringBuilderå¯¹è±¡sb1ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åœ¨æ•´ç†ä¸€äº›ä¹‹å‰çš„åšå®¢ï¼Œå‘ç°å…³äºJavaå€¼ä¼ é€’çš„é—®é¢˜è¿˜æ˜¯æœ‰äº›æ¨¡ç³Šï¼Œåœ¨æ­¤å†æ•´ç†ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºJavaçš„å€¼ä¼ é€’ï¼Œå¹¶ä¸æƒ³C++ä¸€æ ·å¯ä»¥ç”±è‡ªå·±æŒæ§ï¼Œä¸è¿‡ç†è§£Javaçš„å€¼ä¼ é€’åæ„Ÿè§‰æ¯”C++ç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;b style=&quot;color: red&quot;&gt;å¯èƒ½ç†è§£ä¸å¤ªå¯¹ï¼Œ
      
    
    </summary>
    
    
      <category term="Java" scheme="http://zhongyp.me/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>çº¢é»‘æ ‘</title>
    <link href="http://zhongyp.me/2018/03/07/algorithm/2018-03-07-RedBlackTree/"/>
    <id>http://zhongyp.me/2018/03/07/algorithm/2018-03-07-RedBlackTree/</id>
    <published>2018-03-06T16:00:00.000Z</published>
    <updated>2018-10-26T08:44:22.105Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h2><p><a href="https://www.cnblogs.com/sandy2013/p/3270999.html" target="_blank" rel="noopener">åšæ–‡è½¬è½½ï¼šhttps://www.cnblogs.com/sandy2013/p/3270999.html</a></p><h2 id="çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«"><a href="#çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«" class="headerlink" title="çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«"></a>çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«</h2><ul><li><p>çº¢é»‘æ ‘æ”¾å¼ƒäº†è¿½æ±‚å®Œå…¨å¹³è¡¡ï¼Œè¿½æ±‚å¤§è‡´å¹³è¡¡ï¼Œåœ¨ä¸å¹³è¡¡äºŒå‰æ ‘çš„æ—¶é—´å¤æ‚åº¦ç›¸å·®ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œä¿è¯æ¯æ¬¡æ’å…¥æœ€å¤šåªéœ€è¦ä¸‰æ¬¡æ—‹è½¬å°±èƒ½è¾¾åˆ°å¹³è¡¡ï¼Œå®ç°èµ·æ¥ä¹Ÿæ›´ä¸ºç®€å•ã€‚</p></li><li><p>å¹³è¡¡äºŒå‰æ ‘è¿½æ±‚ç»å¯¹å¹³è¡¡ï¼Œæ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¯æ¬¡æ’å…¥æ–°èŠ‚ç‚¹ä¹‹åéœ€è¦æ—‹è½¬çš„æ¬¡æ•°ä¸èƒ½é¢„çŸ¥ã€‚<br>å¹³è¡¡äºŒå‰æ ‘åˆè¢«ç§°ä¸ºAVLæ ‘ï¼ˆæœ‰åˆ«äºAVLç®—æ³•ï¼‰ï¼Œä¸”å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå®ƒæ˜¯ä¸€ æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚æ„é€ ä¸è°ƒæ•´æ–¹æ³• å¹³è¡¡äºŒå‰æ ‘çš„å¸¸ç”¨ç®—æ³•æœ‰çº¢é»‘æ ‘ã€AVLã€Treapç­‰ã€‚ æœ€å°äºŒå‰å¹³è¡¡æ ‘çš„èŠ‚ç‚¹çš„å…¬å¼å¦‚ä¸‹ F(n)=F(n-1)+F(n-2)+1 è¿™ä¸ªç±»ä¼¼äºä¸€ä¸ªé€’å½’çš„æ•°åˆ—ï¼Œå¯ä»¥å‚è€ƒFibonacciæ•°åˆ—ï¼Œ1æ˜¯æ ¹èŠ‚ç‚¹ï¼ŒF(n-1)æ˜¯å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼ŒF(n-2)æ˜¯å³å­æ ‘çš„èŠ‚ç‚¹æ•°é‡ã€‚</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;çº¢é»‘æ ‘&quot;&gt;&lt;a href=&quot;#çº¢é»‘æ ‘&quot; class=&quot;headerlink&quot; title=&quot;çº¢é»‘æ ‘&quot;&gt;&lt;/a&gt;çº¢é»‘æ ‘&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/sandy2013/p/3270999.html&quot; target=
      
    
    </summary>
    
    
      <category term="ç®—æ³•" scheme="http://zhongyp.me/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
</feed>
