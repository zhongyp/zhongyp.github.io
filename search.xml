<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>çº¿ç¨‹å¯åŠ¨ä¸ç»ˆæ­¢</title>
      <link href="/2018/12/04/concurrent/2018-12-04-thread-start-end/"/>
      <url>/2018/12/04/concurrent/2018-12-04-thread-start-end/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šç¯‡å¯¹<a href="https://zhongyp.me/2018/03/16/concurrent/2017-03-16-Thread-brief/">ä»€ä¹ˆæ˜¯çº¿ç¨‹</a>åšäº†ç®€å•çš„ä»‹ç»,æœ¬ç¯‡ä¸»è¦æ˜¯ä»æ„é€ çº¿ç¨‹ã€ä¸­æ–­çº¿ç¨‹ã€ç»ˆæ­¢çº¿ç¨‹3ä¸ªæ–¹é¢äº†è§£çº¿ç¨‹ã€‚</p><h3 id="1-æ„é€ çº¿ç¨‹"><a href="#1-æ„é€ çº¿ç¨‹" class="headerlink" title="1. æ„é€ çº¿ç¨‹"></a>1. æ„é€ çº¿ç¨‹</h3><h4 id="1-1-æ„é€ çº¿ç¨‹çš„æ–¹å¼"><a href="#1-1-æ„é€ çº¿ç¨‹çš„æ–¹å¼" class="headerlink" title="1.1 æ„é€ çº¿ç¨‹çš„æ–¹å¼"></a>1.1 æ„é€ çº¿ç¨‹çš„æ–¹å¼</h4><p>Javaæ„é€ ä¸€ä¸ªçº¿ç¨‹æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>ä¸€ç§ç›´æ¥new Thread()çº¿ç¨‹å®ä¾‹æˆ–è€…æ˜¯å£°æ˜å­ç±»ç»§æ‰¿Threadçˆ¶ç±»å¹¶é‡å†™çˆ¶ç±»çš„runæ–¹æ³•ã€‚å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// çº¿ç¨‹ç±»</span><br><span class="line">class PrimeThread extends Thread &#123;</span><br><span class="line">    long minPrime;</span><br><span class="line">    PrimeThread(long minPrime) &#123;</span><br><span class="line">        this.minPrime = minPrime;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    public void run() &#123;</span><br><span class="line">        // compute primes larger than minPrime</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å¯åŠ¨çº¿ç¨‹å®ä¾‹</span><br><span class="line">PrimeThread p = new PrimeThread(143);</span><br><span class="line">p.start();</span><br></pre></td></tr></table></figure></p><p>å¦ä¸€ç§æ–¹å¼æ˜¯å£°æ˜å­ç±»å®ç°Runnableæ¥å£ï¼Œå¹¶å®ç°runæ–¹æ³•ã€‚å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// çº¿ç¨‹ç±»</span><br><span class="line">class PrimeRun implements Runnable &#123;</span><br><span class="line">    long minPrime;</span><br><span class="line">    PrimeRun(long minPrime) &#123;</span><br><span class="line">        this.minPrime = minPrime;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    public void run() &#123;</span><br><span class="line">        // compute primes larger than minPrime</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//å¯åŠ¨çº¿ç¨‹å®ä¾‹</span><br><span class="line">PrimeRun p = new PrimeRun(143);</span><br><span class="line">new Thread(p).start();</span><br></pre></td></tr></table></figure></p><p>ä¸¤è€…å…¶å®åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œå®ç°/é‡å†™Runableä¸­çš„runæ–¹æ³•ï¼Œå› ä¸ºThreadç±»ä¹Ÿç»§æ‰¿äº†Runableæ¥å£ã€‚Javaå°†çº¿ç¨‹çš„æ‰§è¡Œå’Œæ‰§è¡Œå¯¹è±¡æŠ½è±¡å¼€æ¥ï¼ŒJDKä¸­æ‰§è¡Œçš„æ˜¯Threadç±»ï¼ŒExecutoræ¡†æ¶ï¼Œå¯æ‰§è¡Œç›®æ ‡æœ‰Runableï¼ŒCallableã€‚å¯¹äºç¬¬ä¸€ç§æ–¹å¼å¹¶ä¸æ¨èï¼Œå› ä¸ºç»§æ‰¿Threadç±»é™å®šäº†å…¶åŸºæœ¬è¡Œä¸ºï¼Œåœ¨è®¾è®¡ä¸Šè¿åå¤šç”¨ç»„åˆ å°‘ç”¨ç»§æ‰¿çš„åŸåˆ™ï¼Œæ‰€ä»¥ä¸€èˆ¬æ„é€ çº¿ç¨‹ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚</p><h4 id="1-2-æ„é€ çº¿ç¨‹çš„å±æ€§"><a href="#1-2-æ„é€ çº¿ç¨‹çš„å±æ€§" class="headerlink" title="1.2 æ„é€ çº¿ç¨‹çš„å±æ€§"></a>1.2 æ„é€ çº¿ç¨‹çš„å±æ€§</h4><p>æ„é€ çº¿ç¨‹æ—¶éœ€è¦æä¾›çº¿ç¨‹æ‰€éœ€è¦çš„å±æ€§ã€‚ä¸€ä¸ªæ–°çš„ï¼ˆchildï¼‰çº¿ç¨‹å¯¹è±¡æ˜¯ç”±parentçº¿ç¨‹è¿›è¡Œç©ºé—´åˆ†é…çš„ï¼Œè€Œchildçº¿ç¨‹ç»§æ‰¿äº†parentæ˜¯å¦ä¸ºDaemonã€ä¼˜å…ˆçº§ã€å’ŒåŠ è½½èµ„æºçš„contextClassLoaderä»¥åŠå¯ç»§æ‰¿çš„ThreadLocalï¼ŒåŒæ—¶åˆ†é…å”¯ä¸€çš„IDæ¥è¡¨ç¤ºè¿™ä¸ªchildçº¿ç¨‹ã€‚å¦‚æœåˆ›å»ºçº¿ç¨‹å®ä¾‹åéœ€è¦ä¿®æ”¹çº¿ç¨‹å±æ€§ï¼Œåˆ™å¯ä»¥é€šè¿‡Threadæä¾›çš„ä¸€äº›ä¿®æ”¹å±æ€§çš„æ–¹æ³•è¿›è¡Œä¿®æ”¹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">setPriority()</span><br><span class="line">getPriority()</span><br><span class="line">setName()</span><br><span class="line">getName()</span><br><span class="line">setDaemon()</span><br><span class="line">isDaemon()</span><br><span class="line">getContextClassLoader()</span><br><span class="line">setContextClassLoader()</span><br><span class="line">getStackTrace()</span><br><span class="line">getAllStackTraces()</span><br><span class="line">checkAccess()</span><br><span class="line">isCCLOverridden()</span><br><span class="line">auditSubclass()</span><br><span class="line">dumpThreads()</span><br><span class="line">getThreads()</span><br><span class="line">getId()</span><br><span class="line">getState()</span><br><span class="line">setDefaultUncaughtExceptionHandler()</span><br><span class="line">getDefaultUncaughtExceptionHandler()</span><br><span class="line">getUncaughtExceptionHandler()</span><br><span class="line">setUncaughtExceptionHandler()</span><br><span class="line">dispatchUncaughtException()</span><br><span class="line">processQueue()</span><br></pre></td></tr></table></figure></p><p>å½“ç„¶æ„é€ çº¿ç¨‹å±æ€§æœ‰äº›å±æ€§è¿˜å¯ä»¥åœ¨åˆ›å»ºçº¿ç¨‹å®ä¾‹æ—¶å°±è®¾ç½®ï¼Œå¦‚ä¸‹æ˜¯ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–æ—¶çš„ä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * @param g</span><br><span class="line"> * @param target</span><br><span class="line"> * @param name</span><br><span class="line"> * @param stackSize çº¿ç¨‹çš„æ ˆå¤§å° æ ¹æ®å‚æ•°ä¼ é€’è¿‡ç¨‹å¯ä»¥çœ‹å‡ºé»˜è®¤å¤§å°ä¸ºé›¶ï¼Œå³ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹æ ˆå¤§å°</span><br><span class="line"> * @param acc è®¿é—®æ§åˆ¶æƒé™</span><br><span class="line"> * @param inheritThreadLocals // å¯ç»§æ‰¿çš„ThreadLocal</span><br><span class="line"> *</span><br><span class="line"> * ThreadGroup çº¿ç¨‹ç»„ï¼ˆThreadGroupï¼‰å°±æ˜¯ç”±çº¿ç¨‹ç»„æˆçš„ç®¡ç†çº¿ç¨‹çš„ç±»ï¼Œ</span><br><span class="line"> *     è¿™ä¸ªç±»æ˜¯java.lang.ThreadGroupç±»ã€‚</span><br><span class="line"> *     å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ç»„ï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç å¯ä»¥å®ç°ã€‚</span><br><span class="line"> *     ThreadGroup group=new ThreadGroup(&quot;group&quot;);</span><br><span class="line"> *     Thread thread=new Thread(group,&quot;the first thread of group&quot;);</span><br><span class="line"> *     ThreadGroupç±»ä¸­çš„æŸäº›æ–¹æ³•ï¼Œå¯ä»¥å¯¹çº¿ç¨‹ç»„ä¸­çš„çº¿ç¨‹äº§ç”Ÿä½œç”¨ã€‚ä¾‹å¦‚ï¼ŒsetMaxPriority()æ–¹æ³•å¯ä»¥è®¾å®šçº¿ç¨‹ç»„ä¸­çš„æ‰€æœ‰çº¿ç¨‹æ‹¥æœ‰æœ€å¤§çš„ä¼˜å…ˆæƒã€‚</span><br><span class="line"> */</span><br><span class="line">private void init(ThreadGroup g, Runnable target, String name,</span><br><span class="line">                  long stackSize, AccessControlContext acc,</span><br><span class="line">                  boolean inheritThreadLocals) &#123;</span><br><span class="line">    if (name == null) &#123;// çº¿ç¨‹åï¼Œå¯ç›¸åŒ</span><br><span class="line">        throw new NullPointerException(&quot;name cannot be null&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.name = name;</span><br><span class="line"></span><br><span class="line">    Thread parent = currentThread();// è·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶ä½œä¸ºçˆ¶çº¿ç¨‹ã€‚</span><br><span class="line">    SecurityManager security = System.getSecurityManager();// è·å–å®‰å…¨ç­–ç•¥</span><br><span class="line">    if (g == null) &#123;</span><br><span class="line">        /* Determine if it&apos;s an applet or not */</span><br><span class="line"></span><br><span class="line">        /* If there is a security manager, ask the security manager</span><br><span class="line">           what to do. */</span><br><span class="line">        if (security != null) &#123;//å¦‚æœå­˜åœ¨å®‰å…¨ç®¡ç†å™¨ï¼Œåˆ™è·å–å®ƒé‡å†™çš„çº¿ç¨‹ç»„</span><br><span class="line">            g = security.getThreadGroup();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* If the security doesn&apos;t have a strong opinion of the matter</span><br><span class="line">           use the parent thread group. */</span><br><span class="line">        if (g == null) &#123;</span><br><span class="line">            g = parent.getThreadGroup();//ä½¿ç”¨çˆ¶çº¿ç¨‹ç»„</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* checkAccess regardless of whether or not threadgroup is</span><br><span class="line">       explicitly passed in. */</span><br><span class="line">    g.checkAccess();</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">     * Do we have the required permissions?</span><br><span class="line">     */</span><br><span class="line">    if (security != null) &#123;</span><br><span class="line">        if (isCCLOverridden(getClass())) &#123;</span><br><span class="line">            security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g.addUnstarted();</span><br><span class="line"></span><br><span class="line">    this.group = g;</span><br><span class="line">    this.daemon = parent.isDaemon();//ç»§æ‰¿çˆ¶çº¿ç¨‹çš„å®ˆæŠ¤å±æ€§</span><br><span class="line">    this.priority = parent.getPriority();//ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ä¼˜å…ˆçº§</span><br><span class="line">    //ç»§æ‰¿çˆ¶çº¿ç¨‹åŠ è½½èµ„æºçš„contextClassLoader</span><br><span class="line">    if (security == null || isCCLOverridden(parent.getClass()))</span><br><span class="line">        this.contextClassLoader = parent.getContextClassLoader();</span><br><span class="line">    else</span><br><span class="line">        this.contextClassLoader = parent.contextClassLoader;</span><br><span class="line">    this.inheritedAccessControlContext =</span><br><span class="line">            acc != null ? acc : AccessController.getContext();</span><br><span class="line">    this.target = target;</span><br><span class="line">    setPriority(priority);</span><br><span class="line">    // ç»§æ‰¿çˆ¶çº¿ç¨‹å¯ç»§æ‰¿çš„ThreadLocal</span><br><span class="line">    if (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != null)</span><br><span class="line">        this.inheritableThreadLocals =</span><br><span class="line">            ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);</span><br><span class="line">    /* Stash the specified stack size in case the VM cares */</span><br><span class="line">    this.stackSize = stackSize;</span><br><span class="line"></span><br><span class="line">    /* Set thread ID */</span><br><span class="line">    tid = nextThreadID();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-å¯åŠ¨çº¿ç¨‹"><a href="#1-3-å¯åŠ¨çº¿ç¨‹" class="headerlink" title="1.3 å¯åŠ¨çº¿ç¨‹"></a>1.3 å¯åŠ¨çº¿ç¨‹</h4><p>çº¿ç¨‹å¯¹è±¡åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œè°ƒç”¨startæ–¹æ³•å°±å¯ä»¥å¯åŠ¨çº¿ç¨‹ã€‚<br><strong><em>æ³¨æ„ï¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæœ€å¥½ä¸ºè¿™ä¸ªçº¿ç¨‹è®¾ç½®çº¿ç¨‹åç§°ï¼Œè¿™è¡Œæœ‰åŠ©äºåˆ†ææˆ–è€…æ’æŸ¥é—®é¢˜</em></strong></p><h3 id="2-ä¸­æ–­çº¿ç¨‹"><a href="#2-ä¸­æ–­çº¿ç¨‹" class="headerlink" title="2. ä¸­æ–­çº¿ç¨‹"></a>2. ä¸­æ–­çº¿ç¨‹</h3><h4 id="2-1-ä¸­æ–­çš„åŸç†"><a href="#2-1-ä¸­æ–­çš„åŸç†" class="headerlink" title="2.1 ä¸­æ–­çš„åŸç†"></a>2.1 ä¸­æ–­çš„åŸç†</h4><p>ä¸­æ–­ï¼Œå¯ä»¥ç†è§£ä¸ºè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œæ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†ä¸­æ–­æ“ä½œã€‚ä¸­æ–­æ“ä½œæœ‰çš„æƒ…å†µä¸‹ä»…ä»…è®¾ç½®ä¸­æ–­çŠ¶æ€ï¼Œæœ‰çš„<br>ä¸­æ–­æ“ä½œåŒ…å«ä¸‰ä¸ªæ–¹æ³•ã€‚interrupt(),interrupted(),isInterrupted()ã€‚ä¸‹é¢æˆ‘ä»¬å°†å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œè¯¦ç»†äº†è§£ã€‚</p><h5 id="2-1-1-interrupt"><a href="#2-1-1-interrupt" class="headerlink" title="2.1.1 interrupt()"></a>2.1.1 interrupt()</h5><p>ä¸­æ–­æ“ä½œé€šè¿‡è°ƒç”¨çº¿ç¨‹çš„interrupt()æ–¹æ³•è¿›è¡Œã€‚ä¾‹å¦‚çº¿ç¨‹Aä¸­æ–­çº¿ç¨‹Bï¼Œåœ¨çº¿ç¨‹Açš„ä»£ç ä¸­è°ƒç”¨ThreadB.interrupt()å³å¯ã€‚</p><p>interrupt()æ–¹æ³•ä¸æ˜¯ç›´æ¥å°†çº¿ç¨‹ç»ˆæ­¢ï¼Œè€Œæ˜¯é’ˆå¯¹äºä¸åŒæƒ…å†µçš„ä¸åŒå¤„ç†å¦‚ä¸‹ã€‚ç¿»è¯‘è‡ª<a href="https://docs.oracle.com/javase/7/docs/api/" target="_blank" rel="noopener">Java se7docs</a>ï¼š</p><ol><li>é™¤éç»ˆæ­¢çš„æ˜¯å½“å‰çº¿ç¨‹ï¼ˆå§‹ç»ˆè¢«å…è®¸ï¼‰ï¼Œå¦åˆ™è°ƒç”¨checkAccessæ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŠ›å‡ºSecurityExceptionå¼‚å¸¸ã€‚</li><li>å¦‚æœè°ƒç”¨Objectç±»çš„wait(),wait(long)æˆ–è€…wait(long, int)ç­‰æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨æ­¤çº¿ç¨‹çš„join(),join(long),join(long, int), sleep(long), sleep(long, int)æ–¹æ³•ï¼Œ<strong><em>æ­¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€å°†è¢«æ¸…é™¤ï¼ŒåŒæ—¶å°†æŠ›å‡ºInterruptedExceptionå¼‚å¸¸</em></strong>ã€‚</li><li>å¦‚æœæ­¤çº¿ç¨‹åœ¨å¯ä¸­æ–­é€šé“çš„IOæ“ä½œä¸Šï¼Œé€šé“å°†è¢«å…³é—­ï¼Œçº¿ç¨‹è¢«è®¾ç½®ä¸­æ–­çŠ¶æ€ï¼ŒåŒæ—¶å°†æŠ›å‡ºClosedByInterruptExceptionå¼‚å¸¸ã€‚</li><li>å¦‚æœçº¿ç¨‹åœ¨é€‰æ‹©å™¨(Selector)é˜»å¡ï¼Œçº¿ç¨‹å°†è¢«è®¾ç½®ä¸­æ–­çŠ¶æ€ï¼Œç«‹å³ä»é€‰æ‹©æ“ä½œä¸­è¿”å›ï¼Œå¯èƒ½å¸¦æœ‰éé›¶å€¼ï¼Œå°±åƒé€‰æ‹©å™¨å”¤é†’æ–¹æ³•è¢«è°ƒç”¨ä¸€æ ·ã€‚</li><li>å¦‚æœä»¥ä¸Šçš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæ­¤çº¿ç¨‹å°†è¢«è®¾ç½®ä¸­æ–­çŠ¶æ€ã€‚</li><li>ä¸­æ–­ä¸å­˜æ´»çš„çº¿ç¨‹ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚</li></ol><p>è¿™é‡Œæä¾›äº†ä¸Šé¢çš„ç»ˆæ­¢å½“å‰çº¿ç¨‹ï¼Œsleepé˜»å¡çº¿ç¨‹ï¼ŒIOé˜»å¡çº¿ç¨‹ä¾‹å­ï¼Œè¯»è€…å¯æ ¹æ®ä¸Šè¿°è¦æ±‚æµ‹è¯•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class InterruptCurrentThread extends Thread&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        super.run();</span><br><span class="line">        this.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class InterruptBlockedThread extends Thread&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        super.run();</span><br><span class="line">        SleepUtils.sleep(100);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class InterruptIOBlockedThread extends Thread&#123;</span><br><span class="line">    private LinkedBlockingQueue&lt;String&gt; queue = new LinkedBlockingQueue&lt;&gt;();</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        super.run();</span><br><span class="line">        try &#123;</span><br><span class="line">            queue.take();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨ï¼šSelectorï¼ˆé€‰æ‹©å™¨ï¼‰æ˜¯Java NIOä¸­èƒ½å¤Ÿæ£€æµ‹ä¸€åˆ°å¤šä¸ªNIOé€šé“ï¼Œå¹¶èƒ½å¤ŸçŸ¥æ™“é€šé“æ˜¯å¦ä¸ºè¯¸å¦‚è¯»å†™äº‹ä»¶åšå¥½å‡†å¤‡çš„ç»„ä»¶ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªchannelï¼Œä»è€Œç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚è¿™ä¸ªä¸å¤ªå¸¸ç”¨æ‰€ä»¥å°±æ²¡æœ‰ç»™å‡ºæµ‹è¯•ç”¨ä¾‹ã€‚</p><p>æ³¨æ„ï¼š<strong><em>å¯¹äºä¼šæŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µï¼Œå¼‚å¸¸ä¸€å®šè¦å¤„ç†ï¼Œä¸€èˆ¬å­çº¿ç¨‹å¼‚å¸¸ä¸èƒ½æŠ›å‡ºéè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ‰€ä»¥å­çº¿ç¨‹æˆ‘ä»¬éœ€è¦æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œç”¨äºç»™çˆ¶çº¿ç¨‹æ•è·ã€‚</em></strong></p><h5 id="2-1-2-interrupted"><a href="#2-1-2-interrupted" class="headerlink" title="2.1.2 interrupted()"></a>2.1.2 interrupted()</h5><p>interrupted()ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>æµ‹è¯•<strong><em>å½“å‰çº¿ç¨‹</em></strong>æ˜¯å¦è¢«ä¸­æ–­,çº¿ç¨‹ä¸­æ–­çŠ¶æ€å°†è¢«æ¸…é™¤ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¦‚æœå½“å‰æ–¹æ³•è¢«æˆåŠŸè°ƒç”¨ä¸¤æ¬¡ï¼Œåˆ™è¿”å›falseï¼ˆé™¤éå½“å‰çº¿ç¨‹åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ­¤æ–¹æ³•åç¬¬äºŒæ¬¡è°ƒç”¨æ­¤æ–¹æ³•å‰è¢«å†æ¬¡ä¸­æ–­ï¼‰ã€‚</li><li>çº¿ç¨‹ä¸­æ–­è¢«å¿½ç•¥ï¼Œå› ä¸ºåœ¨ä¸­æ–­æ—¶çº¿ç¨‹æ­»æ‰å°†è¢«æ­¤æ–¹æ³•åæ˜ è¿”å›falseã€‚(æˆ‘çš„ç†è§£)</li></ol><p>interrupted()ä¸åŒäºinterrupt(),æ­¤æ–¹æ³•ç”¨äºæµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¹¶æ¸…é™¤ä¸­æ–­çŠ¶æ€ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Thread thread = new InterruptThread();</span><br><span class="line">    thread.start();</span><br><span class="line">    SleepUtils.sleep(1);</span><br><span class="line">    thread.interrupt();</span><br><span class="line">&#125;</span><br><span class="line">    static class InterruptThread extends Thread&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            int count = 0;</span><br><span class="line">            while(true)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                if(interrupted())&#123;//æ­¤å¤„ä»…ä»…æ˜¯ä¸ºäº†ç¤ºä¾‹</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h5 id="2-1-3-isInterrupted"><a href="#2-1-3-isInterrupted" class="headerlink" title="2.1.3 isInterrupted()"></a>2.1.3 isInterrupted()</h5><p>isInterruptedè™½ç„¶ä¹Ÿæ˜¯æµ‹è¯•çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œä½†æ˜¯æ­¤æ–¹æ³•ä¸ä¼šæ›´æ”¹çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚</p><h3 id="3-ç»ˆæ­¢çº¿ç¨‹"><a href="#3-ç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="3. ç»ˆæ­¢çº¿ç¨‹"></a>3. ç»ˆæ­¢çº¿ç¨‹</h3><h4 id="3-1-è¿‡æœŸçš„suspend-ã€resume-å’Œstop"><a href="#3-1-è¿‡æœŸçš„suspend-ã€resume-å’Œstop" class="headerlink" title="3.1 è¿‡æœŸçš„suspend()ã€resume()å’Œstop()"></a>3.1 è¿‡æœŸçš„suspend()ã€resume()å’Œstop()</h4><p>åœ¨Java APIä¸­ï¼Œsuspend()ã€resume()å’Œstop()ä¸‰ä¸ªæ–¹æ³•æ˜¯è¿‡æœŸçš„ï¼Œä¸å»ºè®®ä½¿ç”¨çš„ã€‚<br>ä¸»è¦åŸå› æ˜¯ï¼šsuspend()åœ¨è°ƒç”¨åï¼Œçº¿ç¨‹ä¸æ˜¯æ”¾å·²ç»å æœ‰çš„èµ„æºæ¯”å¦‚è¯´é”ï¼Œè€Œæ˜¯å æœ‰ç€èµ„æºè¿›å…¥ç¡çœ ï¼Œè¿™æ ·å®¹æ˜“å¼•å‘æ­»é”çŠ¶æ€ã€‚stop()æ–¹æ³•åœ¨ç»ˆç»“ä¸€ä¸ªçº¿ç¨‹æ—¶ä¸ä¼šä¿è¯çº¿ç¨‹èµ„æºçš„é‡Šæ”¾ï¼Œå› æ­¤å¯¼è‡´çº¿ç¨‹å¤„äºä¸ç¡®å®šçš„çŠ¶æ€ä¸‹ã€‚</p><p><strong><em>sleepå’ŒsuspendåŒºåˆ«ï¼š</em></strong><br>ç›¸åŒç‚¹ï¼šsleepå’Œsuspendéƒ½ä¼šæŒæœ‰å æœ‰çš„èµ„æºä¸é‡Šæ”¾ã€‚<br>ä¸åŒç‚¹ï¼šsleepé˜»å¡ï¼ˆTIMED_WAITINGï¼‰åï¼Œç»è¿‡ä¸€æ®µæ—¶é—´è‡ªè¡Œæ¢å¤è¿è¡Œã€‚è€Œsuspendå¿…é¡»ä½¿ç”¨resume()æ˜¾ç¤ºçš„æ¢å¤ï¼Œå¦‚æœä¸ä½¿ç”¨resume()æˆ–è€…resume()å¤±è´¥ï¼Œå¾ˆå®¹æ˜“å¼•èµ·èµ„æºå ç”¨å¯¼è‡´çš„æ­»é”ã€‚</p><h4 id="3-2-å®‰å…¨çš„ç»ˆæ­¢çº¿ç¨‹"><a href="#3-2-å®‰å…¨çš„ç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="3.2 å®‰å…¨çš„ç»ˆæ­¢çº¿ç¨‹"></a>3.2 å®‰å…¨çš„ç»ˆæ­¢çº¿ç¨‹</h4><p>åœ¨ç¬¬2å°èŠ‚æåˆ°çš„ä¸­æ–­æ˜¯çº¿ç¨‹çš„ä¸€ä¸ªæ ‡ç¤ºä½ï¼Œä¸­æ–­æ“ä½œæ˜¯ä¸€ç§ç®€ä¾¿çš„çº¿ç¨‹é—´äº¤äº’æ–¹å¼ï¼Œè¿™ç§äº¤äº’æ–¹å¼é€‚åˆç”¨æ¥å–æ¶ˆå’Œåœæ­¢ä»»åŠ¡ã€‚é™¤äº†ä¸­æ–­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åŒæ­¥å˜é‡æ¥æ§åˆ¶æ˜¯å¦åœæ­¢å¹¶ç»ˆæ­¢è¯¥çº¿ç¨‹ã€‚<br><strong><em>çº¿ç¨‹çš„ç»ˆæ­¢ä¸æ˜¯ç›´æ¥å¼ºåˆ¶çº¿ç¨‹åœæ­¢ï¼Œè€Œæ˜¯å¼•å¯¼çº¿ç¨‹è¿è¡Œç»“æŸã€‚</em></strong></p><h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-javasecurity/" target="_blank" rel="noopener">Java å®‰å…¨æ¨¡å‹ä»‹ç»</a><br><a href="https://docs.oracle.com/javase/7/docs/api/" target="_blank" rel="noopener">Class Thread</a><br><a href="https://my.oschina.net/u/2500836/blog/1538667" target="_blank" rel="noopener">Javaçº¿ç¨‹(1)-Threadç±»æºç </a><br><a href="https://book.douban.com/subject/26591326/" target="_blank" rel="noopener">Javaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æˆ‘çš„åšå®¢</title>
      <link href="/2018/11/28/life/2018-11-29-myblog/"/>
      <url>/2018/11/28/life/2018-11-29-myblog/</url>
      
        <content type="html"><![CDATA[<p><strong>å°‘å¹´æ—¶ä»£å¯¹æœªæ¥ç”Ÿæ´»çš„æƒ³è±¡è™½ç„¶æœ¦èƒ§ï¼Œä½†å®é™…ä¸Šå´æœ‰ç€æé«˜çš„æœŸå¾…ã€‚ä½ æ€»è§‰å¾—ç°åœ¨åªæ˜¯æ´»ç€ï¼Œç­‰å¾…ç€ï¼Œç­‰å¾…ç€æŸä¸€åˆ»ä¼šé‡‘é¼“é½é¸£ï¼Œå…‰èŠ’å››å°„ï¼Œç„¶åï¼ŒçœŸæ­£çš„ç”Ÿæ´»å¼€å§‹äº†ã€‚ä½†æ—¥å¸¸ç”Ÿæ´»è‡ªæœ‰å®ƒè‡ªå·±ç¼“æ…¢è€Œå¹³é™çš„èŠ‚å¥ï¼Œå®ƒæ³¢æ¾œä¸å…´åœ°å‘å‰å¼¥æ¼«ï¼Œè¶Šè¿‡å²æœˆã€‚ç›´åˆ°ä½ éª¤ç„¶å‘ç°ï¼Œå¤§å¤šæ•°äººçš„ç”Ÿæ´»ä¸ä¼šæœ‰é‡‘é¼“é½é¸£çš„å¼€å§‹ï¼Œå¤§å¤šæ•°äººçš„ç”Ÿæ´»ï¼Œå°±æ˜¯ä¸€ç§æ°´æ»´çŸ³ç©¿çš„å•è°ƒå’Œå®é™ã€‚</strong></p><p>å¼€å§‹å†™åšå®¢ä¸€æ®µæ—¶é—´äº†ï¼Œåªæ˜¯æƒ³æ‰¾ä¸ªåœ°æ–¹è®°å½•ä¸‹è‡ªå·±çš„çœ‹è¿‡çš„ã€å­¦è¿‡çš„çŸ¥è¯†ï¼Œè®°å½•ä¸‹å­¦ä¹ çš„è¿‡ç¨‹ä¸­è‡ªå·±çš„æƒ³æ³•/æ„Ÿæ‚Ÿã€‚thinkingâ€¦ğŸŒ</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åšå®¢å£°æ˜</title>
      <link href="/2018/11/28/life/2018-11-29-blog-announce/"/>
      <url>/2018/11/28/life/2018-11-29-blog-announce/</url>
      
        <content type="html"><![CDATA[<p>åšå®¢ä¸­çš„æ–‡ç« ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå‡ä¸ºåŸåˆ›ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„ï¼Œå¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼›å¿…é¡»åœ¨æ–‡ç« ä¸­ç»™å‡ºåŸæ–‡è¿æ¥ï¼›å¦åˆ™å¿…ç©¶æ³•å¾‹è´£ä»»ã€‚<br>åšå®¢ä¸­å¯èƒ½æœ‰äº›å†…å®¹æ‘˜å½•è‡³åˆ«äººçš„æ–‡ç« /åšå®¢/ä¹¦ï¼Œä»…ä¸ºä¸ªäººæ”¶è—ï¼Œåˆ†äº«çŸ¥è¯†ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åšä¸»è¿›è¡Œåˆ é™¤ã€‚ğŸ“§ï¼š<a href="mailto:zhongyp001@163.com" target="_blank" rel="noopener">zhongyp001@163.com</a>ï¼Œæ”¶åˆ°åä¸€å®šå°½å¿«åˆ é™¤ä¸æ‚¨çš„ç›¸å…³å†…å®¹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Java Classæ–‡ä»¶ç»“æ„</title>
      <link href="/2018/11/22/jvm/2018-11-22-class-structure/"/>
      <url>/2018/11/22/jvm/2018-11-22-class-structure/</url>
      
        <content type="html"><![CDATA[<h2 id="classç»“æ„"><a href="#classç»“æ„" class="headerlink" title="classç»“æ„"></a>classç»“æ„</h2><p>æ‘˜è‡ª<a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html" target="_blank" rel="noopener">Chapter 4.The class File Format</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4             magic;</span><br><span class="line">    u2             minor_version;</span><br><span class="line">    u2             major_version;</span><br><span class="line">    u2             constant_pool_count;</span><br><span class="line">    cp_info        constant_pool[constant_pool_count-1];</span><br><span class="line">    u2             access_flags;</span><br><span class="line">    u2             this_class;</span><br><span class="line">    u2             super_class;</span><br><span class="line">    u2             interfaces_count;</span><br><span class="line">    u2             interfaces[interfaces_count];</span><br><span class="line">    u2             fields_count;</span><br><span class="line">    field_info     fields[fields_count];</span><br><span class="line">    u2             methods_count;</span><br><span class="line">    method_info    methods[methods_count];</span><br><span class="line">    u2             attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="magic"><a href="#magic" class="headerlink" title="magic"></a>magic</h3><p>ç”¨æ¥è¯†åˆ«classæ–‡ä»¶ï¼Œå›ºå®šå€¼ï¼š0xCAFEBABEã€‚å…³äº0xCAFEBABEè¿˜æœ‰ä¸€ä¸ªæ•…äº‹<a href="https://leokongwq.github.io/2016/12/31/java-magic-0xCAFEBABE.html" target="_blank" rel="noopener">javaé­”æ³•ä¹‹0xCAFEBABE</a></p><h3 id="minor-version-major-version"><a href="#minor-version-major-version" class="headerlink" title="minor_version, major_version"></a>minor_version, major_version</h3><p>The values of the minor_version and major_version items are the minor and major version numbers of this class file. Together, a major and a minor version number determine the version of the class file format. If a class file has major version number M and minor version number m, we denote the version of its class file format as M.m. Thus, class file format versions may be ordered lexicographically, for example, 1.5 &lt; 2.0 &lt; 2.1.</p><p>A Java Virtual Machine implementation can support a class file format of version v if and only if v lies in some contiguous range Mi.0 â‰¤ v â‰¤ Mj.m. The release level of the Java SE platform to which a Java Virtual Machine implementation conforms is responsible for determining the range.</p><p>Oracleâ€™s Java Virtual Machine implementation in JDK release 1.0.2 supports class file format versions 45.0 through 45.3 inclusive. JDK releases 1.1.* support class file format versions in the range 45.0 through 45.65535 inclusive. For k â‰¥ 2, JDK release 1.k supports class file format versions in the range 45.0 through 44+k.0 inclusive.</p><h3 id="constant-pool-count"><a href="#constant-pool-count" class="headerlink" title="constant_pool_count"></a>constant_pool_count</h3><p>The value of the constant_pool_count item is equal to the number of entries in the constant_pool table plus one. A constant_pool index is considered valid if it is greater than zero and less than constant_pool_count, with the exception for constants of type long and double noted in Â§4.4.5.</p><h3 id="constant-pool"><a href="#constant-pool" class="headerlink" title="constant_pool[]"></a>constant_pool[]</h3><p>The constant_pool is a table of structures (Â§4.4) representing various string constants, class and interface names, field names, and other constants that are referred to within the ClassFile structure and its substructures. The format of each constant_pool table entry is indicated by its first â€œtagâ€ byte.</p><p>The constant_pool table is indexed from 1 to constant_pool_count-1.</p><h3 id="access-flags"><a href="#access-flags" class="headerlink" title="access_flags"></a>access_flags</h3><p>The value of the access_flags item is a mask of flags used to denote access permissions to and properties of this class or interface. The interpretation of each flag, when set, is as shown in Table 4.1.</p><p>Table 4.1. Class access and property modifiers</p><p>Flag Name    Value    Interpretation<br>ACC_PUBLIC    0x0001    Declared public; may be accessed from outside its package.<br>ACC_FINAL    0x0010    Declared final; no subclasses allowed.<br>ACC_SUPER    0x0020    Treat superclass methods specially when invoked by the invokespecial instruction.<br>ACC_INTERFACE    0x0200    Is an interface, not a class.<br>ACC_ABSTRACT    0x0400    Declared abstract; must not be instantiated.<br>ACC_SYNTHETIC    0x1000    Declared synthetic; not present in the source code.<br>ACC_ANNOTATION    0x2000    Declared as an annotation type.<br>ACC_ENUM    0x4000    Declared as an enum type.<br>A class may be marked with the ACC_SYNTHETIC flag to indicate that it was generated by a compiler and does not appear in source code.</p><p>The ACC_ENUM flag indicates that this class or its superclass is declared as an enumerated type.</p><p>An interface is distinguished by its ACC_INTERFACE flag being set. If its ACC_INTERFACE flag is not set, this class file defines a class, not an interface.</p><p>If the ACC_INTERFACE flag of this class file is set, its ACC_ABSTRACT flag must also be set (JLS Â§9.1.1.1). Such a class file must not have its ACC_FINAL, ACC_SUPER or ACC_ENUM flags set.</p><p>An annotation type must have its ACC_ANNOTATION flag set. If the ACC_ANNOTATION flag is set, the ACC_INTERFACE flag must be set as well. If the ACC_INTERFACE flag of this class file is not set, it may have any of the other flags in Table 4.1 set, except the ACC_ANNOTATION flag. However, such a class file cannot have both its ACC_FINAL and ACC_ABSTRACT flags set (JLS Â§8.1.1.2).</p><p>The ACC_SUPER flag indicates which of two alternative semantics is to be expressed by the invokespecial instruction (Â§invokespecial) if it appears in this class. Compilers to the instruction set of the Java Virtual Machine should set the ACC_SUPER flag.</p><p>The ACC_SUPER flag exists for backward compatibility with code compiled by older compilers for the Java programming language. In Oracleâ€™s JDK prior to release 1.0.2, the compiler generated ClassFile access_flags in which the flag now representing ACC_SUPER had no assigned meaning, and Oracleâ€™s Java Virtual Machine implementation ignored the flag if it was set.</p><p>All bits of the access_flags item not assigned in Table 4.1 are reserved for future use. They should be set to zero in generated class files and should be ignored by Java Virtual Machine implementations.</p><h3 id="this-class"><a href="#this-class" class="headerlink" title="this_class"></a>this_class</h3><p>The value of the this_class item must be a valid index into the constant_pool table. The constant_pool entry at that index must be a CONSTANT_Class_info structure (Â§4.4.1) representing the class or interface defined by this class file.</p><h3 id="super-class"><a href="#super-class" class="headerlink" title="super_class"></a>super_class</h3><p>For a class, the value of the super_class item either must be zero or must be a valid index into the constant_pool table. If the value of the super_class item is nonzero, the constant_pool entry at that index must be a CONSTANT_Class_info structure (Â§4.4.1) representing the direct superclass of the class defined by this class file. Neither the direct superclass nor any of its superclasses may have the ACC_FINAL flag set in the access_flags item of its ClassFile structure.</p><p>If the value of the super_class item is zero, then this class file must represent the class Object, the only class or interface without a direct superclass.</p><p>For an interface, the value of the super_class item must always be a valid index into the constant_pool table. The constant_pool entry at that index must be a CONSTANT_Class_info structure representing the class Object.</p><h3 id="interfaces-count"><a href="#interfaces-count" class="headerlink" title="interfaces_count"></a>interfaces_count</h3><p>The value of the interfaces_count item gives the number of direct superinterfaces of this class or interface type.</p><h3 id="interfaces"><a href="#interfaces" class="headerlink" title="interfaces[]"></a>interfaces[]</h3><p>Each value in the interfaces array must be a valid index into the constant_pool table. The constant_pool entry at each value of interfaces[i], where 0 â‰¤ i &lt; interfaces_count, must be a CONSTANT_Class_info structure (Â§4.4.1) representing an interface that is a direct superinterface of this class or interface type, in the left-to-right order given in the source for the type.</p><h3 id="fields-count"><a href="#fields-count" class="headerlink" title="fields_count"></a>fields_count</h3><p>The value of the fields_count item gives the number of field_info structures in the fields table. The field_info structures (Â§4.5) represent all fields, both class variables and instance variables, declared by this class or interface type.</p><h3 id="fields"><a href="#fields" class="headerlink" title="fields[]"></a>fields[]</h3><p>Each value in the fields table must be a field_info (Â§4.5) structure giving a complete description of a field in this class or interface. The fields table includes only those fields that are declared by this class or interface. It does not include items representing fields that are inherited from superclasses or superinterfaces.</p><h3 id="methods-count"><a href="#methods-count" class="headerlink" title="methods_count"></a>methods_count</h3><p>The value of the methods_count item gives the number of method_info structures in the methods table.</p><h3 id="methods"><a href="#methods" class="headerlink" title="methods[]"></a>methods[]</h3><p>Each value in the methods table must be a method_info (Â§4.6) structure giving a complete description of a method in this class or interface. If neither of the ACC_NATIVE and ACC_ABSTRACT flags are set in the access_flags item of a method_info structure, the Java Virtual Machine instructions implementing the method are also supplied.</p><p>The method_info structures represent all methods declared by this class or interface type, including instance methods, class methods, instance initialization methods (Â§2.9), and any class or interface initialization method (Â§2.9). The methods table does not include items representing methods that are inherited from superclasses or superinterfaces.</p><h3 id="attributes-count"><a href="#attributes-count" class="headerlink" title="attributes_count"></a>attributes_count</h3><p>The value of the attributes_count item gives the number of attributes (Â§4.7) in the attributes table of this class.</p><h3 id="attributes"><a href="#attributes" class="headerlink" title="attributes[]"></a>attributes[]</h3><p>Each value of the attributes table must be an attribute_info (Â§4.7) structure.</p><p>The attributes defined by this specification as appearing in the attributes table of a ClassFile structure are the InnerClasses (Â§4.7.6), EnclosingMethod (Â§4.7.7), Synthetic (Â§4.7.8), Signature (Â§4.7.9), SourceFile (Â§4.7.10), SourceDebugExtension (Â§4.7.11), Deprecated (Â§4.7.15), RuntimeVisibleAnnotations (Â§4.7.16), RuntimeInvisibleAnnotations (Â§4.7.17), and BootstrapMethods (Â§4.7.21) attributes.</p><p>If a Java Virtual Machine implementation recognizes class files whose version number is 49.0 or above, it must recognize and correctly read Signature (Â§4.7.9), RuntimeVisibleAnnotations (Â§4.7.16), and RuntimeInvisibleAnnotations (Â§4.7.17) attributes found in the attributes table of a ClassFile structure of a class file whose version number is 49.0 or above.</p><p>If a Java Virtual Machine implementation recognizes class files whose version number is 51.0 or above, it must recognize and correctly read BootstrapMethods (Â§4.7.21) attributes found in the attributes table of a ClassFile structure of a class file whose version number is 51.0 or above.</p><p>A Java Virtual Machine implementation is required to silently ignore any or all attributes in the attributes table of a ClassFile structure that it does not recognize. Attributes not defined in this specification are not allowed to affect the semantics of the class file, but only to provide additional descriptive information (Â§4.7.1).</p>]]></content>
      
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¹¶å‘çŸ¥è¯†æ¶æ„</title>
      <link href="/2018/11/16/concurrent/2018-11-27-concurrency-structure/"/>
      <url>/2018/11/16/concurrent/2018-11-27-concurrency-structure/</url>
      
        <content type="html"><![CDATA[<p><img src="/media/concurrency.png" alt="Javaå¹¶å‘æ¶æ„å›¾"></p>]]></content>
      
      
      
        <tags>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Gitå¸¸ç”¨å‘½ä»¤æ€»ç»“</title>
      <link href="/2018/10/23/utils/2018-10-23-git/"/>
      <url>/2018/10/23/utils/2018-10-23-git/</url>
      
        <content type="html"><![CDATA[<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><p>ç³»ç»Ÿç³»ç»Ÿæ€§çš„å­¦ä¹ Gitï¼Œè¯·ç§»æ­¥<a href="https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%85%B3%E4%BA%8E%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener">Gitä¸­æ–‡å­¦ä¹ æ–‡æ¡£</a>ï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯åˆ†ç±»è®°å½•ä¸€ä¸‹gitçš„å¸¸ç”¨å‘½ä»¤ã€‚<br><img src="/media/15403035072735.png" alt="Gitç‰ˆæœ¬æ§åˆ¶ç³»ç»ŸVCSåŸºæœ¬æ“ä½œæµç¨‹å›¾"></p><h2 id="å¸¸ç”¨å‘½ä»¤æ€»ç»“"><a href="#å¸¸ç”¨å‘½ä»¤æ€»ç»“" class="headerlink" title="å¸¸ç”¨å‘½ä»¤æ€»ç»“"></a>å¸¸ç”¨å‘½ä»¤æ€»ç»“</h2><h3 id="Gitåˆå§‹åŒ–"><a href="#Gitåˆå§‹åŒ–" class="headerlink" title="Gitåˆå§‹åŒ–"></a>Gitåˆå§‹åŒ–</h3><p><code>git init</code> å°†å½“å‰ç›®å½•å˜ä¸ºå¯ç®¡ç†çš„ä»“åº“<br><code>git clone</code> å…‹éš†ä¸€ä¸ªä»“åº“åˆ°æœ¬åœ°<br><code>git clone -b branch uri</code> å…‹éš†æŒ‡å®šbranchåˆ†æ”¯åˆ°æœ¬åœ°<br><code>git config user.name</code> æŸ¥çœ‹ç”¨æˆ·å<br><code>git config user.email</code> æŸ¥çœ‹é‚®ç®±</p><h3 id="è®¾ç½®ä¸é…ç½®"><a href="#è®¾ç½®ä¸é…ç½®" class="headerlink" title="è®¾ç½®ä¸é…ç½®"></a>è®¾ç½®ä¸é…ç½®</h3><p><code>git config -global user.name/email &quot;å‚æ•°&quot;</code> gitæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ï¼Œæ‰€ä»¥æ·»åŠ ç”¨æˆ·åå’Œé‚®ç®±ä½œä¸ºä¸€ä¸ªæ ‡è¯†<br><code>ssh -keygen -t rsa -C &quot;email&quot;</code> ç”Ÿæˆæœ¬åœ°ssh key</p><h3 id="æœ¬åœ°ç‰ˆæœ¬åº“"><a href="#æœ¬åœ°ç‰ˆæœ¬åº“" class="headerlink" title="æœ¬åœ°ç‰ˆæœ¬åº“"></a>æœ¬åœ°ç‰ˆæœ¬åº“</h3><p><code>git add &quot;filename.*&quot;</code> æ·»åŠ åˆ°æš‚å­˜åŒº<br><code>git commit -m &quot;filename.*&quot;</code> æäº¤åˆ°ä»“åº“<br><code>git commit --amend</code> å°è¯•é‡æ–°æäº¤,è¿™ä¸ªæ“ä½œéœ€è¦ç»„åˆæ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add file1 // å°†file1 æ·»åŠ è‡³ç¼“å­˜åŒº</span><br><span class="line">git commmit -m &quot;update files&quot; //æäº¤file1åˆ°æœ¬åœ°ä»“åº“,æäº¤å®Œå‘ç°å¿˜è®°file2æ²¡æœ‰æäº¤ï¼Œåˆ™ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œæäº¤file2å¹¶è¦†ç›–ä¹‹å‰çš„æäº¤ä¿¡æ¯ã€‚</span><br><span class="line">git add file2 // æ·»åŠ file2</span><br><span class="line">git commit -amend // å°è¯•é‡æ–°æäº¤commitä¿¡æ¯ï¼Œå¹¶è¦†ç›–æ‰ä¹‹å‰çš„æäº¤ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><code>git status</code> æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€<br><code>git diff filename.*</code> æŸ¥çœ‹ä¿®æ”¹äº†ä»€ä¹ˆ<br><code>git log</code> çœ‹çœ‹æ¯æ¬¡ä¿®æ”¹çš„æ—¥å¿—<br><code>git log --pretty=oneline</code> æ—¥å¿—æ˜¾ç¤ºä¸ºç¼©ç•¥ç‰ˆ<br>æ³¨ï¼š<code>git reset</code> ä¸åŠ <code>--hard</code>å‚æ•°å¯¹å½“å‰å·¥ä½œåŒºæ–‡ä»¶ä¸ä¼šæœ‰ä»»ä½•ä¿®æ”¹ï¼Œåªæ˜¯å¯¹ç¼“å­˜åŒºè¿›è¡Œæ“ä½œã€‚ä¸€æ—¦åŠ äº†å‚æ•°ï¼Œæ“ä½œä¸€å®šè¦æ…é‡ï¼Œå¦åˆ™ä½ å½“å‰å·¥ä½œåŒºä¸­çš„ä¿®æ”¹å°†ä¼šå…¨éƒ¨è¢«æ¸…é™¤ã€‚<br><code>git reset HEAD file</code> å°†fileé€€å›åˆ°å½“å‰ç‰ˆæœ¬ï¼ˆä»…ä»…æ˜¯å¯¹ç¼“å­˜åŒºè¿›è¡Œæ“ä½œï¼‰<br><code>git reset --hard HEAD^</code> é€€å›åˆ°ä¸Šä¸€ç‰ˆæœ¬<br><code>git reset --hard HEAD^^</code> é€€å›åˆ°å‰äºŒçš„ç‰ˆæœ¬<br><code>git reset --hard HEAD~100</code> é€€å›åˆ°å‰100ç‰ˆæœ¬<br><code>git reset --hard ç‰ˆæœ¬å·</code> é€€å›åˆ°ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬<br><code>git reflog</code> æŸ¥çœ‹ç‰ˆæœ¬å·å’Œä¸Šä¸€ä¸ªå‘½ä»¤ä¸€å—ç”¨æ•ˆæœæ¯”è¾ƒå¥½<br><code>git reset --mixed</code> å°†å½“å‰æ–‡ä»¶æ’¤å‡ºç¼“å­˜åŒºï¼Œä¿ç•™æ–‡ä»¶ä¿®æ”¹<br><code>git rm --cached file</code> åˆ é™¤ç¼“å­˜åŒºfile<br><code>git checkout -- file</code> æ¢å¤å·¥ä½œåŒºfileï¼ˆå–æ¶ˆå·¥ä½œåŒºæ–‡ä»¶çš„ä¿®æ”¹ï¼‰</p><h3 id="è¿œç¨‹ç‰ˆæœ¬åº“"><a href="#è¿œç¨‹ç‰ˆæœ¬åº“" class="headerlink" title="è¿œç¨‹ç‰ˆæœ¬åº“"></a>è¿œç¨‹ç‰ˆæœ¬åº“</h3><p><code>git remote add origin è¿œç¨‹gitåœ°å€</code> è¿æ¥<br><code>git push -u origin master</code> æŠŠæœ¬åœ°åº“åˆ†æ”¯masterå†…å®¹æ¨é€åˆ°è¿œç¨‹åº“ï¼ˆ-u å‘½ä»¤åœ¨ç¬¬ä¸€æ¬¡å…³è”æœ¬åœ°åº“å’Œè¿œç¨‹åº“æ—¶ä½¿ç”¨ï¼‰<br><code>git clone url</code> å…‹éš†è¿œç¨‹(url)åº“</p><h3 id="gitåˆ†æ”¯æ“ä½œ"><a href="#gitåˆ†æ”¯æ“ä½œ" class="headerlink" title="gitåˆ†æ”¯æ“ä½œ"></a>gitåˆ†æ”¯æ“ä½œ</h3><p>é¦–å…ˆmasterä¸»åˆ†æ”¯åº”è¯¥æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸å…è®¸åœ¨ä¸Šé¢å¹²æ´»ï¼Œå¹²æ´»ä¸€èˆ¬æƒ…å†µä¸‹åœ¨æ–°å»ºçš„devåˆ†æ”¯ä¸Šå¹²æ´»ï¼Œå¹²å®Œåï¼Œæ¯”å¦‚ä¸Šè¦å‘å¸ƒï¼Œæˆ–è€…è¯´devåˆ†æ”¯ä»£ç ç¨³å®šåå¯ä»¥åˆå¹¶åˆ°ä¸»åˆ†æ”¯masterä¸Šæ¥ã€‚</p><p><code>git branch</code> æŸ¥çœ‹åˆ†æ”¯<br><code>git checkout</code> åˆ‡æ¢åˆ†æ”¯<br><code>git checkout -b</code>  åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯<br><code>git merge</code> åˆå¹¶åˆ°å½“å‰åˆ†æ”¯<br><code>git branch -d</code>åˆ é™¤æŸåˆ†æ”¯<br><code>git merge --no-ff -m &quot;æ³¨é‡Š&quot;</code>åˆ†æ”¯åˆå¹¶åˆ†æ”¯ç¦ç”¨fast forward<br><code>git stash</code> å°†å½“å‰åˆ†æ”¯çš„å·¥ä½œç°åœºä¿ç•™ä¸‹æ¥<br><code>git stash list</code> æŸ¥çœ‹å·¥ä½œç°åœº<br><code>git stash apply</code> æ¢å¤å†…å®¹ä½†æ˜¯ä½ éœ€è¦git stash dropåˆ é™¤stash<br><code>git stash pop</code> æ¢å¤çš„åŒæ—¶æŠŠstashå†…å®¹ä¹Ÿåˆ é™¤<br><code>git remote</code> æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯<br><code>git remote -v</code> æŸ¥çœ‹è¿œç¨‹åº“çš„è¯¦ç»†ä¿¡æ¯<br><code>git push origin master</code> masterä¸ºæœ¬åœ°çš„åˆ†æ”¯åæ¨é€åˆ†æ”¯<br><code>git checkout -b dev origin/dev</code> devä¸ºåˆ†æ”¯åï¼Œåšå®Œå¼€å‘å<br><code>git push origin dev</code> æ¨é€åˆ°è¿œç¨‹åº“<br><code>git pull</code> æŠ“å–æœ€æ–°çš„æäº¤,å¹¶å°è¯•è‡ªåŠ¨åˆå¹¶åˆ°æœ¬åœ°å½“å‰æ‰€åœ¨çš„åˆ†æ”¯<br><code>git fetch</code> æŠ“å–æœ€æ–°çš„æäº¤ï¼Œä¸ä¼šè‡ªåŠ¨åˆå¹¶ï¼Œå¿…é¡»æ‰‹åŠ¨ã€‚<br><code>git rebase</code> å˜åŸº,å°†æäº¤åˆ°æŸä¸€åˆ†æ”¯ä¸Šçš„æ‰€æœ‰ä¿®æ”¹éƒ½ç§»è‡³å¦ä¸€åˆ†æ”¯ä¸Š<br><code>git rebase --continue</code> <strong><em>ç»§ç»­å˜åŸºæ“ä½œï¼Œä¸€èˆ¬ç”¨äºç¬¬ä¸€æ¬¡å˜åŸºå¤±è´¥åï¼Œè§£å†³å†²çªæ–‡ä»¶ï¼Œå°†å†²çªæ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜åŒºï¼Œä¸è¦æäº¤ï¼Œç„¶åå†æ‰§è¡Œæ­¤å‘½ä»¤ã€‚å¦‚æœæäº¤äº†ï¼Œæ‰§è¡Œ<code>git rebase --skip</code>å‘½ä»¤å–æ¶ˆrebaseçŠ¶æ€ã€‚</em></strong><br><code>git branch --set-upstream dev origin/dev</code> æŒ‡å®šæœ¬åœ°devåˆ†æ”¯ï¼ˆå·²ç»åˆ›å»ºçš„ï¼‰ä¸è¿œç¨‹origin/devåˆ†æ”¯çš„è¿æ¥<br><code>git branch -u origin/dev</code> æŒ‡å®šå½“å‰æ‰€åœ¨è¿æ¥è¿œç¨‹origin/devåˆ†æ”¯çš„è¿æ¥<br><code>git checkout --track origin/dev</code> åˆ›å»ºæ–°çš„devåˆ†æ”¯ï¼Œåˆ¶å®šè¿œç¨‹è¿æ¥origin/dev</p><p>æ³¨ï¼šå¦‚æœé¡ºç€ä¸€ä¸ªåˆ†æ”¯èµ°ä¸‹å»èƒ½å¤Ÿåˆ°è¾¾å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆGitåœ¨åˆå¹¶ä¸¤è€…çš„æ—¶å€™ï¼Œåªä¼šç®€å•çš„å°†æŒ‡é’ˆå‘å‰æ¨è¿›ï¼ˆæŒ‡é’ˆå³ç§»ï¼‰ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹çš„åˆå¹¶æ“ä½œæ²¡æœ‰éœ€è¦è§£å†³çš„åˆ†æ­§â€”â€”è¿™å°±å«åš â€œå¿«è¿›ï¼ˆfast-forwardï¼‰â€ã€‚</p><h3 id="å¤šäººåä½œ"><a href="#å¤šäººåä½œ" class="headerlink" title="å¤šäººåä½œ"></a>å¤šäººåä½œ</h3><ol><li>æ¯å¼€å‘ä¸€ä¸ªæ–°ç‰¹æ€§å¯ä»¥æ–°å»ºä¸€ä¸ªæœ¬åœ°ç‰¹æ€§åˆ†æ”¯ï¼Œå¼€å‘å®Œæˆååˆå¹¶åˆ°æœ¬åœ°ä¸»çº¿ã€‚</li><li>å¦‚æœä¸ä½¿ç”¨ç‰¹æ€§åˆ†æ”¯å¼€å‘å¯ä»¥ä½¿ç”¨<code>git stash</code>ä¿å­˜å½“å‰çš„å·¥ä½œç©ºé—´ã€‚</li><li>è¿œç¨‹ä»£ç å’Œæœ¬åœ°ä»£ç åˆå¹¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œ<code>git pull</code>å’Œ<code>git fetch</code>ï¼Œ<code>git pull</code>å‘½ä»¤ä¼šè‡ªåŠ¨åˆå¹¶è¿œç¨‹ä»£ç ï¼Œå†²çªåéœ€è¦è§£å†³å†²çªåæäº¤ã€‚<code>git fetch</code>ä¸è‡ªåŠ¨å’Œæœ¬åœ°ä»£ç åˆå¹¶ï¼Œéœ€è¦æ‰‹åŠ¨mergeã€‚</li><li>åœ¨åˆå¹¶æ—¶ï¼Œæ ¹æ®é¡¹ç›®æƒ…å†µä½¿ç”¨<a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA" target="_blank" rel="noopener">å˜åŸº</a>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿œç¨‹åº“ä¸ä¿ç•™æœ¬åœ°æ“ä½œå†å²ã€‚</li><li><strong><em>ä½¿ç”¨å˜åŸºåŸåˆ™</em></strong>ï¼šåªå¯¹å°šæœªæ¨é€æˆ–åˆ†äº«ç»™åˆ«äººçš„æœ¬åœ°ä¿®æ”¹æ‰§è¡Œå˜åŸºæ“ä½œæ¸…ç†å†å²ï¼Œä»ä¸å¯¹å·²æ¨é€è‡³åˆ«å¤„çš„æäº¤æ‰§è¡Œå˜åŸºæ“ä½œï¼Œè¿™æ ·ï¼Œä½ æ‰èƒ½äº«å—åˆ°ä¸¤ç§æ–¹å¼å¸¦æ¥çš„ä¾¿åˆ©ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Utils </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring AOP</title>
      <link href="/2018/10/03/spring/2018-09-28-AOP/"/>
      <url>/2018/10/03/spring/2018-09-28-AOP/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h2><p>æœ¬ç¯‡æ–‡ç« ç¿»è¯‘è‡ª<a href="https://www.tutorialspoint.com/spring/aop_with_spring.htm" target="_blank" rel="noopener">AOP with Spring</a>ï¼Œä¸»è¦ä»‹ç»æ˜¯å…³äºAOPçš„æ¦‚å¿µã€‚</p><h3 id="Brief-introduction-ï¼ˆç®€ä»‹ï¼‰"><a href="#Brief-introduction-ï¼ˆç®€ä»‹ï¼‰" class="headerlink" title="Brief introduction ï¼ˆç®€ä»‹ï¼‰"></a>Brief introduction ï¼ˆç®€ä»‹ï¼‰</h3><p>One of the key components of Spring Framework is the Aspect oriented programming (AOP) framework. Aspect-Oriented Programming entails breaking down program logic into distinct parts called so-called concerns. The functions that span multiple points of an application are called cross-cutting concerns and these cross-cutting concerns are conceptually separate from the applicationâ€™s business logic. There are various common good examples of aspects like logging, auditing, declarative transactions, security, caching, etc.</p><p>The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the aspect. Dependency Injection helps you decouple your application objects from each other and AOP helps you decouple cross-cutting concerns from the objects that they affect. AOP is like triggers in programming languages such as Perl, .NET, Java, and others.</p><p>Spring AOP module provides interceptors to intercept an application. For example, when a method is executed, you can add extra functionality before or after the method execution.</p><p>ç¿»è¯‘ï¼š</p><p>AOPé¢å‘åˆ‡é¢ç¼–ç¨‹æ˜¯Springæ¡†æ¶ä¸­çš„æœ€å…³é”®çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚é¢å‘åˆ‡é¢ç¼–ç¨‹éœ€è¦æ‹†åˆ†ç¨‹åºé€»è¾‘åˆ°è¢«ç§°ä¸ºå…³æ³¨ç‚¹çš„ä¸åŒéƒ¨åˆ†ã€‚ä¸€ä¸ªåœ¨åº”ç”¨ç¨‹åºå†…è·¨è¶Šå¤šä¸ªç‚¹çš„æ–¹æ³•è¢«ç§°ä¸ºæ¨ªåˆ‡ç‚¹ï¼Œè¿™äº›æ¨ªåˆ‡ç‚¹å’Œåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘åœ¨æ¦‚å¿µä¸Šæ˜¯åˆ†å¼€çš„ã€‚ç›®å‰å·²ç»æœ‰å¾ˆå¤šåº”ç”¨åˆ‡é¢çš„ä¾‹å­ï¼Œæ¯”å¦‚æ—¥å¿—ï¼Œå®¡è®¡ï¼Œå£°æ˜å¼äº‹åŠ¡ï¼Œå®‰å…¨ï¼Œç¼“å­˜ç­‰ã€‚</p><p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæ¨¡å—åŒ–çš„å…³é”®å•å…ƒæ˜¯ç±»ï¼Œä½†æ˜¯åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œæ¨¡å—åŒ–å•å…ƒæ˜¯åˆ‡é¢ã€‚ä¾èµ–æ³¨å…¥å¸®åŠ©ä½ å°†åº”ç”¨ä¸­çš„å¯¹è±¡ç›¸äº’è§£è€¦ï¼ŒAOPå¸®åŠ©ä½ å°†æ¨ªåˆ‡ç‚¹ä»å®ƒä»¬ä½œç”¨çš„å¯¹è±¡ä¸­è§£è€¦ã€‚AOPå°±åƒæ˜¯Perl,.NET,Javaæˆ–è€…å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„è§¦å‘å™¨ã€‚</p><p>Spring AOPæ¨¡å—æä¾›æ‹¦æˆªåº”ç”¨çš„æ‹¦æˆªå™¨ã€‚ä¸¾ä¸ªğŸŒ°ï¼Œä½ å¯ä»¥åœ¨ä½ è¿è¡Œçš„æ–¹æ³•ä¹‹å‰æˆ–è€…ä¹‹åæ·»åŠ é¢å¤–çš„åŠŸèƒ½æˆ–è€…æ–¹æ³•ã€‚</p><h3 id="AOP-Terminologiesï¼ˆAOP-æœ¯è¯­ï¼‰"><a href="#AOP-Terminologiesï¼ˆAOP-æœ¯è¯­ï¼‰" class="headerlink" title="AOP Terminologiesï¼ˆAOP æœ¯è¯­ï¼‰"></a>AOP Terminologiesï¼ˆAOP æœ¯è¯­ï¼‰</h3><h4 id="Aspectï¼ˆåˆ‡é¢ï¼‰"><a href="#Aspectï¼ˆåˆ‡é¢ï¼‰" class="headerlink" title="Aspectï¼ˆåˆ‡é¢ï¼‰"></a>Aspectï¼ˆåˆ‡é¢ï¼‰</h4><p>This is a module which has a set of APIs providing cross-cutting requirements. For example, a logging module would be called AOP aspect for logging. An application can have any number of aspects depending on the requirement.</p><p>ç¿»è¯‘ï¼š Aspectä¸€ä¸ªæä¾›æ¨ªåˆ‡ï¼ˆcross-cuttingï¼‰APIsçš„æ¨¡å—ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ—¥å¿—æ¨¡å—è¢«ç§°ä¸ºAOP æ—¥å¿—åˆ‡é¢ã€‚ä¸€ä¸ªåº”ç”¨å¯ä»¥æ ¹æ®éœ€æ±‚æ‹¥æœ‰ä»»ä½•æ•°é‡çš„åˆ‡é¢ã€‚</p><h4 id="Join-pointï¼ˆè¿æ¥ç‚¹ï¼‰"><a href="#Join-pointï¼ˆè¿æ¥ç‚¹ï¼‰" class="headerlink" title="Join pointï¼ˆè¿æ¥ç‚¹ï¼‰"></a>Join pointï¼ˆè¿æ¥ç‚¹ï¼‰</h4><p>This represents a point in your application where you can plug-in the AOP aspect. You can also say, it is the actual place in the application where an action will be taken using Spring AOP framework.</p><p>ç¿»è¯‘ï¼š åœ¨åº”ç”¨ä¸­å¯ä»¥æ’å…¥AOPåˆ‡é¢çš„åœ°æ–¹å¯è¢«æŠ½è±¡ä¸ºä¸€ä¸ªç‚¹ã€‚ä½ ä¹Ÿå¯ä»¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨åº”ç”¨ä¸­å­˜åœ¨çš„åœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹å°†è¢«Spring AOP æ¡†æ¶æ‰§è¡Œä¸€äº›åŠ¨ä½œã€‚</p><p>Adviceï¼ˆé€šçŸ¥ï¼‰</p><p>This is the actual action to be taken either before or after the method execution. This is an actual piece of code that is invoked during the program execution by Spring AOP framework.</p><p>ç¿»è¯‘ï¼šAdviceæ˜¯ä¸€ä¸ªå®é™…çš„åŠ¨ä½œï¼Œå®ƒå°†åœ¨æ–¹æ³•æ‰§è¡Œå‰å’Œæ–¹æ³•æ‰§è¡Œåæ‰§è¡Œã€‚è¿™æ®µä»£ç é€šè¿‡Spring AOPæ¡†æ¶åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«è°ƒç”¨ã€‚</p><h4 id="Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰"><a href="#Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰" class="headerlink" title="Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰"></a>Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰</h4><p>This is a set of one or more join points where an advice should be executed. You can specify pointcuts using expressions or patterns as we will see in our AOP examples.</p><p>ç¿»è¯‘ï¼šPointcutæ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿æ¥ç‚¹çš„é›†åˆã€‚æ­£å¦‚æˆ‘ä»¬å°†åœ¨AOPä¾‹å­ä¸­çœ‹åˆ°çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼åˆ¶å®šä½ çš„åˆ‡å…¥ç‚¹ã€‚</p><h4 id="Introductionï¼ˆå¼•å…¥ï¼‰"><a href="#Introductionï¼ˆå¼•å…¥ï¼‰" class="headerlink" title="Introductionï¼ˆå¼•å…¥ï¼‰"></a>Introductionï¼ˆå¼•å…¥ï¼‰</h4><p>An introduction allows you to add new methods or attributes to the existing classes.</p><p>ç¿»è¯‘ï¼šå¼•å…¥å¯ä»¥å…è®¸ä½ æ·»åŠ æ–°çš„æ–¹æ³•æˆ–è€…å±æ€§åˆ°å·²ç»å­˜åœ¨çš„ç±»ä¸­ã€‚</p><h4 id="Target-object"><a href="#Target-object" class="headerlink" title="Target object"></a>Target object</h4><p>The object being advised by one or more aspects. This object will always be a proxied object, also referred to as the advised object.</p><p>ç¿»è¯‘ï¼šè¿™ä¸ªå¯¹è±¡è¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ‡é¢é€šçŸ¥ã€‚è¿™ä¸ªå¯¹è±¡ä¸€èˆ¬æ˜¯ä»£ç†å¯¹è±¡ï¼Œä½œä¸ºè¢«é€šçŸ¥å¯¹è±¡å¼•ç”¨ã€‚</p><h4 id="Weavingï¼ˆç»‡å…¥ï¼‰"><a href="#Weavingï¼ˆç»‡å…¥ï¼‰" class="headerlink" title="Weavingï¼ˆç»‡å…¥ï¼‰"></a>Weavingï¼ˆç»‡å…¥ï¼‰</h4><p>Weaving is the process of linking aspects with other application types or objects to create an advised object. This can be done at compile time, load time, or at runtime.</p><p>ç¿»è¯‘ï¼šç»‡å…¥æ˜¯é“¾æ¥åˆ‡é¢å’Œå…¶ä»–åº”ç”¨ç±»å‹æˆ–è€…å¯¹è±¡æ¥åˆ›å»ºé€šçŸ¥å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨ç¼–è¯‘ã€åŠ è½½æˆ–è€…æ‰§è¡ŒæœŸé—´è¿›è¡Œã€‚</p><h3 id="Types-of-Advice"><a href="#Types-of-Advice" class="headerlink" title="Types of Advice"></a>Types of Advice</h3><p>Spring aspects can work with five kinds of advice mentioned as follows.<br>ç¿»è¯‘ï¼šSpring åˆ‡é¢å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æåˆ°çš„äº”ç§advice</p><ul><li><p>before: Run advice before a method execution.</p></li><li><p>after: Run advice after a method execution.</p></li><li><p>after-returning: Run advice after the a method execution only if method completes successfully.</p></li><li><p>after-throwing: Run advice after the method execution only if method exits by throwing an exception.</p></li><li><p>around: Run advice before and after the advised method is invoked.</p></li></ul><h3 id="Custom-Aspects-Implementation-è‡ªå®šä¹‰æ¥å£å®ç°"><a href="#Custom-Aspects-Implementation-è‡ªå®šä¹‰æ¥å£å®ç°" class="headerlink" title="Custom Aspects Implementation(è‡ªå®šä¹‰æ¥å£å®ç°)"></a>Custom Aspects Implementation(è‡ªå®šä¹‰æ¥å£å®ç°)</h3><p>XML Schema basedï¼ˆåŸºäºXMLæ¨¡å¼ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http:www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http:www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xmlns:aop=&quot;http:www.springframework.org/schema/aop&quot;</span><br><span class="line">       xmlns:tx=&quot;http:www.springframework.org/schema/tx&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http:www.springframework.org/schema/beans</span><br><span class="line">        http:www.springframework.org/schema/beans/spring-beans-4.2.xsd</span><br><span class="line">        http:www.springframework.org/schema/aop</span><br><span class="line">        http:www.springframework.org/schema/aop/spring-aop-4.2.xsd&quot;&gt;</span><br><span class="line">    &lt;!-- ä¸šåŠ¡é€»è¾‘ç±»--AOPè¿æ¥ç‚¹ --&gt;</span><br><span class="line">    &lt;bean id=&quot;aopTest&quot; class=&quot;com.zhongyp.zen.service.aop.AOPTestService&quot; /&gt;</span><br><span class="line">    &lt;!--AOPåˆ‡é¢--&gt;</span><br><span class="line">    &lt;bean id=&quot;timeHandler&quot; class=&quot;com.zhongyp.zen.service.handler.TimeHandler&quot; /&gt;</span><br><span class="line">    &lt;!--AOPåˆ‡é¢--&gt;</span><br><span class="line">    &lt;bean id=&quot;printHandler&quot; class=&quot;com.zhongyp.zen.service.handler.PrintHandler&quot;&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;aop:aspectj-autoproxy /&gt;</span><br><span class="line">    &lt;aop:config&gt;</span><br><span class="line">        &lt;!-- pointcutåˆ‡å…¥ç‚¹ï¼ˆAOPè¿æ¥ç‚¹çš„é›†åˆï¼‰--&gt;</span><br><span class="line">        &lt;aop:pointcut id=&quot;pointcut&quot; expression=&quot;execution(* com.zhongyp.zen.service.*.*.*(..))&quot; /&gt;</span><br><span class="line">        &lt;!-- åˆ‡é¢ --&gt;</span><br><span class="line">        &lt;aop:aspect id=&quot;time&quot; ref=&quot;timeHandler&quot;&gt;</span><br><span class="line">            &lt;!-- AOP Advice --&gt;</span><br><span class="line">            &lt;aop:before method=&quot;printStartTime&quot; pointcut-ref=&quot;pointcut&quot; /&gt;</span><br><span class="line">            &lt;aop:after method=&quot;printEndTime&quot; pointcut-ref=&quot;pointcut&quot; /&gt;</span><br><span class="line">        &lt;/aop:aspect&gt;</span><br><span class="line">        &lt;aop:aspect id=&quot;print&quot; ref=&quot;printHandler&quot;&gt;</span><br><span class="line">            &lt;aop:after-returning method=&quot;printString&quot; pointcut-ref=&quot;pointcut&quot;&gt;&lt;/aop:after-returning&gt;</span><br><span class="line">        &lt;/aop:aspect&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>@AspectJ basedï¼ˆåŸºäºåˆ‡é¢æ³¨è§£ï¼‰</p><p>æ³¨è§£æ–¹å¼å¯ä»¥å°†ä¸Šè¿°xmlé…ç½®ä»¥æ³¨è§£çš„å½¢å¼é…ç½®ä¸€ä¸‹ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ç»™å‡ºä¸€ä¸ªæ ·ä¾‹ï¼Œå…¶ä»–çš„è¿˜éœ€è¯»è€…è‡ªå·±å®è·µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component(&quot;logHandler&quot;)</span><br><span class="line">public class LogHandler &#123;</span><br><span class="line">    @Pointcut(&quot;execution(* com.zhongyp.zen.service.*.*.*(..))&quot;)</span><br><span class="line">    private void hehe()&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    @Before(&quot;hehe()&quot;)</span><br><span class="line">    public void doBefore()&#123;</span><br><span class="line">        System.out.println(&quot;ä¸ºæ¯›å›½åº†è¦åŠ ç­ï¼ï¼ï¼ï¼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SQLä¼˜åŒ–</title>
      <link href="/2018/04/02/mysql/2018-04-02-SQL/"/>
      <url>/2018/04/02/mysql/2018-04-02-SQL/</url>
      
        <content type="html"><![CDATA[<h2 id="å¸¸ç”¨SQLæŠ€å·§"><a href="#å¸¸ç”¨SQLæŠ€å·§" class="headerlink" title="å¸¸ç”¨SQLæŠ€å·§"></a>å¸¸ç”¨SQLæŠ€å·§</h2><h3 id="1-1-æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ"><a href="#1-1-æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ" class="headerlink" title="1.1 æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ"></a>1.1 æ£€ç´¢åŒ…å«æœ€å¤§å’Œæœ€å°å€¼çš„è¡Œ</h3><p><code>select max(test_score),min(test_score) from student</code></p><h3 id="1-2-å·§ç”¨rand-rand-n-æå–éšæœºè¡Œ"><a href="#1-2-å·§ç”¨rand-rand-n-æå–éšæœºè¡Œ" class="headerlink" title="1.2 å·§ç”¨rand()/rand(n)æå–éšæœºè¡Œ"></a>1.2 å·§ç”¨rand()/rand(n)æå–éšæœºè¡Œ</h3><p><code>select * from table order by rand()</code></p><h3 id="1-3-group-byçš„with-rollupå­å¥åšç»Ÿè®¡"><a href="#1-3-group-byçš„with-rollupå­å¥åšç»Ÿè®¡" class="headerlink" title="1.3 group byçš„with rollupå­å¥åšç»Ÿè®¡"></a>1.3 group byçš„with rollupå­å¥åšç»Ÿè®¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">create table sales(</span><br><span class="line"></span><br><span class="line">year int not null,</span><br><span class="line">country varchar(20) not null,</span><br><span class="line">product varchar(32) not null,</span><br><span class="line">profit int</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into sales values(2004,&apos;china&apos;,&apos;tnt2004&apos;,2001);</span><br><span class="line">insert into sales values(2004,&apos;china&apos;,&apos;tnt2004&apos;,2002);</span><br><span class="line">insert into sales values(2004,&apos;china&apos;,&apos;tnt2004&apos;,2003);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2004);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2005);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2006);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2007);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2008);</span><br><span class="line">insert into sales values(2005,&apos;china&apos;,&apos;tnt2005&apos;,2009);</span><br><span class="line">insert into sales values(2006,&apos;china&apos;,&apos;tnt2006&apos;,2010);</span><br><span class="line">insert into sales values(2006,&apos;china&apos;,&apos;tnt2006&apos;,2011);</span><br><span class="line">insert into sales values(2006,&apos;china&apos;,&apos;tnt2006&apos;,2012);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select year,sum(profit) from sales group by year;</span><br><span class="line"></span><br><span class="line">select year,sum(profit) from sales group by year with rollup;</span><br></pre></td></tr></table></figure><p>å½“ä½ ä½¿ç”¨ROLLUPæ—¶, ä½ ä¸èƒ½åŒæ—¶ä½¿ç”¨ORDER BYå­å¥è¿›è¡Œç»“æœæ’åºã€‚æ¢è¨€ä¹‹ï¼Œ ROLLUPå’ŒORDER BY æ˜¯äº’ç›¸æ’æ–¥çš„LIMIT ç”¨åœ¨ROLLUP åé¢ã€‚</p><h3 id="1-4-bit-group-functionsåšç»Ÿè®¡"><a href="#1-4-bit-group-functionsåšç»Ÿè®¡" class="headerlink" title="1.4 bit group functionsåšç»Ÿè®¡"></a>1.4 bit group functionsåšç»Ÿè®¡</h3><p>bit_count:ç”¨æ¥è®¡ç®—äºŒè¿›åˆ¶æ•°ä¸­åŒ…å«1çš„ä¸ªæ•°</p><p>bit_or:å°±æ˜¯å¯¹ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°è¿›è¡Œæˆ–è¿ç®—</p><p>bit_and:å°±æ˜¯å¯¹ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°è¿›è¡Œå¹¶è¿ç®—</p><h2 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h2><h3 id="é€šè¿‡show-statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚"><a href="#é€šè¿‡show-statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚" class="headerlink" title="é€šè¿‡show statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚"></a>é€šè¿‡show statuså’Œåº”ç”¨ç‰¹ç‚¹äº†è§£å„ç§SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚</h3><p>é¦–å…ˆæˆ‘ä»¬äº†è§£mysqlæ•°æ®åº“çš„ä¸€äº›è¿è¡ŒçŠ¶æ€å¦‚ä½•æŸ¥è¯¢(æ¯”å¦‚æƒ³çŸ¥é“å½“å‰mysqlè¿è¡Œçš„æ—¶é—´/ä¸€å…±æ‰§è¡Œäº†å¤šå°‘æ¬¡select/update/delete.. / å½“å‰è¿æ¥)</p><p>show status</p><p>å¸¸ç”¨çš„:</p><p>show status like â€˜uptimeâ€™ ; </p><p>show stauts like â€˜com_selectâ€™  show status like â€˜com_insertâ€™ â€¦ç±»æ¨ update  delete</p><p>show sessionæˆ–global status like â€¦. å¦‚æœä½ ä¸å†™sessionæˆ–global,é»˜è®¤æ˜¯session ä¼šè¯ï¼ŒæŒ‡å–å‡ºå½“å‰çª—å£çš„æ‰§è¡Œï¼Œå¦‚æœä½ æƒ³çœ‹æ‰€æœ‰session,ä»mysql å¯åŠ¨åˆ°ç°åœ¨ï¼Œåˆ™åº”è¯¥ globalã€‚</p><p>show status like â€˜connectionsâ€™; </p><p>//æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ¬¡æ•°</p><p>show status like â€˜slow_queriesâ€™;</p><p>ä»¥ä¸‹å‡ ä¸ªå‚æ•°å¯¹Myisam å’ŒInnodb å­˜å‚¨å¼•æ“éƒ½è®¡æ•°ï¼š</p><ol><li><p>Com_select æ‰§è¡Œselect æ“ä½œçš„æ¬¡æ•°ï¼Œä¸€æ¬¡æŸ¥è¯¢åªç´¯åŠ 1ï¼›</p></li><li><p>Com_insert æ‰§è¡Œinsert æ“ä½œçš„æ¬¡æ•°ï¼Œå¯¹äºæ‰¹é‡æ’å…¥çš„insert æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ï¼›</p></li><li><p>Com_update æ‰§è¡Œupdate æ“ä½œçš„æ¬¡æ•°ï¼›</p></li><li><p>Com_delete æ‰§è¡Œdelete æ“ä½œçš„æ¬¡æ•°ï¼›</p></li></ol><p>ä»¥ä¸‹å‡ ä¸ªå‚æ•°æ˜¯é’ˆå¯¹Innodb å­˜å‚¨å¼•æ“è®¡æ•°çš„ï¼Œç´¯åŠ çš„ç®—æ³•ä¹Ÿç•¥æœ‰ä¸åŒï¼š</p><ol><li><p>Innodb_rows_read select æŸ¥è¯¢è¿”å›çš„è¡Œæ•°ï¼›</p></li><li><p>Innodb_rows_inserted æ‰§è¡ŒInsert æ“ä½œæ’å…¥çš„è¡Œæ•°ï¼›</p></li><li><p>Innodb_rows_updated æ‰§è¡Œupdate æ“ä½œæ›´æ–°çš„è¡Œæ•°ï¼›</p></li><li><p>Innodb_rows_deleted æ‰§è¡Œdelete æ“ä½œåˆ é™¤çš„è¡Œæ•°ï¼›</p></li></ol><p>å¯¹äºäº‹åŠ¡å‹çš„åº”ç”¨ï¼Œé€šè¿‡Com_commit å’ŒCom_rollback å¯ä»¥äº†è§£äº‹åŠ¡æäº¤å’Œå›æ»šçš„æƒ…å†µï¼Œå¯¹äºå›æ»šæ“ä½œéå¸¸é¢‘ç¹çš„æ•°æ®åº“ï¼Œå¯èƒ½æ„å‘³ç€åº”ç”¨ç¼–å†™å­˜åœ¨é—®é¢˜ã€‚</p><p>æ­¤å¤–ï¼Œä»¥ä¸‹å‡ ä¸ªå‚æ•°ä¾¿äºæˆ‘ä»¬äº†è§£æ•°æ®åº“çš„åŸºæœ¬æƒ…å†µï¼š</p><ol><li><p>Connections è¯•å›¾è¿æ¥Mysql æœåŠ¡å™¨çš„æ¬¡æ•°</p></li><li><p>Uptime æœåŠ¡å™¨å·¥ä½œæ—¶é—´</p></li><li><p>Slow_queries æ…¢æŸ¥è¯¢çš„æ¬¡æ•°</p></li></ol><h3 id="å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL"><a href="#å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL" class="headerlink" title="å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL"></a>å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL</h3><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„SQL è¯­å¥ï¼š</p><ol><li><p>å¯ä»¥é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—å®šä½é‚£äº›æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„sql è¯­å¥ï¼Œç”¨â€“log-slowqueries[=file_name]é€‰é¡¹å¯åŠ¨æ—¶ï¼Œmysqld å†™ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_time ç§’çš„SQLè¯­å¥çš„æ—¥å¿—æ–‡ä»¶ã€‚å¯ä»¥é“¾æ¥åˆ°ç®¡ç†ç»´æŠ¤ä¸­çš„ç›¸å…³ç« èŠ‚ã€‚</p></li><li><p>æ…¢æŸ¥è¯¢æ—¥å¿—åœ¨æŸ¥è¯¢ç»“æŸä»¥åæ‰çºªå½•ï¼Œæ‰€ä»¥åœ¨åº”ç”¨åæ˜ æ‰§è¡Œæ•ˆç‡å‡ºç°é—®é¢˜çš„æ—¶å€™æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶ä¸èƒ½å®šä½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨show processlist å‘½ä»¤æŸ¥çœ‹å½“å‰MySQL åœ¨è¿›è¡Œçš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„çŠ¶æ€ï¼Œæ˜¯å¦é”è¡¨ç­‰ç­‰ï¼Œå¯ä»¥å®æ—¶çš„æŸ¥çœ‹SQL æ‰§è¡Œæƒ…å†µï¼ŒåŒæ—¶å¯¹ä¸€äº›é”è¡¨æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚</p></li></ol><h3 id="é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’"><a href="#é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’" class="headerlink" title="é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’"></a>é€šè¿‡explainåˆ†æä½æ•ˆSQLçš„æ‰§è¡Œè®¡åˆ’</h3><h4 id="select-typeï¼š-select-ç±»å‹"><a href="#select-typeï¼š-select-ç±»å‹" class="headerlink" title="select_typeï¼š select ç±»å‹"></a>select_typeï¼š select ç±»å‹</h4><p>Aï¼šsimpleï¼šè¡¨ç¤ºä¸éœ€è¦unionæ“ä½œæˆ–è€…ä¸åŒ…å«å­æŸ¥è¯¢çš„ç®€å•selectæŸ¥è¯¢ã€‚æœ‰è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¤–å±‚çš„æŸ¥è¯¢ä¸ºsimpleï¼Œä¸”åªæœ‰ä¸€ä¸ª</p><p>Bï¼šprimaryï¼šä¸€ä¸ªéœ€è¦unionæ“ä½œæˆ–è€…å«æœ‰å­æŸ¥è¯¢çš„selectï¼Œä½äºæœ€å¤–å±‚çš„å•ä½æŸ¥è¯¢çš„select_typeå³ä¸ºprimaryã€‚ä¸”åªæœ‰ä¸€ä¸ª</p><p>Cï¼šunionï¼šunionè¿æ¥çš„ä¸¤ä¸ªselectæŸ¥è¯¢ï¼Œç¬¬ä¸€ä¸ªæŸ¥è¯¢æ˜¯derviedæ´¾ç”Ÿè¡¨ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªè¡¨å¤–ï¼Œç¬¬äºŒä¸ªä»¥åçš„è¡¨select_typeéƒ½æ˜¯union</p><p>Dï¼šdependent unionï¼šä¸unionä¸€æ ·ï¼Œå‡ºç°åœ¨union æˆ–union allè¯­å¥ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæŸ¥è¯¢è¦å—åˆ°å¤–éƒ¨æŸ¥è¯¢çš„å½±å“</p><p>Eï¼šunion resultï¼šåŒ…å«unionçš„ç»“æœé›†ï¼Œåœ¨unionå’Œunion allè¯­å¥ä¸­,å› ä¸ºå®ƒä¸éœ€è¦å‚ä¸æŸ¥è¯¢ï¼Œæ‰€ä»¥idå­—æ®µä¸ºnull</p><p>Fï¼šsubqueryï¼šé™¤äº†fromå­—å¥ä¸­åŒ…å«çš„å­æŸ¥è¯¢å¤–ï¼Œå…¶ä»–åœ°æ–¹å‡ºç°çš„å­æŸ¥è¯¢éƒ½å¯èƒ½æ˜¯subquery</p><p>Gï¼šdependent subqueryï¼šä¸dependent unionç±»ä¼¼ï¼Œè¡¨ç¤ºè¿™ä¸ªsubqueryçš„æŸ¥è¯¢è¦å—åˆ°å¤–éƒ¨è¡¨æŸ¥è¯¢çš„å½±å“</p><p>Hï¼šderivedï¼šfromå­—å¥ä¸­å‡ºç°çš„å­æŸ¥è¯¢ï¼Œä¹Ÿå«åšæ´¾ç”Ÿè¡¨ï¼Œå…¶ä»–æ•°æ®åº“ä¸­å¯èƒ½å«åšå†…è”è§†å›¾æˆ–åµŒå¥—select</p><h4 id="tableï¼š-è¾“å‡ºç»“æœé›†çš„è¡¨"><a href="#tableï¼š-è¾“å‡ºç»“æœé›†çš„è¡¨" class="headerlink" title="tableï¼š è¾“å‡ºç»“æœé›†çš„è¡¨"></a>tableï¼š è¾“å‡ºç»“æœé›†çš„è¡¨</h4><p>æ˜¾ç¤ºçš„æŸ¥è¯¢è¡¨åï¼Œå¦‚æœæŸ¥è¯¢ä½¿ç”¨äº†åˆ«åï¼Œé‚£ä¹ˆè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯åˆ«åï¼Œå¦‚æœä¸æ¶‰åŠå¯¹æ•°æ®è¡¨çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™æ˜¾ç¤ºä¸ºnullï¼Œå¦‚æœæ˜¾ç¤ºä¸ºå°–æ‹¬å·æ‹¬èµ·æ¥çš„<derived n="">å°±è¡¨ç¤ºè¿™ä¸ªæ˜¯ä¸´æ—¶è¡¨ï¼Œåè¾¹çš„Nå°±æ˜¯æ‰§è¡Œè®¡åˆ’ä¸­çš„idï¼Œè¡¨ç¤ºç»“æœæ¥è‡ªäºè¿™ä¸ªæŸ¥è¯¢äº§ç”Ÿã€‚å¦‚æœæ˜¯å°–æ‹¬å·æ‹¬èµ·æ¥çš„<union m,n="">ï¼Œä¸<derived n="">ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œè¡¨ç¤ºè¿™ä¸ªç»“æœæ¥è‡ªäºunionæŸ¥è¯¢çš„idä¸ºM,Nçš„ç»“æœé›†ã€‚</derived></union></derived></p><h4 id="typeï¼š-è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹"><a href="#typeï¼š-è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹" class="headerlink" title="typeï¼š è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹"></a>typeï¼š è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹</h4><p>å½“è¡¨ä¸­ä»…æœ‰ä¸€è¡Œæ˜¯typeçš„å€¼ä¸ºsystemæ˜¯æœ€ä½³çš„è¿æ¥ç±»å‹ï¼›</p><p>å½“selectæ“ä½œä¸­ä½¿ç”¨ç´¢å¼•è¿›è¡Œè¡¨è¿æ¥æ—¶typeçš„å€¼ä¸ºrefï¼›</p><p>å½“selectçš„è¡¨è¿æ¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œç»å¸¸ä¼šçœ‹åˆ°typeçš„å€¼ä¸ºALLï¼Œè¡¨ç¤ºå¯¹è¯¥è¡¨è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘é€šè¿‡åˆ›å»ºç´¢å¼•æ¥æé«˜è¡¨è¿æ¥çš„æ•ˆç‡ã€‚</p><p>ä¾æ¬¡ä»å¥½åˆ°å·®ï¼šsystemï¼Œconstï¼Œeq_refï¼Œrefï¼Œfulltextï¼Œref_or_nullï¼Œunique_subqueryï¼Œindex_subqueryï¼Œrangeï¼Œindex_mergeï¼Œindexï¼ŒALLï¼Œé™¤äº†allä¹‹å¤–ï¼Œå…¶ä»–çš„typeéƒ½å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œé™¤äº†index_mergeä¹‹å¤–ï¼Œå…¶ä»–çš„typeåªå¯ä»¥ç”¨åˆ°ä¸€ä¸ªç´¢å¼•</p><p>Aï¼šsystemï¼šè¡¨ä¸­åªæœ‰ä¸€è¡Œæ•°æ®æˆ–è€…æ˜¯ç©ºè¡¨ï¼Œä¸”åªèƒ½ç”¨äºmyisamå’Œmemoryè¡¨ã€‚å¦‚æœæ˜¯Innodbå¼•æ“è¡¨ï¼Œtypeåˆ—åœ¨è¿™ä¸ªæƒ…å†µé€šå¸¸éƒ½æ˜¯allæˆ–è€…index</p><p>Bï¼šconstï¼šä½¿ç”¨å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ï¼Œè¿”å›è®°å½•ä¸€å®šæ˜¯1è¡Œè®°å½•çš„ç­‰å€¼whereæ¡ä»¶æ—¶ï¼Œé€šå¸¸typeæ˜¯constã€‚å…¶ä»–æ•°æ®åº“ä¹Ÿå«åšå”¯ä¸€ç´¢å¼•æ‰«æ</p><p>Cï¼šeq_refï¼šå‡ºç°åœ¨è¦è¿æ¥è¿‡ä¸ªè¡¨çš„æŸ¥è¯¢è®¡åˆ’ä¸­ï¼Œé©±åŠ¨è¡¨åªè¿”å›ä¸€è¡Œæ•°æ®ï¼Œä¸”è¿™è¡Œæ•°æ®æ˜¯ç¬¬äºŒä¸ªè¡¨çš„ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼Œä¸”å¿…é¡»ä¸ºnot nullï¼Œå”¯ä¸€ç´¢å¼•å’Œä¸»é”®æ˜¯å¤šåˆ—æ—¶ï¼Œåªæœ‰æ‰€æœ‰çš„åˆ—éƒ½ç”¨ä½œæ¯”è¾ƒæ—¶æ‰ä¼šå‡ºç°eq_ref</p><p>Dï¼šrefï¼šä¸åƒeq_refé‚£æ ·è¦æ±‚è¿æ¥é¡ºåºï¼Œä¹Ÿæ²¡æœ‰ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•çš„è¦æ±‚ï¼Œåªè¦ä½¿ç”¨ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ—¶å°±å¯èƒ½å‡ºç°ï¼Œå¸¸è§ä¸è¾…åŠ©ç´¢å¼•çš„ç­‰å€¼æŸ¥æ‰¾ã€‚æˆ–è€…å¤šåˆ—ä¸»é”®ã€å”¯ä¸€ç´¢å¼•ä¸­ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªåˆ—ä¹‹å¤–çš„åˆ—ä½œä¸ºç­‰å€¼æŸ¥æ‰¾ä¹Ÿä¼šå‡ºç°ï¼Œæ€»ä¹‹ï¼Œè¿”å›æ•°æ®ä¸å”¯ä¸€çš„ç­‰å€¼æŸ¥æ‰¾å°±å¯èƒ½å‡ºç°ã€‚</p><p>Eï¼šfulltextï¼šå…¨æ–‡ç´¢å¼•æ£€ç´¢ï¼Œè¦æ³¨æ„ï¼Œå…¨æ–‡ç´¢å¼•çš„ä¼˜å…ˆçº§å¾ˆé«˜ï¼Œè‹¥å…¨æ–‡ç´¢å¼•å’Œæ™®é€šç´¢å¼•åŒæ—¶å­˜åœ¨æ—¶ï¼Œmysqlä¸ç®¡ä»£ä»·ï¼Œä¼˜å…ˆé€‰æ‹©ä½¿ç”¨å…¨æ–‡ç´¢å¼•</p><p>Fï¼šref_or_nullï¼šä¸refæ–¹æ³•ç±»ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†nullå€¼çš„æ¯”è¾ƒã€‚å®é™…ç”¨çš„ä¸å¤šã€‚</p><p>Gï¼šunique_subqueryï¼šç”¨äºwhereä¸­çš„inå½¢å¼å­æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢è¿”å›ä¸é‡å¤å€¼å”¯ä¸€å€¼</p><p>Hï¼šindex_subqueryï¼šç”¨äºinå½¢å¼å­æŸ¥è¯¢ä½¿ç”¨åˆ°äº†è¾…åŠ©ç´¢å¼•æˆ–è€…inå¸¸æ•°åˆ—è¡¨ï¼Œå­æŸ¥è¯¢å¯èƒ½è¿”å›é‡å¤å€¼ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•å°†å­æŸ¥è¯¢å»é‡ã€‚</p><p>Iï¼šrangeï¼šç´¢å¼•èŒƒå›´æ‰«æï¼Œå¸¸è§äºä½¿ç”¨&gt;,&lt;,is null,between ,in ,likeç­‰è¿ç®—ç¬¦çš„æŸ¥è¯¢ä¸­ã€‚</p><p>Jï¼šindex_mergeï¼šè¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•ï¼Œæœ€åå–äº¤é›†æˆ–è€…å¹¶é›†ï¼Œå¸¸è§and ï¼Œorçš„æ¡ä»¶ä½¿ç”¨äº†ä¸åŒçš„ç´¢å¼•ï¼Œå®˜æ–¹æ’åºè¿™ä¸ªåœ¨ref_or_nullä¹‹åï¼Œä½†æ˜¯å®é™…ä¸Šç”±äºè¦è¯»å–æ‰€ä¸ªç´¢å¼•ï¼Œæ€§èƒ½å¯èƒ½å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸å¦‚range</p><p>Kï¼šindexï¼šç´¢å¼•å…¨è¡¨æ‰«æï¼ŒæŠŠç´¢å¼•ä»å¤´åˆ°å°¾æ‰«ä¸€éï¼Œå¸¸è§äºä½¿ç”¨ç´¢å¼•åˆ—å°±å¯ä»¥å¤„ç†ä¸éœ€è¦è¯»å–æ•°æ®æ–‡ä»¶çš„æŸ¥è¯¢ã€å¯ä»¥ä½¿ç”¨ç´¢å¼•æ’åºæˆ–è€…åˆ†ç»„çš„æŸ¥è¯¢ã€‚</p><p>Lï¼šallï¼šè¿™ä¸ªå°±æ˜¯å…¨è¡¨æ‰«ææ•°æ®æ–‡ä»¶ï¼Œç„¶åå†åœ¨serverå±‚è¿›è¡Œè¿‡æ»¤è¿”å›ç¬¦åˆè¦æ±‚çš„è®°å½•ã€‚</p><h4 id="possible-keysï¼š-è¡¨ç¤ºæŸ¥è¯¢æ—¶-å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—"><a href="#possible-keysï¼š-è¡¨ç¤ºæŸ¥è¯¢æ—¶-å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—" class="headerlink" title="possible_keysï¼š è¡¨ç¤ºæŸ¥è¯¢æ—¶,å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—."></a>possible_keysï¼š è¡¨ç¤ºæŸ¥è¯¢æ—¶,å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•åˆ—.</h4><h4 id="keyï¼š-è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•"><a href="#keyï¼š-è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•" class="headerlink" title="keyï¼š è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•"></a>keyï¼š è¡¨ç¤ºä½¿ç”¨çš„ç´¢å¼•</h4><h4 id="key-lenï¼š-ç´¢å¼•é•¿åº¦"><a href="#key-lenï¼š-ç´¢å¼•é•¿åº¦" class="headerlink" title="key_lenï¼š ç´¢å¼•é•¿åº¦"></a>key_lenï¼š ç´¢å¼•é•¿åº¦</h4><h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>å¦‚æœæ˜¯ä½¿ç”¨çš„å¸¸æ•°ç­‰å€¼æŸ¥è¯¢ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºconstï¼Œå¦‚æœæ˜¯è¿æ¥æŸ¥è¯¢ï¼Œè¢«é©±åŠ¨è¡¨çš„æ‰§è¡Œè®¡åˆ’è¿™é‡Œä¼šæ˜¾ç¤ºé©±åŠ¨è¡¨çš„å…³è”å­—æ®µï¼Œå¦‚æœæ˜¯æ¡ä»¶ä½¿ç”¨äº†è¡¨è¾¾å¼æˆ–è€…å‡½æ•°ï¼Œæˆ–è€…æ¡ä»¶åˆ—å‘ç”Ÿäº†å†…éƒ¨éšå¼è½¬æ¢ï¼Œè¿™é‡Œå¯èƒ½æ˜¾ç¤ºä¸ºfunc</p><h4 id="rowsï¼š-æ‰«æèŒƒå›´"><a href="#rowsï¼š-æ‰«æèŒƒå›´" class="headerlink" title="rowsï¼š æ‰«æèŒƒå›´"></a>rowsï¼š æ‰«æèŒƒå›´</h4><h4 id="Extraï¼š-æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°"><a href="#Extraï¼š-æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°" class="headerlink" title="Extraï¼š æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°"></a>Extraï¼š æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°</h4><p>Aï¼šdistinctï¼šåœ¨selectéƒ¨åˆ†ä½¿ç”¨äº†distincå…³é”®å­—</p><p>Bï¼šno tables usedï¼šä¸å¸¦fromå­—å¥çš„æŸ¥è¯¢æˆ–è€…From dualæŸ¥è¯¢</p><p>Cï¼šä½¿ç”¨not in()å½¢å¼å­æŸ¥è¯¢æˆ–not existsè¿ç®—ç¬¦çš„è¿æ¥æŸ¥è¯¢ï¼Œè¿™ç§å«åšåè¿æ¥ã€‚å³ï¼Œä¸€èˆ¬è¿æ¥æŸ¥è¯¢æ˜¯å…ˆæŸ¥è¯¢å†…è¡¨ï¼Œå†æŸ¥è¯¢å¤–è¡¨ï¼Œåè¿æ¥å°±æ˜¯å…ˆæŸ¥è¯¢å¤–è¡¨ï¼Œå†æŸ¥è¯¢å†…è¡¨ã€‚</p><p>Dï¼šusing filesortï¼šæ’åºæ—¶æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ä¸ªã€‚å¸¸è§äºorder byå’Œgroup byè¯­å¥ä¸­</p><p>Eï¼šusing indexï¼šæŸ¥è¯¢æ—¶ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›´æ¥é€šè¿‡ç´¢å¼•å°±å¯ä»¥è·å–æŸ¥è¯¢çš„æ•°æ®ã€‚</p><p>Fï¼šusing join bufferï¼ˆblock nested loopï¼‰ï¼Œusing join bufferï¼ˆbatched key accssï¼‰ï¼š5.6.xä¹‹åçš„ç‰ˆæœ¬ä¼˜åŒ–å…³è”æŸ¥è¯¢çš„BNLï¼ŒBKAç‰¹æ€§ã€‚ä¸»è¦æ˜¯å‡å°‘å†…è¡¨çš„å¾ªç¯æ•°é‡ä»¥åŠæ¯”è¾ƒé¡ºåºåœ°æ‰«ææŸ¥è¯¢ã€‚</p><p>Gï¼šusing sort_unionï¼Œusing_unionï¼Œusing intersectï¼Œusing sort_intersectionï¼š</p><p>using intersectï¼šè¡¨ç¤ºä½¿ç”¨andçš„å„ä¸ªç´¢å¼•çš„æ¡ä»¶æ—¶ï¼Œè¯¥ä¿¡æ¯è¡¨ç¤ºæ˜¯ä»å¤„ç†ç»“æœè·å–äº¤é›†</p><p>using unionï¼šè¡¨ç¤ºä½¿ç”¨orè¿æ¥å„ä¸ªä½¿ç”¨ç´¢å¼•çš„æ¡ä»¶æ—¶ï¼Œè¯¥ä¿¡æ¯è¡¨ç¤ºä»å¤„ç†ç»“æœè·å–å¹¶é›†</p><p>using sort_unionå’Œusing sort_intersectionï¼šä¸å‰é¢ä¸¤ä¸ªå¯¹åº”çš„ç±»ä¼¼ï¼Œåªæ˜¯ä»–ä»¬æ˜¯å‡ºç°åœ¨ç”¨andå’ŒoræŸ¥è¯¢ä¿¡æ¯é‡å¤§æ—¶ï¼Œå…ˆæŸ¥è¯¢ä¸»é”®ï¼Œç„¶åè¿›è¡Œæ’åºåˆå¹¶åï¼Œæ‰èƒ½è¯»å–è®°å½•å¹¶è¿”å›ã€‚</p><p>Hï¼šusing temporaryï¼šè¡¨ç¤ºä½¿ç”¨äº†ä¸´æ—¶è¡¨å­˜å‚¨ä¸­é—´ç»“æœã€‚ä¸´æ—¶è¡¨å¯ä»¥æ˜¯å†…å­˜ä¸´æ—¶è¡¨å’Œç£ç›˜ä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­çœ‹ä¸å‡ºæ¥ï¼Œéœ€è¦æŸ¥çœ‹statuså˜é‡ï¼Œused_tmp_tableï¼Œused_tmp_disk_tableæ‰èƒ½çœ‹å‡ºæ¥ã€‚</p><p>Iï¼šusing whereï¼šè¡¨ç¤ºå­˜å‚¨å¼•æ“è¿”å›çš„è®°å½•å¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œéœ€è¦åœ¨serverå±‚è¿›è¡Œè¿‡æ»¤ã€‚æŸ¥è¯¢æ¡ä»¶ä¸­åˆ†ä¸ºé™åˆ¶æ¡ä»¶å’Œæ£€æŸ¥æ¡ä»¶ï¼Œ5.6ä¹‹å‰ï¼Œå­˜å‚¨å¼•æ“åªèƒ½æ ¹æ®é™åˆ¶æ¡ä»¶æ‰«ææ•°æ®å¹¶è¿”å›ï¼Œç„¶åserverå±‚æ ¹æ®æ£€æŸ¥æ¡ä»¶è¿›è¡Œè¿‡æ»¤å†è¿”å›çœŸæ­£ç¬¦åˆæŸ¥è¯¢çš„æ•°æ®ã€‚5.6.xä¹‹åæ”¯æŒICPç‰¹æ€§ï¼Œå¯ä»¥æŠŠæ£€æŸ¥æ¡ä»¶ä¹Ÿä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚ï¼Œä¸ç¬¦åˆæ£€æŸ¥æ¡ä»¶å’Œé™åˆ¶æ¡ä»¶çš„æ•°æ®ï¼Œç›´æ¥ä¸è¯»å–ï¼Œè¿™æ ·å°±å¤§å¤§å‡å°‘äº†å­˜å‚¨å¼•æ“æ‰«æçš„è®°å½•æ•°é‡ã€‚extraåˆ—æ˜¾ç¤ºusing index condition</p><p>Jï¼šfirstmatch(tb_name)ï¼š5.6.xå¼€å§‹å¼•å…¥çš„ä¼˜åŒ–å­æŸ¥è¯¢çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œå¸¸è§äºwhereå­—å¥å«æœ‰in()ç±»å‹çš„å­æŸ¥è¯¢ã€‚å¦‚æœå†…è¡¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå°±å¯èƒ½å‡ºç°è¿™ä¸ª</p><p>Kï¼šloosescan(m..n)ï¼š5.6.xä¹‹åå¼•å…¥çš„ä¼˜åŒ–å­æŸ¥è¯¢çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œåœ¨in()ç±»å‹çš„å­æŸ¥è¯¢ä¸­ï¼Œå­æŸ¥è¯¢è¿”å›çš„å¯èƒ½æœ‰é‡å¤è®°å½•æ—¶ï¼Œå°±å¯èƒ½å‡ºç°è¿™ä¸ª</p><p>é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šæŸ¥è¯¢æ•°æ®å­—å…¸åº“ï¼Œæ‰§è¡Œè®¡åˆ’è¿‡ç¨‹ä¸­å°±å‘ç°ä¸å¯èƒ½å­˜åœ¨ç»“æœçš„ä¸€äº›æç¤ºä¿¡æ¯</p><h3 id="ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½"><a href="#ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½" class="headerlink" title="ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½"></a>ç¡®å®šé—®é¢˜å¹¶é‡‡å–å“åº”çš„ä¼˜åŒ–æªæ–½</h3><h3 id="ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»"><a href="#ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»" class="headerlink" title="ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»"></a>ç´¢å¼•çš„å­˜å‚¨åˆ†ç±»</h3><p>myisam è¡¨çš„æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶æ˜¯è‡ªåŠ¨åˆ†å¼€çš„ï¼›innodb çš„æ•°æ®å’Œç´¢å¼•æ˜¯å­˜å‚¨åœ¨<br>åŒä¸€ä¸ªè¡¨ç©ºé—´é‡Œé¢ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶ç»„æˆã€‚<br>åˆ›å»ºç´¢å¼•è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE [UNIQUE|FULLTEXT|SPATIAL] INDEX index_name</span><br><span class="line">[USING index_type]</span><br><span class="line">ON tbl_name (index_col_name,...)</span><br><span class="line">index_col_name:</span><br><span class="line">col_name [(length)] [ASC | DESC]</span><br></pre></td></tr></table></figure><p>ç´¢å¼•çš„å­˜å‚¨ç±»å‹ç›®å‰åªæœ‰ä¸¤ç§ï¼ˆbtree å’Œhashï¼‰ï¼Œå…·ä½“å’Œè¡¨çš„æ¨¡å¼ç›¸å…³ï¼š</p><p>myisam btree</p><p>innodb btree</p><p>memory/heap hashï¼Œbtree</p><p>mysql ç›®å‰ä¸æ”¯æŒå‡½æ•°ç´¢å¼•ï¼Œåªèƒ½å¯¹åˆ—çš„å‰ä¸€éƒ¨åˆ†ï¼ˆlengthï¼‰è¿›è¡Œç´¢å¼•ï¼Œä¾‹ï¼š</p><p><code>create index ind_test on table1(name(5))</code></p><p>å¯¹äºchar å’Œvarchar åˆ—ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•å°†å¤§å¤§èŠ‚çœç©ºé—´ã€‚</p><h3 id="MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•"><a href="#MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•" class="headerlink" title="MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•"></a>MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•</h3><p>ç´¢å¼•ç”¨äºå¿«é€Ÿæ‰¾å‡ºåœ¨æŸä¸ªåˆ—ä¸­æœ‰ä¸€ç‰¹å®šå€¼çš„è¡Œã€‚å¯¹ç›¸å…³åˆ—ä½¿ç”¨ç´¢å¼•æ˜¯æé«˜SELECT æ“ä½œæ€§èƒ½çš„æœ€ä½³é€”å¾„ã€‚</p><p>æŸ¥è¯¢è¦ä½¿ç”¨ç´¢å¼•æœ€ä¸»è¦çš„æ¡ä»¶æ˜¯æŸ¥è¯¢æ¡ä»¶ä¸­éœ€è¦ä½¿ç”¨ç´¢å¼•å…³é”®å­—ï¼Œå¦‚æœæ˜¯å¤šåˆ—ç´¢å¼•ï¼Œé‚£ä¹ˆåªæœ‰æŸ¥è¯¢æ¡ä»¶ä½¿ç”¨äº†å¤šåˆ—å…³é”®å­—æœ€å·¦è¾¹çš„å‰ç¼€æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œå¦åˆ™å°†ä¸èƒ½ä½¿ç”¨ç´¢å¼•ã€‚</p><p>ä¸‹åˆ—æƒ…å†µä¸‹ï¼ŒMysql ä¸ä¼šä½¿ç”¨å·²æœ‰çš„ç´¢å¼•ï¼š</p><p>1.å¦‚æœmysql ä¼°è®¡ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ‰«ææ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ä¾‹å¦‚ï¼šå¦‚æœkey_part1å‡åŒ€åˆ†å¸ƒåœ¨1 å’Œ100 ä¹‹é—´ï¼Œä¸‹åˆ—æŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•å°±ä¸æ˜¯å¾ˆå¥½ï¼š</p><p><code>SELECT * FROM table_name where key_part1 &gt; 1 and key_part1 &lt; 90</code></p><p>2.å¦‚æœä½¿ç”¨heap è¡¨å¹¶ä¸”where æ¡ä»¶ä¸­ä¸ç”¨ï¼ç´¢å¼•åˆ—ï¼Œå…¶ä»–&gt; ã€&lt;ã€&gt;=ã€&lt;=å‡ä¸ä½¿ç”¨ç´¢å¼•ï¼›</p><p>3.å¦‚æœä¸æ˜¯ç´¢å¼•åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ï¼›</p><p>4.å¦‚æœlike æ˜¯ä»¥ï¼…å¼€å§‹ï¼›</p><p>5.å¯¹where åè¾¹æ¡ä»¶ä¸ºå­—ç¬¦ä¸²çš„ä¸€å®šè¦åŠ å¼•å·ï¼Œå­—ç¬¦ä¸²å¦‚æœä¸ºæ•°å­—mysql ä¼šè‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸ä½¿ç”¨ç´¢å¼•ã€‚</p><h3 id="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ</h3><p>å¦‚æœç´¢å¼•æ­£åœ¨å·¥ä½œï¼ŒHandler_read_key çš„å€¼å°†å¾ˆé«˜ï¼Œè¿™ä¸ªå€¼ä»£è¡¨äº†ä¸€ä¸ªè¡Œè¢«ç´¢å¼•å€¼è¯»çš„æ¬¡æ•°ï¼Œå¾ˆä½çš„å€¼è¡¨æ˜å¢åŠ ç´¢å¼•å¾—åˆ°çš„æ€§èƒ½æ”¹å–„ä¸é«˜ï¼Œå› ä¸ºç´¢å¼•å¹¶ä¸ç»å¸¸ä½¿ç”¨ã€‚</p><p>Handler_read_rnd_next çš„å€¼é«˜åˆ™æ„å‘³ç€æŸ¥è¯¢è¿è¡Œä½æ•ˆï¼Œå¹¶ä¸”åº”è¯¥å»ºç«‹ç´¢å¼•è¡¥æ•‘ã€‚è¿™ä¸ªå€¼çš„å«ä¹‰æ˜¯åœ¨æ•°æ®æ–‡ä»¶ä¸­è¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£è¿›è¡Œå¤§é‡çš„è¡¨æ‰«æï¼Œè¯¥å€¼è¾ƒé«˜ã€‚é€šå¸¸è¯´æ˜è¡¨ç´¢å¼•ä¸æ­£ç¡®æˆ–å†™å…¥çš„æŸ¥è¯¢æ²¡æœ‰åˆ©ç”¨ç´¢å¼•ã€‚</p><p><code>show status like &#39;Handler_read%&#39;;</code></p><h3 id="å®šæœŸåˆ†æè¡¨"><a href="#å®šæœŸåˆ†æè¡¨" class="headerlink" title="å®šæœŸåˆ†æè¡¨"></a>å®šæœŸåˆ†æè¡¨</h3><h4 id="ANALYZE-TABLE"><a href="#ANALYZE-TABLE" class="headerlink" title="ANALYZE TABLE"></a>ANALYZE TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</code></p><p>æœ¬è¯­å¥ç”¨äºåˆ†æå’Œå­˜å‚¨è¡¨çš„å…³é”®å­—åˆ†å¸ƒã€‚åœ¨åˆ†ææœŸé—´ï¼Œä½¿ç”¨ä¸€ä¸ªè¯»å–é”å®šå¯¹è¡¨è¿›è¡Œé”å®šã€‚è¿™å¯¹äºMyISAM, BDB å’ŒInnoDB è¡¨æœ‰ä½œç”¨ã€‚å¯¹äºMyISAM è¡¨ï¼Œæœ¬è¯­å¥ä¸ä½¿ç”¨myisamchk -a ç›¸å½“ã€‚</p><h4 id="CHECK-TABLE"><a href="#CHECK-TABLE" class="headerlink" title="CHECK TABLE"></a>CHECK TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>CHECK TABLE tbl_name [, tbl_name] ... [option] ...</code></p><p><code>option = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED}</code></p><p>æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨æ˜¯å¦æœ‰é”™è¯¯ã€‚CHECK TABLE å¯¹MyISAM å’ŒInnoDB è¡¨æœ‰ä½œç”¨ã€‚å¯¹äºMyISAM è¡¨ï¼Œå…³é”®å­—ç»Ÿè®¡æ•°æ®è¢«æ›´æ–°ã€‚</p><p>CHECK TABLE ä¹Ÿå¯ä»¥æ£€æŸ¥è§†å›¾æ˜¯å¦æœ‰é”™è¯¯ï¼Œæ¯”å¦‚åœ¨è§†å›¾å®šä¹‰ä¸­è¢«å¼•ç”¨çš„è¡¨å·²ä¸å­˜åœ¨ã€‚</p><h4 id="CHECKSUM-TABLE"><a href="#CHECKSUM-TABLE" class="headerlink" title="CHECKSUM TABLE"></a>CHECKSUM TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>CHECKSUM TABLE tbl_name [, tbl_name] ... [ QUICK | EXTENDED ]</code></p><p>æŠ¥å‘Šä¸€ä¸ªè¡¨æ ¡éªŒå’Œã€‚</p><h3 id="ä½¿ç”¨optimize-table"><a href="#ä½¿ç”¨optimize-table" class="headerlink" title="ä½¿ç”¨optimize table"></a>ä½¿ç”¨optimize table</h3><h4 id="OPTIMIZE-TABLE"><a href="#OPTIMIZE-TABLE" class="headerlink" title="OPTIMIZE TABLE"></a>OPTIMIZE TABLE</h4><p>è¯­æ³•ï¼š</p><p><code>OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</code></p><p>å¦‚æœå·²ç»åˆ é™¤äº†è¡¨çš„ä¸€å¤§éƒ¨åˆ†ï¼Œæˆ–è€…å¦‚æœæ‚¨å·²ç»å¯¹å«æœ‰å¯å˜é•¿åº¦è¡Œçš„è¡¨ï¼ˆå«æœ‰VARCHAR, BLOB æˆ–TEXT åˆ—çš„è¡¨ï¼‰è¿›è¡Œäº†å¾ˆå¤šæ›´æ”¹ï¼Œåˆ™åº”ä½¿ç”¨OPTIMIZE TABLEã€‚è¢«åˆ é™¤çš„è®°å½•è¢«ä¿æŒåœ¨é“¾æ¥æ¸…å•ä¸­ï¼Œåç»­çš„INSERT æ“ä½œä¼šé‡æ–°ä½¿ç”¨æ—§çš„è®°å½•ä½ç½®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨OPTIMIZE TABLE æ¥é‡æ–°åˆ©ç”¨æœªä½¿ç”¨çš„ç©ºé—´ï¼Œå¹¶æ•´ç†æ•°æ®æ–‡ä»¶çš„ç¢ç‰‡ã€‚</p><p>OPTIMIZE TABLE åªå¯¹MyISAM, BDB å’ŒInnoDB è¡¨èµ·ä½œç”¨ã€‚</p><h3 id="å¤§æ‰¹é‡æ’å…¥æ•°æ®"><a href="#å¤§æ‰¹é‡æ’å…¥æ•°æ®" class="headerlink" title="å¤§æ‰¹é‡æ’å…¥æ•°æ®"></a>å¤§æ‰¹é‡æ’å…¥æ•°æ®</h3><h4 id="å¯¹äºMyisam-ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚"><a href="#å¯¹äºMyisam-ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚" class="headerlink" title="å¯¹äºMyisam ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚"></a>å¯¹äºMyisam ç±»å‹çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿçš„å¯¼å…¥å¤§é‡çš„æ•°æ®ã€‚</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tblname DISABLE KEYS;</span><br><span class="line">loading the data</span><br><span class="line">ALTER TABLE tblname ENABLE KEYS;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå‘½ä»¤ç”¨æ¥æ‰“å¼€æˆ–è€…å…³é—­Myisam è¡¨éå”¯ä¸€ç´¢å¼•çš„æ›´æ–°ã€‚åœ¨å¯¼å…¥å¤§é‡çš„æ•°æ®åˆ°ä¸€ä¸ªéç©ºçš„Myisam è¡¨æ—¶ï¼Œé€šè¿‡è®¾ç½®è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚å¯¹äºå¯¼å…¥å¤§é‡æ•°æ®åˆ°ä¸€ä¸ªç©ºçš„Myisam è¡¨ï¼Œé»˜è®¤å°±æ˜¯å…ˆå¯¼å…¥æ•°æ®ç„¶åæ‰åˆ›å»ºç´¢å¼•çš„ï¼Œæ‰€ä»¥ä¸ç”¨è¿›è¡Œè®¾ç½®ã€‚</p><h4 id="è€Œå¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š"><a href="#è€Œå¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb-ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š" class="headerlink" title="è€Œå¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š"></a>è€Œå¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸èƒ½æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¯¹äºInnodb ç±»å‹çš„è¡¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š</h4><p>a. å› ä¸ºInnodb ç±»å‹çš„è¡¨æ˜¯æŒ‰ç…§ä¸»é”®çš„é¡ºåºä¿å­˜çš„ï¼Œæ‰€ä»¥å°†å¯¼å…¥çš„æ•°æ®æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’åˆ—ï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¦‚æœInnodb è¡¨æ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªå†…éƒ¨åˆ—ä½œä¸ºä¸»é”®ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥ç»™è¡¨åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œå°†å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¼˜åŠ¿æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚</p><p>b. åœ¨å¯¼å…¥æ•°æ®å‰æ‰§è¡ŒSET UNIQUE_CHECKS=0ï¼Œå…³é—­å”¯ä¸€æ€§æ ¡éªŒï¼Œåœ¨å¯¼å…¥ç»“æŸåæ‰§è¡ŒSETUNIQUE_CHECKS=1ï¼Œæ¢å¤å”¯ä¸€æ€§æ ¡éªŒï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p><p>c. å¦‚æœåº”ç”¨ä½¿ç”¨è‡ªåŠ¨æäº¤çš„æ–¹å¼ï¼Œå»ºè®®åœ¨å¯¼å…¥å‰æ‰§è¡ŒSET AUTOCOMMIT=0ï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼Œå¯¼å…¥ç»“æŸåå†æ‰§è¡ŒSET AUTOCOMMIT=1ï¼Œæ‰“å¼€è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p><h3 id="ä¼˜åŒ–insertè¯­å¥"><a href="#ä¼˜åŒ–insertè¯­å¥" class="headerlink" title="ä¼˜åŒ–insertè¯­å¥"></a>ä¼˜åŒ–insertè¯­å¥</h3><p>å¦‚æœä½ åŒæ—¶ä»åŒä¸€å®¢æˆ·æ’å…¥å¾ˆå¤šè¡Œï¼Œä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„INSERT è¯­å¥ã€‚è¿™æ¯”ä½¿ç”¨åˆ†å¼€INSERT è¯­å¥å¿«(åœ¨ä¸€äº›æƒ…å†µä¸­å‡ å€)ã€‚</p><p><code>Insert into test values(1,2),(1,3),(1,4)â€¦</code></p><p>å¦‚æœä½ ä»ä¸åŒå®¢æˆ·æ’å…¥å¾ˆå¤šè¡Œï¼Œèƒ½é€šè¿‡ä½¿ç”¨INSERT DELAYED è¯­å¥å¾—åˆ°æ›´é«˜çš„é€Ÿåº¦ã€‚Delayed çš„å«ä¹‰æ˜¯è®©insert è¯­å¥é©¬ä¸Šæ‰§è¡Œï¼Œå…¶å®æ•°æ®éƒ½è¢«æ”¾åœ¨å†…å­˜çš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å†™å…¥ç£ç›˜ï¼›è¿™æ¯”æ¯æ¡è¯­å¥åˆ†åˆ«æ’å…¥è¦å¿«çš„å¤šï¼›LOW_PRIORITY åˆšå¥½ç›¸åï¼Œåœ¨æ‰€æœ‰å…¶ä»–ç”¨æˆ·å¯¹è¡¨çš„è¯»å†™å®Œåæ‰è¿›è¡Œæ’å…¥ã€‚</p><p><code>Insert delayed into test values(1,2),(1,3),(1,4)â€¦</code></p><p><code>Insert low_priority into test values(1,2),(1,3),(1,4)â€¦</code></p><p>å°†ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶åˆ†åœ¨ä¸åŒçš„ç£ç›˜ä¸Šå­˜æ”¾ï¼ˆåˆ©ç”¨å»ºè¡¨ä¸­çš„é€‰é¡¹ï¼‰ã€‚</p><p>å¦‚æœè¿›è¡Œæ‰¹é‡æ’å…¥ï¼Œå¯ä»¥å¢åŠ bulk_insert_buffer_size å˜é‡å€¼çš„æ–¹æ³•æ¥æé«˜é€Ÿåº¦ï¼Œä½†æ˜¯ï¼Œè¿™åªèƒ½å¯¹myisam è¡¨ä½¿ç”¨ã€‚</p><p>åœ¨my.cnfä¸­æ·»åŠ å¦‚ä¸‹è¯­å¥ï¼Œå°†insertè¯­å¥çš„é•¿åº¦è®¾ä¸ºæœ€å¤§ã€‚</p><p><code>Max_allowed_packet=1M</code></p><p><code>Net_buffer_length=2k</code></p><p>å½“ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶è£…è½½ä¸€ä¸ªè¡¨æ—¶ï¼Œä½¿ç”¨LOAD DATA INFILEã€‚è¿™é€šå¸¸æ¯”ä½¿ç”¨å¾ˆå¤šINSERT è¯­å¥å¿«20 å€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//æ•°æ®</span><br><span class="line"></span><br><span class="line">1669,Jim,Smith</span><br><span class="line">337,Mary,Jones</span><br><span class="line">2005,Linda,Black</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹è¯­å¥ï¼š</span><br><span class="line"></span><br><span class="line">load data infile &quot;/data/mysql/e.sql&quot; into table tablename fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure><p>æ ¹æ®åº”ç”¨æƒ…å†µä½¿ç”¨replace è¯­å¥ä»£æ›¿insertã€‚<code>replace low_priority into ta values(1,2);</code><br>replaceå…·å¤‡æ›¿æ¢æ‹¥æœ‰å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•é‡å¤æ•°æ®çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½¿ç”¨replaceintoæ’å…¥çš„æ•°æ®çš„å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•ä¸ä¹‹å‰çš„æ•°æ®æœ‰é‡å¤çš„æƒ…å†µï¼Œå°†ä¼šåˆ é™¤åŸå…ˆçš„æ•°æ®ï¼Œç„¶åå†è¿›è¡Œæ·»åŠ ã€‚</p><p>æ ¹æ®åº”ç”¨æƒ…å†µä½¿ç”¨ignore å…³é”®å­—å¿½ç•¥é‡å¤è®°å½•ã€‚<br><code>insert ignore into</code><br>å½“æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚å‡ºç°é”™è¯¯æ—¶ï¼Œå¦‚é‡å¤æ•°æ®ï¼Œå°†ä¸è¿”å›é”™è¯¯ï¼Œåªä»¥è­¦å‘Šå½¢å¼è¿”å›ã€‚æ‰€ä»¥ä½¿ç”¨ignoreè¯·ç¡®ä¿è¯­å¥æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œå¦åˆ™ä¹Ÿä¼šè¢«å¿½ç•¥æ‰ã€‚ä¾‹å¦‚ï¼š<code>INSERT IGNORE INTO books (name) VALUES (&#39;MySQL Manual&#39;)</code></p><h3 id="ä¼˜åŒ–group-byè¯­å¥"><a href="#ä¼˜åŒ–group-byè¯­å¥" class="headerlink" title="ä¼˜åŒ–group byè¯­å¥"></a>ä¼˜åŒ–group byè¯­å¥</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL æ’åºæ‰€æœ‰GROUP BY col1ï¼Œcol2ï¼Œâ€¦.ã€‚æŸ¥è¯¢çš„æ–¹æ³•å¦‚åŒåœ¨æŸ¥è¯¢ä¸­æŒ‡å®šORDER BY col1ï¼Œcol2ï¼Œâ€¦ã€‚å¦‚æœæ˜¾å¼åŒ…æ‹¬ä¸€ä¸ªåŒ…å«ç›¸åŒçš„åˆ—çš„ORDER BYå­å¥ï¼ŒMySQL å¯ä»¥æ¯«ä¸å‡é€Ÿåœ°å¯¹å®ƒè¿›è¡Œä¼˜åŒ–ï¼Œå°½ç®¡ä»ç„¶è¿›è¡Œæ’åºã€‚</p><p>å¦‚æœæŸ¥è¯¢åŒ…æ‹¬GROUP BY ä½†ä½ æƒ³è¦é¿å…æ’åºç»“æœçš„æ¶ˆè€—ï¼Œä½ å¯ä»¥æŒ‡å®šORDER BY NULLç¦æ­¢æ’åºã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">INSERT INTO foo</span><br><span class="line">SELECT a, COUNT(*) FROM bar GROUP BY a ORDER BY NULL;</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–order-byè¯­å¥"><a href="#ä¼˜åŒ–order-byè¯­å¥" class="headerlink" title="ä¼˜åŒ–order byè¯­å¥"></a>ä¼˜åŒ–order byè¯­å¥</h3><p>åœ¨æŸäº›æƒ…å†µä¸­ï¼ŒMySQL å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥æ»¡è¶³ORDER BY å­å¥ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„æ’åºã€‚where æ¡ä»¶å’Œorder by ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•ï¼Œå¹¶ä¸”order byçš„é¡ºåºå’Œç´¢å¼•é¡ºåºç›¸åŒï¼Œå¹¶ä¸”order byçš„å­—æ®µéƒ½æ˜¯å‡åºæˆ–è€…éƒ½æ˜¯é™åºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼šä¸‹åˆ—sql å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼š</span><br><span class="line">SELECT * FROM t1 ORDER BY key_part1,key_part2,... ;</span><br><span class="line">SELECT * FROM t1 WHERE key_part1=1 ORDER BY key_part1 DESC, key_part2</span><br><span class="line">DESC;</span><br><span class="line">SELECT * FROM t1 ORDER BY key_part1 DESC, key_part2 DESC;</span><br><span class="line">ä½†æ˜¯ä»¥ä¸‹æƒ…å†µä¸ä½¿ç”¨ç´¢å¼•ï¼š</span><br><span class="line">SELECT * FROM t1 ORDER BY key_part1 DESC, key_part2 ASC;</span><br><span class="line">--order by çš„å­—æ®µæ··åˆASC å’ŒDESC</span><br><span class="line">SELECT * FROM t1 WHERE key2=constant ORDER BY key1;</span><br><span class="line">--ç”¨äºæŸ¥è¯¢è¡Œçš„å…³é”®å­—ä¸ORDER BY ä¸­æ‰€ä½¿ç”¨çš„ä¸ç›¸åŒ</span><br><span class="line">SELECT * FROM t1 ORDER BY key1, key2;</span><br><span class="line">--å¯¹ä¸åŒçš„å…³é”®å­—ä½¿ç”¨ORDER BYã€‚</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–joinè¯­å¥"><a href="#ä¼˜åŒ–joinè¯­å¥" class="headerlink" title="ä¼˜åŒ–joinè¯­å¥"></a>ä¼˜åŒ–joinè¯­å¥</h3><p>Mysql4.1 å¼€å§‹æ”¯æŒSQL çš„å­æŸ¥è¯¢ã€‚è¿™ä¸ªæŠ€æœ¯å¯ä»¥ä½¿ç”¨SELECT è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„SQL æ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»ï¼Œå¹¶ä¸”å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢å¯ä»¥è¢«æ›´æœ‰æ•ˆç‡çš„è¿æ¥(JOIN)..æ›¿ä»£ã€‚</p><p>å‡è®¾æˆ‘ä»¬è¦å°†æ‰€æœ‰æ²¡æœ‰è®¢å•è®°å½•çš„ç”¨æˆ·å–å‡ºæ¥ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢å®Œæˆï¼š</p><p><code>SELECT * FROM customerinfo WHERE CustomerID NOT in (SELECT CustomerIDFROM salesinfo)</code></p><p>å¦‚æœä½¿ç”¨è¿æ¥(JOIN).. æ¥å®Œæˆè¿™ä¸ªæŸ¥è¯¢å·¥ä½œï¼Œé€Ÿåº¦å°†ä¼šå¿«å¾ˆå¤šã€‚å°¤å…¶æ˜¯å½“salesinfoè¡¨ä¸­å¯¹CustomerID å»ºæœ‰ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°†ä¼šæ›´å¥½ï¼ŒæŸ¥è¯¢å¦‚ä¸‹ï¼š</p><p><code>SELECT * FROM customerinfo LEFT JOIN salesinfoON customerinfo.CustomerID=salesinfo.CustomerID WHERE salesinfo.CustomerID IS NULL</code></p><p>è¿æ¥(JOIN).. ä¹‹æ‰€ä»¥æ›´æœ‰æ•ˆç‡ä¸€äº›ï¼Œæ˜¯å› ä¸ºMySQL ä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨æ¥å®Œæˆè¿™ä¸ªé€»è¾‘ä¸Šçš„éœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œã€‚</p><h3 id="mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶"><a href="#mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶" class="headerlink" title="mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶"></a>mysqlå¦‚ä½•ä¼˜åŒ–oræ¡ä»¶</h3><p>å¯¹äºor å­å¥ï¼Œå¦‚æœè¦åˆ©ç”¨ç´¢å¼•ï¼Œåˆ™or ä¹‹é—´çš„æ¯ä¸ªæ¡ä»¶åˆ—éƒ½å¿…é¡»ç”¨åˆ°ç´¢å¼•ï¼›å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œåˆ™åº”è¯¥è€ƒè™‘å¢åŠ ç´¢å¼•ã€‚</p><h3 id="æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ"><a href="#æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ" class="headerlink" title="æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ"></a>æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆ</h3><p>MySQL è¿˜å…è®¸æ”¹å˜è¯­å¥è°ƒåº¦çš„ä¼˜å…ˆçº§ï¼Œå®ƒå¯ä»¥ä½¿æ¥è‡ªå¤šä¸ªå®¢æˆ·ç«¯çš„æŸ¥è¯¢æ›´å¥½åœ°åä½œï¼Œè¿™æ ·å•ä¸ªå®¢æˆ·ç«¯å°±ä¸ä¼šç”±äºé”å®šè€Œç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚æ”¹å˜ä¼˜å…ˆçº§è¿˜å¯ä»¥ç¡®ä¿ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¢«å¤„ç†å¾—æ›´å¿«ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆåº”è¯¥ç¡®å®šåº”ç”¨çš„ç±»å‹ï¼Œåˆ¤æ–­åº”ç”¨æ˜¯ä»¥æŸ¥è¯¢ä¸ºä¸»è¿˜æ˜¯ä»¥æ›´æ–°ä¸ºä¸»çš„ï¼Œæ˜¯ç¡®ä¿æŸ¥è¯¢æ•ˆç‡è¿˜æ˜¯ç¡®ä¿æ›´æ–°çš„æ•ˆç‡ï¼Œå†³å®šæ˜¯æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æåˆ°çš„æ”¹å˜è°ƒåº¦ç­–ç•¥çš„æ–¹æ³•ä¸»è¦æ˜¯é’ˆå¯¹Myisam å­˜å‚¨å¼•æ“çš„ï¼Œå¯¹äºInnodb å­˜å‚¨å¼•æ“ï¼Œè¯­å¥çš„æ‰§è¡Œæ˜¯ç”±è·å¾—è¡Œé”çš„é¡ºåºå†³å®šçš„ã€‚</p><p>MySQL çš„é»˜è®¤çš„è°ƒåº¦ç­–ç•¥å¯ç”¨æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><p>å†™å…¥æ“ä½œä¼˜å…ˆäºè¯»å–æ“ä½œã€‚</p></li><li><p>å¯¹æŸå¼ æ•°æ®è¡¨çš„å†™å…¥æ“ä½œæŸä¸€æ—¶åˆ»åªèƒ½å‘ç”Ÿä¸€æ¬¡ï¼Œå†™å…¥è¯·æ±‚æŒ‰ç…§å®ƒä»¬åˆ°è¾¾çš„æ¬¡åºæ¥å¤„ç†ã€‚</p></li><li><p>å¯¹æŸå¼ æ•°æ®è¡¨çš„å¤šä¸ªè¯»å–æ“ä½œå¯ä»¥åŒæ—¶åœ°è¿›è¡Œã€‚</p></li></ol><p>MySQL æä¾›äº†å‡ ä¸ªè¯­å¥è°ƒèŠ‚ç¬¦ï¼Œå…è®¸ä½ ä¿®æ”¹å®ƒçš„è°ƒåº¦ç­–ç•¥ï¼š</p><ol><li><p>LOW_PRIORITYå…³é”®å­—åº”ç”¨äºDELETEã€INSERTã€LOAD DATAã€REPLACEå’ŒUPDATEã€‚</p></li><li><p>HIGH_PRIORITYå…³é”®å­—åº”ç”¨äºSELECTå’ŒINSERTè¯­å¥ã€‚</p></li><li><p>DELAYEDå…³é”®å­—åº”ç”¨äºINSERTå’ŒREPLACEè¯­å¥ã€‚</p></li></ol><p>å¦‚æœå†™å…¥æ“ä½œæ˜¯ä¸€ä¸ªLOW_PRIORITYï¼ˆä½ä¼˜å…ˆçº§ï¼‰è¯·æ±‚ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¸ä¼šè®¤ä¸ºå®ƒçš„ä¼˜å…ˆçº§é«˜äºè¯»å–æ“ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå†™å…¥è€…åœ¨ç­‰å¾…çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªè¯»å–è€…åˆ°è¾¾äº†ï¼Œé‚£ä¹ˆå°±å…è®¸ç¬¬äºŒä¸ªè¯»å–è€…æ’åˆ°å†™å…¥è€…ä¹‹å‰ã€‚åªæœ‰åœ¨æ²¡æœ‰å…¶å®ƒçš„è¯»å–è€…çš„æ—¶å€™ï¼Œæ‰å…è®¸å†™å…¥è€…å¼€å§‹æ“ä½œã€‚è¿™ç§è°ƒåº¦ä¿®æ”¹å¯èƒ½å­˜åœ¨LOW_PRIORITY å†™å…¥æ“ä½œæ°¸è¿œè¢«é˜»å¡çš„æƒ…å†µã€‚</p><p>SELECT æŸ¥è¯¢çš„HIGH_PRIORITYï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰å…³é”®å­—ä¹Ÿç±»ä¼¼ã€‚å®ƒå…è®¸SELECT æ’å…¥æ­£åœ¨ç­‰å¾…çš„å†™å…¥æ“ä½œä¹‹å‰ï¼Œå³ä½¿åœ¨æ­£å¸¸æƒ…å†µä¸‹å†™å…¥æ“ä½œçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚å¦å¤–ä¸€ç§å½±å“æ˜¯ï¼Œé«˜ä¼˜å…ˆçº§çš„SELECT åœ¨æ­£å¸¸çš„SELECT è¯­å¥ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºè¿™äº›è¯­å¥ä¼šè¢«å†™å…¥æ“ä½œé˜»å¡ã€‚</p><p>å¦‚æœä½ å¸Œæœ›æ‰€æœ‰æ”¯æŒLOW_PRIORITY é€‰é¡¹çš„è¯­å¥éƒ½é»˜è®¤åœ°æŒ‰ç…§ä½ä¼˜å…ˆçº§æ¥å¤„ç†ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨â€“low-priority-updates é€‰é¡¹æ¥å¯åŠ¨æœåŠ¡å™¨ã€‚é€šè¿‡ä½¿ç”¨INSERT HIGH_PRIORITY æ¥æŠŠINSERT è¯­å¥æé«˜åˆ°æ­£å¸¸çš„å†™å…¥ä¼˜å…ˆçº§ï¼Œå¯ä»¥æ¶ˆé™¤è¯¥é€‰é¡¹å¯¹å•ä¸ªINSERT è¯­å¥çš„å½±å“ã€‚</p><h3 id="ä½¿ç”¨SQLæç¤º"><a href="#ä½¿ç”¨SQLæç¤º" class="headerlink" title="ä½¿ç”¨SQLæç¤º"></a>ä½¿ç”¨SQLæç¤º</h3><p><code>SELECT SQL_BUFFER_RESULTS ...</code></p><p>å°†å¼ºåˆ¶MySQL ç”Ÿæˆä¸€ä¸ªä¸´æ—¶ç»“æœé›†ã€‚åªè¦æ‰€æœ‰ä¸´æ—¶ç»“æœé›†ç”Ÿæˆåï¼Œæ‰€æœ‰è¡¨ä¸Šçš„é”å®šå‡è¢«é‡Šæ”¾ã€‚è¿™èƒ½åœ¨é‡åˆ°è¡¨é”å®šé—®é¢˜æ—¶æˆ–è¦èŠ±å¾ˆé•¿æ—¶é—´å°†ç»“æœä¼ ç»™å®¢æˆ·ç«¯æ—¶æœ‰æ‰€å¸®åŠ©ã€‚</p><p>å½“å¤„ç†ä¸€ä¸ªä¼šè®©å®¢æˆ·ç«¯è€—è´¹ç‚¹æ—¶é—´æ‰èƒ½å¤„ç†çš„å¤§ç»“æœé›†æ—¶ï¼Œ å¯ä»¥è€ƒè™‘ä½¿ç”¨SQL_BUFFER_RESULT æç¤ºå­—ã€‚è¿™æ ·å¯ä»¥å‘Šè¯‰MySQL å°†ç»“æœé›†ä¿å­˜åœ¨ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å°½æ—©çš„é‡Šæ”¾å„ç§é”ã€‚</p><h4 id="USE-INDEX"><a href="#USE-INDEX" class="headerlink" title="USE INDEX"></a>USE INDEX</h4><p>åœ¨ä½ æŸ¥è¯¢è¯­å¥ä¸­è¡¨åçš„åé¢ï¼Œæ·»åŠ USE INDEX æ¥æä¾›ä½ å¸Œæœ›MySQ å»å‚è€ƒçš„ç´¢å¼•åˆ—è¡¨ï¼Œå°±å¯ä»¥è®©MySQL ä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ã€‚</p><p><code>Eg:SELECT * FROM mytable USE INDEX (mod_time, name) ...</code></p><h4 id="IGNORE-INDEX"><a href="#IGNORE-INDEX" class="headerlink" title="IGNORE INDEX"></a>IGNORE INDEX</h4><p>å¦‚æœä½ åªæ˜¯å•çº¯çš„æƒ³è®©MySQL å¿½ç•¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨IGNORE INDEX ä½œä¸ºHintã€‚</p><p><code>Eg:SELECT * FROM mytale IGNORE INDEX (priority) ...</code></p><h4 id="FORCE-INDEX"><a href="#FORCE-INDEX" class="headerlink" title="FORCE INDEX"></a>FORCE INDEX</h4><p>ä¸ºå¼ºåˆ¶MySQL ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ï¼Œå¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨FORCE INDEX ä½œä¸ºHintã€‚</p><p><code>Eg:SELECT * FROM mytable FORCE INDEX (mod_time) ...</code></p><h3 id="å…¶ä»–ä¼˜åŒ–æªæ–½"><a href="#å…¶ä»–ä¼˜åŒ–æªæ–½" class="headerlink" title="å…¶ä»–ä¼˜åŒ–æªæ–½"></a>å…¶ä»–ä¼˜åŒ–æªæ–½</h3><ol><li><p>ä½¿ç”¨æŒä¹…çš„è¿æ¥æ•°æ®åº“ä»¥é¿å…è¿æ¥å¼€é”€ã€‚</p></li><li><p>ç»å¸¸æ£€æŸ¥æ‰€æœ‰æŸ¥è¯¢ç¡®å®ä½¿ç”¨äº†å¿…è¦çš„ç´¢å¼•ã€‚</p></li><li><p>é¿å…åœ¨é¢‘ç¹æ›´æ–°çš„è¡¨ä¸Šæ‰§è¡Œå¤æ‚çš„SELECT æŸ¥è¯¢ï¼Œä»¥é¿å…ä¸é”å®šè¡¨æœ‰å…³çš„ç”±äºè¯»ã€å†™å†²çªå‘ç”Ÿçš„é—®é¢˜ã€‚</p></li><li><p>å¯¹äºæ²¡æœ‰åˆ é™¤çš„è¡Œæ“ä½œçš„MyISAM è¡¨ï¼Œæ’å…¥æ“ä½œå’ŒæŸ¥è¯¢æ“ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œå› ä¸ºæ²¡æœ‰åˆ é™¤æ“ä½œçš„è¡¨æŸ¥è¯¢æœŸé—´ä¸ä¼šé˜»å¡æ’å…¥æ“ä½œï¼å¯¹äºç¡®å®éœ€è¦æ‰§è¡Œåˆ é™¤æ“ä½œçš„è¡¨ï¼Œå°½é‡åœ¨ç©ºé—²æ—¶é—´è¿›è¡Œæ‰¹é‡åˆ é™¤æ“ä½œï¼Œé¿å…é˜»å¡å…¶ä»–æ“ä½œã€‚</p></li><li><p>å……åˆ†åˆ©ç”¨åˆ—æœ‰é»˜è®¤å€¼çš„äº‹å®ã€‚åªæœ‰å½“æ’å…¥çš„å€¼ä¸åŒäºé»˜è®¤å€¼æ—¶ï¼Œæ‰æ˜ç¡®åœ°æ’å…¥å€¼ã€‚è¿™å‡å°‘MySQL éœ€è¦åšçš„è¯­æ³•åˆ†æä»è€Œæé«˜æ’å…¥é€Ÿåº¦ã€‚</p></li><li><p>å¯¹ç»å¸¸è®¿é—®çš„å¯ä»¥é‡æ„çš„æ•°æ®ä½¿ç”¨å†…å­˜è¡¨ï¼Œå¯ä»¥æ˜¾è‘—æé«˜è®¿é—®çš„æ•ˆç‡ã€‚</p></li><li><p>é€šè¿‡å¤åˆ¶å¯ä»¥æé«˜æŸäº›æ“ä½œçš„æ€§èƒ½ã€‚å¯ä»¥åœ¨å¤åˆ¶æœåŠ¡å™¨ä¸­åˆ†å¸ƒå®¢æˆ·çš„æ£€ç´¢ä»¥å‡åˆ†è´Ÿè½½ã€‚ä¸ºäº†é˜²æ­¢å¤‡ä»½æœŸé—´å¯¹åº”ç”¨çš„å½±å“ï¼Œå¯ä»¥åœ¨å¤åˆ¶æœåŠ¡å™¨ä¸Šæ‰§è¡Œå¤‡ä»½æ“ä½œã€‚</p></li><li><p>è¡¨çš„å­—æ®µå°½é‡ä¸ä½¿ç”¨è‡ªå¢é•¿å˜é‡ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹è¯¥å­—æ®µçš„è‡ªå¢å¯èƒ½å¯¹æ•ˆç‡æœ‰æ¯”è¾ƒå¤§çš„å½±å“ï¼Œæ¨èé€šè¿‡åº”ç”¨æ¥å®ç°å­—æ®µçš„è‡ªå¢é•¿ã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é«˜æ€§èƒ½MySQL -- æ‘˜è‡ªã€Šé«˜æ€§èƒ½MySQLç¬¬ä¸‰ç‰ˆã€‹</title>
      <link href="/2018/04/02/mysql/2018-04-02-MySQL/"/>
      <url>/2018/04/02/mysql/2018-04-02-MySQL/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•æ“ç¯‡"><a href="#å¼•æ“ç¯‡" class="headerlink" title="å¼•æ“ç¯‡"></a>å¼•æ“ç¯‡</h2><h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><ul><li><p>Myisamæ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå½“createåˆ›å»ºæ–°è¡¨æ—¶ï¼ŒæœªæŒ‡å®šæ–°è¡¨çš„å­˜å‚¨å¼•æ“æ—¶ï¼Œé»˜è®¤ä½¿ç”¨Myisamã€‚</p></li><li><p>æ¯ä¸ªMyISAMåœ¨ç£ç›˜ä¸Šå­˜å‚¨æˆä¸‰ä¸ªæ–‡ä»¶ã€‚æ–‡ä»¶åéƒ½å’Œè¡¨åç›¸åŒï¼Œæ‰©å±•ååˆ†åˆ«æ˜¯.frmï¼ˆå­˜å‚¨è¡¨å®šä¹‰ï¼‰ã€.MYD (MYDataï¼Œå­˜å‚¨æ•°æ®)ã€.MYI (MYIndexï¼Œå­˜å‚¨ç´¢å¼•)ã€‚æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶å¯ä»¥æ”¾ç½®åœ¨ä¸åŒçš„ç›®å½•ï¼Œå¹³å‡åˆ†å¸ƒioï¼Œè·å¾—æ›´å¿«çš„é€Ÿåº¦ã€‚</p></li><li><p>å®ƒæ˜¯åœ¨Webã€æ•°æ®ä»“å‚¨å’Œå…¶ä»–åº”ç”¨ç¯å¢ƒä¸‹æœ€å¸¸ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ä¹‹ä¸€ .</p></li></ul><h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><ul><li><p>InnoDB å­˜å‚¨å¼•æ“æä¾›äº†å…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹åŠ¡å®‰å…¨ã€‚ä½†æ˜¯å¯¹æ¯”Myisamçš„å­˜å‚¨å¼•æ“ï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº›å¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿ç•™æ•°æ®å’Œç´¢å¼•ã€‚</p></li><li><p>ç”¨äºäº‹åŠ¡å¤„ç†åº”ç”¨ç¨‹åºï¼Œå…·æœ‰ä¼—å¤šç‰¹æ€§ï¼ŒåŒ…æ‹¬ACID äº‹åŠ¡æ”¯æŒã€‚</p></li></ul><h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨RAM ä¸­ï¼Œåœ¨éœ€è¦å¿«é€ŸæŸ¥æ‰¾å¼•ç”¨å’Œå…¶ä»–ç±»ä¼¼æ•°æ®çš„ç¯å¢ƒä¸‹ï¼Œå¯æä¾›æå¿«çš„è®¿é—®ã€‚</p><table><br><tr></tr><br><tr></tr><br><tr><td>ç‰¹ç‚¹</td><td>Myisam</td><td> BDB</td><td> Memory</td> <td>InnoDB</td><td> Archive</td></tr><br><tr><td>å­˜å‚¨é™åˆ¶</td><td>æ²¡æœ‰</td><td>æ²¡æœ‰</td><td>æœ‰</td><td>64TB </td><td>æ²¡æœ‰</td></tr><br><tr><td>äº‹åŠ¡å®‰å…¨</td><td></td><td>æ”¯æŒ</td><td></td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>é”æœºåˆ¶</td><td>è¡¨é”</td><td>é¡µé”</td><td>è¡¨é”</td><td>è¡Œé”</td><td>è¡Œé”</td></tr><br><tr><td>B æ ‘ç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>å“ˆå¸Œç´¢å¼•</td><td></td><td></td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒ</td><td></td><td></td><td></td><td></td></tr><br><tr><td>é›†ç¾¤ç´¢å¼•</td><td></td><td></td><td></td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>æ•°æ®ç¼“å­˜</td><td></td><td></td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>ç´¢å¼•ç¼“å­˜</td><td>æ”¯æŒ</td><td></td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td></td></tr><br><tr><td>æ•°æ®å¯å‹ç¼©</td><td>æ”¯æŒ</td><td></td><td></td><td></td><td>æ”¯æŒ</td></tr><br><tr><td>ç©ºé—´ä½¿ç”¨</td><td>ä½</td><td>ä½</td><td>N/A</td><td> é«˜</td><td>éå¸¸ä½</td></tr><br><tr><td>å†…å­˜ä½¿ç”¨</td><td>ä½</td><td>ä½</td><td>ä¸­ç­‰</td><td>é«˜</td><td>ä½</td></tr><br><tr><td>æ‰¹é‡æ’å…¥çš„é€Ÿåº¦</td><td>é«˜</td><td>é«˜</td><td>é«˜</td><td>ä½</td><td>éå¸¸é«˜</td></tr><br><tr><td>æ”¯æŒå¤–é”®</td><td></td><td></td><td></td><td>æ”¯æŒ</td><td></td></tr><br><tr></tr><br></table><h2 id="Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"><a href="#Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–" class="headerlink" title="Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"></a>Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–</h2><h3 id="æ•°æ®ç±»å‹ä¼˜åŒ–"><a href="#æ•°æ®ç±»å‹ä¼˜åŒ–" class="headerlink" title="æ•°æ®ç±»å‹ä¼˜åŒ–"></a>æ•°æ®ç±»å‹ä¼˜åŒ–</h3><ul><li><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨å¯ä»¥æ­£ç¡®å­˜å‚¨æ•°æ®çš„æœ€å°æ•°æ®ç±»å‹ã€‚</p></li><li><p>ç®€å•çš„æ•°æ®ç±»å‹é€šå¸¸éœ€è¦æ›´å°‘çš„CPUå‘¨æœŸã€‚</p></li><li><p>å°½é‡é¿å…ä½¿ç”¨NULLï¼ŒåŸå› æ˜¯ç”±äºNULLå¯èƒ½éœ€è¦å•ç‹¬çš„ä½ï¼ˆbitï¼‰å»å­˜å‚¨æˆ–è€…NULLä½¿å¾—ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡ã€å€¼æ¯”è¾ƒéƒ½æ›´ä¸ºå¤æ‚ã€‚</p></li></ul><h3 id="èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>èŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h3><ul><li><p>èŒƒå¼åŒ–çš„æ›´æ–°æ“ä½œä¼šæ¯”åèŒƒå¼åŒ–çš„å¿«ã€‚</p></li><li><p>å½“æ•°æ®è¾ƒå¥½èŒƒå¼åŒ–çš„æ—¶å€™ï¼Œåªæœ‰å¾ˆå°‘æˆ–è€…æ²¡æœ‰é‡å¤æ•°æ®ï¼Œæ‰€ä»¥åªéœ€è¦ä¿®æ”¹æ›´å°‘çš„æ•°æ®ã€‚</p></li><li><p>èŒƒå¼åŒ–çš„è¡¨é€šå¸¸æ›´å°ã€‚</p></li><li><p>å¾ˆå°‘æœ‰å†—ä½™æ•°æ®æ„å‘³ç€æ£€ç´¢åˆ—è¡¨æ•°æ®æ›´å°‘éœ€è¦distinctæˆ–è€…group byè¯­å¥ã€‚</p></li></ul><h3 id="åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>åèŒƒå¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h3><ul><li>åèŒƒå¼çš„schemaæ‰€æœ‰æ•°æ®éƒ½åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå¯ä»¥å¾ˆå¥½çš„é¿å…å…³è”ï¼Œè¿˜å¯ä»¥é¿å…éšæœºIO(å’Œå­˜å‚¨å¼•æ“æœ‰å…³)ã€‚</li></ul><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><ul><li><p>å°½å¯èƒ½é¿å…è¿‡åº¦è®¾è®¡ï¼Œä¾‹å¦‚ä¼šå¯¼è‡´å¤æ‚æŸ¥è¯¢çš„schemaè®¾è®¡ï¼Œæˆ–è€…æœ‰å¾ˆå¤šåˆ—çš„è¡¨çš„è®¾è®¡ã€‚</p></li><li><p>ä½¿ç”¨å°è€Œç®€å•çš„åˆé€‚æ•°æ®ç±»å‹ï¼Œé™¤éçœŸå®æ•°æ®æ¨¡å‹ä¸­ç¡®åˆ‡çš„éœ€è¦ï¼Œå¦åˆ™åº”å°½å¯èƒ½çš„é¿å…NULLå€¼ã€‚</p></li><li><p>å°½é‡ä½¿ç”¨ç›¸åŒçš„æ•°æ®ç±»å‹å­˜å‚¨ç›¸ä¼¼æˆ–è€…ç›¸å…³çš„å€¼ï¼Œå°¤å…¶æ˜¯åœ¨å…³è”æ¡ä»¶ä¸­è¦ä½¿ç”¨çš„åˆ—ã€‚</p></li><li><p>é¿å…ä½¿ç”¨MySQLå·²ç»é—å¼ƒçš„ç‰¹æ€§ï¼Œä¾‹å¦‚æµ®ç‚¹æ•°çš„ç²¾åº¦ï¼Œæˆ–è€…æ•´æ•°çš„æ˜¾ç¤ºå®½åº¦ã€‚</p></li><li><p>å°å¿ƒä½¿ç”¨ENUMå’ŒSETã€‚é¿å…ä½¿ç”¨BITã€‚</p></li></ul><h2 id="é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º"><a href="#é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º" class="headerlink" title="é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º"></a>é«˜æ€§èƒ½ç´¢å¼•åˆ›å»º</h2><p>ç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜æ˜¯ä»¥ç£ç›˜å—ï¼ˆblockï¼‰ä¸ºåŸºæœ¬å•ä½çš„ï¼Œä½äºåŒä¸€ä¸ªç£ç›˜å—ä¸­çš„æ•°æ®ä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦ä»€ä¹ˆå–ä»€ä¹ˆã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“ä¸­æœ‰é¡µï¼ˆpageï¼‰çš„æ¦‚å¿µï¼Œé¡µæ˜¯å…¶ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚</p><h3 id="ç´¢å¼•åŸºç¡€"><a href="#ç´¢å¼•åŸºç¡€" class="headerlink" title="ç´¢å¼•åŸºç¡€"></a>ç´¢å¼•åŸºç¡€</h3><h4 id="B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰"><a href="#B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰" class="headerlink" title="B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰"></a>B-Treeç´¢å¼•ï¼ˆå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼‰</h4><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/b-tree.png?raw=true" alt="b-tree"></p><p>B-Tree é€šå¸¸æ„å‘³ç€æ‰€æœ‰çš„å€¼éƒ½æ˜¯æŒ‰ç…§é¡ºåºå­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå¶å­é¡µåˆ°æ ¹çš„è·ç¦»ç›¸åŒã€‚B-Treeç´¢å¼•èƒ½å¤ŸåŠ å¿«è®¿é—®æ•°æ®çš„é€Ÿåº¦ï¼Œå­˜å‚¨å¼•æ“ä¸éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«ææ¥è·å–éœ€è¦çš„æ•°æ®ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä»ç´¢å¼•çš„æ ¹èŠ‚ç‚¹å¼€å§‹è¿›è¡Œæœç´¢ã€‚æ ¹èŠ‚ç‚¹çš„æ§½ä¸­å­˜æ”¾æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå­˜å‚¨å¼•æ“æ ¹æ®è¿™äº›æŒ‡é’ˆå‘ä¸‹å±‚æŸ¥æ‰¾ã€‚æŒ‡é’ˆä¸­å®šä¹‰äº†å­èŠ‚ç‚¹é¡µä¸­å€¼çš„<br>ä¸Šé™å’Œä¸‹é™ã€‚æœ€ç»ˆæ‰¾åˆ°è¯¥å€¼æˆ–è€…ä¸å­˜åœ¨ã€‚</p><p>å¶å­èŠ‚ç‚¹æ¯”è¾ƒç‰¹æ®Šï¼Œä»–ä»¬æŒ‡å‘çš„æ˜¯è¢«ç´¢å¼•çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„èŠ‚ç‚¹é¡µã€‚</p><p>æ ‘çš„æ·±åº¦å’Œè¡¨çš„å¤§å°ç›´æ¥ç›¸å…³ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/b-tree1.png?raw=true" alt="b-tree"></p><p>å¯ä»¥ä½¿ç”¨B-Treeç´¢å¼•çš„æŸ¥è¯¢ç±»å‹ï¼š</p><p>å…¨å€¼åŒ¹é…ï¼šå…¨å€¼åŒ¹é…æŒ‡çš„æ˜¯å’Œç´¢å¼•çš„æ‰€æœ‰åˆ—è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚å‰é¢æåˆ°çš„ç´¢å¼•å¯ç”¨äºæŸ¥æ‰¾å§“åä¸ºCuba Allen 1960-01-01ã€‚</p><p>åŒ¹é…æœ€å·¦å‰ç¼€ï¼šå¯ç”¨äºæŸ¥æ‰¾ç´¢å¼•çš„ç¬¬ä¸€åˆ—ã€‚</p><p>åŒ¹é…åˆ—å‰ç¼€ï¼šä¹Ÿå¯ä»¥åŒ¹é…æŸä¸€åˆ—çš„å€¼çš„å¼€å¤´éƒ¨åˆ†ã€‚</p><p>åŒ¹é…èŒƒå›´å€¼ï¼šéµå¾ªæœ€å·¦å‰ç¼€çš„å‰æä¸‹ï¼ŒèŒƒå›´æŸ¥æ‰¾ã€‚</p><p>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—ï¼šå¯ç”¨äºæŸ¥æ‰¾æ‰€æœ‰å§“ä¸ºAllen,å¹¶ä¸”åå­—æ˜¯å­—æ¯Kå¼€å¤´çš„äººã€‚</p><p>åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼šB-Treeé€šå¸¸å¯ä»¥æ”¯æŒâ€œåªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢â€ï¼Œå³æŸ¥è¯¢åªéœ€è¦è®¿é—®ç´¢å¼•ï¼Œè€Œæ— éœ€è®¿é—®æ•°æ®è¡Œã€‚</p><p>B-Treeä½¿ç”¨é™åˆ¶ï¼š</p><p>å¿…é¡»éµå¾ªæœ€å·¦åŸåˆ™ã€‚</p><p>å¦‚æœæŸ¥è¯¢ä¸­æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™å…¶å³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥æ‰¾ã€‚</p><h4 id="B-Treeç´¢å¼•"><a href="#B-Treeç´¢å¼•" class="headerlink" title="B+Treeç´¢å¼•"></a>B+Treeç´¢å¼•</h4><p>B+Treeæ˜¯åœ¨B-TreeåŸºç¡€ä¸Šçš„ä¸€ç§ä¼˜åŒ–ï¼Œä½¿å…¶æ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼ŒInnoDBå­˜å‚¨å¼•æ“å°±æ˜¯ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</p><p>åœ¨B-treeçš„åŸºç¡€ä¸Šï¼Œä¸ºå¶å­èŠ‚ç‚¹å¢åŠ é“¾è¡¨æŒ‡é’ˆï¼Œè€Œä¸”æ‰€æœ‰çš„å…³é”®å­—éƒ½åœ¨å¶å­èŠ‚ç‚¹ä¸­å‡ºç°ï¼Œä¸”æ•°æ®åªå­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚éå¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä»…ä½œä¸ºå¶å­èŠ‚ç‚¹çš„ç´¢å¼•ã€‚</p><h4 id="hashç´¢å¼•"><a href="#hashç´¢å¼•" class="headerlink" title="hashç´¢å¼•"></a>hashç´¢å¼•</h4><p>å“ˆå¸Œç´¢å¼•åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚å¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œå­˜å‚¨å¼•æ“éƒ½ä¼šå¯¹æ‰€æœ‰çš„ç´¢å¼•åˆ—è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼Œå“ˆå¸Œç æ˜¯ä¸€ä¸ªè¾ƒå°çš„å€¼ï¼Œå¹¶ä¸”ä¸åŒé”®å€¼çš„è¡Œè®¡ç®—å‡ºæ¥çš„å“ˆå¸Œç ä¹Ÿä¸ä¸€æ ·ã€‚å“ˆå¸Œç å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼ŒåŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆã€‚</p><p>åœ¨MySQLä¸­ï¼Œåªæœ‰Memoryå¼•æ“æ˜¾å¼æ”¯æŒå“ˆå¸Œç´¢å¼•ä¸”æ”¯æŒéå”¯ä¸€å“ˆå¸Œç´¢å¼•çš„ã€‚</p><p>å“ˆå¸Œç´¢å¼•æ¯ä¸ªæ§½ç‚¹ç¼–å·æ˜¯æœ‰åºçš„ã€‚</p><p>å“ˆå¸Œç´¢å¼•ä½¿ç”¨é™åˆ¶ï¼š</p><p>å“ˆå¸Œç´¢å¼•åªåŒ…å«å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆï¼Œè€Œä¸å­˜å‚¨å­—æ®µå€¼ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­çš„å€¼æ¥é¿å…è¯»å–è¡Œã€‚</p><p>å“ˆå¸Œç´¢å¼•å¹¶ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥æ— æ³•ç”¨äºæ’åºã€‚</p><p>å“ˆå¸Œç´¢å¼•ä¹Ÿä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—çš„åŒ¹é…æŸ¥æ‰¾ï¼Œå› ä¸ºå“ˆå¸Œç´¢å¼•å§‹ç»ˆæ˜¯ä½¿ç”¨ç´¢å¼•åˆ—çš„å…¨éƒ¨å†…å®¹æ¥è®¡ç®—å“ˆå¸Œå€¼çš„ã€‚</p><p>å“ˆå¸Œç´¢å¼•æ”¯æŒç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢ï¼ŒåŒ…æ‹¬=ã€in()ã€&lt;=&gt;ä¹Ÿä¸æ”¯æŒä»»ä½•èŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚WHERE price &gt; 100ã€‚</p><p>è®¿é—®å“ˆå¸Œç´¢å¼•çš„æ•°æ®éå¸¸å¿«ï¼Œé™¤éæœ‰å¾ˆå¤šå“ˆå¸Œå†²çªã€‚</p><p>å¦‚æœå“ˆå¸Œå†²çªå¾ˆå¤šçš„è¯ï¼Œä¸€äº›ç´¢å¼•ç»´æŠ¤æ“ä½œçš„ä»£ä»·ä¹Ÿä¼šå¾ˆé«˜ã€‚</p><p>é™¤äº†Memoryå¼•æ“å¤–ï¼ŒNDBé›†ç¾¤å¼•æ“ä¹Ÿæ”¯æŒå”¯ä¸€å“ˆå¸Œç´¢å¼•ï¼Œä¸”åœ¨NDBé›†ç¾¤å¼•æ“ä¸­ä½œç”¨éå¸¸ç‰¹æ®Šã€‚</p><p>InnoDBå¼•æ“æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å«â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€ã€‚å½“InnoDBå¼•æ“æ³¨æ„åˆ°æŸäº›ç´¢å¼•å€¼è¢«ä½¿ç”¨çš„éå¸¸é¢‘ç¹æ—¶ï¼Œä»–ä¼šåœ¨å†…å­˜ä¸­åŸºäºB-Treeç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·å°±è®©B-Treeç´¢å¼•ä¹Ÿå…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¿«é€Ÿå“ˆå¸ŒæŸ¥æ‰¾ã€‚</p><h4 id="å…¨æ–‡ç´¢å¼•"><a href="#å…¨æ–‡ç´¢å¼•" class="headerlink" title="å…¨æ–‡ç´¢å¼•"></a>å…¨æ–‡ç´¢å¼•</h4><p>å…¨æ–‡ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹ç´¢å¼•ï¼Œå®ƒæŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒç´¢å¼•ä¸­çš„å€¼ã€‚é€‚ç”¨äºMATCH AGINSTæ“ä½œï¼Œè€Œä¸æ˜¯æ™®é€šçš„WHEREæ¡ä»¶æ“ä½œã€‚</p><h3 id="ç´¢å¼•çš„ä¼˜ç‚¹"><a href="#ç´¢å¼•çš„ä¼˜ç‚¹" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç‚¹"></a>ç´¢å¼•çš„ä¼˜ç‚¹</h3><ul><li><p>ç´¢å¼•å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</p></li><li><p>ç´¢å¼•å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ã€‚</p></li><li><p>ç´¢å¼•å¯ä»¥å°†éšæœºIOå˜ä¸ºé¡ºåºIOã€‚</p></li></ul><h3 id="é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"><a href="#é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥" class="headerlink" title="é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"></a>é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥</h3><h4 id="ç‹¬ç«‹çš„åˆ—"><a href="#ç‹¬ç«‹çš„åˆ—" class="headerlink" title="ç‹¬ç«‹çš„åˆ—"></a>ç‹¬ç«‹çš„åˆ—</h4><p>ç‹¬ç«‹çš„åˆ—æ˜¯æŒ‡ç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ã€‚æˆ‘ä»¬åº”è¯¥ç®€åŒ–WHEREæ¡ä»¶çš„ä¹ æƒ¯ï¼Œå§‹ç»ˆå°†ç´¢å¼•åˆ—å•ç‹¬æ”¾åœ¨æ¯”è¾ƒç¬¦å·çš„ä¸€ä¾§ã€‚</p><p>ä¾‹å¦‚ï¼š<code>select actor_id from sakila.actor where actor_id + 1 = 4</code></p><h4 id="å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§"><a href="#å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§" class="headerlink" title="å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§"></a>å‰ç¼€ç´¢å¼•å’Œç´¢å¼•çš„é€‰æ‹©æ€§</h4><p>é—®é¢˜ï¼š æœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©ç´¢å¼•å˜çš„å¤§ä¸”æ…¢ã€‚</p><p>é€šå¸¸å¯ä»¥ç´¢å¼•å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚ä½†ä¼šé™ä½ç´¢å¼•çš„é€‰æ‹©æ€§ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹å¯¹äºBlobã€textæˆ–è€…å¾ˆé•¿çš„varchar()ç±»å‹çš„åˆ—ï¼Œå¿…é¡»ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå› ä¸ºMySQLä¸å…è®¸ç´¢å¼•è¿™äº›åˆ—çš„å®Œæ•´é•¿åº¦ã€‚</p><p>å‰ç¼€çš„åŸºæ•°åº”è¯¥æ¥è¿‘äºå®Œæ•´åˆ—çš„åŸºæ•°ã€‚</p><h4 id="å¤šç´¢å¼•åˆ—"><a href="#å¤šç´¢å¼•åˆ—" class="headerlink" title="å¤šç´¢å¼•åˆ—"></a>å¤šç´¢å¼•åˆ—</h4><p>åœ¨å¤šä¸ªåˆ—ä¸Šå»ºç«‹ç‹¬ç«‹çš„å•åˆ—ç´¢å¼•å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸èƒ½æé«˜MySQLçš„æŸ¥è¯¢æ€§èƒ½ã€‚</p><h4 id="é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"><a href="#é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº" class="headerlink" title="é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"></a>é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº</h4><p>å¤šåˆ—ç´¢å¼•çš„åˆ—é¡ºåºç»å…¸æ³•åˆ™ï¼šå½“ä¸éœ€è¦è€ƒè™‘æ’åºå’Œåˆ†ç»„æ—¶ï¼Œå°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åˆ°ç´¢å¼•æœ€å‰åˆ—ã€‚å¤§éƒ½æƒ…å†µä¸‹æ˜¯é€‚ç”¨çš„ï¼Œä¹Ÿéœ€è¦æ ¹æ®ä¸šåŠ¡å»è€ƒè™‘ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚</p><p>éœ€è¦è€ƒè™‘å“ªäº›è¿è¡Œé¢‘ç‡æœ€é«˜çš„æŸ¥è¯¢æ¥è°ƒæ•´ç´¢å¼•åˆ—çš„é¡ºåºï¼Œè®©è¿™ç§æƒ…å†µä¸‹ç´¢å¼•çš„é€‰æ‹©æ€§æœ€é«˜ã€‚</p><h4 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h4><p>èšç°‡ç´¢å¼•å¹¶ä¸æ˜¯ä¸€ç§å•çº¯çš„ç´¢å¼•ç±»å‹ï¼Œè€Œæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ã€‚å…·ä½“ç»†èŠ‚ä¾èµ–å…¶å®ç°æ–¹å¼ï¼Œä½†InnoDBçš„èšç°‡ç´¢å¼•å®é™…ä¸Šåœ¨åŒä¸€ä¸ªç»“æ„ä¸­ä¿å­˜äº†B-Treeç´¢å¼•å’Œæ•°æ®è¡Œã€‚</p><p>å½“è¡¨æœ‰èšç°‡ç´¢å¼•æ—¶ï¼Œå®ƒçš„æ•°æ®è¡Œå®é™…å­˜æ”¾åœ¨ç´¢å¼•çš„å¶å­é¡µä¸­ã€‚æœ¯è¯­â€œèšç°‡â€æ ‡è¯†æ•°æ®è¡Œå’Œç›¸é‚»çš„é”®å€¼ç´§å‡‘çš„å­˜å‚¨åœ¨ä¸€èµ·ã€‚å› ä¸ºæ— æ³•åŒæ—¶æŠŠæ•°æ®è¡Œå­˜æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p><p>ç”±äºæ˜¯å­˜å‚¨å¼•æ“è‡ªå·±å®ç°èšç°‡ç´¢å¼•ï¼Œå› æ­¤ä¸æ˜¯æ¯ä¸ªå¼•æ“éƒ½æ”¯æŒèšç°‡ç´¢å¼•ã€‚</p><p>å¶å­é¡µåŒ…å«äº†è¡Œçš„å…¨éƒ¨æ•°æ®ï¼Œä½†æ˜¯èŠ‚ç‚¹é¡µåªåŒ…å«äº†ç´¢å¼•åˆ—ã€‚InnoDBå°†é€šè¿‡ä¸»é”®èšé›†æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´å›¾ä¸­çš„â€œè¢«ç´¢å¼•åˆ—â€å°±æ˜¯ä¸»é”®åˆ—ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/clusterindex.png?raw=true" alt="cluster-index"></p><p>æ³¨ï¼š å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼ŒInnoDBä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ã€‚InnoDBåªèšé›†åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ã€‚åŒ…å«ç›¸é‚»é”®å€¼çš„é¡µé¢å¯èƒ½ä¼šç›¸è·ç”šè¿œã€‚</p><p>èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>å¯ä»¥æŠŠç›¸å…³æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚å®ç°ç”µå­é‚®ç®±æ—¶ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·IDæ¥èšé›†æ•°æ®ï¼Œè¿™æ ·åªéœ€è¦ä»ç£ç›˜è¯»å–å°‘é‡çš„æ•°æ®é¡µå°±èƒ½è·å–æŸä¸ªç”¨æˆ·çš„å…¨éƒ¨é‚®ä»¶ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨èšç°‡ç´¢å¼•ï¼Œåˆ™æ¯å°é‚®ä»¶éƒ½å¯èƒ½å¯¼è‡´ä¸€æ¬¡ç£ç›˜IOã€‚</p></li><li><p>æ•°æ®è®¿é—®æ›´å¿«ã€‚èšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB-Treeä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®é€šå¸¸æ¯”åœ¨éèšç°‡ç´¢å¼•æŸ¥æ‰¾çš„è¦å¿«ã€‚</p></li><li><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æçš„æŸ¥è¯¢å¯ä»¥ç›´æ¥ä½¿ç”¨é¡µèŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼ã€‚</p></li></ul><p>èšç°‡ç´¢å¼•ç¼ºç‚¹ï¼š</p><ul><li><p>èšç°‡ç´¢å¼•æœ€å¤§é™åº¦çš„æé«˜äº†IOå¯†é›†å‹åº”ç”¨çš„æ€§èƒ½ï¼Œä½†å¦‚æœæ•°æ®å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œåˆ™è®¿é—®çš„é¡ºåºå°±æ²¡æœ‰é‚£ä¹ˆé‡è¦äº†ï¼Œèšç°‡ç´¢å¼•ä¹Ÿå°±æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ¿äº†ã€‚</p></li><li><p>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–æ’å…¥é¡ºåºã€‚æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯åŠ è½½æ•°æ®åˆ°InnoDBè¡¨ä¸­é€Ÿåº¦æœ€å¿«çš„æ–¹å¼ã€‚ä½†å¦‚æœä¸æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºåŠ è½½æ•°æ®ï¼Œé‚£ä¹ˆåœ¨åŠ è½½å®Œæˆåæœ€å¥½ä½¿ç”¨optimize tableå‘½ä»¤é‡æ–°ç»„ç»‡ä¸€ä¸‹è¡¨ã€‚</p></li><li><p>æ›´æ–°èšç°‡ç´¢å¼•åˆ—çš„ä»£ä»·å¾ˆé«˜ï¼Œå› ä¸ºä¼šå¼ºåˆ¶InnoDBå°†æ¯ä¸ªè¢«åŠ¨æ›´æ–°çš„è¡Œç§»åŠ¨åˆ°æ–°çš„ä½ç½®ã€‚</p></li><li><p>åŸºäºèšç°‡ç´¢å¼•çš„è¡¨åœ¨æ’å…¥æ–°è¡Œï¼Œæˆ–è€…ä¸»é”®è¢«æ›´æ–°å¯¼è‡´éœ€è¦ç§»åŠ¨è¡Œçš„æ—¶å€™ï¼Œå¯èƒ½é¢ä¸´â€œé¡µåˆ†è£‚â€çš„é—®é¢˜ã€‚å½“è¡Œçš„ä¸»é”®å€¼è¦æ±‚å¿…é¡»å°†è¿™ä¸€è¡Œæ’å…¥åˆ°æŸä¸ªå·²æ»¡çš„é¡µä¸­æ—¶ï¼Œå­˜å‚¨å¼•æ“ä¼šå°†è¯¥é¡µåˆ†è£‚æˆä¸¤ä¸ªé¡µé¢æ¥å®¹çº³æ”¹è¡Œï¼Œè¿™å°±æ˜¯ä¸€æ¬¡é¡µåˆ†è£‚æ“ä½œã€‚é¡µåˆ†è£‚ä¼šå¯¼è‡´è¡¨å ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚</p></li><li><p>èšç°‡ç´¢å¼•å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢ï¼Œå°¤å…¶æ˜¯è¡Œæ¯”è¾ƒç¨€ç–ï¼Œæˆ–è€…ç”±äºé¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­çš„æ—¶å€™ã€‚</p></li><li><p>äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰å¯èƒ½æ¯”æƒ³è±¡çš„è¦æ›´å¤§ï¼Œå› ä¸ºåœ¨äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«äº†å¼•ç”¨è¡Œçš„ä¸»é”®åˆ—ã€‚</p></li><li><p>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¿å­˜çš„ä¸æ˜¯æŒ‡å‘è¡Œçš„ç‰©ç†ä½ç½®çš„æŒ‡é’ˆï¼Œè€Œæ˜¯è¡Œçš„ä¸»é”®å€¼ã€‚è¿™æ„å‘³ç€é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥æ‰¾è¡Œï¼Œå­˜å‚¨å¼•æ“éœ€è¦æ‰¾åˆ°äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è·å¾—å¯¹åº”çš„ä¸»é”®å€¼ï¼Œç„¶åæ ¹æ®è¿™ä¸ªå€¼å»èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å¯¹åº”çš„è¡Œã€‚å¯¹äºInnoDBï¼Œè‡ªé€‚åº”æ€§å“ˆå¸Œç´¢å¼•èƒ½å¤Ÿå‡å°‘è¿™æ ·é‡å¤çš„å·¥ä½œã€‚</p></li></ul><h4 id="InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”"><a href="#InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”" class="headerlink" title="InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”"></a>InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒå¯¹æ¯”</h4><p>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„æ•°æ®åˆ†å¸ƒæœ‰åŒºåˆ«ï¼Œä»¥åŠå¯¹åº”çš„ä¸»é”®ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•çš„æ•°æ®åˆ†å¸ƒä¹Ÿæœ‰åŒºåˆ«ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table    layout_test&#123;</span><br><span class="line">col1 int not null,</span><br><span class="line">col2 int not null,</span><br><span class="line">primary key(col1),</span><br><span class="line">key(col2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾è¯¥è¡¨ä¸»é”®å–å€¼1-10000ï¼ŒæŒ‰ç…§éšæœºé¡ºåºæ’å…¥å¹¶ä½¿ç”¨OPTIMIZE TABLEå‘½ä»¤åšäº†ä¼˜åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œæ•°æ®åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨å·²ç»åšåˆ°æœ€ä¼˜ï¼Œä½†è¡Œçš„é¡ºåºæ˜¯éšæœºçš„ã€‚</p><p>åˆ—col2çš„å€¼æ˜¯ä»1-100çš„éšæœºå€¼ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šé‡å¤çš„å€¼ã€‚</p><p>MyISAMæ•°æ®ï¼ˆéèšç°‡ï¼‰åˆ†å¸ƒï¼š</p><p>MyISAMæŒ‰ç…§æ•°æ®æ’å…¥é¡ºåºå­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><p>åœ¨è¡Œçš„æ—è¾¹æ˜¾ç¤ºè¡Œå·ï¼Œä»0å¼€å§‹é€’å¢ã€‚å› ä¸ºè¡Œæ˜¯å®šé•¿çš„ï¼Œæ‰€ä»¥MyISAMå¯ä»¥ä»è¡¨çš„å¼€å¤´è·³è¿‡æ‰€éœ€çš„å­—èŠ‚æ‰¾åˆ°éœ€è¦çš„è¡Œã€‚</p><p>è¿™ç§åˆ†å¸ƒæ–¹å¼å®¹æ˜“åˆ›å»ºç´¢å¼•ã€‚</p><p>æ•°æ®åˆ†å¸ƒï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/myisam.png?raw=true" alt="æ•°æ®åˆ†å¸ƒ"></p><p>ä¸»é”®åˆ†å¸ƒï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/myisamcol.png?raw=true" alt="è¡¨çš„ä¸»é”®"></p><p>col2åˆ—ç´¢å¼•åˆ†å¸ƒï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/myisamkey.png?raw=true" alt="col2åˆ—ç´¢å¼•åˆ†å¸ƒ"></p><p>InnoDBæ•°æ®ï¼ˆèšç°‡ï¼‰åˆ†å¸ƒï¼š</p><p>InnoDBæ”¯æŒèšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥ä½¿ç”¨éå¸¸ä¸åŒçš„æ–¹å¼å­˜å‚¨åŒæ ·çš„æ•°æ®ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/innodbkey.png?raw=true" alt="ä¸»é”®åˆ†å¸ƒ"></p><p>è¯¥å›¾æ˜¾ç¤ºäº†æ•´ä¸ªè¡¨ï¼Œè€Œä¸æ˜¯åªæœ‰ç´¢å¼•ã€‚åœ¨InnoDBä¸­ï¼Œèšç°‡ç´¢å¼•å°±æ˜¯è¡¨ï¼Œæ‰€ä»¥ä¸åƒMyISAMé‚£æ ·éœ€è¦ç‹¬ç«‹çš„å­˜å‚¨ã€‚</p><p>èšç°‡ç´¢å¼•çš„æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸»é”®å€¼ã€äº‹åŠ¡IDã€ç”¨äºäº‹åŠ¡å’ŒMVCCçš„å›æ»šæŒ‡é’ˆä»¥åŠæ‰€æœ‰çš„å‰©ä½™åˆ—ã€‚å¦‚æœä¸»é”®æ˜¯ä¸€ä¸ªåˆ—å‰ç¼€ç´¢å¼•ï¼ŒInnoDBä¹Ÿä¼šåŒ…å«å®Œæ•´çš„ä¸»é”®åˆ—å’Œå‰©ä¸‹çš„å…¶ä»–åˆ—ã€‚</p><p>InnoDBäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ä¸æ˜¯â€œè¡ŒæŒ‡é’ˆâ€ï¼Œè€Œæ˜¯ä¸»é”®å€¼ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºæŒ‡å‘è¡Œçš„â€œæŒ‡é’ˆâ€ã€‚åˆ©ï¼šå‡å°‘äº†å½“å‡ºç°è¡Œç§»åŠ¨æˆ–è€…æ•°æ®é¡µåˆ†è£‚æ—¶äºŒçº§ç´¢å¼•çš„ç»´æŠ¤å·¥ä½œã€‚å¼Šï¼šä½¿ç”¨ä¸»é”®å€¼å½“åšæŒ‡é’ˆä¼šè®©äºŒçº§ç´¢å¼•å ç”¨æ›´å¤šçš„ç©ºé—´ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/innodb.png?raw=true" alt="ç´¢å¼•åˆ†å¸ƒ"></p><p>ä¸Šå›¾æ˜¾ç¤ºäº†ç¤ºä¾‹è¡¨col2çš„ç´¢å¼•ï¼Œæ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«äº†ç´¢å¼•åˆ—ï¼ˆcol2ï¼‰,ç´§æ¥ç€æ˜¯ä¸»é”®å€¼ï¼ˆcol1ï¼‰ã€‚</p><p>è¯¥å›¾å±•ç¤ºäº†B-Treeçš„å¶å­èŠ‚ç‚¹ç»“æ„ï¼ŒInnoDBçš„éå¶å­èŠ‚ç‚¹åŒ…å«äº†ç´¢å¼•åˆ—å’Œä¸€ä¸ªæŒ‡å‘ä¸‹çº§èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆä¸‹ä¸€çº§èŠ‚ç‚¹å¯ä»¥æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¶å­èŠ‚ç‚¹ï¼‰ã€‚è¿™å¯¹èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•éƒ½é€‚ç”¨ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/innodba.png?raw=true" alt="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"></p><h4 id="InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ"><a href="#InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ" class="headerlink" title="InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ"></a>InnoDBè¡¨ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ</h4><p>å¦‚æœæ­£åœ¨ä½¿ç”¨InnoDBè¡¨å¹¶ä¸”å¹¶æ²¡æœ‰ä»€ä¹ˆæ•°æ®éœ€è¦èšé›†ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªä»£ç†é”®ä½œä¸ºä¸»é”®ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨AUTO_INCREMENTè‡ªå¢åˆ—ã€‚è¿™æ ·å¯ä»¥ä¿è¯æ•°æ®æŒ‰é¡ºåºå†™å…¥ï¼Œå¯¹äºæ ¹æ®ä¸»é”®åšå…³è”æ“ä½œçš„æ€§èƒ½ä¹Ÿä¼šæ›´å¥½ã€‚</p><p>æœ€å¥½é¿å…éšæœºï¼ˆä¸è¿ç»­ä¸”å€¼åˆ†å¸ƒèŒƒå›´éå¸¸å¤§ï¼‰èšç°‡ç´¢å¼•ï¼Œç‰¹åˆ«å¯¹IOå¯†é›†å‹åº”ç”¨ã€‚ä»æ€§èƒ½è€ƒè™‘ï¼Œä½¿ç”¨UUIDä½œä¸ºèšç°‡ç´¢å¼•ï¼Œä½¿å¾—èšç°‡ç´¢å¼•çš„æ’å…¥å˜çš„å®Œå…¨éšæœºï¼Œä½¿å¾—æ•°æ®æ²¡æœ‰ä»»ä½•èšé›†ç‰¹æ€§ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/clustersort.png?raw=true" alt="èšç°‡ç´¢å¼•æ’å…¥é¡ºåºçš„ç´¢å¼•å€¼"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå› ä¸ºä¸»é”®çš„å€¼æ˜¯é¡ºåºçš„ï¼Œæ‰€ä»¥InnoDBæŠŠæ¯ä¸€æ¡çºªå¾‹éƒ½å­˜å‚¨åœ¨ä¸Šä¸€æ¡çºªå¾‹åé¢ã€‚å½“è¾¾åˆ°é¡µçš„æœ€å¤§å¡«å……å› å­æ—¶ï¼Œä¸‹ä¸€æ¡è®°å½•å°±ä¼šå†™å…¥æ–°çš„é¡µä¸­ï¼Œä¸€æ—¦æ•°æ®æŒ‰ç…§è¿™ç§é¡ºåºçš„æ–¹å¼åŠ è½½ï¼Œä¸»é”®é¡µå°±ä¼šè¿‘ä¼¼äºè¢«é¡ºåºçš„è®°å½•å¡«æ»¡ã€‚</p><p>èšç°‡ç´¢å¼•é¡ºåºæ’å…¥ç¼ºç‚¹ï¼š</p><ul><li><p>å¯¹äºé«˜å¹¶å‘å·¥ä½œè´Ÿè½½ï¼Œåœ¨InnoDBä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥å¯èƒ½ä¼šé€ æˆæ˜æ˜¾çš„äº‰ç”¨ï¼ˆä¸»é”®å¼•èµ·é—´éš™é”ç«äº‰ï¼‰ã€‚</p></li><li><p>å¦ä¸€ä¸ªçƒ­ç‚¹æ˜¯AUTO_INCREMENTé”æœºåˆ¶ï¼Œå¦‚æœé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡æ–°è®¾è®¡è¡¨æˆ–è€…åº”ç”¨ï¼Œæˆ–è€…ä¿®æ”¹innodb_autoinc_lock_modeé…ç½®ã€‚</p></li></ul><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/clusternosort.png?raw=true" alt="éèšç°‡ç´¢å¼•æ’å…¥é¡ºåºçš„ç´¢å¼•å€¼"></p><p>éèšç°‡ç´¢å¼•å› ä¸ºæ–°è¡Œçš„ä¸»é”®å€¼ä¸ä¸€å®šæ¯”ä¹‹å‰æ’å…¥çš„å¤§ï¼Œæ‰€ä»¥InnoDBæ— æ³•ç®€å•çš„æ€»æ˜¯æŠŠæ–°è¡Œæ’å…¥åˆ°ç´¢å¼•çš„æœ€åï¼Œè€Œæ˜¯éœ€è¦ä¸ºæ–°çš„è¡Œå¯»æ‰¾éœ€è¦çš„ä½ç½®â€”é€šå¸¸æ˜¯å·²æœ‰æ•°æ®çš„ä¸­é—´ä½ç½®â€”å¹¶ä¸”åˆ†é…ç©ºé—´ã€‚è¿˜ä¼šå¢åŠ å¾ˆå¤šé¢å¤–çš„å·¥ä½œï¼Œå¹¶å¯¼è‡´æ•°æ®åˆ†å¸ƒä¸å¤Ÿä¼˜åŒ–ã€‚</p><p>éèšç°‡ç´¢å¼•æ’å…¥ç¼ºç‚¹ï¼š</p><ul><li><p>å†™å…¥çš„ç›®æ ‡é¡µå¯èƒ½å·²ç»åˆ·åˆ°ç£ç›˜ä¸Šå¹¶ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œæˆ–è€…è¿˜æ²¡æœ‰è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼ŒInnoDBåœ¨æ’å…¥ä¹‹å‰ä¸å¾—ä¸å…ˆæ‰¾åˆ°å¹¶ä»ç£ç›˜è¯»å–ç›®æ ‡é¡µåˆ°å†…å­˜ä¸­ã€‚è¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„éšæœºIOã€‚</p></li><li><p>å› ä¸ºå†™å…¥æ˜¯ä¹±åºçš„ï¼ŒInnoDBä¸å¾—ä¸é¢‘ç¹çš„åšé¡µåˆ†è£‚æ“ä½œï¼Œä»¥ä¾¿æ–°çš„è¡Œåˆ†é…ç©ºé—´ã€‚é¡µåˆ†è£‚ä¼šå¯¼è‡´ç§»åŠ¨å¤§é‡æ•°æ®ï¼Œä¸€æ¬¡æ’å…¥æœ€å°‘éœ€è¦ä¿®æ”¹ä¸‰ä¸ªé¡µè€Œä¸æ˜¯ä¸€ä¸ªé¡µã€‚</p></li><li><p>ç”±äºé¢‘ç¹çš„é¡µåˆ†è£‚ï¼Œé¡µä¼šå˜çš„ç¨€ç–å¹¶è¢«ä¸è§„åˆ™çš„å¡«å……ï¼Œæ‰€ä»¥æœ€ç»ˆä¼šæœ‰æ•°æ®ç¢ç‰‡ã€‚</p></li></ul><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h4><p>é€šå¸¸å¤§å®¶ä¼šæ ¹æ®æŸ¥è¯¢çš„whereæ¡ä»¶æ¥åˆ›å»ºç´¢å¼•ï¼Œä¸è¿‡è¿™åªæ˜¯ä¼˜åŒ–ç´¢å¼•çš„ä¸€ä¸ªæ–¹é¢ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢å­—æ®µçš„å€¼æˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œè¦†ç›–ç´¢å¼•â€ã€‚</p><p>è¦†ç›–ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>ç´¢å¼•æ¡ç›®é€šå¸¸è¿œå°äºæ•°æ®è¡Œå¤§å°ï¼Œæ‰€ä»¥å¦‚æœåªéœ€è¦è¯»å–ç´¢å¼•ï¼Œé‚£MySQLå°±ä¼šæå¤§çš„å‡å°‘æ•°æ®è®¿é—®é‡ã€‚è¿™å¯¹ç¼“å­˜çš„è´Ÿè½½éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹å“åº”æ—¶é—´å¤§éƒ¨åˆ†èŠ±è´¹åœ¨æ•°æ®æ‹·è´ä¸Šã€‚è¦†ç›–ç´¢å¼•å¯¹IOå¯†é›†å‹åº”ç”¨ä¹Ÿæœ‰å¸®åŠ©ï¼Œå› ä¸ºç´¢å¼•æ¯”æ•°æ®æ›´å°ï¼Œæ›´å®¹æ˜“å…¨éƒ¨æ”¾å…¥å†…å­˜ä¸­ï¼ˆMyISAMå‹ç¼©ç´¢å¼•ä»¥å˜å¾—æ›´å°ï¼‰ã€‚</p></li><li><p>å› ä¸ºç´¢å¼•æ˜¯æŒ‰ç…§åˆ—å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å¯¹äºIOå¯†é›†å‹çš„èŒƒå›´æŸ¥è¯¢ä¼šæ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œæ•°æ®çš„IOè¦å°‘çš„å¤šã€‚ï¼ˆMyISAMå’ŒPercona XtraDBï¼Œç”šè‡³å¯ä»¥é€šè¿‡OPTIMIZEå‘½ä»¤ä½¿å¾—ç´¢å¼•å®Œå…¨é¡ºåºæ’åˆ—ï¼Œè¿™æ ·ç®€å•çš„èŒƒå›´æŸ¥è¯¢èƒ½ä½¿ç”¨å®Œå…¨é¡ºåºçš„ç´¢å¼•è®¿é—®ï¼‰</p></li><li><p>ä¸€äº›å­˜å‚¨å¼•æ“å¦‚MyISAMåœ¨å†…å­˜ä¸­åªç¼“å­˜ç´¢å¼•ï¼Œæ•°æ®åˆ™ä¾èµ–äºæ“ä½œç³»ç»Ÿæ¥ç¼“å­˜ï¼Œå› æ­¤è¦è®¿é—®æ•°æ®éœ€è¦ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ã€‚</p></li><li><p>ç”±äºInnoDBçš„èšç°‡ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•å¯¹InnoDBè¡¨ç‰¹åˆ«æœ‰ç”¨ã€‚InnoDBçš„äºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜äº†è¡Œçš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥å¦‚æœäºŒçº§ä¸»é”®èƒ½å¤Ÿè¦†ç›–æŸ¥è¯¢ï¼Œåˆ™å¯ä»¥é¿å…å¯¹ä¸»é”®ç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚</p></li></ul><p>ä¸æ˜¯æ‰€æœ‰çš„ç´¢å¼•éƒ½å¯ä»¥æˆä¸ºè¦†ç›–ç´¢å¼•ã€‚è¦†ç›–ç´¢å¼•å¿…é¡»è¦å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œè€Œå“ˆå¸Œç´¢å¼•ã€ç©ºé—´ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•ç­‰éƒ½ä¸å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œæ‰€ä»¥MySQLåªèƒ½ä½¿ç”¨B-Treeåšç´¢å¼•è¦†ç›–ã€‚</p><p>å½“å‘èµ·ä¸€ä¸ªç´¢å¼•è¦†ç›–æŸ¥è¯¢æ—¶ï¼Œåœ¨Explainçš„Extraåˆ—å¯ä»¥çœ‹åˆ°â€œUsing indexâ€çš„ä¿¡æ¯ï¼ˆExtraåˆ—çš„Using indexå’Œtypeåˆ—çš„inxexææ··æ·†ï¼Œå…¶å®ä¸¤è€…æˆ‘å®Œå…¨ä¸åŒï¼Œtypeåˆ—æ ‡è¯†æŸ¥è¯¢è®¿é—®æ•°æ®æ–¹å¼ï¼Œä¹Ÿç§°ä¹‹ä¸ºjoin typeï¼‰ã€‚</p><p>ç´¢å¼•è¦†ç›–æŸ¥è¯¢å¯èƒ½è¿˜æœ‰å¾ˆå¤šé™·é˜±å¯èƒ½å¯¼è‡´æ— æ³•å®ç°ä¼˜åŒ–ã€‚MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šåœ¨æ‰§è¡ŒæŸ¥è¯¢å‰åˆ¤æ–­æ˜¯å¦æœ‰ä¸€ä¸ªç´¢å¼•èƒ½è¿›è¡Œè¦†ç›–ã€‚å‡è®¾ç´¢å¼•è¦†ç›–äº†WHEREæ¡ä»¶ä¸­çš„å­—æ®µï¼Œä½†ä¸æ˜¯æ•´ä¸ªæŸ¥è¯¢æ¶‰åŠçš„å­—æ®µã€‚å¦‚æœæ¡ä»¶ä¸ºå‡ï¼ŒMySQL5.5å’Œæ›´æ—©ç‰ˆæœ¬ä¹Ÿæ€»æ˜¯ä¼šå›è¡¨è·å–æ•°æ®è¡Œï¼Œå°½ç®¡å¹¶ä¸éœ€è¦è¿™ä¸€è¡Œä¸”æœ€ç»ˆä¹Ÿä¼šè¢«è¿‡æ»¤æ‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">explain select * from products where actor=&apos;scan carrey&apos; and title like &apos;%APOLLO%&apos; --è¿™æ¡è¯­å¥ä½¿ç”¨çš„æ˜¯Extra:using where</span><br></pre></td></tr></table></figure><p>åŸå› ï¼š</p><ul><li><p>æ²¡æœ‰ä»»ä½•ç´¢å¼•èƒ½å¤Ÿè¦†ç›–è¿™ä¸ªæŸ¥è¯¢ã€‚å› ä¸ºæŸ¥è¯¢ä»è¡¨ä¸­é€‰æ‹©äº†æ‰€æœ‰åˆ—ï¼Œè€Œæ²¡æœ‰ä»»ä½•ç´¢å¼•è¦†ç›–äº†æ‰€æœ‰çš„åˆ—ã€‚MySQLå­˜åœ¨å¦ä¸€ä¸ªé€”å¾„ï¼šWHEREæ¡ä»¶ä¸­çš„åˆ—æ˜¯æœ‰ç´¢å¼•å¯ä»¥è¦†ç›–çš„ï¼Œå› æ­¤MySQLå¯ä»¥ä½¿ç”¨è¯¥ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„actorå¹¶æ£€æŸ¥titleæ˜¯å¦åŒ¹é…ï¼Œè¿‡æ»¤ä¹‹åå†è¯»å–éœ€è¦çš„æ•°æ®è¡Œã€‚</p></li><li><p>MySQLä¸èƒ½å†ç´¢å¼•ä¸­æ‰§è¡ŒLIKEæ“ä½œã€‚è¿™æ˜¯åº•å±‚å­˜å‚¨å¼•æ“APIçš„é™åˆ¶ï¼ŒMySQL5.5å’Œæ›´æ—©ç‰ˆæœ¬ä¸­åªå…è®¸åœ¨ç´¢å¼•ä¸­åšç®€å•æ¯”è¾ƒæ“ä½œã€‚MySQLèƒ½åœ¨ç´¢å¼•ä¸­åšæœ€å·¦å‰ç¼€åŒ¹é…çš„LIKEæŸ¥è¯¢ï¼Œå­˜å‚¨å¼•æ“å°±æ— æ³•æ¯”è¾ƒåŒ¹é…ã€‚MySQLæœåŠ¡å™¨åªèƒ½æå–æ•°æ®è¡Œçš„å€¼è€Œä¸æ˜¯ç´¢å¼•å€¼æ¥åšæ¯”è¾ƒã€‚</p></li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>å…ˆå°†ç´¢å¼•æ‰©å±•è‡³3ä¸ªï¼ˆartistï¼Œtitleï¼Œprod_idï¼‰,ç„¶åæŒ‰ç…§å¦‚ä¸‹æ–¹å¼é‡å†™æŸ¥è¯¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">explain select * from products join(select prob_id from products where actor=&apos;sean carrey&apos; and title like &apos;%APOLLO%&apos;) as t1 on(t1.prod_id=products.prod_id)</span><br></pre></td></tr></table></figure><p>Extra: using where;using index</p><p>æˆ‘ä»¬æŠŠè¿™ç§æ–¹å¼å«åšå»¶è¿Ÿå…³è”ï¼Œå› ä¸ºå»¶è¿Ÿäº†å¯¹åˆ—çš„è®¿é—®ã€‚åœ¨æŸ¥è¯¢çš„ç¬¬ä¸€é˜¶æ®µMySQLå¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œåœ¨FROMå­å¥çš„å­æŸ¥è¯¢ä¸­æ‰¾åˆ°åŒ¹é…çš„prod_id,ç„¶åæ ¹æ®è¿™äº›prop_idå€¼åœ¨å¤–å±‚æŸ¥è¯¢åŒ¹é…è·å–éœ€è¦çš„æ‰€æœ‰åˆ—å€¼ã€‚è™½ç„¶æ— æ³•ä½¿ç”¨ç´¢å¼•è¦†ç›–æ•´ä¸ªæŸ¥è¯¢ï¼Œä½†æ€»ç®—æ¯”å®Œå…¨æ— æ³•åˆ©ç”¨ç´¢å¼•è¦†ç›–çš„å¥½ã€‚</p><p>è¿™æ ·çš„ä¼˜åŒ–æ•ˆæœå–å†³äºWHEREæ¡ä»¶åŒ¹é…è¿”å›çš„è¡Œæ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾productsæœ‰100wè¡Œæ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªSQLåœ¨ä¸åŒçš„ä¸‰ä¸ªåœºæ™¯ä¸­æµ‹è¯•ã€‚</p><ol><li><p>sean carrey å‡ºæ¼”äº†3wéƒ¨ä½œå“ï¼Œ2wéƒ¨æ ‡é¢˜ä¸­åŒ…å«Apolloã€‚</p></li><li><p>sean carrey å‡ºæ¼”äº†3wéƒ¨ä½œå“ï¼Œ40éƒ¨æ ‡é¢˜ä¸­åŒ…å«Apolloã€‚</p></li><li><p>sean carrey å‡ºæ¼”äº†50éƒ¨ä½œå“ï¼Œ10éƒ¨æ ‡é¢˜ä¸­åŒ…å«Apolloã€‚</p></li></ol><p>æµ‹è¯•ç»“æœï¼š</p><table><br><br><tr><td>åºå·</td><td>åŸæŸ¥è¯¢</td><td>ä¼˜åŒ–å</td></tr><br><tr><td>1</td><td>5</td><td>5</td></tr><br><tr><td>2</td><td>7</td><td>35</td></tr><br><tr><td>3</td><td>2400</td><td>2000</td></tr><br><br></table><p>ç»“æœåˆ†æï¼š</p><p>å®ä¾‹1ä¸­ï¼ŒæŸ¥è¯¢è¿”å›äº†ä¸€ä¸ªå¾ˆå¤§çš„ç»“æœé›†ï¼Œå› æ­¤çœ‹ä¸åˆ°ä¼˜åŒ–ç»“æœã€‚å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨è¯»å–å’Œå‘é€æ•°æ®ä¸Šäº†ã€‚</p><p>å®ä¾‹2ä¸­ï¼Œç»è¿‡ç´¢å¼•è¿‡æ»¤ï¼Œå°¤å…¶ç¬¬äºŒä¸ªæ¡ä»¶è¿‡æ»¤ååªè¿”å›å¾ˆå°‘çš„ç»“æœé›†ï¼Œä¼˜åŒ–æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œä¼˜åŒ–æŸ¥è¯¢çš„æ•ˆç‡ä¸»è¦å¾—ç›Šäºåªéœ€è¦è¯»å–40è¡Œå®Œæ•´çš„æ•°æ®è¡Œã€‚</p><p>å®ä¾‹3ä¸­ï¼Œæ˜¾ç¤ºäº†å­æŸ¥è¯¢æ•ˆç‡åè€Œä¸‹é™çš„æƒ…å†µã€‚å› ä¸ºç´¢å¼•è¿‡æ»¤ç¬¦åˆç¬¬ä¸€ä¸ªæ¡ä»¶çš„ç»“æœé›†å·²ç»å¾ˆå°ï¼Œæ‰€ä»¥å­æŸ¥è¯¢å¸¦æ¥çš„æˆæœ¬åè€Œæ¯”ä»è¡¨ä¸­ç›´æ¥æå–å®Œæ•´è¡Œæ›´é«˜ã€‚</p><h4 id="ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"><a href="#ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº" class="headerlink" title="ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"></a>ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº</h4><p>MySQLæœ‰ä¸¤ç§æ–¹å¼ç”Ÿæˆæœ‰åºçš„ç»“æœï¼šé€šè¿‡æ’åºæ“ä½œã€‚æŒ‰ç´¢å¼•é¡ºåºæ‰«æã€‚</p><p>å¦‚æœexplainå‡ºæ¥çš„typeåˆ—çš„å€¼ä¸ºindexï¼Œåˆ™è¯´æ˜MySQLä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åºã€‚</p><p>æ‰«æç´¢å¼•æœ¬èº«æ˜¯å¾ˆå¿«çš„ï¼Œå› ä¸ºåªéœ€è¦ä»ä¸€æ¡ç´¢å¼•çºªå¾‹ç§»åŠ¨åˆ°ç´§æ¥ç€çš„ä¸‹ä¸€æ¡è®°å½•ã€‚ä½†å¦‚æœç´¢å¼•ä¸èƒ½è¦†ç›–æŸ¥è¯¢æ‰€éœ€çš„å…¨éƒ¨åˆ—ï¼Œé‚£å°±ä¸å¾—ä¸æ²¡æ‰«æä¸€æ¡ç´¢å¼•è®°å½•å°±éƒ½å›è¡¨æŸ¥è¯¢ä¸€æ¬¡å¯¹åº”çš„è¡Œã€‚è¿™åŸºæœ¬ä¸Šéƒ½æ˜¯éšæœºIOï¼Œå› æ­¤æŒ‰ç´¢å¼•é¡ºåºè¯»å–æ•°æ®çš„é€Ÿåº¦é€šå¸¸è¦æ¯”é¡ºåºçš„å…¨è¡¨æ‰«ææ…¢ï¼Œå°¤å…¶æ˜¯åœ¨IOå¯†é›†å‹çš„å·¥ä½œè´Ÿè½½æ—¶ã€‚</p><p>MySQLå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç´¢å¼•æ—¢æ»¡è¶³æ’åºï¼Œåˆæ»¡è¶³æŸ¥æ‰¾è¡Œã€‚</p><p>åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’Œ order byå­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘éƒ½ä¸€æ ·æ—¶ï¼ŒMySQLæ‰èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åºã€‚å¦‚æœæŸ¥è¯¢éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œåˆ™åªæœ‰å½“order byå­å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€ä¸ªè¡¨æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºã€‚order byå­å¥å’ŒæŸ¥æ‰¾å‹æŸ¥è¯¢çš„é™åˆ¶æ˜¯ä¸€æ ·çš„ï¼šéœ€è¦æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼Œå¦åˆ™MySQLéƒ½éœ€æ‰§è¡Œæ’åºæ“ä½œï¼Œè€Œæ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºã€‚</p><p>æœ‰ä¸€ç§æƒ…å†µä¸‹ order byå­å¥å¯ä»¥ä¸æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼Œå°±æ˜¯å‰å¯¼åˆ—ä¸ºå¸¸é‡çš„æ—¶å€™ã€‚å¦‚æœWHEREå­å¥æˆ–è€…JOINå­å¥ä¸­å¯¹è¿™äº›åˆ—æŒ‡å®šäº†å¸¸é‡ï¼Œå°±å¯ä»¥å¼¥è¡¥ç´¢å¼•çš„ä¸è¶³ã€‚</p><p>ä¾‹å¦‚ï¼šè¡¨rentalåœ¨åˆ—(rental_date,inventory_id,customer_id)ä¸Šæœ‰åä¸ºrental_dateçš„ç´¢å¼•ã€‚</p><p>å»ºè¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table rental(</span><br><span class="line">    primary key(rental_id),</span><br><span class="line">    unique key rental_date(rental_date,inventory_id,customer_id),</span><br><span class="line">    key idx_fk_inventory_id(inventory_id),</span><br><span class="line">    key idx_fk_customer(customer_id),</span><br><span class="line">    key idx_fk_staff_id(staff_id),</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ’åºï¼š</p><p><code>explain select rental_id,staff_id from sakila.rental where rental_date=&#39;2005-05-25&#39; order by inventory_id, customer_id</code></p><p>å³æ—¶order by å­å¥ä¸æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼Œä¹Ÿå¯ä»¥ç”¨äºæŸ¥è¯¢æ’åºï¼Œè¿™æ˜¯å› ä¸ºç´¢å¼•çš„ç¬¬ä¸€åˆ—è¢«æŒ‡å®šä¸ºä¸€ä¸ªå¸¸æ•°ã€‚</p><p>ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•æ’åºï¼Œæ˜¯å› ä¸ºæŸ¥è¯¢ä¸ºç´¢å¼•çš„ç¬¬ä¸€åˆ—æä¾›äº†å¸¸é‡æ¡ä»¶ï¼Œè€Œä½¿ç”¨ç¬¬äºŒåˆ—è¿›è¡Œæ’åºï¼Œå°†ä¸¤åˆ—ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†ç´¢å¼•çš„æœ€å·¦å‰ç¼€,æ€»çš„æ¥è¯´åªè¦æŸ¥è¯¢æ»¡è¶³æœ€å·¦å‰ç¼€å³å¯æ’åºï¼š</p><p><code>where rental_date=&#39;2005-05-05&#39; order by inventory_id desc</code></p><p>ä¸‹é¢æ˜¯ä¸€äº›ä¸èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢ï¼š</p><ul><li><p>è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨äº†ä¸¤ç§ä¸åŒçš„æ’åºæ–¹å‘ï¼Œä½†ç´¢å¼•åˆ—éƒ½æ˜¯æ­£åºæ’åºçš„ï¼š</p><p><code>where rental_date =&#39;2005-05-25&#39; order by inventory_id desc,customer_id asc</code></p></li></ul><ul><li><p>è¿™ä¸ªæŸ¥è¯¢çš„order by å­å¥ä¸­å¼•ç”¨äº†ä¸€ä¸ªä¸åœ¨ç´¢å¼•ä¸­çš„åˆ—ï¼š</p><p><code>where rental_date =&#39;2005-05-25&#39; order by inventory_id,staff_id</code></p></li><li><p>è¿™ä¸ªæŸ¥è¯¢çš„whereå’Œorder byä¸­çš„åˆ—æ— æ³•ç»„åˆæˆç´¢å¼•çš„æœ€å·¦å‰ç¼€ï¼š</p><p><code>where rental_date =&#39;2005-05-25&#39; order by customer_id</code></p></li><li><p>è¿™ä¸ªæŸ¥è¯¢åœ¨ç´¢å¼•åˆ—çš„ç¬¬ä¸€åˆ—ä¸Šæ˜¯èŒƒå›´æ¡ä»¶ï¼Œæ‰€ä»¥MySQLæ— æ³•ä½¿ç”¨ç´¢å¼•çš„å…¶ä½™åˆ—ï¼š</p></li></ul><p><code>where rental_date &gt; &#39;2005-05-25 order by ...</code> </p><ul><li>è¿™ä¸ªæŸ¥è¯¢åœ¨inventory_idä¸Šæœ‰å¤šä¸ªç­‰äºæ¡ä»¶ï¼Œå¯¹äºæ’åºæ¥è¯´ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§èŒƒå›´æŸ¥è¯¢ï¼š</li></ul><p><code>where rental_date=&#39;2015-05-25&#39; and inventory_id in(1,2) order by customer_id</code></p><p>ä¸‹é¢è¿™ä¸ªä¾‹å­ç†è®ºä¸Šæ˜¯å¯ä»¥ä½¿ç”¨ç´¢å¼•è¿›è¡Œå…³è”æ’åºçš„ï¼Œä½†ç”±äºä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æ—¶å°†film_actorè¡¨å½“åšå…³è”çš„ç¬¬äºŒå¼ è¡¨ï¼Œæ‰€ä»¥å®é™…ä¸Šæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼š</p><p><code>explain select actor_id,title from sakila.film_actor inner join sakila.film using(film_id) order by actor_id</code></p><p>ä½¿ç”¨ç´¢å¼•æ’åºåšæ’åºçš„ä¸€ä¸ªé‡è¦çš„ç”¨æ³•æ˜¯å½“æŸ¥è¯¢åŒæ—¶æœ‰order byå’Œlimitå­å¥çš„æ—¶å€™ã€‚</p><h4 id="å‹ç¼©ç´¢å¼•"><a href="#å‹ç¼©ç´¢å¼•" class="headerlink" title="å‹ç¼©ç´¢å¼•"></a>å‹ç¼©ç´¢å¼•</h4><p>MyISAMä½¿ç”¨å‰ç¼€å‹ç¼©æ¥å‡å°‘ç´¢å¼•çš„å¤§å°ï¼Œä»è€Œè®©æ›´å¤šçš„ç´¢å¼•å¯ä»¥æ”¾å…¥åˆ°å†…å­˜ä¸­ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹èƒ½æå¤§çš„æé«˜æ€§èƒ½ã€‚é»˜è®¤åªå‹ç¼©å­—ç¬¦ä¸²ï¼Œä½†é€šè¿‡å‚æ•°è®¾ç½®ä¹Ÿå¯ä»¥å¯¹æ•´æ•°è¿›è¡Œå‹ç¼©ã€‚</p><p>MyISAMçš„å‹ç¼©æ–¹æ³•æ˜¯ï¼šå…ˆå®Œå…¨ä¿å­˜ç´¢å¼•å—çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç„¶åå°†å…¶ä»–å€¼å’Œç¬¬ä¸€ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒå¾—åˆ°ç›¸åŒçš„å‰ç¼€çš„å­—èŠ‚æ•°å’Œå‰©ä½™çš„ä¸åŒåç¼€éƒ¨åˆ†ï¼ŒæŠŠè¿™éƒ¨åˆ†å­˜å‚¨èµ·æ¥å³å¯ã€‚</p><p>å‹ç¼©å—ä½¿ç”¨æ›´å°‘çš„æ—¶é—´ï¼Œä»£ä»·æ˜¯æŸäº›æ“ä½œå¯èƒ½æ›´æ…¢ã€‚å› ä¸ºæ¯ä¸ªå€¼çš„å‹ç¼©å‰ç¼€éƒ½ä¾èµ–å‰é¢çš„å€¼ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾è€Œåªèƒ½ä»å¤´å¼€å§‹ã€‚æ­£åºå¿«ï¼Œå€’åºæ…¢ã€‚</p><p>ä½¿ç”¨pack_keysæ¥æ§åˆ¶ç´¢å¼•å‹ç¼©çš„æ–¹å¼ã€‚</p><h4 id="å†—ä½™å’Œé‡å¤çš„ç´¢å¼•"><a href="#å†—ä½™å’Œé‡å¤çš„ç´¢å¼•" class="headerlink" title="å†—ä½™å’Œé‡å¤çš„ç´¢å¼•"></a>å†—ä½™å’Œé‡å¤çš„ç´¢å¼•</h4><p>MySQLå…è®¸åœ¨ç›¸åŒåˆ—ä¸Šåˆ›å»ºå¤šä¸ªç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦å•ç‹¬ç»´æŠ¤é‡å¤çš„ç´¢å¼•ï¼Œå¹¶ä¸”ä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿéœ€è¦é€ä¸ªçš„è¿›è¡Œè€ƒè™‘ï¼Œå½±å“æ€§èƒ½ã€‚</p><p>é‡å¤ç´¢å¼•æ˜¯æŒ‡åœ¨ç›¸åŒåˆ—ä¸ŠæŒ‰ç…§ç›¸åŒçš„é¡ºåºåˆ›å»ºçš„ç›¸åŒç±»å‹çš„ç´¢å¼•ã€‚</p><p>é”™è¯¯ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">create table test(</span><br><span class="line"> id int not null primary key,</span><br><span class="line"> a int not null,</span><br><span class="line"> b int not null,</span><br><span class="line"> unique(id),</span><br><span class="line"> index(id)</span><br><span class="line">)engine=InnoDB;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å…¶å®ç»™idåˆ›å»ºäº†3æ¡ç´¢å¼•ï¼ŒMySQLçš„å”¯ä¸€é™åˆ¶å’Œä¸»é”®é™åˆ¶éƒ½æ˜¯é€šè¿‡ç´¢å¼•å®ç°çš„ã€‚</p><p>é€šå¸¸æ²¡æœ‰ç†ç”±åœ¨åŒä¸€åˆ—ä¸Šåˆ›å»ºå¤šæ¡ç´¢å¼•ï¼Œé™¤éåœ¨åŒä¸€åˆ—ä¸Šåˆ›å»ºä¸åŒç±»å‹çš„ç´¢å¼•æ¥æ»¡è¶³æŸ¥è¯¢éœ€æ±‚ã€‚ä¾‹å¦‚keyï¼ˆidï¼‰å’Œfulltext keyï¼ˆidï¼‰å°±æ˜¯ä¸¤ç§ç±»å‹çš„ç´¢å¼•ã€‚</p><p>å†—ä½™å’Œé‡å¤æœ‰äº›ä¸åŒï¼Œå¦‚æœåˆ›å»ºäº†ç´¢å¼•ï¼ˆA,Bï¼‰ï¼Œå†åˆ›å»ºï¼ˆAï¼‰ï¼Œåˆ™ï¼ˆAï¼‰å°±æ˜¯å†—ä½™çš„ã€‚è¿™ç§å†—ä½™åªæ˜¯å¯¹B-Treeæ¥è¯´çš„ã€‚å¦å¤–ï¼Œå…¶ä»–ä¸åŒç±»å‹çš„ç´¢å¼•ï¼ˆå“ˆå¸Œç´¢å¼•æˆ–è€…å…¨æ–‡ç´¢å¼•ï¼‰ä¹Ÿä¸ä¼šæ˜¯B-Treeç´¢å¼•çš„å†—ä½™ç´¢å¼•ï¼Œè€Œæ— è®ºè¦†ç›–çš„ç´¢å¼•åˆ—æ˜¯ä»€ä¹ˆã€‚</p><p>å†—ä½™ç´¢å¼•é€šå¸¸å‘ç”Ÿåœ¨ä¸ºè¡¨æ·»åŠ æ–°ç´¢å¼•çš„æ—¶å€™ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸éœ€è¦å†—ä½™ç´¢å¼•ï¼Œåº”è¯¥å°½é‡æ‰©å±•å·²ç»æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ã€‚æœ‰æ—¶å€™å‡ºäºæ€§èƒ½é—®é¢˜ä¹Ÿè€ƒè™‘å†—ä½™ç´¢å¼•ï¼Œå› ä¸ºæ‰©å±•å·²æœ‰çš„ç´¢å¼•ä¼šå¯¼è‡´å…¶å˜çš„å¤ªå¤§ï¼Œä»è€Œå½±å“å…¶ä»–ä½¿ç”¨è¯¥ç´¢å¼•çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p><h4 id="æœªä½¿ç”¨çš„ç´¢å¼•"><a href="#æœªä½¿ç”¨çš„ç´¢å¼•" class="headerlink" title="æœªä½¿ç”¨çš„ç´¢å¼•"></a>æœªä½¿ç”¨çš„ç´¢å¼•</h4><p>é™¤äº†å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼Œå¯èƒ½è¿˜ä¼šæœ‰ä¸€äº›æœåŠ¡å™¨æ°¸è¿œä¸ç”¨çš„ç´¢å¼•ã€‚å»ºè®®åˆ é™¤ã€‚</p><p>æœ€ç®€å•æœ‰æ•ˆçš„åŠæ³•æ˜¯åœ¨Percona Serveræˆ–è€…MariaDBä¸­å…ˆæ‰“å¼€userstatesæœåŠ¡å™¨å˜é‡ï¼Œç„¶åè®©æœåŠ¡å™¨æ­£å¸¸è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå†é€šè¿‡æŸ¥è¯¢Information_schema.index_statisticså°±èƒ½æŸ¥åˆ°æ¯ä¸ªç´¢å¼•çš„ä½¿ç”¨é¢‘ç‡ã€‚</p><p>è¿˜å¯ä»¥ä½¿ç”¨Percona Toolkitä¸­çš„pt-index-usageï¼Œè¯¥å·¥å…·å¯ä»¥è¯»å–æŸ¥è¯¢æ—¥å¿—ï¼Œå¹¶å¯¹æ—¥å¿—ä¸­çš„æ¯æ¡æŸ¥è¯¢è¿›è¡Œexplainæ“ä½œï¼Œç„¶åæ‰“å°å‡ºå…³äºç´¢å¼•å’ŒæŸ¥è¯¢çš„æŠ¥å‘Šã€‚</p><h4 id="ç´¢å¼•å’Œé”"><a href="#ç´¢å¼•å’Œé”" class="headerlink" title="ç´¢å¼•å’Œé”"></a>ç´¢å¼•å’Œé”</h4><p>ç´¢å¼•å¯ä»¥è®©æŸ¥è¯¢é”å®šæ›´å°‘çš„è¡Œã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>InnoDBçš„è¡Œé”æ•ˆç‡å¾ˆé«˜ï¼Œå†…å­˜ä½¿ç”¨ä¹Ÿå¾ˆå°‘ï¼Œä½†æ˜¯é”å®šè¡Œçš„æ—¶å€™ä»ç„¶ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚</p></li><li><p>é”å®šè¶…è¿‡éœ€è¦çš„è¡Œä¼šå¢åŠ é”äº‰ç”¨å¹¶å‡å°‘å¹¶å‘æ€§ã€‚</p></li></ul><p>InnoDBåªæœ‰åœ¨è®¿é—®è¡Œçš„æ—¶å€™æ‰ä¼šå¯¹å…¶åŠ é”ï¼Œè€Œç´¢å¼•èƒ½å¤Ÿå‡å°‘InnoDBè®¿é—®è¡Œæ•°ï¼Œä»è€Œå‡å°‘é”çš„æ•°é‡ã€‚åªæœ‰å½“InnoDBåœ¨å­˜å‚¨å¼•æ“å±‚èƒ½å¤Ÿè¿‡æ»¤æ‰€æœ‰ä¸éœ€è¦çš„è¡Œæ—¶æ‰æœ‰æ•ˆã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">set autocommmit = 0;</span><br><span class="line">begin;</span><br><span class="line">select actor_id from sakila.actor where actor_id &lt; 5 and actor_id &lt;&gt; 1 for update;</span><br></pre></td></tr></table></figure><table><tr><td>actor_id</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr></table><p>è¿™æ¡æŸ¥è¯¢ä»…ä»…ä¼šè¿”å›2-4è¡Œæ•°æ®ï¼Œä½†æ˜¯å®é™…ä¸Šè·å–äº†1-4è¡Œä¹‹é—´çš„è¡Œçš„æ’å®ƒé”ã€‚é”ä½ç¬¬ä¸€è¡Œæ˜¯å› ä¸ºMySQLä¸ºè¯¥æŸ¥è¯¢é€‰æ‹©çš„æ‰§è¡Œè®¡åˆ’æ˜¯ç´¢å¼•èŒƒå›´æ‰«æï¼š</p><table><br>    <tr><td>id</td><td>select_type</td><td>table</td><td>type</td><td>key</td><td>Extra</td></tr><br>    <tr><td>1</td><td>SIMPLE</td><td>actor</td><td>range</td><td>PRIMARY</td><td>Using where;Using index</td></tr><br><br></table><p>é—®é¢˜ï¼šå¦‚æœä¸èƒ½ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾å’Œé”å®šè¡Œçš„è¯é—®é¢˜å¯èƒ½ä¼šæ›´ç³Ÿç³•ï¼ŒMySQLä¼šåšå…¨è¡¨æ‰«æå¹¶é”ä½æ‰€æœ‰çš„è¡Œã€‚</p><p>InnoDBåœ¨äºŒçº§ç´¢å¼•ä¸Šä½¿ç”¨å…±äº«é”ï¼Œä½†è®¿é—®ä¸»é”®ç´¢å¼•éœ€è¦æ’ä»–é”ã€‚è¿™æ¶ˆé™¤äº†ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”ä½¿å¾—<code>select for update</code> æ¯”<code>lock in share mode</code>æˆ–éé”å®šæŸ¥è¯¢è¦æ…¢çš„å¤šã€‚</p><h3 id="ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ "><a href="#ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ " class="headerlink" title="ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ "></a>ç´¢å¼•æ¡ˆä¾‹å­¦ä¹ </h3><h3 id="ç»´æŠ¤ç´¢å¼•å’Œè¡¨"><a href="#ç»´æŠ¤ç´¢å¼•å’Œè¡¨" class="headerlink" title="ç»´æŠ¤ç´¢å¼•å’Œè¡¨"></a>ç»´æŠ¤ç´¢å¼•å’Œè¡¨</h3><p>ç»´æŠ¤è¡¨æœ‰3ä¸ªç›®çš„ï¼šæ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨ï¼Œç»´æŠ¤å‡†ç¡®çš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ï¼Œå‡å°‘ç¢ç‰‡ã€‚</p><h4 id="æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨"><a href="#æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨" class="headerlink" title="æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨"></a>æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨</h4><p>è¡¨æŸåï¼ˆcorruptionï¼‰æ˜¯ä»¶å¾ˆç³Ÿç³•çš„äº‹æƒ…ã€‚å¯¹äºMyISAMï¼Œè¡¨æŸåé€šå¸¸æ˜¯ç³»ç»Ÿå´©æºƒå¯¼è‡´çš„ã€‚</p><p>æŸåçš„ç´¢å¼•ä¼šå¯¼è‡´æŸ¥è¯¢è¿”å›é”™è¯¯çš„ç»“æœæˆ–è€…è«é¡»æœ‰çš„ä¸»é”®å†²çªç­‰é—®é¢˜ï¼Œä¸¥é‡æ—¶ç”šè‡³è¿˜ä¼šå¯¼è‡´æ•°æ®åº“çš„å´©æºƒã€‚</p><p>ä¿®å¤ï¼š</p><ul><li><p>check tableï¼Œèƒ½æ‰¾å‡ºå¤§å¤šæ•°è¡¨å’Œç´¢å¼•é”™è¯¯ã€‚æœ‰äº›å­˜å‚¨å¼•æ“ä¸æ”¯æŒè¯¥å‘½ä»¤ã€‚</p></li><li><p>repair tableï¼Œå’Œcheckç±»ä¼¼ã€‚</p></li><li><p>alter table innodb_tbl engine=innodbï¼Œä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“ä¸ºå½“å‰å¼•æ“é‡å»ºè¡¨ã€‚</p></li><li><p>ç¦»çº¿å·¥å…·myisamchk</p></li><li><p>å°†æ•°æ®å¯¼å‡ºåœ¨é‡æ–°å¯¼å…¥ã€‚</p></li><li><p>å¦‚æœæŸåçš„æ˜¯è¡Œæ•°æ®æˆ–è€…ç³»ç»ŸåŒºåŸŸï¼Œä»¥ä¸ŠåŠæ³•æ— æ•ˆã€‚</p></li><li><p>å¦‚æœæŸåç³»ç»ŸåŒºåŸŸæˆ–è€…è¡Œæ•°æ®ï¼Œå¯ä»¥ä»å¤‡ä»½ä¸­æ¢å¤è¡¨ï¼Œæˆ–è€…å°è¯•ä»æŸåçš„æ•°æ®æ–‡ä»¶ä¸­å°½å¯èƒ½çš„æ¢å¤æ•°æ®ã€‚</p></li></ul><p>å¦‚æœInnoDBå¼•æ“çš„è¡¨å‡ºç°æŸåï¼Œé‚£ä¹ˆä¸€å®šæ˜¯å‘ç”Ÿäº†ä¸¥é‡çš„é”™è¯¯ï¼Œéœ€è¦ç«‹åˆ»è°ƒæŸ¥åŸå› ã€‚å…·ä½“ç»†èŠ‚å¯ä»¥æŸ¥çœ‹MySQLæ‰‹å†Œã€‚</p><h4 id="æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯"><a href="#æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯"></a>æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯</h4><h4 id="å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡"><a href="#å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡" class="headerlink" title="å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡"></a>å‡å°‘ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡</h4><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸‰ä¸ªåŸåˆ™ï¼š</p><ul><li><p>å•è¡Œè®¿é—®æ—¶å¾ˆæ…¢çš„ã€‚æœ€å¥½è¯»å–å—ä¸­èƒ½åŒ…å«å°½å¯èƒ½å¤šçš„æ‰€éœ€è¦çš„è¡Œã€‚ä½¿ç”¨ç´¢å¼•å¯ä»¥åˆ›å»ºä½ç½®å¼•ç”¨ä»¥æå‡æ•ˆç‡ã€‚</p></li><li><p>æŒ‰é¡ºåºè®¿é—®èŒƒå›´æ•°æ®æ˜¯å¾ˆå¿«çš„ï¼Œè¿™æœ‰ä¸¤ä¸ªåŸå› ã€‚ç¬¬ä¸€ã€é¡ºåºIOä¸éœ€è¦å¤šæ¬¡ç£ç›˜å¯»é“ï¼Œæ‰€ä»¥æ¯”éšæœºIOå¿«å¾ˆå¤šã€‚ç¬¬äºŒã€å¦‚æœæœåŠ¡å™¨èƒ½å¤ŸæŒ‰éœ€è¦é¡ºåºè¯»å–æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦é¢å¤–çš„æ’åºæ“ä½œï¼Œå¹¶ä¸”group byæŸ¥è¯¢ä¹Ÿæ— éœ€å†åšæ’åºå’Œå°†è¡ŒæŒ‰ç»„è¿›è¡Œèšåˆè®¡ç®—äº†ã€‚</p></li><li><p>ç´¢å¼•è¦†ç›–æŸ¥è¯¢æ˜¯å¾ˆå¿«çš„ã€‚</p></li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å»ºè®®æŒ‰å“åº”æ—¶é—´æ¥å¯¹æŸ¥è¯¢è¿›è¡Œåˆ†æã€‚</p><p>å¦‚æœä¸€ä¸ªæŸ¥è¯¢æ— æ³•ä»æ‰€æœ‰å¯èƒ½çš„ç´¢å¼•ä¸­è·ç›Šï¼Œåˆ™åº”è¯¥çœ‹çœ‹æ˜¯å¦å¯ä»¥åˆ›å»ºä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•æ¥æå‡æ€§èƒ½ã€‚</p><h2 id="å‰–æMySQLæŸ¥è¯¢"><a href="#å‰–æMySQLæŸ¥è¯¢" class="headerlink" title="å‰–æMySQLæŸ¥è¯¢"></a>å‰–æMySQLæŸ¥è¯¢</h2><p>å¯¹æŸ¥è¯¢è¿›è¡Œæ€§èƒ½å‰–ææœ‰ä¸¤ç§æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å„è‡ªçš„é—®é¢˜ã€‚</p><h3 id="å‰–ææœåŠ¡å™¨è´Ÿè½½"><a href="#å‰–ææœåŠ¡å™¨è´Ÿè½½" class="headerlink" title="å‰–ææœåŠ¡å™¨è´Ÿè½½"></a>å‰–ææœåŠ¡å™¨è´Ÿè½½</h3><p>æœåŠ¡å™¨ç«¯å¯ä»¥æœ‰æ•ˆçš„å®¡è®¡æ•ˆç‡ä½ä¸‹çš„æŸ¥è¯¢ã€‚</p><h4 id="æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­"><a href="#æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­" class="headerlink" title="æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­"></a>æ•è·MySQLçš„æŸ¥è¯¢åˆ°æ—¥å¿—æ–‡ä»¶ä¸­</h4><p>æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ä¸€ç§è½»é‡è€Œä¸”åŠŸèƒ½å…¨é¢çš„æ€§èƒ½å‰–æå·¥å…·ï¼Œæ˜¯ä¼˜åŒ–æœåŠ¡å™¨æŸ¥è¯¢çš„åˆ©å™¨ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹é’ˆå¯¹æ¯ä¸ªé“¾æ¥çš„long_query_timeçš„é˜ˆå€¼æ¥æ•è·æ‰€ä»¥çš„æŸ¥è¯¢ã€‚</p><p>é€šç”¨æ—¥å¿—åœ¨æŸ¥è¯¢è¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶è¿›è¡Œè®°å½•ï¼Œæ‰€ä»¥ä¸åŒ…å«å“åº”æ—¶é—´å’Œæ‰§è¡Œè®¡åˆ’ç­‰é‡è¦ä¿¡æ¯ã€‚æ—¥å¿—ä¿¡æ¯è®°å½•åˆ°æ•°æ®åº“è¡¨ä¸­ã€‚</p><h4 id="åˆ†ææŸ¥è¯¢æ—¥å¿—"><a href="#åˆ†ææŸ¥è¯¢æ—¥å¿—" class="headerlink" title="åˆ†ææŸ¥è¯¢æ—¥å¿—"></a>åˆ†ææŸ¥è¯¢æ—¥å¿—</h4><p>å·¥å…·ï¼špt-query-digest</p><p>å‰–ææŠ¥å‘Šï¼š<br><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/digest1.png?raw=true" alt="æŸ¥è¯¢æ—¥å¿—"></p><p>è¯¦ç»†æŠ¥å‘Šï¼š<br><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/digest2.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><h3 id="å‰–æå•æ¡æŸ¥è¯¢"><a href="#å‰–æå•æ¡æŸ¥è¯¢" class="headerlink" title="å‰–æå•æ¡æŸ¥è¯¢"></a>å‰–æå•æ¡æŸ¥è¯¢</h3><h4 id="show-profile"><a href="#show-profile" class="headerlink" title="show profile"></a>show profile</h4><p>show profileå‘½ä»¤æ˜¯åœ¨5.1ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ï¼Œé»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡<code>set profiling=1</code>åŠ¨æ€çš„ä¿®æ”¹ã€‚è¿™ä¸ªåŠŸèƒ½æœ‰ä¸€å®šçš„ä½œç”¨ï¼Œå°†æ¥èƒ½ä¼šè¢«Performance Schemaæ‰€å–ä»£ã€‚</p><p>ä¸‹é¢æ˜¯å¯¹ä¸€ä¸ªè§†å›¾çš„å‰–æç»“æœï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/profiling1.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/profiling2.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/profiling3.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>å‰–ææŠ¥å‘Šç»™å‡ºæŸ¥è¯¢æ‰§è¡Œæ¯ä¸ªæ­¥éª¤èŠ±è´¹çš„æ—¶é—´ï¼Œçœ‹ç»“æœæ— æ³•å¿«é€Ÿç¡®å®šå“ªä¸ªæ­¥éª¤èŠ±è´¹æ—¶é—´æœ€å¤šï¼Œå› ä¸ºè¾“å‡ºæ˜¯æŒ‰ç…§æ‰§è¡Œé¡ºåºæ’åºï¼Œè€Œä¸æ˜¯èŠ±è´¹çš„æ—¶é—´æ’åºçš„ã€‚å¦‚æœä¸ä½¿ç”¨show profileå‘½ä»¤ã€‚è¿˜å¯ä»¥ç›´æ¥æŸ¥è¯¢information_schemaä¸­å¯¹åº”çš„è¡¨ï¼ŒæŒ‰ç…§æ ¼å¼åŒ–è¾“å‡ºã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/information_schema.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>æ•ˆæœæ¯”çœ‹show profileè¾“å‡ºçš„ç»“æœå¥½å¾ˆå¤šï¼Œå¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°å“ªäº›æ­¥éª¤èŠ±è´¹æ—¶é•¿è¾ƒé•¿ã€‚</p><h2 id="æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"><a href="#æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"></a>æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</h2><h3 id="æŸ¥è¯¢æ…¢çš„åŸå› "><a href="#æŸ¥è¯¢æ…¢çš„åŸå› " class="headerlink" title="æŸ¥è¯¢æ…¢çš„åŸå› "></a>æŸ¥è¯¢æ…¢çš„åŸå› </h3><p>æŸ¥è¯¢æœ€é‡è¦çš„æ˜¯å“åº”æ—¶é—´ï¼Œå¦‚æœè¦ä¼˜åŒ–æŸ¥è¯¢ï¼Œå®é™…ä¸Šè¦ä¼˜åŒ–å…¶å­ä»»åŠ¡ï¼Œè¦ä¹ˆæ¶ˆé™¤å…¶ä¸­ä¸€äº›å­ä»»åŠ¡ï¼Œè¦ä¹ˆå‡å°‘å­ä»»åŠ¡çš„æ‰§è¡Œæ¬¡æ•°ï¼Œè¦ä¹ˆè®©å­ä»»åŠ¡è¿è¡Œæ›´å¿«ã€‚</p><p>MySQLæ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼ŒæŸ¥è¯¢éœ€è¦åœ¨ä¸åŒçš„åœ°æ–¹èŠ±è´¹æ—¶é—´ï¼Œå¦‚ç½‘ç»œã€cpuã€ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯å’Œæ‰§è¡Œè®¡åˆ’ã€é”ç­‰å¾…ç­‰ã€‚åœ¨æ¯ä¸€ä¸ªæ¶ˆè€—å¤§é‡æ—¶é—´çš„æŸ¥è¯¢æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½èƒ½çœ‹åˆ°ä¸€äº›ä¸å¿…è¦çš„é¢å¤–æ“ä½œã€æŸäº›æ“ä½œè¢«é¢å¤–çš„æ‰§è¡Œäº†å¾ˆå¤šæ¬¡ã€æŸäº›æ“ä½œæ‰§è¡Œçš„å¤ªæ…¢ç­‰ã€‚</p><p>ä¼˜åŒ–æŸ¥è¯¢çš„ç›®çš„å°±æ˜¯å‡å°‘å’Œæ¶ˆé™¤è¿™äº›æ“ä½œæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p><h3 id="æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®"><a href="#æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®" class="headerlink" title="æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®"></a>æ…¢æŸ¥è¯¢åŸºç¡€ï¼šä¼˜åŒ–æ•°æ®è®¿é—®</h3><p>æŸ¥è¯¢æ€§èƒ½ä½ä¸‹æœ€åŸºæœ¬çš„åŸå› æ˜¯è®¿é—®çš„æ•°æ®å¤ªå¤šã€‚æŸäº›æŸ¥è¯¢ä¸å¯é¿å…çš„éœ€è¦ç­›é€‰å¤§é‡æ•°æ®ï¼Œå¤§éƒ¨åˆ†æŸ¥è¯¢éƒ½å¯ä»¥é€šè¿‡å‡å°‘è®¿é—®çš„æ•°æ®é‡çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚å¯¹äºä½æ•ˆæŸ¥è¯¢å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤åˆ†æï¼š</p><ul><li><p>1.ç¡®è®¤åº”ç”¨ç¨‹åºæ˜¯å¦æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®ã€‚å¦‚è®¿é—®è¿‡å¤šçš„è¡Œæˆ–è€…åˆ—ã€‚</p></li><li><p>2.ç¡®å®šMySQLæœåŠ¡å™¨å±‚æ˜¯å¦åœ¨åˆ†æå¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®è¡Œã€‚</p></li></ul><h4 id="æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®"><a href="#æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®" class="headerlink" title="æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®"></a>æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®</h4><ul><li><p>æŸ¥è¯¢ä¸éœ€è¦çš„è®°å½•</p></li><li><p>å¤šè¡¨å…³è”è¿”å›å…¨éƒ¨çš„åˆ—</p></li><li><p>æ€»æ˜¯å–å‡ºå…¨éƒ¨çš„åˆ—</p></li><li><p>é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®</p></li></ul><h4 id="MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•"><a href="#MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•" class="headerlink" title="MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•"></a>MySQLæ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•</h4><p>åœ¨ç¡®å®šæŸ¥è¯¢åªè¿”å›éœ€è¦çš„æ•°æ®ä»¥åï¼Œæœ€ç®€å•çš„è¡¡é‡æŸ¥è¯¢å¼€é”€çš„ä¸‰ä¸ªæŒ‡æ ‡å¦‚ä¸‹ï¼š</p><ul><li><p>å“åº”æ—¶é—´</p></li><li><p>æ‰«æçš„è¡Œæ•°</p></li><li><p>è¿”å›çš„è¡Œæ•°</p></li></ul><p>å“åº”æ—¶é—´ï¼šå“åº”æ—¶é—´åªæ˜¯ä¸€ä¸ªè¡¨é¢ä¸Šçš„å€¼ã€‚å“åº”æ—¶é—´æ˜¯æœåŠ¡æ—¶é—´å’Œæ’é˜Ÿæ—¶é—´ã€‚æœåŠ¡æ—¶é—´æŒ‡æ•°æ®åº“å¤„ç†è¿™ä¸ªæ—¶é—´èŠ±è´¹çš„æ—¶é—´ã€‚æ’é˜Ÿæ—¶é—´æŒ‡æœåŠ¡å™¨å› ä¸ºç­‰å¾…æŸäº›èµ„æºè€Œæ²¡æœ‰çœŸæ­£æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶é—´ã€‚</p><p>å¿«é€Ÿä¸Šé™ä¼°è®¡ï¼šäº†è§£æŸ¥è¯¢éœ€è¦å“ªäº›ç´¢å¼•ä»¥åŠå®ƒçš„æ‰§è¡Œè®¡åˆ’æ˜¯ä»€ä¹ˆï¼Œç„¶åè®¡ç®—å¤§æ¦‚éœ€è¦å¤šå°‘ä¸ªé¡ºåºå’ŒéšæœºIOï¼Œå†ç”¨å…¶ä¹˜ä»¥åœ¨å…·ä½“ç¡¬ä»¶æ¡ä»¶ä¸‹ä¸€æ¬¡IOçš„æ¶ˆè€—æ—¶é—´ã€‚</p><p>æ‰«æçš„è¡Œæ•°å’Œè¿”å›çš„è¡Œæ•°ï¼š åˆ†ææŸ¥è¯¢æ—¶ï¼ŒæŸ¥çœ‹æ‰«æçš„è¡Œæ•°ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åæ˜ å‡ºè¯¥æŸ¥è¯¢æ‰¾åˆ°éœ€è¦çš„æ•°æ®çš„æ•ˆç‡é«˜ä¸é«˜ã€‚</p><p>æ‰«æçš„è¡Œæ•°å’Œè®¿é—®ç±»å‹ï¼šåœ¨explainè¯­å¥ä¸­çš„typeåˆ—åæ˜ äº†è®¿é—®ç±»å‹ã€‚è®¿é—®ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œä»å…¨è¡¨æ‰«æåˆ°ç´¢å¼•æ‰«æã€èŒƒå›´æ‰«æã€å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€å¸¸æ•°å¼•ç”¨ç­‰ã€‚ä»æ…¢åˆ°å¿«ï¼Œæ‰«æçš„è¡Œæ•°ä»å°åˆ°å¤§ã€‚</p><p>å¦‚æœæŸ¥è¯¢æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„è®¿é—®ç±»å‹ï¼Œé‚£ä¹ˆè§£å†³çš„æœ€å¥½åŠæ³•é€šå¸¸æ˜¯å¢åŠ ä¸€ä¸ªåˆé€‚çš„ç´¢å¼•ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p><code>select * from sakila.film_actor where film_id = 1;</code></p><p>è¿™ä¸ªæŸ¥è¯¢è¿”å›10è¡Œæ•°æ®ï¼Œä»explainçš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒMySQLåœ¨ç´¢å¼•idx_fk_film_idä¸Šä½¿ç”¨äº†refè®¿é—®ç±»å‹æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/ref.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>explainçš„ç»“æœä¹Ÿæ˜¾ç¤ºMySQLé¢„ä¼°éœ€è¦è®¿é—®10è¡Œæ•°æ®ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨è®¤ä¸ºè¿™ç§è®¿é—®ç±»å‹å¯ä»¥é«˜æ•ˆçš„å®ŒæˆæŸ¥è¯¢ã€‚å¦‚æœæˆ‘ä»¬åˆ é™¤ç´¢å¼•å†æ¥è¿è¡Œï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/where.png?raw=true" alt="è¯¦ç»†æŸ¥è¯¢æ—¥å¿—"></p><p>æ­£å¦‚æˆ‘ä»¬é¢„æ–™çš„ï¼ŒæŸ¥è¯¢å˜æˆå…¨è¡¨æ‰«æï¼ŒMySQLé¢„ä¼°ä¼šæ‰«æ5073æ¡è®°å½•æ¥å®ŒæˆæŸ¥è¯¢ã€‚</p><p>ä¸€èˆ¬MySQLä½¿ç”¨å¦‚ä¸‹ä¸‰ç§æ–¹å¼åº”ç”¨WHEREæ¡ä»¶ï¼Œä»å¥½åˆ°åä¾æ¬¡æ˜¯ï¼š</p><ul><li><p>åœ¨ç´¢å¼•ä¸­ä½¿ç”¨WHEREæ¡ä»¶æ¥è¿‡æ»¤ä¸åŒ¹é…çš„è®°å½•ã€‚è¿™æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®Œæˆçš„ã€‚</p></li><li><p>ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼ˆExtra:using indexï¼‰æ¥è¿”å›è®°å½•ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿‡æ»¤ä¸éœ€è¦çš„è®°å½•å¹¶è¿”å›å‘½ä¸­çš„ç»“æœã€‚è¿™æ˜¯åœ¨MySQLæœåŠ¡å™¨å±‚å®Œæˆçš„ï¼Œä½†æ— éœ€å†å›è¡¨æŸ¥è¯¢è®°å½•ã€‚</p></li><li><p>ä»æ•°æ®è¡¨ä¸­è¿”å›æ•°æ®ï¼ˆExtra:using whereï¼‰ï¼Œç„¶åè¿‡æ»¤ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚è¿™æ˜¯åœ¨æœåŠ¡å™¨å±‚å®Œæˆçš„ï¼ŒMySQLéœ€è¦ä»æ•°æ®è¡¨ä¸­è¯»å‡ºæ¥ç„¶åå†è¿›è¡Œè¿‡æ»¤ã€‚</p></li></ul><p>è™½ç„¶ä¾‹å­è¯´æ˜äº†å¥½çš„ç´¢å¼•å¤šä¹ˆé‡è¦ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯è¯´å¢åŠ äº†ç´¢å¼•å°±èƒ½è®©æ‰«æçš„è¡Œæ•°ç­‰äºè¿”å›çš„è¡Œæ•°ã€‚ä¾‹å¦‚ä½¿ç”¨èšåˆå‡½æ•°çš„æŸ¥è¯¢ï¼š</p><p><code>select actor_id,count(*) from sakila.film_actor group by actor_id</code></p><p>è¿™ä¸ªä¾‹å­æ²¡æœ‰ä»€ä¹ˆç´¢å¼•èƒ½å¤Ÿè®©è¿™æ ·çš„æŸ¥è¯¢å‡å°‘éœ€è¦æ‰«æçš„è¡Œæ•°ã€‚</p><p>é€šå¸¸å¦‚æœå‘ç°æŸ¥è¯¢éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®ä½†åªè¿”å›å°‘æ•°çš„è¡Œï¼Œé‚£ä¹ˆé€šå¸¸å¯ä»¥å°è¯•ä½¿ç”¨ä¸‹é¢çš„æŠ€å·§å»ä¼˜åŒ–ï¼š</p><ul><li><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æï¼ŒæŠŠæ‰€æœ‰éœ€è¦çš„åˆ—æ”¾åˆ°ç´¢å¼•ä¸­ï¼Œè¿™æ ·å­˜å‚¨å¼•æ“æ— éœ€å›è¡¨è·å–å¯¹åº”è¡Œå°±å¯ä»¥è¿”å›ç»“æœäº†ã€‚</p></li><li><p>æ”¹å˜åº“è¡¨ç»“æ„ã€‚ä¾‹å¦‚ä½¿ç”¨å•ç‹¬çš„æ±‡æ€»è¡¨ã€‚</p></li><li><p>é‡å†™å¤æ‚çš„æŸ¥è¯¢ï¼Œè®©MySQLä¼˜åŒ–å™¨èƒ½å¤Ÿä»¥æ›´ä¼˜åŒ–çš„æ–¹å¼æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ã€‚</p></li></ul><h3 id="é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”"><a href="#é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”" class="headerlink" title="é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”"></a>é‡æ„æŸ¥è¯¢çš„æ–¹å¼éé”</h3><h4 id="ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢"><a href="#ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢" class="headerlink" title="ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢"></a>ä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•çš„æŸ¥è¯¢</h4><h4 id="åˆ‡åˆ†æŸ¥è¯¢"><a href="#åˆ‡åˆ†æŸ¥è¯¢" class="headerlink" title="åˆ‡åˆ†æŸ¥è¯¢"></a>åˆ‡åˆ†æŸ¥è¯¢</h4><p>å°†å¤§æŸ¥è¯¢åˆ†ä¸ºå°æŸ¥è¯¢ï¼Œæ¯ä¸ªæŸ¥è¯¢åŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼Œåªå®Œæˆä¸€å°éƒ¨åˆ†ï¼Œæ¯æ¬¡è¿”å›ä¸€å°éƒ¨åˆ†æŸ¥è¯¢ç»“æœã€‚åˆ é™¤æ—§æ•°æ®å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­</p><h4 id="åˆ†è§£å…³è”æŸ¥è¯¢"><a href="#åˆ†è§£å…³è”æŸ¥è¯¢" class="headerlink" title="åˆ†è§£å…³è”æŸ¥è¯¢"></a>åˆ†è§£å…³è”æŸ¥è¯¢</h4><p>å¯¹æ¯ä¸€ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡å•è¡¨æŸ¥è¯¢ï¼Œç„¶åå°†ç»“æœåœ¨åº”ç”¨ç¨‹åºä¸­å…³è”ã€‚</p><p>åˆ†è§£å…³è”æŸ¥è¯¢çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>è®©ç¼“å­˜æ•ˆç‡è·Ÿé«˜ã€‚</p></li><li><p>æ‰§è¡Œå•ä¸ªæŸ¥è¯¢å¯ä»¥å‡å°‘é”çš„ç«äº‰ã€‚</p></li><li><p>åšåº”ç”¨å±‚å…³è”ï¼Œå¯ä»¥æ›´å¥½çš„å¯¹æ•°æ®åº“æ‹†åˆ†ï¼Œæ›´å®¹æ˜“åšåˆ°ï¼Œé«˜æ€§èƒ½å¯æ‰©å±•ã€‚</p></li><li><p>æŸ¥è¯¢æ•ˆç‡æœ¬èº«æ•ˆç‡ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€æå‡ã€‚</p></li><li><p>å¯ä»¥å‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚</p></li><li><p>è¿™æ ·åšç›¸å½“äºåœ¨åº”ç”¨ä¸­å®ç°äº†å“ˆå¸Œå…³è”è€Œä¸æ˜¯MySQLçš„åµŒå¥—å¾ªç¯å…³è”ã€‚</p></li></ul><h3 id="æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"><a href="#æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€" class="headerlink" title="æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"></a>æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€</h3><p>æŸ¥è¯¢æ‰§è¡Œè·¯å¾„ï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/process.png?raw=true" alt="æŸ¥è¯¢æ‰§è¡Œè·¯å¾„"></p><h3 id="MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§"><a href="#MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§" class="headerlink" title="MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§"></a>MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§</h3><h3 id="æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º"><a href="#æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º"></a>æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º</h3><h3 id="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"><a href="#ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"></a>ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢</h3><h3 id="æ¡ˆä¾‹å­¦ä¹ "><a href="#æ¡ˆä¾‹å­¦ä¹ " class="headerlink" title="æ¡ˆä¾‹å­¦ä¹ "></a>æ¡ˆä¾‹å­¦ä¹ </h3><h2 id="MySQLçš„é«˜çº§ç‰¹æ€§"><a href="#MySQLçš„é«˜çº§ç‰¹æ€§" class="headerlink" title="MySQLçš„é«˜çº§ç‰¹æ€§"></a>MySQLçš„é«˜çº§ç‰¹æ€§</h2><ul><li><p>åˆ†åŒºè¡¨</p></li><li><p>è§†å›¾</p></li><li><p>å¤–é”®çº¦æŸ</p></li><li><p>MySQLå†…éƒ¨å­˜å‚¨ä»£ç </p></li><li><p>æ¸¸æ ‡</p></li><li><p>ç»‘å®šå˜é‡</p></li><li><p>ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</p></li><li><p>æ’ä»¶</p></li><li><p>å­—ç¬¦é›†å’Œæ ¡å¯¹</p></li><li><p>å…¨æ–‡ç´¢å¼•</p></li><li><p>åˆ†å¸ƒå¼ï¼ˆXAï¼‰äº‹åŠ¡</p></li><li><p>æŸ¥è¯¢ç¼“å­˜</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaç±»åŠ è½½å’ŒåŒäº²å§”æ´¾æœºåˆ¶</title>
      <link href="/2018/03/28/jvm/2018-03-28-Classloader/"/>
      <url>/2018/03/28/jvm/2018-03-28-Classloader/</url>
      
        <content type="html"><![CDATA[<h2 id="JVMç±»åŠ è½½æœºåˆ¶"><a href="#JVMç±»åŠ è½½æœºåˆ¶" class="headerlink" title="JVMç±»åŠ è½½æœºåˆ¶"></a>JVMç±»åŠ è½½æœºåˆ¶</h2><p>â€¢å…¨ç›˜è´Ÿè´£ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æŸä¸ªClassæ—¶ï¼Œè¯¥Classæ‰€ä¾èµ–çš„å’Œå¼•ç”¨çš„å…¶ä»–Classä¹Ÿå°†ç”±è¯¥ç±»åŠ è½½å™¨è´Ÿè´£è½½å…¥ï¼Œé™¤éæ˜¾ç¤ºä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»åŠ è½½å™¨æ¥è½½å…¥</p><p>â€¢çˆ¶ç±»å§”æ‰˜ï¼Œå…ˆè®©çˆ¶ç±»åŠ è½½å™¨è¯•å›¾åŠ è½½è¯¥ç±»ï¼Œåªæœ‰åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶æ‰å°è¯•ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­åŠ è½½è¯¥ç±»</p><p>â€¢ç¼“å­˜æœºåˆ¶ï¼Œç¼“å­˜æœºåˆ¶å°†ä¼šä¿è¯æ‰€æœ‰åŠ è½½è¿‡çš„Classéƒ½ä¼šè¢«ç¼“å­˜ï¼Œå½“ç¨‹åºä¸­éœ€è¦ä½¿ç”¨æŸä¸ªClassæ—¶ï¼Œç±»åŠ è½½å™¨å…ˆä»ç¼“å­˜åŒºå¯»æ‰¾è¯¥Classï¼Œåªæœ‰ç¼“å­˜åŒºä¸å­˜åœ¨ï¼Œç³»ç»Ÿæ‰ä¼šè¯»å–è¯¥ç±»å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢æˆClasså¯¹è±¡ï¼Œå­˜å…¥ç¼“å­˜åŒºã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¿®æ”¹äº†Classåï¼Œå¿…é¡»é‡å¯JVMï¼Œç¨‹åºçš„ä¿®æ”¹æ‰ä¼šç”Ÿæ•ˆ</p><p>ç±»çš„åŠ è½½æŒ‡çš„æ˜¯å°†ç±»çš„.classæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œç„¶ååœ¨å †åŒºåˆ›å»ºä¸€ä¸ªjava.lang.Classå¯¹è±¡ï¼Œç”¨æ¥å°è£…ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ã€‚ç±»çš„åŠ è½½çš„æœ€ç»ˆäº§å“æ˜¯ä½äºå †åŒºä¸­çš„Classå¯¹è±¡ï¼ŒClasså¯¹è±¡å°è£…äº†ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å‘Javaç¨‹åºå‘˜æä¾›äº†è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ã€‚</p><p>åŠ è½½.classæ–‡ä»¶çš„æ–¹å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â€“ ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½</span><br><span class="line">â€“ é€šè¿‡ç½‘ç»œä¸‹è½½.classæ–‡ä»¶</span><br><span class="line">â€“ ä»zipï¼Œjarç­‰å½’æ¡£æ–‡ä»¶ä¸­åŠ è½½.classæ–‡ä»¶</span><br><span class="line">â€“ ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå–.classæ–‡ä»¶</span><br><span class="line">â€“ å°†Javaæºæ–‡ä»¶åŠ¨æ€ç¼–è¯‘ä¸º.classæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç±»åŠ è½½çš„è¿‡ç¨‹åŒ…æ‹¬äº†åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–äº”ä¸ªé˜¶æ®µã€‚åœ¨è¿™äº”ä¸ªé˜¶æ®µä¸­ï¼ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡å’Œåˆå§‹åŒ–è¿™å››ä¸ªé˜¶æ®µå‘ç”Ÿçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œè€Œè§£æé˜¶æ®µåˆ™ä¸ä¸€å®šï¼Œå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆä¹Ÿæˆä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®šï¼‰ã€‚å¦å¤–æ³¨æ„è¿™é‡Œçš„å‡ ä¸ªé˜¶æ®µæ˜¯æŒ‰é¡ºåºå¼€å§‹ï¼Œè€Œä¸æ˜¯æŒ‰é¡ºåºè¿›è¡Œæˆ–å®Œæˆï¼Œå› ä¸ºè¿™äº›é˜¶æ®µé€šå¸¸éƒ½æ˜¯äº’ç›¸äº¤å‰åœ°æ··åˆè¿›è¡Œçš„ï¼Œé€šå¸¸åœ¨ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨æˆ–æ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µã€‚</p><ul><li>åŠ è½½ï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®</li></ul><p>åŠ è½½æ—¶ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨åŠ è½½é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š</p><p>1ã€é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å…¶å®šä¹‰çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</p><p>2ã€å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</p><p>3ã€åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</p><p>ç›¸å¯¹äºç±»åŠ è½½çš„å…¶ä»–é˜¶æ®µè€Œè¨€ï¼ŒåŠ è½½é˜¶æ®µï¼ˆå‡†ç¡®åœ°è¯´ï¼Œæ˜¯åŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œå› ä¸ºå¼€å‘äººå‘˜æ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ã€‚</p><p>åŠ è½½é˜¶æ®µå®Œæˆåï¼Œè™šæ‹Ÿæœºå¤–éƒ¨çš„ äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€éœ€çš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œè€Œä¸”åœ¨Javaå †ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼Œè¿™æ ·ä¾¿å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è®¿é—®æ–¹æ³•åŒºä¸­çš„è¿™äº›æ•°æ®ã€‚åŠ è½½ååœ¨å¸¸é‡æ± å­˜å‚¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p><ul><li>éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§</li></ul><p>éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š</p><p>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥0xCAFEBABEå¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹ã€‚</p><p>å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ã€‚</p><p>å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚</p><p>ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚</p><p>éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨-Xverifynoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚</p><ul><li>å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</li></ul><p>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><p>1ã€è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨Javaå †ä¸­ã€‚</p><p>2ã€è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚0ã€0Lã€nullã€falseç­‰ï¼‰ï¼Œè€Œä¸æ˜¯è¢«åœ¨Javaä»£ç ä¸­è¢«æ˜¾å¼åœ°èµ‹äºˆçš„å€¼ã€‚</p><p>å‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼špublic static int value = 3ï¼›</p><p>é‚£ä¹ˆå˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0ï¼Œè€Œä¸æ˜¯3ï¼Œå› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•Javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º3çš„putstaticæŒ‡ä»¤æ˜¯åœ¨ç¨‹åºç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨<clinit>()æ–¹æ³•ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º3çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚</clinit></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">è¿™é‡Œè¿˜éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š</span><br><span class="line"></span><br><span class="line">å¯¹åŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œå¯¹äºç±»å˜é‡ï¼ˆstaticï¼‰å’Œå…¨å±€å˜é‡ï¼Œå¦‚æœä¸æ˜¾å¼åœ°å¯¹å…¶èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œåˆ™ç³»ç»Ÿä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œè€Œå¯¹äºå±€éƒ¨å˜é‡æ¥è¯´ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ã€‚</span><br><span class="line"></span><br><span class="line">static int d;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">    int c;</span><br><span class="line">    System.out.println(d + &quot; &quot; + c);//då¯ä»¥ç¼–è¯‘ä¸æŠ¥é”™ï¼ŒcæŠ¥é”™ã€‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¯¹äºåŒæ—¶è¢«staticå’Œfinalä¿®é¥°çš„å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™å°±ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ï¼›è€Œåªè¢«finalä¿®é¥°çš„å¸¸é‡åˆ™æ—¢å¯ä»¥åœ¨å£°æ˜æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»åˆå§‹åŒ–æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œæ€»ä¹‹ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤é›¶å€¼ã€‚</span><br><span class="line"></span><br><span class="line">å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹referenceæ¥è¯´ï¼Œå¦‚æ•°ç»„å¼•ç”¨ã€å¯¹è±¡å¼•ç”¨ç­‰ï¼Œå¦‚æœæ²¡æœ‰å¯¹å…¶è¿›è¡Œæ˜¾å¼åœ°èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œå³nullã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœåœ¨æ•°ç»„åˆå§‹åŒ–æ—¶æ²¡æœ‰å¯¹æ•°ç»„ä¸­çš„å„å…ƒç´ èµ‹å€¼ï¼Œé‚£ä¹ˆå…¶ä¸­çš„å…ƒç´ å°†æ ¹æ®å¯¹åº”çš„æ•°æ®ç±»å‹è€Œè¢«èµ‹äºˆé»˜è®¤çš„é›¶å€¼ã€‚</span><br></pre></td></tr></table></figure><p>3ã€å¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨ä¸­å­˜åœ¨ConstantValueå±æ€§ï¼Œå³åŒæ—¶è¢«finalå’Œstaticä¿®é¥°ï¼Œé‚£ä¹ˆåœ¨å‡†å¤‡é˜¶æ®µå˜é‡valueå°±ä¼šè¢«åˆå§‹åŒ–ä¸ºConstValueå±æ€§æ‰€æŒ‡å®šçš„å€¼ã€‚</p><p>å‡è®¾ä¸Šé¢çš„ç±»å˜é‡valueè¢«å®šä¹‰ä¸ºï¼š public static final int value = 3ï¼›</p><p>ç¼–è¯‘æ—¶Javacå°†ä¼šä¸ºvalueç”ŸæˆConstantValueå±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ®ConstantValueçš„è®¾ç½®å°†valueèµ‹å€¼ä¸º3ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºstatic finalå¸¸é‡åœ¨ç¼–è¯‘æœŸå°±å°†å…¶ç»“æœæ”¾å…¥äº†è°ƒç”¨å®ƒçš„ç±»çš„å¸¸é‡æ± ä¸­</p><ul><li>è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li></ul><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚</p><p>ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</p><ul><li>åˆå§‹åŒ–ï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVMè´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨Javaä¸­å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹å€¼è®¾å®šæœ‰ä¸¤ç§æ–¹å¼ï¼š</li></ul><p>â‘ å£°æ˜ç±»å˜é‡æ˜¯æŒ‡å®šåˆå§‹å€¼</p><p>â‘¡ä½¿ç”¨é™æ€ä»£ç å—ä¸ºç±»å˜é‡æŒ‡å®šåˆå§‹å€¼</p><p>JVMåˆå§‹åŒ–æ­¥éª¤</p><p>1ã€å‡å¦‚è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½å’Œè¿æ¥ï¼Œåˆ™ç¨‹åºå…ˆåŠ è½½å¹¶è¿æ¥è¯¥ç±»</p><p>2ã€å‡å¦‚è¯¥ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±»</p><p>3ã€å‡å¦‚ç±»ä¸­æœ‰åˆå§‹åŒ–è¯­å¥ï¼Œåˆ™ç³»ç»Ÿä¾æ¬¡æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥</p><p>ç±»åˆå§‹åŒ–æ—¶æœºï¼šåªæœ‰å½“å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼Œç±»çš„ä¸»åŠ¨ä½¿ç”¨åŒ…æ‹¬ä»¥ä¸‹å…­ç§ï¼š</p><p>â€“ åˆ›å»ºç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯newçš„æ–¹å¼</p><p>â€“ è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</p><p>â€“ è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</p><p>â€“ åå°„ï¼ˆå¦‚Class.forName(â€œcom.shengsiyuan.Testâ€)ï¼‰</p><p>â€“ åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±»ï¼Œåˆ™å…¶çˆ¶ç±»ä¹Ÿä¼šè¢«åˆå§‹åŒ–</p><p>â€“ Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»ï¼ˆJava Testï¼‰ï¼Œç›´æ¥ä½¿ç”¨java.exeå‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»</p><p>åœ¨å¦‚ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼ŒJavaè™šæ‹Ÿæœºå°†ç»“æŸç”Ÿå‘½å‘¨æœŸ</p><p>â€“ æ‰§è¡Œäº†System.exit()æ–¹æ³•</p><p>â€“ ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ</p><p>â€“ ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢</p><p>â€“ ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´Javaè™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢</p><h2 id="Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹"><a href="#Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹"></a>Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹</h2><p>newä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæ ¹æ®newçš„å‚æ•°åœ¨å¸¸é‡æ± ä¸­å®šä½ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¯´æ˜ç±»æœªè¢«åŠ è½½ï¼Œåˆ™è¿›è¡Œç±»åŠ è½½ç­‰ç­‰ä¸Šé¢5ä¸ªæ­¥éª¤ã€‚</p><h2 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h2><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œæµç¨‹æ˜¯ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡å‘ä¸Šï¼Œå› æ­¤ï¼Œæ‰€æœ‰çš„ç±»åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥è¢«ä¼ é€’åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åœ¨å®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»æ—¶ï¼Œå³æ— æ³•å®Œæˆè¯¥åŠ è½½ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¯¥ç±»ã€‚</p><p>è¿‡ç¨‹ï¼š</p><p>1ã€å½“AppClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ExtClassLoaderå»å®Œæˆã€‚</p><p>2ã€å½“ExtClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¹Ÿä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™BootStrapClassLoaderå»å®Œæˆã€‚</p><p>3ã€å¦‚æœBootStrapClassLoaderåŠ è½½å¤±è´¥ï¼ˆä¾‹å¦‚åœ¨$JAVA_HOME/jre/libé‡ŒæœªæŸ¥æ‰¾åˆ°è¯¥classï¼‰ï¼Œä¼šä½¿ç”¨ExtClassLoaderæ¥å°è¯•åŠ è½½ï¼›</p><p>4ã€è‹¥ExtClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šä½¿ç”¨AppClassLoaderæ¥åŠ è½½ï¼Œå¦‚æœAppClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ClassNotFoundExceptionã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹æ„ä¹‰ï¼š</p><p>-ç³»ç»Ÿç±»é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä»½åŒæ ·çš„å­—èŠ‚ç </p><p>-ä¿è¯Javaç¨‹åºå®‰å…¨ç¨³å®šè¿è¡Œ</p><h2 id="Javaç±»åŠ è½½å™¨"><a href="#Javaç±»åŠ è½½å™¨" class="headerlink" title="Javaç±»åŠ è½½å™¨"></a>Javaç±»åŠ è½½å™¨</h2><p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼šBootstrap ClassLoaderï¼Œè´Ÿè´£åŠ è½½å­˜æ”¾åœ¨JDK\jre\lib(JDKä»£è¡¨JDKçš„å®‰è£…ç›®å½•ï¼Œä¸‹åŒ)ä¸‹ï¼Œæˆ–è¢«-Xbootclasspathå‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”èƒ½è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“ï¼ˆå¦‚rt.jarï¼Œæ‰€æœ‰çš„java.*å¼€å¤´çš„ç±»å‡è¢«Bootstrap ClassLoaderåŠ è½½ï¼‰ã€‚å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨çš„ã€‚</p><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼šExtension ClassLoaderï¼Œè¯¥åŠ è½½å™¨ç”±sun.misc.Launcher$ExtClassLoaderå®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½DK\jre\lib\extç›®å½•ä¸­ï¼Œæˆ–è€…ç”±java.ext.dirsç³»ç»Ÿå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼ˆå¦‚javax.*å¼€å¤´çš„ç±»ï¼‰ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚</p><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼šApplication ClassLoaderï¼Œè¯¥ç±»åŠ è½½å™¨ç”±sun.misc.Launcher$AppClassLoaderæ¥å®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰æ‰€æŒ‡å®šçš„ç±»ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</p><p>åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±è¿™ä¸‰ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆè¿›è¡ŒåŠ è½½çš„ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚å› ä¸ºJVMè‡ªå¸¦çš„ClassLoaderåªæ˜¯æ‡‚å¾—ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½æ ‡å‡†çš„java classæ–‡ä»¶ï¼Œå› æ­¤å¦‚æœç¼–å†™äº†è‡ªå·±çš„ClassLoaderï¼Œä¾¿å¯ä»¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š</p><p>1ï¼‰åœ¨æ‰§è¡Œéç½®ä¿¡ä»£ç ä¹‹å‰ï¼Œè‡ªåŠ¨éªŒè¯æ•°å­—ç­¾åã€‚</p><p>2ï¼‰åŠ¨æ€åœ°åˆ›å»ºç¬¦åˆç”¨æˆ·ç‰¹å®šéœ€è¦çš„å®šåˆ¶åŒ–æ„å»ºç±»ã€‚</p><p>3ï¼‰ä»ç‰¹å®šçš„åœºæ‰€å–å¾—java classï¼Œä¾‹å¦‚æ•°æ®åº“ä¸­å’Œç½‘ç»œä¸­ã€‚</p><p>ç±»åŠ è½½æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><p>1ã€å‘½ä»¤è¡Œå¯åŠ¨åº”ç”¨æ—¶å€™ç”±JVMåˆå§‹åŒ–åŠ è½½</p><p>2ã€é€šè¿‡Class.forName()æ–¹æ³•åŠ¨æ€åŠ è½½</p><p>3ã€é€šè¿‡ClassLoader.loadClass()æ–¹æ³•åŠ¨æ€åŠ è½½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ClassLoader loader = HelloWorld.class.getClassLoader();</span><br><span class="line">System.out.println(loader);</span><br><span class="line">//ä½¿ç”¨ClassLoader.loadClass()æ¥åŠ è½½ç±»ï¼Œä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–å—</span><br><span class="line">loader.loadClass(&quot;Test2&quot;);</span><br><span class="line">//ä½¿ç”¨Class.forName()æ¥åŠ è½½ç±»ï¼Œé»˜è®¤ä¼šæ‰§è¡Œåˆå§‹åŒ–å—</span><br><span class="line">//                Class.forName(&quot;Test2&quot;);</span><br><span class="line">//ä½¿ç”¨Class.forName()æ¥åŠ è½½ç±»ï¼Œå¹¶æŒ‡å®šClassLoaderï¼Œåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œé™æ€å—</span><br><span class="line">//                Class.forName(&quot;Test2&quot;, false, loader);</span><br><span class="line"></span><br><span class="line">public class Test2 &#123;</span><br><span class="line">        static &#123;</span><br><span class="line">                System.out.println(&quot;é™æ€åˆå§‹åŒ–å—æ‰§è¡Œäº†ï¼&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ä½†æ˜¯ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚æ¯”å¦‚åº”ç”¨æ˜¯é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“ Java ç±»çš„å­—èŠ‚ç ï¼Œä¸ºä¿è¯å®‰å…¨æ€§ï¼Œè¿™äº›å­—èŠ‚ç ç»è¿‡äº†åŠ å¯†å¤„ç†ï¼Œè¿™æ—¶ç³»ç»Ÿç±»åŠ è½½å™¨å°±æ— æ³•å¯¹å…¶è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·åˆ™éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°ã€‚è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬éƒ½æ˜¯ç»§æ‰¿è‡ª ClassLoader ç±»ï¼Œä»ä¸Šé¢å¯¹ loadClass æ–¹æ³•æ¥åˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬åªéœ€è¦é‡å†™ findClass æ–¹æ³•å³å¯ã€‚</p><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/ityouknow/p/5603287.html" target="_blank" rel="noopener">å°Šé‡åŸåˆ›</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JVM</title>
      <link href="/2018/03/27/jvm/2018-03-27-JVM/"/>
      <url>/2018/03/27/jvm/2018-03-27-JVM/</url>
      
        <content type="html"><![CDATA[<h2 id="1-JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶"><a href="#1-JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶" class="headerlink" title="1. JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶"></a>1. JVMçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶</h2><h3 id="1-1-è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#1-1-è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="1.1 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>1.1 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h3><p><img src="/media/jvm-1.7-later.png" alt="jvm 1.7"></p><h4 id="1-1-1-ç¨‹åºè®¡æ•°å™¨ï¼ˆPC-Registerï¼‰"><a href="#1-1-1-ç¨‹åºè®¡æ•°å™¨ï¼ˆPC-Registerï¼‰" class="headerlink" title="1.1.1 ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰"></a>1.1.1 ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰</h4><ul><li>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£é‡Šå™¨çš„ä½œç”¨æ˜¯é€šè¿‡æ”¹å˜è®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li><li>å¦‚æœå½“å‰æ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•ï¼Œåˆ™è¿™ä¸ªè®¡æ•°å™¨ä¸ºç©ºã€‚</li><li>Javaè™šæ‹Ÿæœºä¸­<strong><em>å”¯ä¸€</em></strong>æ²¡æœ‰OOMçš„åŒºåŸŸã€‚</li></ul><h4 id="1-1-2-Javaè™šæ‹Ÿæœºæ ˆ-ï¼ˆJVM-Stackï¼‰"><a href="#1-1-2-Javaè™šæ‹Ÿæœºæ ˆ-ï¼ˆJVM-Stackï¼‰" class="headerlink" title="1.1.2 Javaè™šæ‹Ÿæœºæ ˆ ï¼ˆJVM Stackï¼‰"></a>1.1.2 Javaè™šæ‹Ÿæœºæ ˆ ï¼ˆJVM Stackï¼‰</h4><ul><li>è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚</li><li><strong><em>æ¯ä¸ªæ–¹æ³•è¿è¡Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§</em></strong>ï¼Œå­˜å‚¨å±€éƒ¨å˜é‡è¡¨(Local Variable Table)ï¼Œæ“ä½œæ ˆ(Operation Stack)ï¼Œæ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</li><li><strong><em>åœ¨ç¼–è¯‘æœŸåˆ†é…</em></strong>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾å„ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ç±»å‹å’ŒreturnAddress(æŒ‡å‘ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€)ã€‚</li><li>å¦‚æœè¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºæœ€å¤§å¯ç”¨æ ˆæ·±åº¦æ—¶ï¼Œç³»ç»Ÿå°±ä¼šæŠ›å‡ºStackOverflowErroré”™è¯¯ã€‚</li><li>å¦‚æœè™šæ‹ŸæœºåŠ¨æ€æ‰©å±•æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„çš„å†…å­˜æ—¶ä¼šæŠ›å‡ºOOMå¼‚å¸¸ã€‚å¤§éƒ¨åˆ†è™šæ‹Ÿæœºéƒ½å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å›ºå®šé•¿åº¦è™šæ‹Ÿæœºæ ˆã€‚</li></ul><h4 id="1-1-3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰"><a href="#1-1-3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰" class="headerlink" title="1.1.3 æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰"></a>1.1.3 æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h4><ul><li>è™šæ‹Ÿæœºæ ˆä¸ºæ‰§è¡ŒJavaæ–¹æ³•æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºNativeæ–¹æ³•æœåŠ¡ã€‚</li><li>ä¼šå‡ºç°OOMæˆ–è€…StackOverflowErrorï¼ŒåŸå› å’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼ã€‚</li></ul><h4 id="1-1-4-Javaå †ï¼ˆHeapï¼‰"><a href="#1-1-4-Javaå †ï¼ˆHeapï¼‰" class="headerlink" title="1.1.4 Javaå †ï¼ˆHeapï¼‰"></a>1.1.4 Javaå †ï¼ˆHeapï¼‰</h4><ul><li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œä¸ºäº†å­˜å‚¨æ‰€æœ‰å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚</li></ul><h4 id="1-1-5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰"><a href="#1-1-5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰" class="headerlink" title="1.1.5 æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰"></a>1.1.5 æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</h4><ul><li>åˆ«åï¼šâ€œæ°¸ä¹…ä»£â€œã€â€éå †ï¼Œå„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œ<strong><em>å­˜å‚¨è™šæ‹Ÿæœºå·²åŠ è½½çš„ç±»ä¿¡æ¯ï¼Œé™æ€å˜é‡ã€å¸¸é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç æ•°æ®</em></strong>ã€‚é»˜è®¤æœ€å°ä¸º16MBï¼Œæœ€å¤§ä¸º64MBï¼Œå¯ä»¥é€šè¿‡-XX:PermSizeå’Œ-XX:MaxPermSize å‚æ•°é™åˆ¶æ–¹æ³•åŒºå¤§å°ã€‚</li><li>Java8ä¸­ï¼Œå·²ç»å½»åº•æ²¡æœ‰äº†æ°¸ä¹…ä»£ï¼Œå°†æ–¹æ³•åŒºç›´æ¥æ”¾åœ¨ä¸€ä¸ªä¸å †ä¸ç›¸è¿çš„æœ¬åœ°å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸè¢«å«åšå…ƒç©ºé—´ã€‚</li></ul><h4 id="1-1-6-è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime-Constant-Poolï¼‰"><a href="#1-1-6-è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime-Constant-Poolï¼‰" class="headerlink" title="1.1.6 è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰"></a>1.1.6 è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</h4><ul><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼šjdk1.6åŠä¹‹å‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸­çš„ä¸»è¦å†…å®¹æ¥è‡ªäºJVMå¯¹Classçš„åŠ è½½ã€‚Java7ä¸­å·²ç»å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰ç§»é™¤ï¼Œåœ¨Java å †ï¼ˆHeapï¼‰ä¸­å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li><li><strong><em>ç±»åŠ è½½å</em></strong>å­˜å‚¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å¸¸é‡ï¼ˆå„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰ã€‚åŸºæœ¬æ•°æ®ç±»å‹ä¸å«å¸¸é‡ï¼Œå¯è¢«ä¿®æ”¹ï¼ŒStringå’Œfinalä¿®é¥°çš„æ‰æ˜¯ã€‚å­—é¢é‡ç›¸å½“äºJavaè¯­è¨€å±‚é¢å¸¸é‡çš„æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ï¼Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬äº†å¦‚ä¸‹ä¸‰ç§ç±»å‹çš„å¸¸é‡ï¼šç±»å’Œæ¥å£çš„å…¨é™å®šåã€å­—æ®µåç§°å’Œæè¿°ç¬¦ã€æ–¹æ³•åç§°å’Œæè¿°ç¬¦ã€‚</li><li>ç”±äºè¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºç§»åŠ¨åˆ°å †ï¼Œæ‰€ä»¥jdk1.6å’Œjdk1.7å¯¹äºå¸¸é‡æ± çš„ä½¿ç”¨è¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ï¼Œ<a href="https://tech.meituan.com/in_depth_understanding_string_intern.html" target="_blank" rel="noopener">æ·±å…¥è§£æString#intern</a></li></ul><h4 id="1-1-7-ç›´æ¥å†…å­˜-Direct-Memory"><a href="#1-1-7-ç›´æ¥å†…å­˜-Direct-Memory" class="headerlink" title="1.1.7 ç›´æ¥å†…å­˜(Direct Memory)"></a>1.1.7 ç›´æ¥å†…å­˜(Direct Memory)</h4><ul><li>å †å¤–å†…å­˜ï¼ŒJVMè™šæ‹Ÿæœºå„ä¸ªåŒºåŸŸå†…å­˜æ€»å’Œå¤§äºæœºå™¨ç‰©ç†å†…å­˜å¯èƒ½ä¼šå¯¼è‡´OOMã€‚</li></ul><h3 id="1-2-å¯¹è±¡çŠ¶æ€ç®—æ³•"><a href="#1-2-å¯¹è±¡çŠ¶æ€ç®—æ³•" class="headerlink" title="1.2 å¯¹è±¡çŠ¶æ€ç®—æ³•"></a>1.2 å¯¹è±¡çŠ¶æ€ç®—æ³•</h3><ul><li><p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼š å¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨çš„é—®é¢˜ï¼Œå†…å­˜æ³„éœ²ã€‚</p></li><li><p>è·Ÿæœç´¢ç®—æ³•ï¼šé€šè¿‡ä¸€ç³»åˆ—åä¸ºâ€œGC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢çš„è·¯å¾„æˆä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootæ²¡æœ‰ä¸€ä¸ªå¼•ç”¨æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚</p></li></ul><p>æ³¨ï¼š1. GCå¯¹è±¡åŒ…æ‹¬ï¼šè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œæ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œæ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­JNIã€‚2. è·Ÿæœç´¢ç®—æ³•ä¸­ï¼Œæ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡å¹¶ééæ­»ä¸å¯ï¼Œè¿˜æœ‰ç»å†ä¸¤æ¬¡æ ‡è®°ï¼Œç¬¬ä¸€æ¬¡å‘ç°æ²¡æœ‰å¼•ç”¨ï¼Œåˆ™è¿›è¡Œæ ‡è®°ï¼Œå¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œå½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•æˆ–finalize()å·²ç»è¢«è°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚</p><h4 id="1-2-1-å›æ”¶æ–¹æ³•åŒº"><a href="#1-2-1-å›æ”¶æ–¹æ³•åŒº" class="headerlink" title="1.2.1 å›æ”¶æ–¹æ³•åŒº"></a>1.2.1 å›æ”¶æ–¹æ³•åŒº</h4><p>æ–¹æ³•åŒºä¸»è¦å›æ”¶åºŸå¼ƒå˜é‡å’Œæ— ç”¨çš„ç±»ã€‚æ— ç”¨çš„ç±»ï¼šè¯¥ç±»æ‰€æœ‰å®ä¾‹éƒ½å·²è¢«å›æ”¶ï¼ŒåŠ è½½è¯¥ç±»çš„ClassLoaderè¢«å›æ”¶ï¼Œè¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚åªæœ‰åŒæ—¶æ»¡è¶³æ— ç”¨çš„ç±»çš„ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰<strong><em>å¯ä»¥</em></strong>è¢«å›æ”¶ã€‚åå°„ã€åŠ¨æ€ä»£ç†ã€CGLibç­‰bytecodeæ¡†æ¶åœºæ™¯ä»¥åŠé¢‘ç¹å®šä¹‰ClassLoaderçš„åœºæ™¯éƒ½éœ€è¦å…·å¤‡å¸è½½åŠŸèƒ½ï¼Œä»¥ä¿è¯æ°¸ä¹…ä»£ä¸ä¼šæº¢å‡ºã€‚</p><h3 id="1-3-åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#1-3-åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="1.3 åƒåœ¾æ”¶é›†ç®—æ³•"></a>1.3 åƒåœ¾æ”¶é›†ç®—æ³•</h3><ul><li><p>æ ‡è®°æ¸…é™¤ç®—æ³•ï¼š æ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚æ•ˆç‡é—®é¢˜ï¼Œç©ºé—´é—®é¢˜ï¼ˆå†…å­˜ç¢ç‰‡ï¼‰ã€‚</p></li><li><p>å¤åˆ¶ç®—æ³•ï¼š æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•å›æ”¶ï¼Œç”±äºæ–°ç”Ÿä»£98%çš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦1:1çš„æ¯”ä¾‹åˆ’åˆ†å†…å­˜ç©ºé—´ï¼ˆHotspoté»˜è®¤8:1ï¼‰ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€ä¸ªSurvivorã€‚å½“å›æ”¶æ—¶ï¼Œå°†Edenå’ŒSurvivorä¸­è¿˜å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§çš„æ‹·è´åˆ°å¦ä¸€å—çš„Survivorä¸Šã€‚æœ€åæ¸…ç†æ‰Edenå’Œåˆšæ‰ä½¿ç”¨è¿‡çš„Survivorã€‚å½“Survivorç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œéœ€è¦ä¾èµ–å…¶ä»–çš„è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆHandle Promotionï¼‰ã€‚åˆ†é…æ‹…ä¿ï¼šå¦‚æœSurvivorç©ºé—´æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾ä¸Šæ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°†ç›´æ¥é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶è¿›å…¥è€å¹´ä»£ã€‚</p></li><li><p>æ ‡è®°-æ•´ç†ç®—æ³•ï¼šè®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚è€å¹´ä»£å¸¸ç”¨çš„ç®—æ³•ã€‚</p></li><li><p>åˆ†ä»£æ”¶é›†ç®—æ³•ï¼š æ ¹æ®å¯¹è±¡çš„å­˜æ´»å‘¨æœŸä¸åŒï¼Œå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œæ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p></li></ul><h3 id="1-4-åƒåœ¾æ”¶é›†å™¨"><a href="#1-4-åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="1.4 åƒåœ¾æ”¶é›†å™¨"></a>1.4 åƒåœ¾æ”¶é›†å™¨</h3><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/gc.jpg?raw=true" alt="åƒåœ¾å›æ”¶å™¨"><br><a href="#åƒåœ¾æ”¶é›†å™¨">å›¾ç‰‡æ¥è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹</a><br>å¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜ä»–ä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚</p><ol><li><p>Serial</p><p> å¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£çš„å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œç®€å•é«˜æ•ˆï¼Œstop the worldã€‚</p></li><li><p>ParNew</p><p> å¤åˆ¶ç®—æ³•ï¼ŒSerialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œstop the worldã€‚é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚</p></li><li><p>Parallel Scavenge</p><p> æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œ, stop the worldã€‚ç›®æ ‡è¾¾åˆ°å¯æ§åˆ¶çš„ååé‡ã€‚è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/CPUæ¶ˆè€—æ€»æ—¶å¸¸=ååé‡ã€‚è¯¥æ”¶é›†å™¨æä¾›ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´çš„-XX:MaxGCPauseMillså‚æ•°åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„-XX:GCTimeRatioå‚æ•°ã€‚MaxGCPauseMillså‚æ•°å…è®¸çš„å€¼æ˜¯ä¸€ä¸ªå¤§äº0çš„æ¯«ç§’æ•°ï¼Œæ”¶é›†å™¨å°†å°½åŠ›ä¿è¯å†…å­˜å›æ”¶èŠ±è´¹çš„æ—¶é—´ä¸è¶…è¿‡è®¾å®šå€¼ã€‚GCTimeRatioå‚æ•°çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªå¤§äº0çš„æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œç›¸å½“äºååé‡çš„å€’æ•°ã€‚é™¤äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ª-XX:+UseAdaptiveSizePolicyå€¼å¾—å…³æ³¨ã€‚æ‰“å¼€è¿™ä¸ªå‚æ•°åï¼Œä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°ã€‚è™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡è¿™ç§æ–¹å¼ç§°ä¸ºGCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰</p></li><li><p>Serial Old</p><p> Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œstop the worldã€‚ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š1. åœ¨JDK1.5åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureçš„æ—¶å€™ç”¨ã€‚</p></li><li><p>Parallel Old</p><p> Parallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œstop the worldã€‚</p></li><li><p>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨</p></li></ol><p>æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œé‡è§†æœåŠ¡å“åº”é€Ÿåº¦ï¼Œæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°ã€‚ç¬¬ä¸€æ¬¾å¹¶å‘æ”¶é›†å™¨ï¼Œå¯ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼šåˆå§‹æ ‡è®°(CMS initial mark)ã€å¹¶å‘æ ‡è®°(CMS concurrent mark)ã€é‡æ–°æ ‡è®°(CMS remark)ã€å¹¶å‘æ¸…é™¤(CMS concurrent sweep)ã€‚åˆå§‹å’Œé‡æ–°stop the worldã€‚åˆå§‹æ ‡è®°åªæ˜¯æ ‡è®°GCRootsèƒ½ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œå¹¶å‘æ ‡è®°è¿›è¡ŒGCROOTs Tracingçš„è¿‡ç¨‹ã€‚é‡æ–°æ ‡è®°ä¸ºäº†ä¿®å¤å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚<br>ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚<br>ç¼ºç‚¹ï¼š1. å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿï¼Œè§£å†³æ–¹æ¡ˆï¼Œå‡å°‘GCçº¿ç¨‹çš„ç‹¬å æ—¶é—´ã€‚2. æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€‚CMSè¿è¡ŒæœŸé—´ï¼Œç”¨æˆ·çº¿ç¨‹äº§ç”Ÿçš„åƒåœ¾ä¸ºæµ®åŠ¨åƒåœ¾ï¼ŒCMSæ— æ³•åœ¨æœ¬æ¬¡æ”¶é›†ä¸­ä¸ªæ¸…ç†è¿™äº›æµ®åŠ¨åƒåœ¾ã€‚å¦‚æœCMSè¿è¡ŒæœŸé—´ï¼Œå†…å­˜æ— æ³•æ»¡è¶³ç”¨æˆ·çº¿ç¨‹è¦æ±‚ï¼Œå°±ä¼šå‡ºç°Concurrent Mode Failureå¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´å¦ä¸€ä¸ªFullGCäº§ç”Ÿï¼Œå¯åŠ¨é¢„å¤‡æ–¹æ¡ˆ Serial Oldã€‚3. äº§ç”Ÿå¤§é‡çš„ç©ºé—´ç¢ç‰‡ã€‚</p><ol start="7"><li><p>G1æ”¶é›†å™¨</p><p> æ ‡è®°æ•´ç†ç®—æ³•å®ç°ï¼Œç²¾ç¡®çš„æ§åˆ¶åœé¡¿ï¼ŒæŒ‡å®šä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸è¶…è¿‡Næ¯«ç§’ã€‚G1å°†æ•´ä¸ªJavaå †ï¼ˆè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£ï¼‰åˆ’åˆ†å¤šä¸ªå¤§å°å›ºå®šçš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œå¹¶ä¸”è¿½è¸ªè¿™äº›åŒºåŸŸé‡Œé¢çš„åƒåœ¾å †ç§¯ç¨‹åº¦ã€‚åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åŒºåŸŸã€‚</p></li></ol><h3 id="1-5-å†…å­˜åˆ†é…ä¸å›æ”¶"><a href="#1-5-å†…å­˜åˆ†é…ä¸å›æ”¶" class="headerlink" title="1.5 å†…å­˜åˆ†é…ä¸å›æ”¶"></a>1.5 å†…å­˜åˆ†é…ä¸å›æ”¶</h3><p>å¯¹è±¡åœ¨Edenä¸­åˆ†é…å†…å­˜ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ã€‚MinorGCã€‚</p><pre><code>MinorGC: æ–°ç”Ÿä»£åƒåœ¾å›æ”¶çš„åŠ¨ä½œï¼Œé¢‘ç¹ä¸”é€Ÿåº¦å¿«ã€‚MajorGCï¼ˆFullGCï¼‰: æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œæ…¢ï¼Œæ¸…ç†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼ŒCMS</code></pre><p>å¤§å¯¹è±¡æŒ‡éœ€è¦å¤§é‡è¿ç»­ç©ºé—´çš„Javaå¯¹è±¡ã€‚å…¸å‹å°±æ˜¯å¾ˆé•¿çš„å­—ç¬¦ä¸²å’Œæ•°ç»„ã€‚ç›´æ¥è¿›å…¥è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨EdenåŠSurvivorä¸­å¤§é‡å¤åˆ¶æ‹·è´ã€‚</p><p>é•¿æœŸç”Ÿæ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚å¯¹è±¡å¹´é¾„è®¡æ•°å™¨ï¼Œæ¯ä¸€æ¬¡MinorGCå¢é•¿1å²ã€‚é»˜è®¤15å²è¿›å…¥è€å¹´ä»£ã€‚</p><p>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­ï¼Œå¦‚æœåœ¨Survivorç©ºé—´ä¸­ï¼Œç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„æ®µçš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</p><p>ç©ºé—´æ‹…ä¿åˆ†é…ï¼Œæ¯æ¬¡MinorGC,æ£€æµ‹å‡çº§åˆ°è€å¹´ä»£çš„å¤§å°æ˜¯å¦å¤§äºè€å¹´ä»£çš„ç©ºé—´ï¼Œå¦‚æœå¤§äºï¼Œåˆ™è¿›è¡ŒFullGCã€‚</p><h2 id="2-JDKå‘½ä»¤è¡Œå·¥å…·-æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†"><a href="#2-JDKå‘½ä»¤è¡Œå·¥å…·-æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†" class="headerlink" title="2. JDKå‘½ä»¤è¡Œå·¥å…· æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†"></a>2. JDKå‘½ä»¤è¡Œå·¥å…· æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†</h2><h3 id="2-1-jps"><a href="#2-1-jps" class="headerlink" title="2.1 jps"></a>2.1 jps</h3><p>è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µå·¥å…·ã€‚ æ˜¾ç¤ºå½“å‰æ‰€æœ‰javaè¿›ç¨‹pidçš„å‘½ä»¤ã€‚</p><p>-l è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯JaråŒ…ï¼Œè¾“å‡ºJarè·¯å¾„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -l</span><br><span class="line">5696 com.intellij.rt.execution.application.AppMain</span><br><span class="line">944 org.jetbrains.idea.maven.server.RemoteMavenServer</span><br><span class="line">4488</span><br><span class="line">1900 org.jetbrains.jps.cmdline.Launcher</span><br><span class="line">7244 sun.tools.jps.Jps</span><br></pre></td></tr></table></figure><p>-v è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶JVMå‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -v</span><br><span class="line">5696 AppMain -Didea.launcher.port=7534 -Didea.launcher.bin.path=F:\Program Files\intellij IDEA\bin -Dfile.encoding=UTF-8</span><br><span class="line">944 RemoteMavenServer -Djava.awt.headless=true -Didea.version==2016.2.5 -Xmx768m -Didea.maven.embedder.version=3.0.5 -Dfile.encoding=GBK</span><br><span class="line">1656 Jps -Denv.class.path=.;C:\Program Files\Java\jdk1.8.0_161\lib\dt.jar;C:\Program Files\Java\jdk1.8.0_161\lib\tools.jar; -Dapplication.home=C:\Program Files\Java\jdk1.8.0_161 -Xms8m</span><br><span class="line">4488  -Xms128m -Xmx750m -XX:ReservedCodeCacheSize=240m -XX:+UseConcMarkSweepGC -XX:SoftRefLRUPolicyMSPerMB=50 -ea -Dsun.io.useCanonCaches=false -Djava.net.preferIPv4Stack=true -XX:+HeapDumpOnOutOfMemoryError -XX:-OmitStackTraceInFastThrow -Djb.vmOptionsFile=F:\Program Files\intellij IDEA\bin\idea64.exe.v</span><br><span class="line">moptions -Xbootclasspath/a:F:\Program Files\intellij IDEA\lib\boot.jar -Didea.paths.selector=IntelliJIdea2016.2 -Didea.jre.check=true -XX:ErrorFile=C:\Users\zhongyp\java_error_in_idea_%p.log -XX:HeapDumpPath=C:\Users\zhongyp\java_error_in_idea.hprof</span><br><span class="line">1900 Launcher -Xmx700m -Djava.awt.headless=true -Djava.endorsed.dirs=&quot;&quot; -Djdt.compiler.useSingleThread=true -Dpreload.project.path=E:/demo -Dpreload.config.path=C:/Users/zhongyp/.IntelliJIdea2016.2/config/options -Dcompile.parallel=false -Drebuild.on.dependency.change=true -Djava.net.preferIPv4Stack=true</span><br><span class="line"> -Dio.netty.initialSeedUniquifier=-1505227146882843300 -Dfile.encoding=GBK -Djps.file.types.component.name=FileTypeManager -Duser.language=zh -Duser.country=CN -Didea.paths.selector=IntelliJIdea2016.2 -Didea.home.path=F:\Program Files\intellij IDEA -Didea.config.path=C:\Users\zhongyp\.IntelliJIdea2016.2\</span><br><span class="line">config -Didea.plugins.path=C:\Users\zhongyp\.IntelliJIdea2016.2\config\plugins -Djps.log.dir=C:/Users/zhongyp/.IntelliJIdea2016.2/system/log/build-log -Djps.fallback.jdk.home=C:/Program Files/Java/jdk1.8.0_161/jre -Djps.fallback.jdk.version=1.8.0_161 -Djava.io.tmpdir=C:/Users/zhongyp/.IntelliJIdea2016.2/</span><br><span class="line">system/compile-server/_temp_ -Dkotlin.incremental.compilation.experimental=true -Dkotlin.daemon.enabled -Dkotlin.daemon.cli</span><br></pre></td></tr></table></figure><p>-q åªè¾“å‡ºLVMIDï¼Œçœç•¥ä¸»ç±»çš„åç§°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -q</span><br><span class="line">5696</span><br><span class="line">8912</span><br><span class="line">944</span><br><span class="line">4488</span><br><span class="line">1900</span><br></pre></td></tr></table></figure><p>-m è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ä¼ é€’ç»™ä¸»ç±»main()å‡½æ•°çš„å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -m</span><br><span class="line">5696 AppMain com.zhongyp.Test</span><br><span class="line">944 RemoteMavenServer</span><br><span class="line">10484 Jps -m</span><br><span class="line">4488</span><br><span class="line">1900 Launcher F:/Program Files/intellij IDEA/lib/log4j.jar;F:/Program Files/intellij IDEA/lib/jps-builders.jar;F:/Program Files/intellij IDEA/lib/netty-all-4.1.1.Final.jar;F:/Program Files/intellij IDEA/lib/annotations.jar;F:/Program Files/intellij IDEA/lib/rt/jps-plugin-system.jar;F:/Program Files/intel</span><br><span class="line">lij IDEA/lib/jgoodies-forms.jar;F:/Program Files/intellij IDEA/lib/util.jar;F:/Program Files/intellij IDEA/lib/trove4j.jar;F:/Program Files/intellij IDEA/lib/jna.jar;F:/Program Files/intellij IDEA/lib/resources_en.jar;F:/Program Files/intellij IDEA/lib/oromatcher.jar;F:/Program Files/intellij IDEA/lib/id</span><br><span class="line">ea_rt.jar;F:/Program Files/intellij IDEA/lib/openapi.jar;F:/Program Files/intellij IDEA/lib/javac2.jar;F:/Program Files/intellij IDEA/lib/snappy-in-java-0.5.1.jar;F:/Program Files/intellij IDEA/lib/jna-platform.jar;F:/Program Files/intellij IDEA/lib/forms_rt.jar;F:/Program Files/intellij IDEA/lib/jdom.ja</span><br><span class="line">r;F:/Program Files/intellij IDEA/lib/asm-all.jar;F:/Program Files/intellij IDEA/lib/jps-</span><br></pre></td></tr></table></figure><h3 id="2-2-jstat"><a href="#2-2-jstat" class="headerlink" title="2.2 jstat"></a>2.2 jstat</h3><p> è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·ï¼Œç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ã€‚å¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»åŠ è½½ã€å†…å­˜ã€åƒåœ¾å›æ”¶ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚è¿è¡ŒæœŸå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-classï¼šç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠç±»è£…è½½æ‰€è€—æ—¶é—´ã€‚</span><br><span class="line"></span><br><span class="line">-gcï¼šç›‘è§†JAVAå †çŠ¶å†µï¼ŒåŒ…æ‹¬EdenåŒºã€ä¸¤ä¸ªSurvivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ï¼ŒGCå·²ç”¨æ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ï¼›</span><br><span class="line"></span><br><span class="line">-gccapacityï¼šç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨ javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-gcutilï¼šç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä¾¿è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”ï¼›</span><br><span class="line"></span><br><span class="line">-gccauseï¼šä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´ ä¸€æ¬¡GCäº§ç”Ÿçš„åŸå› ï¼›</span><br><span class="line"></span><br><span class="line">-gcnewï¼šç›‘è§†æ–°ç”Ÿä»£GCçŠ¶æ€ï¼›</span><br><span class="line"></span><br><span class="line">-gcnewcapacityï¼šç›‘è§†å†…å®¹ä¸-gcnewåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºæœ€è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-gcoldï¼šç›‘è§†è€å¹´ä»£GCçŠ¶å†µï¼›</span><br><span class="line"></span><br><span class="line">-gcoldcapacityï¼šç›‘è§†å†…å®¹ä¸-gcoldåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-gcpermcapacityï¼šç›‘è§†æ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ï¼›</span><br><span class="line"></span><br><span class="line">-compilerï¼šè¾“å…¥JITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ï¼Œè€—æ—¶ç­‰ä¿¡æ¯ï¼›</span><br><span class="line"></span><br><span class="line">-printcompilationï¼šè¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³•ï¼›</span><br></pre></td></tr></table></figure><h3 id="2-3-jinfo"><a href="#2-3-jinfo" class="headerlink" title="2.3 jinfo"></a>2.3 jinfo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-flag &lt;name&gt; ï¼šå¯æŸ¥çœ‹è™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„å‚æ•°åˆ—è¡¨ã€‚</span><br><span class="line">-flag [+|-]&lt;name&gt;ï¼šè®¾ç½®æˆ–å–æ¶ˆVMå‚æ•°</span><br><span class="line">-flag &lt;name&gt;=&lt;value&gt;ï¼šç»™VMå‚æ•°è®¾ç½®æ–°å€¼</span><br><span class="line">-flagsï¼šå¯æŸ¥çœ‹æ‰€æœ‰VMå‚æ•°ï¼›</span><br><span class="line">-syspropsï¼šæŸ¥çœ‹javaç³»ç»Ÿå‚æ•°;</span><br><span class="line">&lt;no option&gt;ï¼šè¡¨ç¤ºåœ¨ä¸ç»™å®šä»»ä½•é€‰é¡¹æ—¶ï¼Œæ‰“å°å‡ºä»¥ä¸Šæ‰€æœ‰çš„VMå‚æ•°</span><br></pre></td></tr></table></figure><p> å®æ—¶çš„æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºçš„å„é¡¹å‚æ•°ã€‚</p><h3 id="2-4-jmap"><a href="#2-4-jmap" class="headerlink" title="2.4 jmap"></a>2.4 jmap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-dumpï¼šç”Ÿæˆjavaå †è½¬å‚¨å¿«ç…§ï¼Œæ ¼å¼ä¸ºï¼š-dump[live, ] format=b, file=&lt;filename&gt;,å…¶ä¸­liveå­å‚æ•°è¯´æ˜æ˜¯å¦åªdumpå‡ºå­˜æ´»å¯¹è±¡ï¼›</span><br><span class="line"></span><br><span class="line">-finalizerinfoï¼šæ˜¾ç¤ºåœ¨F-QueuiK ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeæ–¹æ³•çš„å¯¹è±¡ã€‚åªåœ¨Linux/Solariså¹³å°ä¸‹æœ‰æ•ˆï¼›</span><br><span class="line"></span><br><span class="line">-heapï¼šæ˜¾ç¤ºjavaå †è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ä½¿ç”¨å“ªç§å›æ”¶å™¨ã€å‚æ•°é…ç½®ã€åˆ†ä»£çŠ¶å†µç­‰ã€‚åªåœ¨Linux/Solariså¹³å°ä¸‹æœ‰æ•ˆï¼›</span><br><span class="line"></span><br><span class="line">-histoï¼šæ˜¾ç¤ºå †ä¸­å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡ï¼›</span><br><span class="line"></span><br><span class="line">-permstatï¼šä»¥ClassLoaderä¸ºç»Ÿè®¡å£å¾„æ˜¾ç¤ºæ°¸ä¹…ä»£å†…å­˜çŠ¶æ€ï¼Œåªåœ¨Linux/Solariså¹³å°æœ‰æ•ˆï¼›</span><br><span class="line"></span><br><span class="line">-Fï¼šå½“è™šæ‹Ÿæœºè¿›ç¨‹å¯¹-dumpé€‰é¡¹æ²¡æœ‰å“åº”æ—¶ï¼Œå¯ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¼ºåˆ¶ç”Ÿæˆdumpå¿«ç…§ï¼Œåªåœ¨Linux/Solariså¹³å°æœ‰æ•ˆ</span><br></pre></td></tr></table></figure><p> Javaå†…å­˜æ˜ åƒå·¥å…·ã€‚ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢finalize()æ‰§è¡Œé˜Ÿåˆ—ï¼ŒJavaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jmap -dump:format=b,file=D:\test.bin 2768</span><br><span class="line">Dumping heap to D:\test.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure><h3 id="2-5-jhat"><a href="#2-5-jhat" class="headerlink" title="2.5 jhat"></a>2.5 jhat</h3><p><code>jhat D:\test.bin</code></p><p> åˆ†æjmapç”Ÿæˆçš„å †è½¬å‚¨å¿«ç…§ï¼Œåœ¨æµè§ˆå™¨æŸ¥çœ‹ã€‚</p><h3 id="2-6-jstack"><a href="#2-6-jstack" class="headerlink" title="2.6 jstack"></a>2.6 jstack</h3><p> ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆå¿«ç…§çš„ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ã€‚</p><p>-F    å½“æ­£å¸¸è¾“å‡ºçš„è¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</p><p>-l    é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</p><p>-m    å¦‚æœè°ƒç”¨åˆ°æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºc/c++çš„å †æ ˆ</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">//        Thread t1 = new Worker(1);</span><br><span class="line">//</span><br><span class="line">//</span><br><span class="line">//        t1.start();</span><br><span class="line">        final A a = new A();</span><br><span class="line">        final B b = new B();</span><br><span class="line"></span><br><span class="line">        new Thread()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run()&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    sleep(3000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                a.getBLock(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line"></span><br><span class="line">        new Thread()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run()&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    sleep(3000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                b.getALock(a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class A &#123;</span><br><span class="line"></span><br><span class="line">    public synchronized void getBLock(B b)&#123;</span><br><span class="line"></span><br><span class="line">        b.getALock(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B&#123;</span><br><span class="line"></span><br><span class="line">    public synchronized void getALock(A a)&#123;</span><br><span class="line">        a.getBLock(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jps -m</span><br><span class="line">1904 AppMain com.zhongyp.Test</span><br><span class="line">944 RemoteMavenServer</span><br><span class="line">11540 Jps -m</span><br><span class="line">13204 Launcher F:/Program Files/intellij IDEA/lib/log4j.jar;F:/Program Files/intellij IDEA/lib/jps-builders.jar;F:/Program Files/intellij IDEA/lib/netty-all-4.1.1.Final.jar;F:/Program Files/intellij IDEA/lib/annotations.jar;F:/Program Files/intellij IDEA/lib/rt/jps-plugin-system.jar;F:/Program Files/inte</span><br><span class="line">llij IDEA/lib/jgoodies-forms.jar;F:/Program Files/intellij IDEA/lib/util.jar;F:/Program Files/intellij IDEA/lib/trove4j.jar;F:/Program Files/intellij IDEA/lib/jna.jar;F:/Program Files/intellij IDEA/lib/resources_en.jar;F:/Program Files/intellij IDEA/lib/oromatcher.jar;F:/Program Files/intellij IDEA/lib/i</span><br><span class="line">dea_rt.jar;F:/Program Files/intellij IDEA/lib/openapi.jar;F:/Program Files/intellij IDEA/lib/javac2.jar;F:/Program Files/intellij IDEA/lib/snappy-in-java-0.5.1.jar;F:/Program Files/intellij IDEA/lib/jna-platform.jar;F:/Program Files/intellij IDEA/lib/forms_rt.jar;F:/Program Files/intellij IDEA/lib/jdom.j</span><br><span class="line">ar;F:/Program Files/intellij IDEA/lib/asm-all.jar;F:/Program Files/intellij IDEA/lib/jps-</span><br><span class="line">4488</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Program Files\Java\jdk1.8.0_161\bin&gt;jstack -F 1904</span><br><span class="line">Attaching to process ID 1904, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.161-b12</span><br><span class="line">Deadlock Detection:</span><br><span class="line"></span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line"></span><br><span class="line">&quot;Thread-0&quot;:</span><br><span class="line">  waiting to lock Monitor@0x00000000193ce108 (Object@0x00000000d6129700, a com/zhongyp/B),</span><br><span class="line">  which is held by &quot;Thread-1&quot;</span><br><span class="line">&quot;Thread-1&quot;:</span><br><span class="line">  waiting to lock Monitor@0x00000000193cb878 (Object@0x00000000d6127d20, a com/zhongyp/A),</span><br><span class="line">  which is held by &quot;Thread-0&quot;</span><br><span class="line"></span><br><span class="line">Found a total of 1 deadlock.</span><br><span class="line"></span><br><span class="line">Thread 1: (state = BLOCKED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 18: (state = BLOCKED)</span><br><span class="line"> - com.zhongyp.A.getBLock(com.zhongyp.B) @bci=0, line=51 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.B.getALock(com.zhongyp.A) @bci=2, line=59 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.Test$2.run() @bci=18, line=38 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 17: (state = BLOCKED)</span><br><span class="line"> - com.zhongyp.B.getALock(com.zhongyp.A) @bci=0, line=59 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.A.getBLock(com.zhongyp.B) @bci=2, line=51 (Interpreted frame)</span><br><span class="line"> - com.zhongyp.Test$1.run() @bci=18, line=26 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 16: (state = IN_NATIVE)</span><br><span class="line"> - java.net.DualStackPlainSocketImpl.accept0(int, java.net.InetSocketAddress[]) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.net.DualStackPlainSocketImpl.socketAccept(java.net.SocketImpl) @bci=37, line=131 (Interpreted frame)</span><br><span class="line"> - java.net.AbstractPlainSocketImpl.accept(java.net.SocketImpl) @bci=7, line=409 (Interpreted frame)</span><br><span class="line"> - java.net.PlainSocketImpl.accept(java.net.SocketImpl) @bci=42, line=199 (Interpreted frame)</span><br><span class="line"> - java.net.ServerSocket.implAccept(java.net.Socket) @bci=60, line=545 (Interpreted frame)</span><br><span class="line"> - java.net.ServerSocket.accept() @bci=48, line=513 (Interpreted frame)</span><br><span class="line"> - com.intellij.rt.execution.application.AppMain$1.run() @bci=13, line=79 (Interpreted frame)</span><br><span class="line"> - java.lang.Thread.run() @bci=11, line=748 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 10: (state = BLOCKED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 9: (state = BLOCKED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 8: (state = BLOCKED)</span><br><span class="line"> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.ReferenceQueue.remove(long) @bci=59, line=143 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.ReferenceQueue.remove() @bci=2, line=164 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.Finalizer$FinalizerThread.run() @bci=36, line=209 (Interpreted frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thread 7: (state = BLOCKED)</span><br><span class="line"> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.lang.Object.wait() @bci=2, line=502 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.Reference.tryHandlePending(boolean) @bci=54, line=191 (Interpreted frame)</span><br><span class="line"> - java.lang.ref.Reference$ReferenceHandler.run() @bci=1, line=153 (Interpreted frame)</span><br></pre></td></tr></table></figure><h2 id="3-JDKå¯è§†åŒ–å·¥å…·"><a href="#3-JDKå¯è§†åŒ–å·¥å…·" class="headerlink" title="3. JDKå¯è§†åŒ–å·¥å…·"></a>3. JDKå¯è§†åŒ–å·¥å…·</h2><p>JConsole: Javaç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°ã€‚åŸºäºJMXçš„å¯è§†åŒ–ç›‘è§†å’Œç®¡ç†å·¥å…·ã€‚ç›‘è§†Javaå †å’Œæ°¸ä¹…ä»£çš„çš„å˜åŒ–è¶‹åŠ¿ã€‚</p><p>VisualVM: å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·ã€‚</p><h2 id="4-JVMè°ƒä¼˜æ¡ˆä¾‹"><a href="#4-JVMè°ƒä¼˜æ¡ˆä¾‹" class="headerlink" title="4. JVMè°ƒä¼˜æ¡ˆä¾‹"></a>4. JVMè°ƒä¼˜æ¡ˆä¾‹</h2><h3 id="4-1-é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥"><a href="#4-1-é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥" class="headerlink" title="4.1 é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥"></a>4.1 é«˜æ€§èƒ½ç¡¬ä»¶ä¸Šçš„ç¨‹åºéƒ¨ç½²ç­–ç•¥</h3><p>ä½¿ç”¨64ä½JDKå¤§å†…å­˜ã€‚</p><p>é—®é¢˜ï¼š1.å†…å­˜å›æ”¶å¯¼è‡´é•¿æ—¶é—´åœé¡¿ã€‚2.64ä½JDKçš„æ€§èƒ½æµ‹è¯•ç»“æœæ™®éä½äº32ä½JDKã€‚3.éœ€è¦ä¿è¯ç¨‹åºè¶³å¤Ÿç¨³å®šï¼Œè¿™ç§åº”ç”¨å¦‚æœäº§ç”Ÿå †æº¢å‡ºå‡ ä¹å°±æ— æ³•äº§ç”Ÿå †è½¬å‚¨å¿«ç…§ã€‚4. ç›¸åŒç¨‹åº64ä½JDKä¸­æ¶ˆè€—å†…å­˜ä¸€èˆ¬æ¯”32ä½å¤§ï¼Œè¿™æ˜¯ç”±äºæŒ‡é’ˆè†¨èƒ€å’Œæ•°æ®ç±»å‹å¯¹å…¶è¡¥ç™½å¯¼è‡´çš„ã€‚</p><p>ä½¿ç”¨è‹¥å¹²ä¸ª32ä½è™šæ‹Ÿæœºå»ºç«‹é€»è¾‘é›†ç¾¤æ¥åˆ©ç”¨é›†ç¾¤èµ„æºã€‚</p><p>é—®é¢˜ï¼š1.å°½é‡é¿å…èŠ‚ç‚¹ç«äº‰å…¨å±€èµ„æºï¼Œå¦‚å¹¶å‘å†™æ“ä½œå¯¼è‡´IOå¼‚å¸¸ã€‚2.å¾ˆéš¾é«˜æ•ˆç‡çš„åˆ©ç”¨æŸäº›èµ„æºæ± ï¼Œæ¯”å¦‚è¿æ¥æ± ï¼Œå¯¼è‡´ä¸€äº›èŠ‚ç‚¹æ»¡äº†ï¼Œå…¶ä»–çš„è¿˜ä¸ºé›¶ã€‚3.å„ä¸ªèŠ‚ç‚¹ä»ç„¶ä¸å¯é¿å…çš„å—åˆ°32ä½çš„é™åˆ¶ï¼ˆ2GBï¼‰ã€‚4.å¤§é‡ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„åº”ç”¨ï¼Œæ”¹ä¸ºé›†ä¸­å¼çš„ç¼“å­˜ã€‚</p><h3 id="4-2-é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º"><a href="#4-2-é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º" class="headerlink" title="4.2 é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º"></a>4.2 é›†ç¾¤é—´åŒæ­¥å¯¼è‡´å†…å­˜æº¢å‡º</h3><h3 id="4-3-å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯"><a href="#4-3-å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯" class="headerlink" title="4.3 å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯"></a>4.3 å †å¤–å†…å­˜å¯¼è‡´çš„æº¢å‡ºé”™è¯¯</h3><h3 id="4-4-å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢"><a href="#4-4-å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢" class="headerlink" title="4.4 å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢"></a>4.4 å¤–éƒ¨å‘½ä»¤å¯¼è‡´ç³»ç»Ÿç¼“æ…¢</h3><h2 id="5-javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹"><a href="#5-javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹" class="headerlink" title="5. javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹"></a>5. javaå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹</h2><h3 id="5-1-javaå†…å­˜æ¨¡å‹"><a href="#5-1-javaå†…å­˜æ¨¡å‹" class="headerlink" title="5.1 javaå†…å­˜æ¨¡å‹"></a>5.1 javaå†…å­˜æ¨¡å‹</h3><h4 id="5-1-1-ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"><a href="#5-1-1-ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜" class="headerlink" title="5.1.1 ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"></a>5.1.1 ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜</h4><p>Javaå†…å­˜æ¨¡å‹çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚</p><p>æ³¨ï¼š è¿™é‡Œè¯´çš„å˜é‡åŒ…æ‹¬äº†å®ä¾‹å˜é‡ã€é™æ€å­—æ®µå’Œæ„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ ï¼Œä½†ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡ä¸æ–¹æ³•å‚æ•°ï¼Œå› ä¸ºåè€…æ˜¯çº¿ç¨‹ç§æœ‰ï¼Œä¸ä¼šè¢«å…±äº«ï¼Œè‡ªç„¶å°±ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚</p><h2 id="6-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"><a href="#6-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–" class="headerlink" title="6. çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"></a>6. çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–</h2><p>çº¿ç¨‹å®‰å…¨çš„å®šä¹‰ï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–çš„åè°ƒæ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æ—¶çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h3 id="6-1-çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"><a href="#6-1-çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="headerlink" title="6.1 çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"></a>6.1 çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</h3><h4 id="6-1-1-äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰"><a href="#6-1-1-äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰" class="headerlink" title="6.1.1 äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰"></a>6.1.1 äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰</h4><p>æ‚²è§‚é”ã€‚</p><p>sychronized å’Œ ReentrantLockã€‚</p><h4 id="6-1-2-éé˜»å¡åŒæ­¥"><a href="#6-1-2-éé˜»å¡åŒæ­¥" class="headerlink" title="6.1.2 éé˜»å¡åŒæ­¥"></a>6.1.2 éé˜»å¡åŒæ­¥</h4><p>ä¹è§‚é”ï¼ŒCASã€‚</p><p>AtomicIntegerç­‰</p><h4 id="6-1-3-æ— åŒæ­¥æ–¹æ¡ˆ"><a href="#6-1-3-æ— åŒæ­¥æ–¹æ¡ˆ" class="headerlink" title="6.1.3 æ— åŒæ­¥æ–¹æ¡ˆ"></a>6.1.3 æ— åŒæ­¥æ–¹æ¡ˆ</h4><ul><li><p>å¯é‡å…¥ä»£ç ï¼šå¯ä»¥åœ¨ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ»ä¸­æ–­å®ƒï¼Œè½¬è€Œå»æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼Œè€Œåœ¨æ§åˆ¶æƒè¿”å›åï¼ŒåŸæ¥çš„ç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚åˆ¤æ–­ä»£ç æ˜¯å¦å…·å¤‡å¯é‡å…¥æ€§ï¼šå¦‚æœä¸€ä¸ªæ–¹æ³•ï¼Œä»–çš„è¿”å›ç»“æœæ˜¯å¯ä»¥é¢„æµ‹çš„ï¼Œåªè¦è¾“å…¥äº†ç›¸åŒçš„æ•°æ®ï¼Œå°±éƒ½èƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œé‚£å®ƒå°±æ»¡è¶³å¯é‡å…¥æ€§çš„è¦æ±‚ã€‚</p></li><li><p>çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼šå¦‚æœä¸€æ®µä»£ç ä¸­æ‰€éœ€è¦çš„æ•°æ®å¿…é¡»ä¸å…¶ä»–ä»£ç å…±äº«ï¼Œé‚£å°±çœ‹çœ‹è¿™äº›å…±äº«æ•°æ®çš„ä»£ç æ˜¯å¦èƒ½ä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼ŸThreadLocalï¼ˆä¸å…±äº«ï¼‰ã€‚volatile(å…±äº«)ã€‚</p></li></ul><h3 id="6-2-é”ä¼˜åŒ–"><a href="#6-2-é”ä¼˜åŒ–" class="headerlink" title="6.2 é”ä¼˜åŒ–"></a>6.2 é”ä¼˜åŒ–</h3><h4 id="6-2-1-è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”"><a href="#6-2-1-è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”" class="headerlink" title="6.2.1 è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”"></a>6.2.1 è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”</h4><h4 id="6-2-2-é”æ¶ˆé™¤"><a href="#6-2-2-é”æ¶ˆé™¤" class="headerlink" title="6.2.2 é”æ¶ˆé™¤"></a>6.2.2 é”æ¶ˆé™¤</h4><h4 id="6-2-3-é”ç²—åŒ–"><a href="#6-2-3-é”ç²—åŒ–" class="headerlink" title="6.2.3 é”ç²—åŒ–"></a>6.2.3 é”ç²—åŒ–</h4><h4 id="6-2-4-è½»é‡çº§é”"><a href="#6-2-4-è½»é‡çº§é”" class="headerlink" title="6.2.4 è½»é‡çº§é”"></a>6.2.4 è½»é‡çº§é”</h4><h4 id="6-2-5-åå‘é”"><a href="#6-2-5-åå‘é”" class="headerlink" title="6.2.5 åå‘é”"></a>6.2.5 åå‘é”</h4><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2>]]></content>
      
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaåå°„å’ŒåŠ¨æ€ä»£ç†</title>
      <link href="/2018/03/18/java/2018-03-18-JavaReflection/"/>
      <url>/2018/03/18/java/2018-03-18-JavaReflection/</url>
      
        <content type="html"><![CDATA[<p>è¦æƒ³ç†è§£åå°„çš„åŸç†ï¼Œé¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯ç±»å‹ä¿¡æ¯ã€‚Javaè®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶è¯†åˆ«å¯¹è±¡å’Œç±»çš„ä¿¡æ¯ï¼Œä¸»è¦æœ‰2ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ä¼ ç»Ÿçš„RTTIï¼Œå®ƒå‡å®šæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å·²ç»çŸ¥é“äº†æ‰€æœ‰çš„ç±»å‹ä¿¡æ¯ï¼›å¦ä¸€ç§æ˜¯åå°„æœºåˆ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å‘ç°å’Œä½¿ç”¨ç±»çš„ä¿¡æ¯ã€‚</p><h2 id="CLASS-å¯¹è±¡"><a href="#CLASS-å¯¹è±¡" class="headerlink" title="CLASS å¯¹è±¡"></a>CLASS å¯¹è±¡</h2><p>æ¯ä¸ªç±»éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„Classå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜åœ¨.classæ–‡ä»¶ã€‚æ‰€æœ‰ç±»éƒ½æ˜¯åœ¨å¯¹å…¶ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ï¼ŒåŠ¨æ€åŠ è½½åˆ°JVMçš„ï¼Œå½“ç¨‹åºåˆ›å»ºä¸€ä¸ªå¯¹ç±»çš„é™æ€æˆå‘˜çš„å¼•ç”¨æ—¶ï¼Œå°±ä¼šåŠ è½½è¿™ä¸ªç±»ã€‚Classå¯¹è±¡ä»…åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šåŠ è½½ï¼Œstaticåˆå§‹åŒ–æ˜¯åœ¨ç±»åŠ è½½æ—¶è¿›è¡Œçš„ã€‚</p><p>ç±»åŠ è½½å™¨é¦–å…ˆä¼šæ£€æŸ¥è¿™ä¸ªç±»çš„Classå¯¹è±¡æ˜¯å¦å·²è¢«åŠ è½½è¿‡ï¼Œå¦‚æœå°šæœªåŠ è½½ï¼Œé»˜è®¤çš„ç±»åŠ è½½å™¨å°±ä¼šæ ¹æ®ç±»åæŸ¥æ‰¾å¯¹åº”çš„.classæ–‡ä»¶ã€‚</p><p>æƒ³åœ¨è¿è¡Œæ—¶ä½¿ç”¨ç±»å‹ä¿¡æ¯ï¼Œå¿…é¡»è·å–å¯¹è±¡(æ¯”å¦‚ç±»Baseå¯¹è±¡)çš„Classå¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿ç”¨åŠŸèƒ½Class.forName(â€œBaseâ€)å¯ä»¥å®ç°è¯¥ç›®çš„ï¼Œæˆ–è€…ä½¿ç”¨base.classã€‚æ³¨æ„ï¼Œæœ‰ä¸€ç‚¹å¾ˆæœ‰è¶£ï¼Œä½¿ç”¨åŠŸèƒ½â€.classâ€æ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ï¼Œä½¿ç”¨forName()ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ã€‚ä¸ºäº†ä½¿ç”¨ç±»è€Œåšçš„å‡†å¤‡å·¥ä½œä¸€èˆ¬æœ‰ä»¥ä¸‹3ä¸ªæ­¥éª¤ï¼š</p><ul><li><p>åŠ è½½ï¼šç”±ç±»åŠ è½½å™¨å®Œæˆï¼Œæ‰¾åˆ°å¯¹åº”çš„å­—èŠ‚ç ï¼Œåˆ›å»ºä¸€ä¸ªClasså¯¹è±¡</p></li><li><p>é“¾æ¥ï¼šéªŒè¯ç±»ä¸­çš„å­—èŠ‚ç ï¼Œä¸ºé™æ€åŸŸåˆ†é…ç©ºé—´</p></li><li><p>åˆå§‹åŒ–ï¼šå¦‚æœè¯¥ç±»æœ‰è¶…ç±»ï¼Œåˆ™å¯¹å…¶åˆå§‹åŒ–ï¼Œæ‰§è¡Œé™æ€åˆå§‹åŒ–å™¨å’Œé™æ€åˆå§‹åŒ–å—</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Base &#123;</span><br><span class="line">    static int num = 1;</span><br><span class="line">    </span><br><span class="line">    static &#123;</span><br><span class="line">        System.out.println(&quot;Base &quot; + num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // ä¸ä¼šåˆå§‹åŒ–é™æ€å—</span><br><span class="line">        Class clazz1 = Base.class;</span><br><span class="line">        System.out.println(&quot;------&quot;);</span><br><span class="line">        // ä¼šåˆå§‹åŒ–</span><br><span class="line">        Class clazz2 = Class.forName(&quot;zzz.Base&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><p>å¦‚æœä¸çŸ¥é“æŸä¸ªå¯¹è±¡çš„ç¡®åˆ‡ç±»å‹ï¼ŒRTTIå¯ä»¥å‘Šè¯‰ä½ ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå‰æï¼šè¿™ä¸ªç±»å‹åœ¨ç¼–è¯‘æ—¶å¿…é¡»å·²çŸ¥ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨RTTIæ¥è¯†åˆ«å®ƒã€‚Classç±»ä¸java.lang.reflectç±»åº“ä¸€èµ·å¯¹åå°„è¿›è¡Œäº†æ”¯æŒï¼Œè¯¥ç±»åº“åŒ…å«Fieldã€Methodå’ŒConstructorç±»ï¼Œè¿™äº›ç±»çš„å¯¹è±¡ç”±JVMåœ¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œç”¨ä»¥è¡¨ç¤ºæœªçŸ¥ç±»é‡Œå¯¹åº”çš„æˆå‘˜ã€‚è¿™æ ·çš„è¯å°±å¯ä»¥ä½¿ç”¨Contructoråˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œç”¨get()å’Œset()æ–¹æ³•è·å–å’Œä¿®æ”¹ç±»ä¸­ä¸Fieldå¯¹è±¡å…³è”çš„å­—æ®µï¼Œç”¨invoke()æ–¹æ³•è°ƒç”¨ä¸Methodå¯¹è±¡å…³è”çš„æ–¹æ³•ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥è°ƒç”¨getFields()ã€getMethods()å’ŒgetConstructors()ç­‰è®¸å¤šä¾¿åˆ©çš„æ–¹æ³•ï¼Œä»¥è¿”å›è¡¨ç¤ºå­—æ®µã€æ–¹æ³•ã€ä»¥åŠæ„é€ å™¨å¯¹è±¡çš„æ•°ç»„ï¼Œè¿™æ ·ï¼Œå¯¹è±¡ä¿¡æ¯å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«å®Œå…¨ç¡®å®šä¸‹æ¥ï¼Œè€Œåœ¨ç¼–è¯‘æ—¶ä¸éœ€è¦çŸ¥é“å…³äºç±»çš„ä»»ä½•äº‹æƒ…ã€‚</p><p>åå°„æœºåˆ¶å¹¶æ²¡æœ‰ä»€ä¹ˆç¥å¥‡ä¹‹å¤„ï¼Œå½“é€šè¿‡åå°„ä¸ä¸€ä¸ªæœªçŸ¥ç±»å‹çš„å¯¹è±¡æ‰“äº¤é“æ—¶ï¼ŒJVMåªæ˜¯ç®€å•åœ°æ£€æŸ¥è¿™ä¸ªå¯¹è±¡ï¼Œçœ‹å®ƒå±äºå“ªä¸ªç‰¹å®šçš„ç±»ã€‚å› æ­¤ï¼Œé‚£ä¸ªç±»çš„.classå¯¹äºJVMæ¥è¯´å¿…é¡»æ˜¯å¯è·å–çš„ï¼Œè¦ä¹ˆåœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œè¦ä¹ˆä»ç½‘ç»œè·å–ã€‚æ‰€ä»¥å¯¹äºRTTIå’Œåå°„ä¹‹é—´çš„çœŸæ­£åŒºåˆ«åªåœ¨äºï¼š</p><ul><li><p>RTTIï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶</p></li><li><p>åå°„ï¼Œè¿è¡Œæ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String args[]) throws ClassNotFoundException, InvocationTargetException, IllegalAccessException, NoSuchMethodException &#123;</span><br><span class="line"></span><br><span class="line">        Test test =  new Test();</span><br><span class="line">    </span><br><span class="line">        Class clazz = Class.forName(&quot;com.zhongyp.advanced.proxy.Test&quot;);</span><br><span class="line">        Constructor[] constructors = clazz.getConstructors();</span><br><span class="line">        for(Constructor str:constructors)&#123;</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method[] method = clazz.getDeclaredMethods();</span><br><span class="line">        for(Method method1:method)&#123;</span><br><span class="line">            System.out.println(method1);</span><br><span class="line">        &#125;</span><br><span class="line">        Method method1 = clazz.getMethod(&quot;go&quot;, null);</span><br><span class="line">        method1.invoke(test,null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">class Test&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Test()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    private void test()&#123;&#125;</span><br><span class="line">    public void go()&#123;</span><br><span class="line">        System.out.println(&quot;go&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void gogogo()&#123;</span><br><span class="line">        System.out.println(&quot;gogogo&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><p>ä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†æä¾›é¢å¤–æˆ–ä¸åŒçš„æ“ä½œï¼Œè€Œæ’å…¥çš„ç”¨æ¥æ›¿ä»£â€å®é™…â€å¯¹è±¡çš„å¯¹è±¡ï¼Œè¿™äº›æ“ä½œæ¶‰åŠåˆ°ä¸â€å®é™…â€å¯¹è±¡çš„é€šä¿¡ï¼Œå› æ­¤ä»£ç†é€šå¸¸å……å½“ä¸­é—´äººè§’è‰²ã€‚Javaçš„åŠ¨æ€ä»£ç†æ¯”ä»£ç†çš„æ€æƒ³æ›´å‰è¿›äº†ä¸€æ­¥ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°åˆ›å»ºå¹¶ä»£ç†å¹¶åŠ¨æ€åœ°å¤„ç†å¯¹æ‰€ä»£ç†æ–¹æ³•çš„è°ƒç”¨ã€‚åœ¨åŠ¨æ€ä»£ç†ä¸Šæ‰€åšçš„æ‰€æœ‰è°ƒç”¨éƒ½ä¼šè¢«é‡å®šå‘åˆ°å•ä¸€çš„è°ƒç”¨å¤„ç†å™¨ä¸Šï¼Œå®ƒçš„å·¥ä½œæ˜¯æ­ç¤ºè°ƒç”¨çš„ç±»å‹å¹¶ç¡®å®šç›¸åº”çš„ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">interface TestService&#123;</span><br><span class="line"></span><br><span class="line">    void test();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TestServiceImpl implements TestService&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        System.out.println(&quot;æˆ‘è¦å¼€å§‹æµ‹è¯•å•¦&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyInvokeHandler implements InvocationHandler&#123;</span><br><span class="line"></span><br><span class="line">    Object obj;</span><br><span class="line">    public MyInvokeHandler(Object obj)&#123;</span><br><span class="line">        this.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        return method.invoke(obj,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line"></span><br><span class="line">        TestServiceImpl testService = new TestServiceImpl();</span><br><span class="line"></span><br><span class="line">        MyInvokeHandler myInvokeHandler = new MyInvokeHandler(testService);</span><br><span class="line"></span><br><span class="line">        TestService proxy = (TestService) Proxy.newProxyInstance(TestService.class.getClassLoader(),new Class[]&#123;TestService.class&#125;,myInvokeHandler);</span><br><span class="line"></span><br><span class="line">        proxy.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ•°æ®å­˜å‚¨-Springäº‹åŠ¡</title>
      <link href="/2018/03/17/spring/2018-03-17-Spring-Transaction/"/>
      <url>/2018/03/17/spring/2018-03-17-Spring-Transaction/</url>
      
        <content type="html"><![CDATA[<h2 id="äº‹åŠ¡ä¼ æ’­ç‰¹æ€§"><a href="#äº‹åŠ¡ä¼ æ’­ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡ä¼ æ’­ç‰¹æ€§"></a>äº‹åŠ¡ä¼ æ’­ç‰¹æ€§</h2><p><a href="https://github.com/zhongyp/Demo" target="_blank" rel="noopener">æºç å®ä¾‹</a></p><h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><h2 id="Spring-äº‹åŠ¡"><a href="#Spring-äº‹åŠ¡" class="headerlink" title="Spring äº‹åŠ¡"></a>Spring äº‹åŠ¡</h2><p>äº‹åŠ¡åŸæœ¬æ˜¯æ•°æ®åº“ä¸­çš„æ¦‚å¿µï¼Œåœ¨ Dao å±‚ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéœ€è¦å°†äº‹åŠ¡æå‡åˆ°ä¸šåŠ¡å±‚ï¼Œå³ Service å±‚ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨äº‹åŠ¡çš„ç‰¹æ€§æ¥ç®¡ç†å…·ä½“çš„ä¸šåŠ¡ã€‚  </p><p>åœ¨ Spring ä¸­é€šå¸¸å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥å®ç°å¯¹äº‹åŠ¡çš„ç®¡ç†ï¼š </p><ol><li><p>ä½¿ç”¨ Spring çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡ </p></li><li><p>ä½¿ç”¨ Spring çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡ </p></li><li><p>ä½¿ç”¨ AspectJ çš„ AOP é…ç½®ç®¡ç†äº‹åŠ¡ </p></li></ol><p>Spring çš„äº‹åŠ¡ç®¡ç†ï¼Œä¸»è¦ç”¨åˆ°ä¸¤ä¸ªäº‹åŠ¡ç›¸å…³çš„æ¥å£ã€‚</p><p> <img src="https://github.com/zhongyp/jekyll.github.io/blob/master/styles/images/article/transaction.jpg?raw=true" alt="Springäº‹åŠ¡æ¥å£"></p><h2 id="äº‹åŠ¡ç®¡ç†å™¨æ¥å£"><a href="#äº‹åŠ¡ç®¡ç†å™¨æ¥å£" class="headerlink" title="äº‹åŠ¡ç®¡ç†å™¨æ¥å£"></a>äº‹åŠ¡ç®¡ç†å™¨æ¥å£</h2><p>äº‹åŠ¡ç®¡ç†å™¨æ˜¯ PlatformTransactionManager æ¥å£å¯¹è±¡ã€‚å…¶ä¸»è¦ç”¨äºå®Œæˆäº‹åŠ¡çš„æäº¤ã€å›æ»šï¼ŒåŠè·å–äº‹åŠ¡çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Public interface PlatformTransactionManager()...&#123;  </span><br><span class="line">// ç”±TransactionDefinitionå¾—åˆ°TransactionStatuså¯¹è±¡</span><br><span class="line">TransactionStatus getTransaction(TransactionDefinition definition) throws TransactionException; </span><br><span class="line">// æäº¤</span><br><span class="line">Void commit(TransactionStatus status) throws TransactionException;  </span><br><span class="line">// å›æ»š</span><br><span class="line">Void rollback(TransactionStatus status) throws TransactionException;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A) å¸¸ç”¨çš„ä¸¤ä¸ªå®ç°ç±»ï¼ŒPlatformTransactionManager æ¥å£æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å®ç°ç±»ï¼š  ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</p><ul><li>DataSourceTransactionManagerï¼šä½¿ç”¨ JDBC æˆ– iBatis  è¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨ã€‚  </li></ul><p>å¦‚æœåº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨JDBCæ¥è¿›è¡ŒæŒä¹…åŒ–ï¼ŒDataSourceTransactionManagerä¼šä¸ºä½ å¤„ç†äº‹åŠ¡è¾¹ç•Œã€‚ä¸ºäº†ä½¿ç”¨DataSourceTransactionManagerï¼Œä½ éœ€è¦ä½¿ç”¨å¦‚ä¸‹çš„XMLå°†å…¶è£…é…åˆ°åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡å®šä¹‰ä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼ŒDataSourceTransactionManageræ˜¯é€šè¿‡è°ƒç”¨java.sql.Connectionæ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œåè€…æ˜¯é€šè¿‡DataSourceè·å–åˆ°çš„ã€‚é€šè¿‡è°ƒç”¨è¿æ¥çš„commit()æ–¹æ³•æ¥æäº¤äº‹åŠ¡ï¼ŒåŒæ ·ï¼Œäº‹åŠ¡å¤±è´¥åˆ™é€šè¿‡è°ƒç”¨rollback()æ–¹æ³•è¿›è¡Œå›æ»šã€‚</p><p>ã€€ã€€</p><ul><li>HibernateTransactionManagerï¼šä½¿ç”¨ Hibernate è¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨ã€‚ </li></ul><p>å¦‚æœåº”ç”¨ç¨‹åºçš„æŒä¹…åŒ–æ˜¯é€šè¿‡Hibernateå®ç°çš„ï¼Œé‚£ä¹ˆä½ éœ€è¦ä½¿ç”¨HibernateTransactionManagerã€‚å¯¹äºHibernate3ï¼Œéœ€è¦åœ¨Springä¸Šä¸‹æ–‡å®šä¹‰ä¸­æ·»åŠ å¦‚ä¸‹çš„<bean>å£°æ˜ï¼š</bean></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.hibernate3.HibernateTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>sessionFactoryå±æ€§éœ€è¦è£…é…ä¸€ä¸ªHibernateçš„sessionå·¥å‚ï¼ŒHibernateTransactionManagerçš„å®ç°ç»†èŠ‚æ˜¯å®ƒå°†äº‹åŠ¡ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™org.hibernate.Transactionå¯¹è±¡ï¼Œè€Œåè€…æ˜¯ä»Hibernate Sessionä¸­è·å–åˆ°çš„ã€‚å½“äº‹åŠ¡æˆåŠŸå®Œæˆæ—¶ï¼ŒHibernateTransactionManagerå°†ä¼šè°ƒç”¨Transactionå¯¹è±¡çš„commit()æ–¹æ³•ï¼Œåä¹‹ï¼Œå°†ä¼šè°ƒç”¨rollback()æ–¹æ³•ã€‚</p><p>B) PlatformTransactionManagerå…¶ä»–å®ç°ç±»</p><p>Springäº‹åŠ¡ç®¡ç†çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ä¸ºä¸åŒçš„äº‹åŠ¡APIæä¾›ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¦‚JTA(äº‹åŠ¡)ã€JPA(æŒä¹…åŒ–)ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªå¹³å°æ¡†æ¶å®ç°äº‹åŠ¡ç®¡ç†çš„æœºåˆ¶ã€‚</p><ul><li>JavaæŒä¹…åŒ–APIäº‹åŠ¡ï¼ˆJPAï¼‰</li></ul><p>Hibernateå¤šå¹´æ¥ä¸€ç›´æ˜¯äº‹å®ä¸Šçš„JavaæŒä¹…åŒ–æ ‡å‡†ï¼Œä½†æ˜¯ç°åœ¨JavaæŒä¹…åŒ–APIä½œä¸ºçœŸæ­£çš„JavaæŒä¹…åŒ–æ ‡å‡†è¿›å…¥å¤§å®¶çš„è§†é‡ã€‚å¦‚æœä½ è®¡åˆ’ä½¿ç”¨JPAçš„è¯ï¼Œé‚£ä½ éœ€è¦ä½¿ç”¨Springçš„JpaTransactionManageræ¥å¤„ç†äº‹åŠ¡ã€‚ä½ éœ€è¦åœ¨Springä¸­è¿™æ ·é…ç½®JpaTransactionManagerï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>JpaTransactionManageråªéœ€è¦è£…é…ä¸€ä¸ªJPAå®ä½“ç®¡ç†å·¥å‚ï¼ˆjavax.persistence.EntityManagerFactoryæ¥å£çš„ä»»æ„å®ç°ï¼‰ã€‚JpaTransactionManagerå°†ä¸ç”±å·¥å‚æ‰€äº§ç”Ÿçš„JPA EntityManageråˆä½œæ¥æ„å»ºäº‹åŠ¡ã€‚</p><ul><li>JavaåŸç”ŸAPIäº‹åŠ¡(JTA)</li></ul><p>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ä»¥ä¸Šæ‰€è¿°çš„äº‹åŠ¡ç®¡ç†ï¼Œæˆ–è€…æ˜¯è·¨è¶Šäº†å¤šä¸ªäº‹åŠ¡ç®¡ç†æºï¼ˆæ¯”å¦‚ä¸¤ä¸ªæˆ–è€…æ˜¯å¤šä¸ªä¸åŒçš„æ•°æ®æºï¼‰ï¼Œä½ å°±éœ€è¦ä½¿ç”¨JtaTransactionManagerï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;transactionManagerName&quot; value=&quot;java:/TransactionManager&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>JtaTransactionManagerå°†äº‹åŠ¡ç®¡ç†çš„è´£ä»»å§”æ‰˜ç»™javax.transaction.UserTransactionå’Œjavax.transaction.TransactionManagerå¯¹è±¡ï¼Œå…¶ä¸­äº‹åŠ¡æˆåŠŸå®Œæˆé€šè¿‡UserTransaction.commit()æ–¹æ³•æäº¤ï¼Œäº‹åŠ¡å¤±è´¥é€šè¿‡UserTransaction.rollback()æ–¹æ³•å›æ»šã€‚</p><p>C) Spring çš„å›æ»šæ–¹å¼ ã€€ã€€</p><ul><li>Spring äº‹åŠ¡çš„é»˜è®¤å›æ»šæ–¹å¼æ˜¯ï¼šå‘ç”Ÿè¿è¡Œæ—¶å¼‚å¸¸æ—¶å›æ»šï¼Œå‘ç”Ÿå—æŸ¥å¼‚å¸¸æ—¶æäº¤ã€‚ä¸è¿‡ï¼Œå¯¹äºå—æŸ¥å¼‚å¸¸ï¼Œç¨‹åºå‘˜ä¹Ÿå¯ä»¥æ‰‹å·¥è®¾ç½®å…¶å›æ»šæ–¹å¼ã€‚</li></ul><h2 id="äº‹åŠ¡å®šä¹‰æ¥å£"><a href="#äº‹åŠ¡å®šä¹‰æ¥å£" class="headerlink" title="äº‹åŠ¡å®šä¹‰æ¥å£"></a>äº‹åŠ¡å®šä¹‰æ¥å£</h2><p>äº‹åŠ¡å®šä¹‰æ¥å£ TransactionDefinition ä¸­å®šä¹‰äº†äº‹åŠ¡æè¿°ç›¸å…³çš„ä¸‰ç±»å¸¸é‡ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«ã€äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€äº‹åŠ¡é»˜è®¤è¶…æ—¶æ—¶é™ï¼ŒåŠå¯¹å®ƒä»¬çš„æ“ä½œã€‚</p><p>A) å®šä¹‰äº†äº”ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«å¸¸é‡,è¿™äº›å¸¸é‡å‡æ˜¯ä»¥ ISOLATION_å¼€å¤´ã€‚å³å½¢å¦‚ ISOLATION_XXXï¼š ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ </p><ul><li>DEFAULTï¼šé‡‡ç”¨DBé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚MySqlçš„é»˜è®¤ä¸ºREPEATABLE_READï¼›  Oracleé»˜è®¤ä¸º READ_COMMITTEDã€‚ ã€€ã€€</li><li>READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ã€‚æœªè§£å†³ä»»ä½•å¹¶å‘é—®é¢˜ã€‚ ã€€ã€€</li><li>READ_COMMITTEDï¼šè¯»å·²æäº¤ã€‚è§£å†³è„è¯»ï¼Œå­˜åœ¨ä¸å¯é‡å¤è¯»ä¸å¹»è¯»ã€‚  ã€€ã€€</li><li>REPEATABLE_READï¼šå¯é‡å¤è¯»ã€‚è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œå­˜åœ¨å¹»è¯»  ã€€ã€€</li><li>SERIALIZABLEï¼šä¸²è¡ŒåŒ–ã€‚ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚</li></ul><p>B) å®šä¹‰äº†ä¸ƒä¸ªäº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¸¸é‡ï¼Œæ‰€è°“äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯æŒ‡ï¼Œå¤„äºä¸åŒäº‹åŠ¡ä¸­çš„æ–¹æ³•åœ¨ç›¸äº’è°ƒç”¨æ—¶ï¼Œæ‰§è¡ŒæœŸé—´äº‹åŠ¡çš„ç»´æŠ¤æƒ…å†µã€‚å¦‚ï¼ŒA äº‹åŠ¡ä¸­çš„æ–¹æ³• doSome()è°ƒç”¨ B äº‹åŠ¡ä¸­çš„æ–¹æ³• doOther()ï¼Œåœ¨è°ƒç”¨æ‰§è¡ŒæœŸé—´äº‹åŠ¡çš„ç»´æŠ¤æƒ…å†µï¼Œå°±ç§°ä¸ºäº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯åŠ åœ¨æ–¹æ³•ä¸Šçš„ã€‚äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¸¸é‡éƒ½æ˜¯ä»¥ PROPAGATION_  å¼€å¤´ï¼Œå½¢å¦‚ PROPAGATION_XXXã€‚  ã€€ã€€</p><ul><li>REQUIREDï¼šæŒ‡å®šçš„æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡å†…æ‰§è¡Œã€‚è‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­ï¼›è‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚è¿™ç§ä¼ æ’­è¡Œä¸ºæ˜¯æœ€å¸¸è§çš„é€‰æ‹©ï¼Œä¹Ÿæ˜¯Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚å¦‚è¯¥ä¼ æ’­è¡Œä¸ºåŠ åœ¨ doOther()æ–¹æ³•ä¸Šã€‚è‹¥ doSome()æ–¹æ³•åœ¨æ‰§è¡Œæ—¶å°±æ˜¯åœ¨äº‹åŠ¡å†…çš„ï¼Œåˆ™ doOther()æ–¹æ³•çš„æ‰§è¡Œä¹ŸåŠ å…¥åˆ°è¯¥äº‹åŠ¡å†…æ‰§è¡Œã€‚è‹¥ doSome()æ–¹æ³•æ²¡æœ‰åœ¨äº‹åŠ¡å†…æ‰§è¡Œï¼Œåˆ™ doOther()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œã€‚ã€€ã€€</li><li><p>SUPPORTSï¼šæŒ‡å®šçš„æ–¹æ³•æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œä½†è‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚ </p></li><li><p>MANDATORYï¼šæŒ‡å®šçš„æ–¹æ³•å¿…é¡»åœ¨å½“å‰äº‹åŠ¡å†…æ‰§è¡Œï¼Œè‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>REQUIRES_NEWï¼šæ€»æ˜¯æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ï¼Œç›´åˆ°æ–°äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p></li><li><p>NOT_SUPPORTEDï¼šæŒ‡å®šçš„æ–¹æ³•ä¸èƒ½åœ¨äº‹åŠ¡ç¯å¢ƒä¸­æ‰§è¡Œï¼Œè‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</p></li><li><p>NEVERï¼šæŒ‡å®šçš„æ–¹æ³•ä¸èƒ½åœ¨äº‹åŠ¡ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œè‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>NESTEDï¼šæŒ‡å®šçš„æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡å†…æ‰§è¡Œã€‚è‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼›è‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚åµŒå¥—äº‹åŠ¡åœ¨å¤–éƒ¨äº‹åŠ¡æäº¤åï¼Œæ‰çœŸæ­£çš„æäº¤ã€‚</p></li></ul><p>C) å®šä¹‰äº†é»˜è®¤äº‹åŠ¡è¶…æ—¶æ—¶é™ </p><ul><li><p>å¸¸é‡ TIMEOUT_DEFAULT å®šä¹‰äº†äº‹åŠ¡åº•å±‚é»˜è®¤çš„è¶…æ—¶æ—¶é™ï¼ŒåŠä¸æ”¯æŒäº‹åŠ¡è¶…æ—¶æ—¶é™è®¾ç½®çš„ none å€¼ã€‚ </p></li><li><p>æ³¨æ„ï¼Œäº‹åŠ¡çš„è¶…æ—¶æ—¶é™èµ·ä½œç”¨çš„æ¡ä»¶æ¯”è¾ƒå¤šï¼Œä¸”è¶…æ—¶çš„æ—¶é—´è®¡ç®—ç‚¹è¾ƒå¤æ‚ã€‚æ‰€ä»¥ï¼Œè¯¥å€¼ä¸€èˆ¬å°±ä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p></li></ul><h2 id="Spring-çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡"><a href="#Spring-çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡" class="headerlink" title="Spring çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡"></a>Spring çš„äº‹åŠ¡ä»£ç†å·¥å‚ç®¡ç†äº‹åŠ¡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†Œæ•°æ®æºï¼šC3P0æ•°æ®æº --&gt;</span><br><span class="line">    &lt;bean id=&quot;myDataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒJDBCå±æ€§æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒDao --&gt;</span><br><span class="line">    &lt;bean id=&quot;accountDao&quot; class=&quot;com.tongji.dao.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;stockDao&quot; class=&quot;com.tongji.dao.StockDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†ŒService --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockService&quot; class=&quot;com.tongji.service.StockProcessServiceImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;stockDao&quot; ref=&quot;stockDao&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;    </span><br><span class="line">    </span><br><span class="line">    &lt;!-- äº‹åŠ¡ --&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span><br><span class="line">    &lt;bean id=&quot;myTxManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- ç”Ÿæˆäº‹åŠ¡ä»£ç† --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockServiceProxy&quot; class=&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;transactionManager&quot; ref=&quot;myTxManager&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;target&quot; ref=&quot;stockService&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;transactionAttributes&quot;&gt;</span><br><span class="line">            &lt;props&gt;</span><br><span class="line">                &lt;prop key=&quot;open*&quot;&gt;ISOLATION_DEFAULT,PROPAGATION_REQUIRED&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=&quot;buyStock&quot;&gt;ISOLATION_DEFAULT,PROPAGATION_REQUIRED,-StockException&lt;/prop&gt;</span><br><span class="line">            &lt;/props&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h2 id="Spring-çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡"><a href="#Spring-çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡" class="headerlink" title="Spring çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡"></a>Spring çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡</h2><p>æ³¨ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@Transactional è‹¥ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œåªèƒ½ç”¨äº public æ–¹æ³•ä¸Šã€‚å¯¹äºå…¶ä»–épublic æ–¹æ³•ï¼Œå¦‚æœåŠ ä¸Šäº†æ³¨è§£@Transactionalï¼Œè™½ç„¶ Spring ä¸ä¼šæŠ¥é”™ï¼Œä½†ä¸ä¼šå°†æŒ‡å®šäº‹åŠ¡ç»‡å…¥åˆ°è¯¥æ–¹æ³•ä¸­ã€‚å› ä¸º Spring ä¼šå¿½ç•¥æ‰æ‰€æœ‰é public æ–¹æ³•ä¸Šçš„@Transaction æ³¨è§£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">        xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; </span><br><span class="line">        xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">        http://www.springframework.org/schema/tx </span><br><span class="line">        http://www.springframework.org/schema/tx/spring-tx.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†Œæ•°æ®æºï¼šC3P0æ•°æ®æº --&gt;</span><br><span class="line">    &lt;bean id=&quot;myDataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒJDBCå±æ€§æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒDao --&gt;</span><br><span class="line">    &lt;bean id=&quot;accountDao&quot; class=&quot;com.tongji.dao.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;stockDao&quot; class=&quot;com.tongji.dao.StockDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†ŒService --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockService&quot; class=&quot;com.tongji.service.StockProcessServiceImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;stockDao&quot; ref=&quot;stockDao&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;    </span><br><span class="line">    </span><br><span class="line">    &lt;!-- äº‹åŠ¡ --&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span><br><span class="line">    &lt;bean id=&quot;myTxManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- å¼€å¯æ³¨è§£é©±åŠ¨ --&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager=&quot;myTxManager&quot;/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Override</span><br><span class="line">@Transactional(isolation=Isolation.DEFAULT, propagation=Propagation.REQUIRED)</span><br><span class="line">public void openAccount(String aname, double money) &#123;</span><br><span class="line">    accountDao.insertAccount(aname, money);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">@Transactional(isolation=Isolation.DEFAULT, propagation=Propagation.REQUIRED)</span><br><span class="line">public void openStock(String sname, int amount) &#123;</span><br><span class="line">    stockDao.insertStock(sname, amount);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">@Transactional(isolation=Isolation.DEFAULT, propagation=Propagation.REQUIRED, rollbackFor=StockException.class)</span><br><span class="line">public void buyStock(String aname, double money, String sname, int amount) throws StockException &#123;</span><br><span class="line">    boolean isBuy = true;</span><br><span class="line">    accountDao.updateAccount(aname, money, isBuy);</span><br><span class="line">    if (true) &#123;</span><br><span class="line">        throw new StockException(&quot;è´­ä¹°è‚¡ç¥¨å¼‚å¸¸&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    stockDao.updateStock(sname, amount, isBuy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring-ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡"><a href="#Spring-ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡" class="headerlink" title="Spring ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡"></a>Spring ä½¿ç”¨AspectJçš„AOPé…ç½®ç®¡ç†äº‹åŠ¡</h2><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/styles/images/article/aop-3.jpg?raw=true" alt="aop3"></p><p>AOPæœ¯è¯­ï¼š</p><ul><li><p>è¿æ¥ç‚¹ï¼ˆjoinpointï¼‰ä½ å¯ä»¥åˆ‡å…¥çš„æ–¹æ³•ï¼ˆæ³¨æ„æ˜¯å¯ä»¥ï¼‰ã€‚</p></li><li><p>åˆ‡ç‚¹ï¼ˆpointcutï¼‰æ˜¯ä½ åˆ‡å…¥çš„æ–¹æ³•ã€‚</p></li><li><p>å¢å¼ºï¼ˆadviceï¼‰å¾€åˆ‡ç‚¹é‡Œé¢å¢åŠ å…¶ä»–ç‰¹æ®Šçš„ä¸œè¥¿ï¼Œæ¯”å¦‚äº‹åŠ¡ä¼ æ’­ã€‚</p></li><li><p>ç›®æ ‡å¯¹è±¡ï¼ˆtargetï¼‰å¼•å…¥ä¸­æ‰€æåˆ°çš„ç›®æ ‡ç±»ï¼Œä¹Ÿå°±æ˜¯è¦è¢«é€šçŸ¥çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»–å¯ä»¥åœ¨æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œè¢«å’±ä»¬ç»‡å…¥åˆ‡é¢ã€‚è€Œè‡ªå·±ä¸“æ³¨äºä¸šåŠ¡æœ¬èº«çš„é€»è¾‘ã€‚</p></li><li><p>å¼•ä»‹ï¼ˆintroductionï¼‰å…è®¸æˆ‘ä»¬å‘ç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•å±æ€§ã€‚</p></li><li><p>ç»‡å…¥ï¼ˆweavingï¼‰ æŠŠåˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚æœ‰3ç§æ–¹å¼ï¼Œspringé‡‡ç”¨çš„æ˜¯è¿è¡Œæ—¶ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿è¡Œæ—¶ï¼Œåé¢è§£é‡Šã€‚</p></li><li><p>ä»£ç†ï¼ˆproxyï¼‰å®ç°æ•´å¥—aopæœºåˆ¶çš„ï¼Œéƒ½æ˜¯é€šè¿‡ä»£ç†ã€‚</p></li><li><p>åˆ‡é¢ï¼ˆaspectï¼‰åˆ‡é¢æ˜¯é€šçŸ¥å’Œåˆ‡å…¥ç‚¹çš„ç»“åˆ,å°±æ˜¯å®šä¹‰äº†é€šçŸ¥çš„ç±»ã€‚ç°åœ¨å‘ç°äº†å§ï¼Œæ²¡è¿æ¥ç‚¹ä»€ä¹ˆäº‹æƒ…ï¼Œè¿æ¥ç‚¹å°±æ˜¯ä¸ºäº†è®©ä½ å¥½ç†è§£åˆ‡ç‚¹ï¼Œæå‡ºæ¥çš„ï¼Œæ˜ç™½è¿™ä¸ªæ¦‚å¿µå°±è¡Œäº†ã€‚é€šçŸ¥è¯´æ˜äº†å¹²ä»€ä¹ˆå’Œä»€ä¹ˆæ—¶å€™å¹²ï¼ˆä»€ä¹ˆæ—¶å€™é€šè¿‡æ–¹æ³•åä¸­çš„before,afterï¼Œaroundç­‰å°±èƒ½çŸ¥é“ï¼‰ï¼Œè€Œåˆ‡å…¥ç‚¹è¯´æ˜äº†åœ¨å“ªå¹²ï¼ˆæŒ‡å®šåˆ°åº•æ˜¯å“ªä¸ªæ–¹æ³•ï¼‰ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ‡é¢å®šä¹‰ã€‚</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">        xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; </span><br><span class="line">        xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">        http://www.springframework.org/schema/tx </span><br><span class="line">        http://www.springframework.org/schema/tx/spring-tx.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop </span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†Œæ•°æ®æºï¼šC3P0æ•°æ®æº --&gt;</span><br><span class="line">    &lt;bean id=&quot;myDataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒJDBCå±æ€§æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- æ³¨å†ŒDao --&gt;</span><br><span class="line">    &lt;bean id=&quot;accountDao&quot; class=&quot;com.tongji.dao.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;stockDao&quot; class=&quot;com.tongji.dao.StockDaoImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†ŒService --&gt;</span><br><span class="line">    &lt;bean id=&quot;stockService&quot; class=&quot;com.tongji.service.StockProcessServiceImpl&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;stockDao&quot; ref=&quot;stockDao&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;    </span><br><span class="line">    </span><br><span class="line">    &lt;!-- äº‹åŠ¡ --&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span><br><span class="line">    &lt;bean id=&quot;myTxManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- æ³¨å†Œäº‹åŠ¡é€šçŸ¥ --&gt;</span><br><span class="line">    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;myTxManager&quot;&gt;</span><br><span class="line">        &lt;tx:attributes&gt;</span><br><span class="line">            &lt;!-- æŒ‡å®šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•ä¸Šåº”ç”¨çš„äº‹åŠ¡å±æ€§ --&gt;</span><br><span class="line">            &lt;tx:method name=&quot;open*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot;/&gt;</span><br><span class="line">            &lt;tx:method name=&quot;buyStock&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;StockException&quot;/&gt;</span><br><span class="line">        &lt;/tx:attributes&gt;</span><br><span class="line">    &lt;/tx:advice&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- AOPé…ç½® --&gt;</span><br><span class="line">    &lt;aop:config proxy-target-class=&quot;true&quot;&gt;//è¡¨ç¤ºä½¿ç”¨CGLibåŠ¨æ€ä»£ç†æŠ€æœ¯ç»‡å…¥å¢å¼ºã€‚è®¾ç½®ä¸ºfalseæ—¶ï¼Œè¡¨ç¤ºä½¿ç”¨jdkåŠ¨æ€ä»£ç†ç»‡å…¥å¢å¼ºï¼Œå¦‚æœç›®æ ‡ç±»æ²¡æœ‰å£°æ˜æ¥å£ï¼Œåˆ™springå°†è‡ªåŠ¨ä½¿ç”¨CGLibåŠ¨æ€ä»£ç†ã€‚</span><br><span class="line">        &lt;!-- æŒ‡å®šåˆ‡å…¥ç‚¹ --&gt;</span><br><span class="line">        &lt;aop:pointcut expression=&quot;execution(* *..service.*.*(..))&quot; id=&quot;stockPointCut&quot;/&gt;//è¿™é‡Œè®¾ç½®åˆ‡å…¥ç‚¹ï¼Œexpressionè®¾ç½®åˆ‡é¢æ¤å…¥çš„åˆ‡å…¥ç‚¹çš„æ–¹æ³•åœ°å€</span><br><span class="line">        &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;stockPointCut&quot;/&gt;// åŠ å…¥äº‹åŠ¡ä¼ æ’­ç‰¹æ€§</span><br><span class="line">        &lt;aop:aspect ref=&quot;stockService&quot;&gt;//å®šä¹‰ä¸€ä¸ªåˆ‡é¢</span><br><span class="line">         </span><br><span class="line">        </span><br><span class="line">        --&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/qjjazry/p/6366204.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®å­˜å‚¨ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çº¿ç¨‹ç®€ä»‹</title>
      <link href="/2018/03/16/concurrent/2017-03-16-thread-brief/"/>
      <url>/2018/03/16/concurrent/2017-03-16-thread-brief/</url>
      
        <content type="html"><![CDATA[<h2 id="çº¿ç¨‹ç®€ä»‹"><a href="#çº¿ç¨‹ç®€ä»‹" class="headerlink" title="çº¿ç¨‹ç®€ä»‹"></a>çº¿ç¨‹ç®€ä»‹</h2><h3 id="1-ä»€ä¹ˆæ˜¯çº¿ç¨‹"><a href="#1-ä»€ä¹ˆæ˜¯çº¿ç¨‹" class="headerlink" title="1. ä»€ä¹ˆæ˜¯çº¿ç¨‹"></a>1. ä»€ä¹ˆæ˜¯çº¿ç¨‹</h3><p>ç°ä»£æ“ä½œç³»ç»Ÿåœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ã€‚æ¯”å¦‚ä½ ç°åœ¨ç”¨çš„æµè§ˆå™¨ï¼Œç³»ç»Ÿå°±ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªç”šè‡³å¤šä¸ªè¿›ç¨‹ã€‚<strong><em>å¼•å…¥è¿›ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„ä½¿æ“ä½œç³»ç»Ÿå¹¶å‘æ‰§è¡Œç¨‹åºã€‚æ¥æé«˜èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ï¼Œå¢åŠ å¹¶å‘ç¨‹åº¦ã€‚</em></strong><br>çº¿ç¨‹æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿè°ƒåº¦çš„åŸºæœ¬å•å…ƒï¼Œæ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„é€»è¾‘æµï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒï¼Œä¹Ÿå«è½»é‡çº§è¿›ç¨‹ï¼ˆLight Weight Processï¼‰ï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºCPUçš„æ‰§è¡Œå•å…ƒã€‚ä¸€ä¸ªç¨‹åºä½œä¸ºä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œï¼Œç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè€Œä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªå¤„ç†å™¨æ ¸å¿ƒä¸Šã€‚<strong><em>å¼•å…¥çº¿ç¨‹ï¼Œåˆ™æ˜¯ä¸ºäº†å‡å°ç¨‹åºåœ¨å¹¶å‘æ‰§è¡Œæ—¶æ‰€ä»˜å‡ºçš„æ—¶ç©ºå¼€é”€ï¼Œæé«˜æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚çº¿ç¨‹ä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼ˆä»£ç ï¼Œæ•°æ®ã€å †ã€å…±äº«åº“ã€æ–‡ä»¶ï¼‰ï¼Œåªæ‹¥æœ‰è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æºï¼ˆçº¿ç¨‹ID, æ ˆï¼Œæ ˆæŒ‡é’ˆï¼Œç¨‹åºè®¡æ•°å™¨ã€é€šç”¨ç›®çš„å¯„å­˜å™¨å’Œæ¡ä»¶ç ï¼‰ã€‚</em></strong><br>çº¿ç¨‹æ˜¯è°ƒåº¦çš„æŠ½è±¡ã€‚<strong><em>Javaä¸­å°†çº¿ç¨‹çš„æ‰§è¡Œå’Œæ‰§è¡Œå¯¹è±¡æŠ½è±¡å¼€æ¥ï¼ŒJDKåŒ…ä¸­æ‰§è¡Œçš„æœ‰Threadç±»ï¼ŒExecutoræ¡†æ¶ï¼Œå¯æ‰§è¡Œç›®æ ‡æœ‰Runaableï¼ŒCallableã€‚</em></strong></p><h4 id="1-1-çº¿ç¨‹çš„ä¼˜ç‚¹"><a href="#1-1-çº¿ç¨‹çš„ä¼˜ç‚¹" class="headerlink" title="1.1 çº¿ç¨‹çš„ä¼˜ç‚¹"></a>1.1 çº¿ç¨‹çš„ä¼˜ç‚¹</h4><ol><li>å¤šå¤„ç†å™¨ä½¿ç”¨ï¼š æé«˜èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ã€‚</li></ol><h4 id="1-2-çº¿ç¨‹çš„é£é™©"><a href="#1-2-çº¿ç¨‹çš„é£é™©" class="headerlink" title="1.2 çº¿ç¨‹çš„é£é™©"></a>1.2 çº¿ç¨‹çš„é£é™©</h4><ol><li>å®‰å…¨é£é™©ï¼šå¯¹äºå…±äº«å˜é‡çš„è®¿é—®ã€æ“ä½œå®¹æ˜“é€ æˆå®‰å…¨é£é™©ã€‚</li><li>æ´»è·ƒåº¦é£é™©ï¼šæ­»é”å¼•å‘æ´»åŠ¨åº¦å¤±è´¥ã€‚</li><li>æ€§èƒ½é£é™©ï¼šçº¿ç¨‹ä¹‹é—´é¢‘ç¹è°ƒåº¦å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´å·¨å¤§çš„ç³»ç»Ÿå¼€é”€ã€‚</li></ol><h3 id="2-çº¿ç¨‹çš„çŠ¶æ€"><a href="#2-çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="2. çº¿ç¨‹çš„çŠ¶æ€"></a>2. çº¿ç¨‹çš„çŠ¶æ€</h3><p><img src="/media/ThreadStatus.png" alt="ThreadStatus"><br><a href="#çº¿ç¨‹ç®€ä»‹">å›¾ç‰‡æ¥è‡ªï¼šJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯-</a></p><ul><li>æ–°å»º(NEW)ï¼šç”¨newå…³é”®å­—å’ŒThreadç±»æˆ–å…¶å­ç±»å»ºç«‹ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åï¼Œè¯¥çº¿ç¨‹å¯¹è±¡å°±å¤„äºæ–°ç”ŸçŠ¶æ€ã€‚å¤„äºæ–°ç”ŸçŠ¶æ€çš„çº¿ç¨‹æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡è°ƒç”¨startæ–¹æ³•è¿›å…¥å°±ç»ªçŠ¶æ€ï¼ˆREADYï¼‰ã€‚</li></ul><p><strong><em>æ³¨æ„ï¼šä¸èƒ½å¯¹å·²ç»å¯åŠ¨çš„çº¿ç¨‹å†æ¬¡è°ƒç”¨start()æ–¹æ³•ï¼Œå¦åˆ™ä¼šå‡ºç°Java.lang.IllegalThreadStateExceptionå¼‚å¸¸ã€‚</em></strong></p><ul><li><p>è¿è¡ŒçŠ¶æ€(RUNNABLE)ï¼šJavaçº¿ç¨‹å°†æ“ä½œç³»ç»Ÿä¸­çš„å°±ç»ªå’Œè¿è¡Œä¸¤ç§çŠ¶æ€ç¬¼ç»Ÿçš„ç§°ä½œâ€œè¿è¡Œä¸­â€ã€‚</p></li><li><p>å°±ç»ª(READY)ï¼šå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹å·²ç»å…·å¤‡äº†è¿è¡Œæ¡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰åˆ†é…åˆ°CPUï¼Œå¤„äºçº¿ç¨‹å°±ç»ªé˜Ÿåˆ—ï¼ˆå°½ç®¡æ˜¯é‡‡ç”¨é˜Ÿåˆ—å½¢å¼ï¼Œäº‹å®ä¸Šï¼ŒæŠŠå®ƒç§°ä¸ºå¯è¿è¡Œæ± è€Œä¸æ˜¯å¯è¿è¡Œé˜Ÿåˆ—ã€‚å› ä¸ºcpuçš„è°ƒåº¦ä¸ä¸€å®šæ˜¯æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥è°ƒåº¦çš„ï¼‰ï¼Œç­‰å¾…ç³»ç»Ÿä¸ºå…¶åˆ†é…CPUã€‚ç­‰å¾…çŠ¶æ€å¹¶ä¸æ˜¯æ‰§è¡ŒçŠ¶æ€ï¼Œå½“ç³»ç»Ÿé€‰å®šä¸€ä¸ªç­‰å¾…æ‰§è¡Œçš„Threadå¯¹è±¡åï¼Œå®ƒå°±ä¼šä»ç­‰å¾…æ‰§è¡ŒçŠ¶æ€è¿›å…¥æ‰§è¡ŒçŠ¶æ€ï¼Œç³»ç»ŸæŒ‘é€‰çš„åŠ¨ä½œç§°ä¹‹ä¸ºâ€œcpuè°ƒåº¦â€ã€‚ä¸€æ—¦è·å¾—CPUï¼Œçº¿ç¨‹å°±è¿›å…¥è¿è¡ŒçŠ¶æ€å¹¶è‡ªåŠ¨è°ƒç”¨è‡ªå·±çš„runæ–¹æ³•ã€‚ä¹Ÿå¯ä»¥å¯¹åœ¨è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨yield()æ–¹æ³•ï¼Œå®ƒå°±ä¼šè®©å‡ºcpuèµ„æºï¼Œå†æ¬¡å˜ä¸ºå°±ç»ªçŠ¶æ€ã€‚</p></li><li><p>è¿è¡Œ(RUNNING)ï¼šå¤„äºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹æœ€ä¸ºå¤æ‚ï¼Œå®ƒå¯ä»¥å˜ä¸ºé˜»å¡çŠ¶æ€ã€å°±ç»ªçŠ¶æ€å’Œæ­»äº¡çŠ¶æ€ã€‚</p></li><li><p>ç­‰å¾…çŠ¶æ€(WAITING)ï¼šè¡¨ç¤ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€è¡¨ç¤ºå½“å‰çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹ä½œå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œï¼ˆé€šçŸ¥æˆ–ä¸­æ–­ï¼‰ã€‚</p></li><li><p>è¶…æ—¶ç­‰å¾…çŠ¶æ€(TIME_WAITING)ï¼šè¯¥çŠ¶æ€ä¸åŒäºWAITINGï¼Œå®ƒæ˜¯å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´è‡ªè¡Œè¿”å›çš„ã€‚</p></li><li><p>é˜»å¡(BLOCKED)ï¼š<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.State.html" target="_blank" rel="noopener">javase7 docs</a>å…³äºBLOCKEDçš„æè¿°ï¼šThread state for a thread blocked waiting for a monitor lock. A thread in the blocked state is waiting for a monitor lock to enter a synchronized block/method or reenter a synchronized block/method after calling Object.wait.ç¿»è¯‘ï¼šé˜»å¡çº¿ç¨‹æ˜¯ç­‰å¾…è·å–åŒæ­¥ç›‘è§†å™¨é”çš„çº¿ç¨‹ã€‚çº¿ç¨‹ç­‰å¾…è·å–åŒæ­¥ç›‘è§†å™¨é”è¿›å…¥åŒæ­¥ä»£ç å—/æ–¹æ³•,æˆ–è€…è°ƒç”¨Object.waitæ–¹æ³•å,è¢«å”¤é†’åç­‰å¾…è·å–åŒæ­¥ç›‘è§†å™¨é”,<strong><em>é‡å…¥</em></strong>åŒæ­¥ä»£ç å—/æ–¹æ³•ã€‚</p></li><li><p>æ­»äº¡(DEAD)ï¼šå½“çº¿ç¨‹çš„run()æ–¹æ³•æ‰§è¡Œå®Œï¼Œæˆ–è€…è¢«å¼ºåˆ¶æ€§åœ°ç»ˆæ­¢ï¼Œå°±è®¤ä¸ºå®ƒæ­»å»ã€‚è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ä¹Ÿè®¸æ˜¯æ´»çš„ï¼Œä½†æ˜¯ï¼Œå®ƒå·²ç»ä¸æ˜¯ä¸€ä¸ªå•ç‹¬æ‰§è¡Œçš„çº¿ç¨‹ã€‚çº¿ç¨‹ä¸€æ—¦æ­»äº¡ï¼Œå°±ä¸èƒ½å¤ç”Ÿã€‚ å¦‚æœåœ¨ä¸€ä¸ªæ­»å»çš„çº¿ç¨‹ä¸Šè°ƒç”¨start()æ–¹æ³•ï¼Œä¼šæŠ›å‡ºjava.lang.IllegalThreadStateExceptionå¼‚å¸¸ã€‚</p></li></ul><h3 id="3-çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#3-çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="3. çº¿ç¨‹ä¼˜å…ˆçº§"></a>3. çº¿ç¨‹ä¼˜å…ˆçº§</h3><p>æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§çš„å±æ€§ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹å¯ä»¥è·å¾—è¾ƒå¤šçš„æ‰§è¡Œæœºä¼šï¼Œè€Œä¼˜å…ˆçº§ä½çš„çº¿ç¨‹åˆ™è·å¾—è¾ƒå°‘çš„æ‰§è¡Œæœºä¼šã€‚ä¸çº¿ç¨‹ä¼‘çœ ç±»ä¼¼ï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§ä»ç„¶æ— æ³•ä¿éšœçº¿ç¨‹çš„æ‰§è¡Œæ¬¡åºã€‚åªä¸è¿‡ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è·å–CPUèµ„æºçš„æ¦‚ç‡è¾ƒå¤§ï¼Œä¼˜å…ˆçº§ä½çš„ä¹Ÿå¹¶éæ²¡æœºä¼šæ‰§è¡Œã€‚</p><p>æ¯ä¸ªçº¿ç¨‹é»˜è®¤çš„ä¼˜å…ˆçº§éƒ½ä¸åˆ›å»ºå®ƒçš„çˆ¶çº¿ç¨‹å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œmainçº¿ç¨‹å…·æœ‰æ™®é€šä¼˜å…ˆçº§ã€‚</p><p><strong><em>æ³¨ï¼šè™½ç„¶Javaæä¾›äº†10ä¸ªä¼˜å…ˆçº§åˆ«ï¼Œä½†è¿™äº›ä¼˜å…ˆçº§åˆ«éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚ä¸åŒçš„æ“ä½œç³»ç»Ÿçš„ä¼˜å…ˆçº§å¹¶ä¸ç›¸åŒï¼Œè€Œä¸”ä¹Ÿä¸èƒ½å¾ˆå¥½çš„å’ŒJavaçš„10ä¸ªä¼˜å…ˆçº§åˆ«å¯¹åº”ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä½¿ç”¨MAX_PRIORITYã€MIN_PRIORITYå’ŒNORM_PRIORITYä¸‰ä¸ªé™æ€å¸¸é‡æ¥è®¾å®šä¼˜å…ˆçº§ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ç¨‹åºæœ€å¥½çš„å¯ç§»æ¤æ€§ã€‚</em></strong></p><h3 id="4-Daemonçº¿ç¨‹"><a href="#4-Daemonçº¿ç¨‹" class="headerlink" title="4. Daemonçº¿ç¨‹"></a>4. Daemonçº¿ç¨‹</h3><p>Daemonçº¿ç¨‹æ˜¯ä¸€ç§æ”¯æŒå‹çº¿ç¨‹ï¼Œå› ä¸ºå®ƒä¸»è¦è¢«ç”¨åšç¨‹åºä¸­åå°è°ƒåº¦åŠæ”¯æŒæ€§å·¥ä½œã€‚<br><strong><em> æ³¨æ„ï¼šæ„å»ºDaemonçº¿ç¨‹æ—¶ï¼Œä¸èƒ½ä¾é finallyå—ä¸­çš„å†…å®¹æ¥ç¡®ä¿æ‰§è¡Œå…³é—­æˆ–æ¸…ç†èµ„æºçš„é€»è¾‘ã€‚</em></strong></p><p>å®ˆæŠ¤çº¿ç¨‹ä½¿ç”¨çš„æƒ…å†µè¾ƒå°‘ï¼Œä½†å¹¶éæ— ç”¨ï¼Œä¸¾ä¾‹æ¥è¯´ï¼ŒJVMçš„åƒåœ¾å›æ”¶ã€å†…å­˜ç®¡ç†ç­‰çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚è¿˜æœ‰å°±æ˜¯åœ¨åšæ•°æ®åº“åº”ç”¨æ—¶å€™ï¼Œä½¿ç”¨çš„æ•°æ®åº“è¿æ¥æ± ï¼Œè¿æ¥æ± æœ¬èº«ä¹ŸåŒ…å«ç€å¾ˆå¤šåå°çº¿ç¨‹ï¼Œç›‘æ§è¿æ¥ä¸ªæ•°ã€è¶…æ—¶æ—¶é—´ã€çŠ¶æ€ç­‰ç­‰ã€‚è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„æ–¹æ³•setDaemon(true)ï¼Œåˆ™å¯ä»¥å°†å…¶è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚å®ˆæŠ¤çº¿ç¨‹çš„ç”¨é€”ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â€¢ å®ˆæŠ¤çº¿ç¨‹é€šå¸¸ç”¨äºæ‰§è¡Œä¸€äº›åå°ä½œä¸šï¼Œä¾‹å¦‚åœ¨ä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œåœ¨æ–‡å­—ç¼–è¾‘å™¨é‡Œåšè‡ªåŠ¨è¯­æ³•æ£€æŸ¥ã€è‡ªåŠ¨ä¿å­˜ç­‰åŠŸèƒ½ã€‚</span><br><span class="line">â€¢ Javaçš„åƒåœ¾å›æ”¶ä¹Ÿæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚å®ˆæŠ¤çº¿çš„å¥½å¤„å°±æ˜¯ä½ ä¸éœ€è¦å…³å¿ƒå®ƒçš„ç»“æŸé—®é¢˜ã€‚ä¾‹å¦‚ä½ åœ¨ä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œçš„æ—¶å€™å¸Œæœ›æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œå¦‚æœå°†è¿™ä¸ªæ’­æ”¾èƒŒæ™¯éŸ³ä¹çš„çº¿ç¨‹è®¾å®šä¸ºéå®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·è¯·æ±‚é€€å‡ºçš„æ—¶å€™ï¼Œä¸ä»…è¦é€€å‡ºä¸»çº¿ç¨‹ï¼Œè¿˜è¦é€šçŸ¥æ’­æ”¾èƒŒæ™¯éŸ³ä¹çš„çº¿ç¨‹é€€å‡ºï¼›å¦‚æœè®¾å®šä¸ºå®ˆæŠ¤çº¿ç¨‹åˆ™ä¸éœ€è¦äº†ã€‚</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line">    * å°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç”¨æˆ·çº¿ç¨‹ã€‚å½“æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼ŒJava è™šæ‹Ÿæœºé€€å‡ºã€‚</span><br><span class="line">    * è¯¥æ–¹æ³•å¿…é¡»åœ¨å¯åŠ¨çº¿ç¨‹å‰è°ƒç”¨ã€‚</span><br><span class="line">    * è¯¥æ–¹æ³•é¦–å…ˆè°ƒç”¨è¯¥çº¿ç¨‹çš„ checkAccess æ–¹æ³•ï¼Œä¸”ä¸å¸¦ä»»ä½•å‚æ•°ã€‚</span><br><span class="line">    * è¿™å¯èƒ½æŠ›å‡º SecurityExceptionï¼ˆåœ¨å½“å‰çº¿ç¨‹ä¸­ï¼‰ã€‚   </span><br><span class="line">    *   å‚æ•°ï¼š</span><br><span class="line">    *      on - å¦‚æœä¸º trueï¼Œåˆ™å°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚    </span><br><span class="line">    *   æŠ›å‡ºï¼š    </span><br><span class="line">    *     IllegalThreadStateException - å¦‚æœè¯¥çº¿ç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚    </span><br><span class="line">    *     SecurityException - å¦‚æœå½“å‰çº¿ç¨‹æ— æ³•ä¿®æ”¹è¯¥çº¿ç¨‹ã€‚</span><br><span class="line">    */</span><br><span class="line">    </span><br><span class="line">public final void setDaemon(boolean on)</span><br></pre></td></tr></table></figure><h3 id="5-å¼•ç”¨"><a href="#5-å¼•ç”¨" class="headerlink" title="5. å¼•ç”¨"></a>5. å¼•ç”¨</h3><p><a href="https://www.cnblogs.com/snow-flower/p/6114765.html" target="_blank" rel="noopener">Javaå¤šçº¿ç¨‹è¯¦è§£</a><br><a href="https://book.douban.com/subject/26591326/" target="_blank" rel="noopener">Javaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯</a><br><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.State.html" target="_blank" rel="noopener">javase7 docs</a><br><a href="https://my.oschina.net/u/2500836/blog/1538667" target="_blank" rel="noopener">Javaçº¿ç¨‹ï¼ˆ1ï¼‰-è¯»Threadç±»æºç </a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaå€¼ä¼ é€’</title>
      <link href="/2018/03/10/java/2018-03-10-JavaPara/"/>
      <url>/2018/03/10/java/2018-03-10-JavaPara/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨æ•´ç†ä¸€äº›ä¹‹å‰çš„åšå®¢ï¼Œå‘ç°å…³äºJavaå€¼ä¼ é€’çš„é—®é¢˜è¿˜æ˜¯æœ‰äº›æ¨¡ç³Šï¼Œåœ¨æ­¤å†æ•´ç†ä¸€ä¸‹ã€‚</p><p>å¯¹äºJavaçš„å€¼ä¼ é€’ï¼Œå¹¶ä¸æƒ³C++ä¸€æ ·å¯ä»¥ç”±è‡ªå·±æŒæ§ï¼Œä¸è¿‡ç†è§£Javaçš„å€¼ä¼ é€’åæ„Ÿè§‰æ¯”C++ç®€å•ã€‚</p><p><b style="color: red">å¯èƒ½ç†è§£ä¸å¤ªå¯¹ï¼Œæ¬¢è¿å¤§å®¶åŠ æˆ‘qqæ‰“æˆ‘è„¸ï¼Œè°¢è°¢ï¼ï¼ï¼ï¼ˆQQ:879376937ï¼‰</b></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> public static void main(String[] args) &#123;</span><br><span class="line">        int a = 1;</span><br><span class="line">        int[] b = &#123;1&#125;;</span><br><span class="line">        StringBuilder sb = new StringBuilder(&quot;22&quot;);</span><br><span class="line">        change(sb);</span><br><span class="line">        System.out.print(sb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void change(int a)&#123;</span><br><span class="line">        a=10;// ä¸èµ·ä½œç”¨</span><br><span class="line">    &#125;</span><br><span class="line">    public static void change(int[] b)&#123;</span><br><span class="line">        b[0]=10;// èµ·ä½œç”¨</span><br><span class="line">    &#125;</span><br><span class="line">    public static void change(StringBuilder sb)&#123;</span><br><span class="line">//        sb.append(&quot;3&quot;);// èµ·ä½œç”¨</span><br><span class="line">        StringBuilder sb1 = new StringBuilder(&quot;232&quot;);</span><br><span class="line">        sb=sb1;// ä¸èµ·ä½œç”¨</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­æˆ‘ç”¨äº†intå¸¸é‡ï¼Œæ•°ç»„ï¼ŒStringBuilderå¯¹è±¡ä¸‰ç§å‚æ•°å€¼ä½œä¸ºJavaå‚æ•°è¿›è¡Œä¼ é€’ï¼Œæ€»çš„æ¥è¯´è¿™ä¸‰ç§å‚æ•°å€¼ä»å®è§‚ä¸Šæ¥è¯´æ€§è´¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¯¹ä¼ é€’å¯¹è±¡çš„å¼•ç”¨å¤åˆ¶ï¼Œä¾‹å¦‚a, mainæ–¹æ³•å®šä¹‰çš„aæ˜¯å¯¹å¸¸é‡æ± ä¸­1çš„å¼•ç”¨ï¼Œchange(int a)ä¸­çš„aæ˜¯å¯¹mainæ–¹æ³•açš„å¼•ç”¨ï¼Œè¿™é‡Œä¸€å®šè¦æ˜ç™½è¿™ä¸¤ä¸ªaæ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ”¹changeä¸­açš„å€¼ï¼Œå®è´¨ä¸Šæ˜¯æŠŠchangeæ–¹æ³•ä¸­açš„å¼•ç”¨ä»å¯¹mainæ–¹æ³•ä¸­açš„å¼•ç”¨æ”¹ä¸ºå¼•ç”¨å¸¸é‡æ± ä¸Šçš„10ï¼Œæ‰€ä»¥main æ–¹æ³•ä¸­çš„aå€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p>å¯¹äºbå’Œsbå¯¹è±¡å‚æ•°ä¼ é€’ï¼Œå…¶å®è´¨aå¯¹è±¡ä¸€æ ·ï¼Œéƒ½æ˜¯å¯¹mainæ–¹æ³•ä¸­çš„bå’Œsbå¯¹è±¡çš„å¼•ç”¨ã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨b[0]èµ‹å€¼æ—¶ï¼Œå› ä¸ºchangeæ–¹æ³•ä¸­çš„bå¼•ç”¨main æ–¹æ³•ä¸­çš„bå¯¹è±¡ï¼Œæ‰€ä»¥changeä¸­çš„b[0]æ²¡æœ‰åŠæ³•èµ‹å€¼ï¼Œåªèƒ½äº¤ç»™mainæ–¹æ³•ä¸­çš„bå»èµ‹å€¼ï¼Œè¿™æ ·æ›´æ”¹çš„å°±æ˜¯mainä¸­bå¯¹è±¡æ‰€å¼•ç”¨çš„æ•°ç»„å®ä¾‹ï¼Œæ‰€ä»¥èµ·äº†ä½œç”¨ã€‚</p><p>changeæ–¹æ³•ä¸­sbåœ¨appendèµ‹å€¼æ—¶å’Œb[0]èµ‹å€¼çš„æƒ…å†µä¸€æ ·ã€‚</p><p>sb=sb1,è¿™ç§æƒ…å†µæ˜¯å’Œaå¯¹è±¡é‡æ–°èµ‹å€¼ç±»ä¼¼ï¼Œä¸è¿‡ä¸å†æ˜¯å¸¸é‡æ± ä¸­çš„å¸¸æ•°å¯¹è±¡10ï¼Œè€Œæ˜¯StringBuilderå¯¹è±¡sb1ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Dubboå·¥ä½œåŸç†</title>
      <link href="/2018/03/07/dubbo/2018-03-07-DubboPrinciple/"/>
      <url>/2018/03/07/dubbo/2018-03-07-DubboPrinciple/</url>
      
        <content type="html"><![CDATA[<h2 id="Dubboå¯åŠ¨åˆå§‹åŒ–"><a href="#Dubboå¯åŠ¨åˆå§‹åŒ–" class="headerlink" title="Dubboå¯åŠ¨åˆå§‹åŒ–"></a>Dubboå¯åŠ¨åˆå§‹åŒ–</h2><p>æˆ‘ä»¬å¤§éƒ½å¯èƒ½éƒ½æ˜¯ç”¨è¿‡Dubboåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ä½¿ç”¨çš„äººå¯èƒ½åªæ˜¯ä½¿ç”¨å¹¶ä¸äº†è§£Dubboæ˜¯æ€æ ·åˆå§‹åŒ–åŠ è½½çš„ï¼Œæœ¬ç¯‡åšæ–‡å°†ä½¿ç”¨æœ€ç®€å•çš„dubbo-demoä¾‹å­æ¥æè¿°Dubboçš„å¯åŠ¨åˆå§‹åŒ–ã€‚</p><h2 id="æœåŠ¡æš´éœ²"><a href="#æœåŠ¡æš´éœ²" class="headerlink" title="æœåŠ¡æš´éœ²"></a>æœåŠ¡æš´éœ²</h2><p>dubboæ¡†æ¶è®¾è®¡æ€»å…±åˆ†äº†10å±‚ï¼š </p><ul><li><p>æœåŠ¡æ¥å£å±‚ï¼ˆServiceï¼‰ï¼šè¯¥å±‚æ˜¯ä¸å®é™…ä¸šåŠ¡é€»è¾‘ç›¸å…³ï¼Œå°±å¦‚ä¸‹é¢é¢demoé…ç½®çš„<code>&lt;dubbo:service interface=&quot;com.xxx.xxx.xxxService&quot; ref=&quot;xxxService&quot; timeout=&quot;5000&quot;/&gt;</code>,è¿™ä¸ªserviceå°±æ˜¯ä¸šåŠ¡æ–¹è‡ªå·±å®šä¹‰çš„æ¥å£ä¸å…¶å®ç°ã€‚</p></li><li><p>é…ç½®å±‚ï¼ˆConfigï¼‰ï¼šè¯¥å±‚æ˜¯å°†ä¸šåŠ¡æ–¹çš„serviceä¿¡æ¯ï¼Œé…ç½®æ–‡ä»¶çš„ä¿¡æ¯æ”¶é›†èµ·æ¥ï¼Œä¸»è¦æ˜¯ä»¥ServiceConfigå’ŒReferenceConfigä¸ºä¸­å¿ƒï¼ŒServiceConfigæ˜¯æœåŠ¡æä¾›æ–¹çš„é…ç½®ï¼Œå½“Springå¯åŠ¨çš„æ—¶å€™ä¼šç›¸åº”çš„å¯åŠ¨provideræœåŠ¡å‘å¸ƒå’Œæ³¨å†Œçš„è¿‡ç¨‹ï¼Œå½“serviceåœ¨springå®¹å™¨åŠ è½½å®Œæˆåï¼ŒServiceBeané€šè¿‡ç›‘å¬å™¨ç›‘å¬springå®¹å™¨æ˜¯å¦åŠ è½½å®Œæ¯•ï¼Œç„¶åå‡ºå‘ç›‘å¬æ–¹æ³•ï¼ŒonApplicationEvent-&gt;export-&gt;doExport-&gt;doExportUrls-&gt;doExportUrlsFor1Protocol,æœ€åå¾—åˆ°providerçš„ä»£ç†å¯¹è±¡invokerï¼ŒProcotolå°†invokerå°è£…ä¸ºExporterã€‚</p></li><li><p>æœåŠ¡ä»£ç†å±‚ï¼ˆProxyï¼‰ï¼šå¯¹æœåŠ¡æ¥å£è¿›è¡Œé€æ˜ä»£ç†ï¼Œç”ŸæˆæœåŠ¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Œä½¿æœåŠ¡çš„è¿œç¨‹è°ƒç”¨å°±åƒåœ¨æœ¬åœ°è°ƒç”¨ä¸€æ ·ã€‚é»˜è®¤ä½¿ç”¨JavassistProxyFactoryï¼Œè¿”å›ä¸€ä¸ªInvokerï¼ŒInvokeråˆ™æ˜¯ä¸ªå¯æ‰§è¡Œæ ¸å¿ƒå®ä½“ï¼ŒInvokerçš„invokeæ–¹æ³•é€šè¿‡åå°„æ‰§è¡Œserviceæ–¹æ³•ã€‚</p></li><li><p>æœåŠ¡æ³¨å†Œå±‚ï¼ˆRegistryï¼‰ï¼šå°è£…æœåŠ¡åœ°å€çš„æ³¨å†Œå’Œå‘ç°ï¼Œä»¥æœåŠ¡URLä¸ºä¸­å¿ƒï¼ŒåŸºäºzkã€‚</p></li><li><p>é›†ç¾¤å±‚ï¼ˆClusterï¼‰:æä¾›å¤šä¸ªèŠ‚ç‚¹å¹¶æ¡¥æ¥æ³¨å†Œä¸­å¿ƒï¼Œä¸»è¦è´Ÿè´£è´Ÿè½½å‡è¡¡ï¼ˆloadBanlanceï¼‰ã€å®¹é”™ã€‚</p></li><li><p>ç›‘æ§å±‚ï¼ˆMonitorï¼‰ï¼šRPCè°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç›‘æ§ï¼Œä»¥Statisticsä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸ºMonitorFactoryã€Monitorå’ŒMonitorServiceã€‚</p></li><li><p>è¿œç¨‹è°ƒç”¨å±‚ï¼ˆProtocolï¼‰ï¼šå°è£…RPCè°ƒç”¨ï¼Œprovideré€šè¿‡exportæ–¹æ³•è¿›è¡Œæš´éœ²æœåŠ¡/consumeré€šè¿‡referæ–¹æ³•è°ƒç”¨æœåŠ¡ã€‚è€ŒProtocolä¾èµ–çš„æ˜¯Invokerã€‚é€šè¿‡ä¸Šé¢è¯´çš„Proxyè·å¾—çš„Invokerï¼ŒåŒ…è£…æˆExporterã€‚</p></li><li><p>ä¿¡æ¯äº¤æ¢å±‚ï¼ˆExchangeï¼‰ï¼šè¯¥å±‚å°è£…äº†è¯·æ±‚å“åº”æ¨¡å‹ï¼Œå°†åŒæ­¥è½¬ä¸ºå¼‚æ­¥ï¼Œä¿¡æ¯äº¤æ¢å±‚ä¾èµ–Exporterï¼Œæœ€ç»ˆå°†é€šè¿‡ç½‘ç»œä¼ è¾“å±‚æ¥æ”¶è°ƒç”¨è¯·æ±‚RequestFutureå’ŒResponseFutureã€‚</p></li><li><p>ç½‘ç»œä¼ è¾“å±‚ï¼ˆTransportï¼‰ï¼šæŠ½è±¡minaå’Œnettyä¸ºç»Ÿä¸€æ¥å£ï¼Œä»¥Messageä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸ºChannelã€Transporterã€Clientã€Serverå’ŒCodecã€‚</p></li><li><p>æ•°æ®åºåˆ—åŒ–å±‚ï¼šè¯¥å±‚æ— éœ€å¤šè¨€ï¼Œå°†æ•°æ®åºåˆ—åŒ–ååºåˆ—åŒ–ã€‚</p></li></ul><p>å…ˆçœ‹åˆ°demoä¸­çš„spring-dubboé…ç½®æ–‡ä»¶ã€‚è¿™äº›é…ç½®æ–‡ä»¶å…¨éƒ½ä¼šè¢«è£…é…æˆRegistryConfigï¼Œå…¶å±æ€§å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class RegistryConfig extends AbstractConfig &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 5508512956753757169L;</span><br><span class="line"></span><br><span class="line">    public static final String NO_AVAILABLE = &quot;N/A&quot;;</span><br><span class="line"></span><br><span class="line">    // æ³¨å†Œä¸­å¿ƒåœ°å€</span><br><span class="line">    private String            address;</span><br><span class="line"></span><br><span class="line">    // æ³¨å†Œä¸­å¿ƒç™»å½•ç”¨æˆ·å</span><br><span class="line">    private String            username;</span><br><span class="line"></span><br><span class="line">    // æ³¨å†Œä¸­å¿ƒç™»å½•å¯†ç </span><br><span class="line">    private String            password;</span><br><span class="line"></span><br><span class="line">    // æ³¨å†Œä¸­å¿ƒç¼ºçœç«¯å£</span><br><span class="line">    private Integer           port;</span><br><span class="line"></span><br><span class="line">    // æ³¨å†Œä¸­å¿ƒåè®®</span><br><span class="line">    private String            protocol;</span><br><span class="line"></span><br><span class="line">    // å®¢æˆ·ç«¯å®ç°</span><br><span class="line">    private String            transporter;</span><br><span class="line"></span><br><span class="line">    private String            server;</span><br><span class="line"></span><br><span class="line">    private String            client;</span><br><span class="line"></span><br><span class="line">    private String            cluster;</span><br><span class="line"></span><br><span class="line">    private String            group;</span><br><span class="line"></span><br><span class="line">    private String            version;</span><br><span class="line"></span><br><span class="line">    // æ³¨å†Œä¸­å¿ƒè¯·æ±‚è¶…æ—¶æ—¶é—´(æ¯«ç§’)</span><br><span class="line">    private Integer           timeout;</span><br><span class="line"></span><br><span class="line">    // æ³¨å†Œä¸­å¿ƒä¼šè¯è¶…æ—¶æ—¶é—´(æ¯«ç§’)</span><br><span class="line">    private Integer           session;</span><br><span class="line"></span><br><span class="line">    // åŠ¨æ€æ³¨å†Œä¸­å¿ƒåˆ—è¡¨å­˜å‚¨æ–‡ä»¶</span><br><span class="line">    private String            file;</span><br><span class="line"></span><br><span class="line">    // åœæ­¢æ—¶ç­‰å€™å®Œæˆé€šçŸ¥æ—¶é—´</span><br><span class="line">    private Integer           wait;</span><br><span class="line"></span><br><span class="line">    // å¯åŠ¨æ—¶æ£€æŸ¥æ³¨å†Œä¸­å¿ƒæ˜¯å¦å­˜åœ¨</span><br><span class="line">    private Boolean           check;</span><br><span class="line"></span><br><span class="line">    // åœ¨è¯¥æ³¨å†Œä¸­å¿ƒä¸Šæ³¨å†Œæ˜¯åŠ¨æ€çš„è¿˜æ˜¯é™æ€çš„æœåŠ¡</span><br><span class="line">    private Boolean           dynamic;</span><br><span class="line"></span><br><span class="line">    // åœ¨è¯¥æ³¨å†Œä¸­å¿ƒä¸ŠæœåŠ¡æ˜¯å¦æš´éœ²</span><br><span class="line">    private Boolean           register;</span><br><span class="line"></span><br><span class="line">    // åœ¨è¯¥æ³¨å†Œä¸­å¿ƒä¸ŠæœåŠ¡æ˜¯å¦å¼•ç”¨</span><br><span class="line">    private Boolean           subscribe;</span><br><span class="line"></span><br><span class="line">    // è‡ªå®šä¹‰å‚æ•°</span><br><span class="line">    private Map&lt;String, String&gt; parameters;</span><br><span class="line"></span><br><span class="line">    // æ˜¯å¦ä¸ºç¼ºçœ</span><br><span class="line">    private Boolean             isDefault;</span><br></pre></td></tr></table></figure><p>è¿™äº›é…ç½®æ–‡ä»¶æ ¹æ®æ³¨å†Œä¸­å¿ƒçš„ä¸ªæ•°ä¼šè¢«è£…é…æ‹¼æ¥æˆDubboçš„URLï¼ˆè¯¥urlæ˜¯dubboä¸­è‡ªå®šä¹‰çš„ï¼‰ï¼Œè¯¥URLé•¿è¿™ä¸ªæ ·å­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">registry://sit-zk.host:2181/com.alibaba.dubbo.registry.RegistryService?application=ifenqu-web&amp;dubbo=2.5.3&amp;pid=13168&amp;registry=zookeeper&amp;timestamp=1510828420296</span><br></pre></td></tr></table></figure></p><p>çœ‹å®Œé…ç½®ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸‹Serviceå‘å¸ƒçš„æ ¸å¿ƒæ–¹æ³•ï¼šServiceConfigç±»ä¸­çš„doExportUrls<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private void doExportUrls() &#123;</span><br><span class="line">    //è¯¥æ–¹æ³•æ ¹æ®é…ç½®æ–‡ä»¶è£…é…æˆä¸€ä¸ªURLçš„list</span><br><span class="line">    List&lt;URL&gt; registryURLs = loadRegistries(true);</span><br><span class="line">    //æ ¹æ®æ¯ä¸€ä¸ªåè®®é…ç½®æ¥åˆ†åˆ«æš´éœ²æœåŠ¡</span><br><span class="line">    for (ProtocolConfig protocolConfig : protocols) &#123;</span><br><span class="line">        doExportUrlsFor1Protocol(protocolConfig, registryURLs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªprotocolsé•¿è¿™ä¸ªæ ·å­<code>&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20888&quot; id=&quot;dubbo&quot; /&gt;</code>protocolsä¹Ÿæ˜¯æ ¹æ®é…ç½®è£…é…å‡ºæ¥çš„ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿›å…¥doExportUrlsFor1Protocolæ–¹æ³•çœ‹çœ‹dubboå…·ä½“æ˜¯æ€ä¹ˆæ ·å°†æœåŠ¡æš´éœ²å‡ºå»çš„ã€‚è¿™ä¸ªæ–¹æ³•ç‰¹åˆ«å¤§ï¼Œæœ‰å°†è¿‘300å¤šè¡Œä»£ç ï¼Œä½†æ˜¯å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯è·å–ç±»ä¼¼protocolsçš„nameã€portã€hostå’Œä¸€äº›å¿…è¦çš„ä¸Šä¸‹æ–‡ï¼Œä»£ç å¤ªé•¿å°±ä¸å…¨éƒ½è´´å‡ºæ¥äº†ï¼Œåªè´´å…³é”®éƒ¨åˆ†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private void doExportUrlsFor1Protocol(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs) &#123; </span><br><span class="line">//........çœç•¥è·å–ä¸Šä¸‹æ–‡ä»£ç </span><br><span class="line">//é€šè¿‡interfaceClassè·å–è¦æš´éœ²æœåŠ¡çš„æ‰€æœ‰è¦æš´éœ²çš„æ–¹æ³•</span><br><span class="line">String[] methods = Wrapper.getWrapper(interfaceClass).getMethodNames();</span><br><span class="line">//.......çœç•¥éæ ¸å¿ƒä»£ç </span><br><span class="line">//æ ¹æ®ä¸Šä¸‹æ–‡åˆ›å»ºURLå¯¹è±¡</span><br><span class="line"> URL url = new URL(name, host, port, (contextPath == null || contextPath.length() == 0 ? &quot;&quot; : contextPath + &quot;/&quot;) + path, map);</span><br><span class="line"></span><br><span class="line">//é€šè¿‡proxyFactoryæ¥è·å–Invokerå¯¹è±¡</span><br><span class="line"> Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, registryURL.addParameterAndEncoded(Constants.EXPORT_KEY, url.toFullString()));</span><br><span class="line">//å°†invokerå¯¹è±¡åœ¨protocolä¸­å°è£…æˆExporteræ–¹ä¾¿æä¾›ç»™ä¿¡æ¯äº¤æ¢å±‚è¿›è¡Œç½‘ç»œä¼ è¾“</span><br><span class="line"> Exporter&lt;?&gt; exporter = protocol.export(invoker);</span><br><span class="line"> //å°†exporteræ·»åŠ åˆ°listä¸­</span><br><span class="line"> exporters.add(exporter);</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œå°±æ¯”è¾ƒæ˜ç™½dubboçš„å·¥ä½œåŸç†äº†doExportUrlsFor1Protocolæ–¹æ³•ï¼Œå…ˆåˆ›å»ºURLï¼ŒURLåˆ›å»ºå‡ºæ¥é•¿è¿™æ ·<code>dubbo://192.168.xx.63:20888/com.xxx.xxx.VehicleInfoService?anyhost=true&amp;application=test-web&amp;default.retries=0&amp;dubbo=2.5.3&amp;interface=com.xxx.xxx.VehicleInfoService&amp;methods=get,save,update,del,list&amp;pid=13168&amp;revision=1.2.38&amp;side=provider&amp;timeout=5000&amp;timestamp=1510829644847</code>ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—è¿™ä¸ªURLå¾ˆçœ¼ç†Ÿï¼Œæ²¡é”™åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°çš„servicesçš„providersä¿¡æ¯å°±æ˜¯è¿™ä¸ªï¼Œå†ä¼ å…¥urlé€šè¿‡proxyFactoryè·å–Invokerï¼Œå†å°†Invokerå°è£…æˆExporterçš„æ•°ç»„ï¼Œåªéœ€è¦å°†è¿™ä¸ªlistæä¾›ç»™ç½‘ç»œä¼ è¾“å±‚ç»„ä»¶ï¼Œç„¶åconsumeræ‰§è¡ŒInvokerçš„invokeæ–¹æ³•å°±è¡Œäº†ã€‚è®©æˆ‘ä»¬å†çœ‹çœ‹è¿™ä¸ªproxyFactoryçš„getInvokeræ–¹æ³•ã€‚proxyFactoryä¸‹æœ‰JDKProxyFactoryå’ŒJavassistProxyFactoryã€‚å®˜æ–¹æ¨èä¹Ÿæ˜¯é»˜è®¤ä½¿ç”¨çš„æ˜¯JavassistProxyFactoryã€‚å› ä¸ºjavassiståŠ¨æ€ä»£ç†æ€§èƒ½æ¯”JDKçš„é«˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class JavassistProxyFactory extends AbstractProxyFactory &#123;</span><br><span class="line"></span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public &lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] interfaces) &#123;</span><br><span class="line">        return (T) Proxy.getProxy(interfaces).newInstance(new InvokerInvocationHandler(invoker));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Invoker&lt;T&gt; getInvoker(T proxy, Class&lt;T&gt; type, URL url) &#123;</span><br><span class="line">        // TODO Wrapperç±»ä¸èƒ½æ­£ç¡®å¤„ç†å¸¦$çš„ç±»å</span><br><span class="line">        final Wrapper wrapper = Wrapper.getWrapper(proxy.getClass().getName().indexOf(&apos;$&apos;) &lt; 0 ? proxy.getClass() : type);</span><br><span class="line">        return new AbstractProxyInvoker&lt;T&gt;(proxy, type, url) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected Object doInvoke(T proxy, String methodName, </span><br><span class="line">                                      Class&lt;?&gt;[] parameterTypes, </span><br><span class="line">                                      Object[] arguments) throws Throwable &#123;</span><br><span class="line">                return wrapper.invokeMethod(proxy, methodName, parameterTypes, arguments);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†åŠ¨æ€ä»£ç†çš„æ–¹å¼è°ƒç”¨äº†è¦æš´éœ²çš„serviceçš„æ–¹æ³•ã€‚å¹¶ä¸”è¿”å›äº†Invokerå¯¹è±¡ã€‚åœ¨dubboçš„æœåŠ¡å‘å¸ƒä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªInvokerè´¯ç©¿å§‹ç»ˆï¼Œéƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªcontextçš„ä½œç”¨äº†ï¼Œè®©æˆ‘ä»¬è¿›Invokeré‡Œé¢å»çœ‹çœ‹è¿™ä¸ªInvokeråˆ°åº•æ˜¯ä½•æ–¹ç¥åœ£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public interface Invoker&lt;T&gt; extends Node &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * get service interface.</span><br><span class="line">     * </span><br><span class="line">     * @return service interface.</span><br><span class="line">     */</span><br><span class="line">    Class&lt;T&gt; getInterface();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * invoke.</span><br><span class="line">     * </span><br><span class="line">     * @param invocation</span><br><span class="line">     * @return result</span><br><span class="line">     * @throws RpcException</span><br><span class="line">     */</span><br><span class="line">    Result invoke(Invocation invocation) throws RpcException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªInvokerå°±ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªgetInterfaceï¼Œä¹Ÿå°±æ˜¯è¦æš´éœ²çš„æœåŠ¡æ¥å£ï¼Œä¸€ä¸ªå°±æ˜¯invokeæ–¹æ³•ï¼Œè¿™ä¸ªinvokeæ–¹æ³•åœ¨AbstractProxyInvokerä¸­æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public Result invoke(Invocation invocation) throws RpcException &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">    //è°ƒç”¨doInvokeæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªResult</span><br><span class="line">        return new RpcResult(doInvoke(proxy, invocation.getMethodName(), invocation.getParameterTypes(), invocation.getArguments()));</span><br><span class="line">    &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">        return new RpcResult(e.getTargetException());</span><br><span class="line">    &#125; catch (Throwable e) &#123;</span><br><span class="line">        throw new RpcException(&quot;Failed to invoke remote proxy method &quot; + invocation.getMethodName() + &quot; to &quot; + getUrl() + &quot;, cause: &quot; + e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®çœ‹åˆ°JavassistProxyFactoryå¤§å®¶å°±åº”è¯¥å¤§æ¦‚æ˜ç™½äº†è¿™ä¸ªInvokerçš„ä½œç”¨ï¼ŒåŒæ—¶è¿™ä¸ªç±»çš„åå­—å°±å«Invokerä¹Ÿå¯ä»¥çŒœä¸ªå¤§æ¦‚ï¼ŒInvokerå°±æ˜¯è°ƒç”¨serviceçš„æ–¹æ³•çš„å®ä½“ç±»ã€‚å…¶ä¸­doInvokeæ–¹æ³•å·²ç»åœ¨JavassistProxyFactoryä¸­å®šä¹‰äº†ï¼Œé€šè¿‡åå°„è°ƒç”¨è¦æš´éœ²çš„serviceçš„æ–¹æ³•ã€‚</p><p>ä¸šåŠ¡æ–¹å°†æœåŠ¡æ¥å£å’Œå®ç°ç¼–å†™å®šä¹‰å¥½ï¼Œæ·»åŠ dubboç›¸å…³é…ç½®æ–‡ä»¶ã€‚</p><ul><li><p>Configå±‚åŠ è½½é…ç½®æ–‡ä»¶å½¢æˆä¸Šä¸‹æ–‡ï¼ŒConfigå±‚åŒ…æ‹¬ï¼šServiceConfigã€ProviderConfigã€RegistryConfigç­‰ã€‚</p></li><li><p>ServiceConfigæ ¹æ®Protocolç±»å‹ï¼Œæ ¹æ®ProtocolConfigã€ProviderConfigåŠ è½½registryï¼Œæ ¹æ®åŠ è½½çš„registryåˆ›å»ºdubboçš„URLã€‚</p></li><li><p>å‡†å¤‡å·¥ä½œåšå®ŒåProxyFactoryä¸Šåœºï¼Œdubboä¸­æœ‰ä¸¤ç§ä»£ç†æ–¹å¼ï¼ŒJDKä»£ç†å’ŒJavassistä»£ç†ï¼Œé»˜è®¤ä½¿ç”¨Javassistä»£ç†ï¼ŒProxyä»£ç†ç±»æ ¹æ®dubboé…ç½®ä¿¡æ¯è·å–åˆ°æ¥å£ä¿¡æ¯ã€é€šè¿‡åŠ¨æ€ä»£ç†æ–¹å¼å°†æ¥å£çš„æ‰€æœ‰æ–¹æ³•äº¤ç»™Proxyä»£ç†ç±»è¿›è¡Œä»£ç†ï¼Œå¹¶å°è£…è¿›Invokeré‡Œé¢ã€‚</p></li><li><p>å°†æ‰€æœ‰éœ€è¦æš´éœ²çš„serviceå°è£…çš„Invokerç»„æˆä¸€ä¸ªlistä¼ ç»™ä¿¡æ¯äº¤æ¢å±‚æä¾›ç»™æ¶ˆè´¹æ–¹è¿›è¡Œè°ƒç”¨ã€‚</p></li></ul><p>æœ‰éœ€è¦çš„åŒå­¦å¯ä»¥å»ä¸‹è½½æºç è¿™æ ·å¯èƒ½æ›´æ–¹ä¾¿äº†è§£</p><p>Demoä»£ç <a href="https://github.com/zhongyp/bodu/bodu-dubbo" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p><p>ä»£ç ç»“æ„ï¼š</p><p>src</p><ul><li><p>main</p><ul><li>java<ul><li>com.bodu.dubbo<ul><li>api<ul><li>DemoService.java</li></ul></li><li>consumer<ul><li>Consumer.java</li></ul></li><li>producer<ul><li>DemoServiceImpl.java</li><li>Producer</li></ul></li></ul></li></ul></li><li>resources<ul><li>dubbo-demo-producer.xml</li><li>dubbo-demo-consumer.xml</li></ul></li></ul></li><li><p>pom.xml</p></li></ul><p>pom.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;properties&gt;</span><br><span class="line">  &lt;dubbo.version&gt;2.5.4&lt;/dubbo.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.8.1&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>DemoService.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public interface DemoService &#123;</span><br><span class="line"></span><br><span class="line">    String sayHello(String name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Producer.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Producer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">System.setProperty(&quot;java.net.preferIPv4Stack&quot;, &quot;true&quot;);</span><br><span class="line">        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;dubbo-demo-producer.xml&quot;&#125;);</span><br><span class="line">        context.start();</span><br><span class="line">// æ·»åŠ ç›‘å¬ï¼Œç‚¹å‡»ä»»ä½•é”®ï¼Œé€€å‡ºæœåŠ¡</span><br><span class="line">        System.in.read(); // press any key to exit</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DemoServiceImpl.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class DemoServiceImpl implements DemoService &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String sayHello(String name) &#123;</span><br><span class="line">        System.out.println(&quot;[&quot; + new SimpleDateFormat(&quot;HH:mm:ss&quot;).format(new Date()) + &quot;] Hello &quot; + name + &quot;, request from consumer: &quot; + RpcContext.getContext().getRemoteAddress());</span><br><span class="line">        return &quot;Hello &quot; + name + &quot;, response form provider: &quot; + RpcContext.getContext().getLocalAddress();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>dubbo-demo-producer.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</span><br><span class="line">       xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span><br><span class="line">       http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- ç”Ÿäº§è€…çš„åç§°ï¼Œç”¨äºè·Ÿè¸ªä¾èµ–å…³ç³» --&gt;</span><br><span class="line">    &lt;dubbo:application name=&quot;demo-provider&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- ä½¿ç”¨ç»„æ’­æ³¨å†Œä¸­å¿ƒæ¥æš´éœ²æœåŠ¡ --&gt;</span><br><span class="line">    &lt;dubbo:registry address=&quot;multicast://224.5.6.7:1234&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- ä½¿ç”¨dubboåè®®æš´éœ²æœåŠ¡ --&gt;</span><br><span class="line">    &lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- æ¥å£çš„å®ç°ç±» --&gt;</span><br><span class="line">    &lt;bean id=&quot;demoService&quot; class=&quot;com.bodu.dubbo.producer.DemoServiceImpl&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- å®šä¹‰ç”¨äºæš´éœ²çš„æœåŠ¡æ¥å£ --&gt;</span><br><span class="line">    &lt;dubbo:service interface=&quot;com.bodu.dubbo.api.DemoService&quot; ref=&quot;demoService&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Main&#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] arsgs)&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;dubbo-demo-producer.xml&quot;&#125;);// è·å–dubbo-demo-producer.xmlé…ç½®æ–‡ä»¶</span><br><span class="line">        context.start();// åˆå§‹åŒ–é…ç½®æ–‡ä»¶</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Consumer.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class Consumer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //Prevent to get IPV6 address,this way only work in debug mode</span><br><span class="line">        //But you can pass use -Djava.net.preferIPv4Stack=true,then it work well whether in debug mode or not</span><br><span class="line">        // é˜²æ­¢å–åˆ°IPV6çš„åœ°å€ï¼Œè¿™ç§æ–¹å¼ä»…é€‚ç”¨äºdebugæ¨¡å¼ï¼Œä½†æ˜¯ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨-Djava.net.preferIPv4Stack=trueï¼Œè¿™æ ·ä¸ç®¡æ˜¯å¦æ˜¯debugæ¨¡å¼ï¼Œè¿è¡Œéƒ½ä¸ä¼šæœ‰é—®é¢˜</span><br><span class="line">        System.setProperty(&quot;java.net.preferIPv4Stack&quot;, &quot;true&quot;);</span><br><span class="line">        // è·å–é…ç½®æ–‡ä»¶åˆå§‹åŒ–xml</span><br><span class="line">        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;dubbo-demo-consuner.xml&quot;&#125;);</span><br><span class="line">        context.start();</span><br><span class="line">        // è·å–è¿œç¨‹æœåŠ¡ä»£ç†</span><br><span class="line">        DemoService demoService = (DemoService) context.getBean(&quot;demoService&quot;); // get remote service proxy</span><br><span class="line">        // å¾ªç¯è®¿é—®è¿œç¨‹ä»£ç†æœåŠ¡</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">                String hello = demoService.sayHello(&quot;world&quot;); // call remote method</span><br><span class="line">                System.out.println(hello); // get result</span><br><span class="line"></span><br><span class="line">            &#125; catch (Throwable throwable) &#123;</span><br><span class="line">                throwable.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>dubbo-demo-consumer.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</span><br><span class="line">       xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span><br><span class="line">       http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- æ¶ˆè´¹è€…çš„åç§°ï¼Œç”¨äºè·Ÿè¸ªä¾èµ–å…³ç³»ï¼Œä¸è¦å’Œç”Ÿäº§è€…åç§°ç›¸åŒ  --&gt;</span><br><span class="line">    &lt;dubbo:application name=&quot;demo-consumer&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- ä½¿ç”¨å¹¿æ’­å‘ç°æœåŠ¡ --&gt;</span><br><span class="line">    &lt;dubbo:registry address=&quot;multicast://224.5.6.7:1234&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†ï¼Œè¿œç¨‹æœåŠ¡ä»£ç†å¯ä»¥å‘ä½¿ç”¨æœ¬åœ°çš„æ¥å£ä¸€æ ·ä½¿ç”¨ --&gt;</span><br><span class="line">    &lt;dubbo:reference id=&quot;demoService&quot; check=&quot;false&quot; interface=&quot;com.bodu.dubbo.api.DemoService&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="http://blog.csdn.net/nethackatschool/article/details/78560574" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çº¢é»‘æ ‘</title>
      <link href="/2018/03/07/algorithm/2018-03-07-RedBlackTree/"/>
      <url>/2018/03/07/algorithm/2018-03-07-RedBlackTree/</url>
      
        <content type="html"><![CDATA[<h2 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h2><p><a href="https://www.cnblogs.com/sandy2013/p/3270999.html" target="_blank" rel="noopener">åšæ–‡è½¬è½½ï¼šhttps://www.cnblogs.com/sandy2013/p/3270999.html</a></p><h2 id="çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«"><a href="#çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«" class="headerlink" title="çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«"></a>çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«</h2><ul><li><p>çº¢é»‘æ ‘æ”¾å¼ƒäº†è¿½æ±‚å®Œå…¨å¹³è¡¡ï¼Œè¿½æ±‚å¤§è‡´å¹³è¡¡ï¼Œåœ¨ä¸å¹³è¡¡äºŒå‰æ ‘çš„æ—¶é—´å¤æ‚åº¦ç›¸å·®ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œä¿è¯æ¯æ¬¡æ’å…¥æœ€å¤šåªéœ€è¦ä¸‰æ¬¡æ—‹è½¬å°±èƒ½è¾¾åˆ°å¹³è¡¡ï¼Œå®ç°èµ·æ¥ä¹Ÿæ›´ä¸ºç®€å•ã€‚</p></li><li><p>å¹³è¡¡äºŒå‰æ ‘è¿½æ±‚ç»å¯¹å¹³è¡¡ï¼Œæ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¯æ¬¡æ’å…¥æ–°èŠ‚ç‚¹ä¹‹åéœ€è¦æ—‹è½¬çš„æ¬¡æ•°ä¸èƒ½é¢„çŸ¥ã€‚<br>å¹³è¡¡äºŒå‰æ ‘åˆè¢«ç§°ä¸ºAVLæ ‘ï¼ˆæœ‰åˆ«äºAVLç®—æ³•ï¼‰ï¼Œä¸”å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå®ƒæ˜¯ä¸€ æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚æ„é€ ä¸è°ƒæ•´æ–¹æ³• å¹³è¡¡äºŒå‰æ ‘çš„å¸¸ç”¨ç®—æ³•æœ‰çº¢é»‘æ ‘ã€AVLã€Treapç­‰ã€‚ æœ€å°äºŒå‰å¹³è¡¡æ ‘çš„èŠ‚ç‚¹çš„å…¬å¼å¦‚ä¸‹ F(n)=F(n-1)+F(n-2)+1 è¿™ä¸ªç±»ä¼¼äºä¸€ä¸ªé€’å½’çš„æ•°åˆ—ï¼Œå¯ä»¥å‚è€ƒFibonacciæ•°åˆ—ï¼Œ1æ˜¯æ ¹èŠ‚ç‚¹ï¼ŒF(n-1)æ˜¯å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼ŒF(n-2)æ˜¯å³å­æ ‘çš„èŠ‚ç‚¹æ•°é‡ã€‚</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç»å…¸é¢è¯•é¢˜æ•´ç†</title>
      <link href="/2018/03/02/interfaceview/2018-03-02-Classic/"/>
      <url>/2018/03/02/interfaceview/2018-03-02-Classic/</url>
      
        <content type="html"><![CDATA[<h2 id="corejava"><a href="#corejava" class="headerlink" title="corejava"></a>corejava</h2><ol><li><p>hashcode ç›¸ç­‰ä¸¤ä¸ªç±»ä¸€å®šç›¸ç­‰ä¹ˆï¼Ÿequalså‘¢ï¼Ÿç›¸åå‘¢ï¼Ÿ</p></li><li><p>ä»‹ç»ä¸€ä¸‹é›†åˆæ¡†æ¶</p></li><li><p>hashmap hashtable åº•å±‚å®ç°ä»€ä¹ˆåŒºåˆ«ï¼Ÿhashtaleå’Œconcurrenthashmapå‘¢ï¼Ÿ</p></li><li><p>hashmapå’Œtreemap ä»€ä¹ˆåŒºåˆ«ï¼Ÿåº•å±‚æ•°æ®ç»“æ„å‘¢ï¼Ÿ</p></li><li><p>çº¿ç¨‹æ± ç”¨è¿‡ä¹ˆï¼Ÿéƒ½æœ‰ä»€ä¹ˆå‚æ•°ï¼Ÿåº•å±‚å¦‚ä½•å®ç°çš„ï¼Ÿ</p></li><li><p>sychnizedå’ŒLockä»€ä¹ˆåŒºåˆ«ï¼Ÿsychnizeä»€ä¹ˆæƒ…å†µæ˜¯å¯¹è±¡é”ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯å…¨å±€é”ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p></li><li><p>ThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿåº•å±‚å¦‚ä½•å®ç°ï¼Ÿå†™ä¸€ä¸ªä¾‹å­ï¼Ÿ</p></li><li><p>volitileçš„å·¥ä½œåŸç†ï¼Ÿ</p></li><li><p>casçŸ¥é“ä¹ˆï¼Ÿå¦‚ä½•å®ç°çš„ï¼Ÿ</p></li><li><p>è¯·ç”¨è‡³å°‘å››ç§å†™æ³•ï¼Ÿå†™ä¸€ä¸ªå•ä¾‹æ¨¡å¼ï¼Ÿ</p></li></ol><h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><ol><li><p>è¯·ä»‹ç»ä¸€ä¸‹JVMå†…å­˜æ¨¡å‹ï¼Ÿç”¨è¿‡ä»€ä¹ˆåƒåœ¾å›æ”¶å™¨ï¼Œéƒ½è¯´è¯´ï¼Ÿ</p></li><li><p>çº¿ä¸Šå‘é€é¢‘ç¹full gcå¦‚ä½•å¤„ç†ï¼ŸCPUä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠï¼Ÿå¦‚ä½•å®šä½é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿè¯´ä¸€ä¸‹è§£å†³æ€è·¯å’Œå¤„ç†æ–¹æ³•ã€‚</p></li><li><p>çŸ¥é“å­—èŠ‚ç ä¹ˆï¼Ÿå­—èŠ‚ç éƒ½æœ‰é‚£äº›ï¼ŸInteger * 5,int y=5, æ¯”è¾ƒx==y éƒ½ç»è¿‡é‚£äº›æ­¥éª¤ï¼Ÿ</p></li><li><p>è®²è®²ç±»åŠ è½½æœºåˆ¶ï¼Ÿéƒ½æœ‰å“ªäº›ç±»åŠ è½½å™¨ï¼Œè¿™äº›ç±»åŠ è½½å™¨éƒ½åŠ è½½å“ªäº›æ–‡ä»¶ï¼Ÿæ‰‹å†™ä¸€ä¸‹ç±»åŠ è½½Demo</p></li><li><p>çŸ¥é“osgiä¹ˆï¼Ÿä»–æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p></li><li><p>è¯·é—®ä½ åšè¿‡å“ªäº›JVMä¼˜åŒ–ï¼Ÿä½¿ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Ÿè¾¾åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ</p></li></ol><ol start="7"><li>class.forName(â€œjava.lang.Stringâ€)å’ŒString.class.getClassLoader.loadClass(â€œjava.lang.Stringâ€)ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li></ol><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><ol><li><p>springéƒ½æœ‰å“ªäº›æœºåˆ¶ï¼ŸAOPåº•å±‚å¦‚ä½•å®ç°çš„ï¼ŸIOCï¼Ÿ</p></li><li><p>cglibçŸ¥é“ä¹ˆï¼Ÿå®ƒå’ŒJDKåŠ¨æ€ä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæ‰‹å†™ä¸€ä¸ªjdkåŠ¨æ€ä»£ç†ï¼Ÿ</p></li></ol><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><ol><li><p>ä½¿ç”¨mysqlç´¢å¼•éƒ½æœ‰å“ªäº›åŸåˆ™ï¼Ÿç´¢å¼•ä»€ä¹ˆæ•°æ®ç»“æ„ï¼ŸB+treeå’ŒB treeä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></li><li><p>mysqlæœ‰å“ªäº›å­˜å‚¨å¼•æ“å•Šï¼Ÿéƒ½æœ‰å•¥åŒºåˆ«ï¼Ÿè¦è¯¦ç»†ï¼Ÿ</p></li><li><p>è®¾è®¡é«˜å¹¶å‘ç³»ç»Ÿæ•°æ®åº“å±‚é¢è¯¥æ€ä¹ˆè®¾è®¡ï¼Ÿæ•°æ®åº“é”æœ‰å“ªäº›ç±»å‹ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ</p></li><li><p>æ•°æ®åº“äº‹åŠ¡æœ‰å“ªäº›ï¼Ÿ</p></li></ol><h2 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h2><ol><li><p>å¦‚ä½•è®¾è®¡å¯ä»¥åŠ¨æ€æ‰©å®¹ç¼©å®¹çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆï¼Ÿ</p></li><li><p>ç”¨è¿‡å“ªäº›åˆ†åº“åˆ†è¡¨çš„ä¸­é—´ä»¶ï¼Œæœ‰å•¥ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œè®²ä¸€ä¸‹ä½ äº†è§£çš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶çš„åº•å±‚å®ç°åŸç†ã€‚</p></li><li><p>æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªæœªåˆ†åº“åˆ†è¡¨çš„ç³»ç»Ÿï¼Œä»¥åç³»ç»Ÿéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Œå¦‚ä½•è®¾è®¡ï¼Œè®©æœªåˆ†åº“åˆ†è¡¨çš„ç³»ç»ŸåŠ¨æ€åˆ‡æ¢åˆ°åˆ†åº“åˆ†è¡¨ç³»ç»Ÿä¸Šï¼Ÿ</p></li><li><p>åˆ†å¸ƒå¼äº‹åŠ¡çŸ¥é“ä¹ˆï¼Ÿ ä½ ä»¬æ€ä¹ˆè§£å†³çš„ï¼Ÿ TCC?é‚£è‹¥å‡ºç°ç½‘ç»œåŸå› ï¼Œç½‘ç»œè¿ä¸é€šæ€ä¹ˆåŠå•Šï¼Ÿ</p></li><li><p>ä¸ºä»€ä¹ˆåˆ†åº“åˆ†è¡¨ï¼Ÿ</p></li><li><p>åˆ†å¸ƒå¼å¯»å€æ–¹å¼éƒ½æœ‰å“ªäº›ç®—æ³•ï¼ŸçŸ¥é“ä¸€è‡´hashä¹ˆï¼Ÿæ‰‹å†™ä¸€ä¸‹Javaå®ç°ä»£ç ï¼Ÿä½ è‹¥userIdå–æ¨¡åˆ†ç‰‡ï¼Œé‚£æˆ‘è¦æŸ¥ä¸€æ®µè¿ç»­æ—¶é—´é‡Œçš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ</p></li><li><p>å¦‚ä½•è§£å†³åˆ†åº“åˆ†è¡¨ä¸»é”®é—®é¢˜ï¼Ÿæœ‰ä»€ä¹ˆå®ç°æ–¹æ¡ˆï¼Ÿ</p></li></ol><h2 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h2><ol><li><p>rediså’Œmemched ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„redisæ¯”å¤šçº¿ç¨‹çš„memchedæ•ˆç‡è¦é«˜ï¼Ÿ</p></li><li><p>redisæœ‰ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Ÿéƒ½åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</p></li><li><p>redisçš„ä¸»ä»å¤åˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿredisçš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿredisçš„keyæ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿ</p></li><li><p>ä½¿ç”¨rediså¦‚ä½•è®¾è®¡åˆ†å¸ƒå¼é”ï¼Ÿä½¿ç”¨zkå¯ä»¥ä¹ˆï¼Ÿå¦‚ä½•å®ç°ï¼Ÿè¿™ä¸¤ç§å“ªä¸ªæ•ˆç‡æ›´é«˜ï¼Ÿ</p></li><li><p>çŸ¥é“redisçš„æŒä¹…åŒ–ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿå…·ä½“åº•å±‚å®ç°å‘¢ï¼Ÿ</p></li><li><p>redisè¿‡æœŸç­–ç•¥éƒ½æœ‰å“ªäº›ï¼ŸLRUï¼Ÿå†™ä¸€ä¸‹Javaç‰ˆæœ¬ä»£ç ï¼Ÿ</p></li></ol><h2 id="åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶"><a href="#åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶" class="headerlink" title="åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶"></a>åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶</h2><ol><li><p>è¯´ä¸€ä¸‹dubboçš„å®ç°è¿‡ç¨‹ï¼Œæ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡ä¹ˆï¼Ÿ</p></li><li><p>zkåŸç†çŸ¥é“ä¹ˆï¼Ÿzkéƒ½å¯ä»¥å¹²ä»€ä¹ˆï¼Ÿpaxosç®—æ³•çŸ¥é“ä¹ˆï¼Ÿè¯´ä¸€ä¸‹åŸç†å’Œå®ç°ï¼Ÿ</p></li><li><p>dubboæ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®ï¼Ÿhessianï¼Ÿè¯´ä¸€ä¸‹hessiançš„æ•°æ®ç»“æ„ï¼ŸPBçŸ¥é“ä¹ˆï¼Ÿä¸ºå•¥PBæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Ÿ</p></li><li><p>çŸ¥é“nettyä¹ˆï¼Ÿnettyå¯ä»¥å¹²å˜›ï¼ŸNIO,BIO,AIOéƒ½æ˜¯ä»€ä¹ˆå•Šï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></li><li><p>dubboå¤åˆ¶å‡è¡¡ç­–ç•¥å’Œé«˜å¯ç”¨ç­–ç•¥éƒ½æœ‰å“ªäº›ï¼ŸåŠ¨æ€ä»£ç†ç­–ç•¥å‘¢ï¼Ÿ</p></li><li><p>ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†å•Šï¼Ÿæ‹†åˆ†ä¸ç”¨dubboå¯ä»¥ä¹ˆï¼Ÿdubboå’Œthriftä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ</p></li></ol><h2 id="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"></a>åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</h2><ol><li><p>ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</p></li><li><p>å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼Ÿ</p></li><li><p>kafkaï¼Œactivemqï¼Œrabbitmqï¼Œrocketmqéƒ½æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</p></li><li><p>å¦‚æœè®©ä½ å†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ¶æ„è®¾è®¡ï¼Ÿè¯´ä¸€ä¸‹ä½ çš„æ€è·¯ï¼Ÿ</p></li></ol><h2 id="åˆ†å¸ƒå¼æœç´¢å¼•æ“"><a href="#åˆ†å¸ƒå¼æœç´¢å¼•æ“" class="headerlink" title="åˆ†å¸ƒå¼æœç´¢å¼•æ“"></a>åˆ†å¸ƒå¼æœç´¢å¼•æ“</h2><ol><li><p>esçš„å·¥ä½œè¿‡ç¨‹å®ç°æ˜¯å¦‚ä½•çš„ï¼Ÿå¦‚ä½•å®ç°åˆ†å¸ƒå¼çš„å•Šï¼Ÿ</p></li><li><p>esåœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Ÿ</p></li><li><p>esçš„æŸ¥è¯¢æ˜¯ä¸€ä¸ªæ€ä¹ˆçš„å·¥ä½œè¿‡ç¨‹ï¼Ÿåº•å±‚çš„lucenceä»‹ç»ä¸€ä¸‹ï¼Ÿå€’æ’ç´¢å¼•çŸ¥é“ä¹ˆï¼Ÿeså’Œmongodbä»€ä¹ˆåŒºåˆ«ï¼Ÿéƒ½åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</p></li></ol><h2 id="é«˜å¹¶å‘é«˜å¯ç”¨æ¶æ„è®¾è®¡"><a href="#é«˜å¹¶å‘é«˜å¯ç”¨æ¶æ„è®¾è®¡" class="headerlink" title="é«˜å¹¶å‘é«˜å¯ç”¨æ¶æ„è®¾è®¡"></a>é«˜å¹¶å‘é«˜å¯ç”¨æ¶æ„è®¾è®¡</h2><ol><li><p>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘é«˜å¯ç”¨ç³»ç»Ÿï¼Ÿ</p></li><li><p>å¦‚ä½•é™æµï¼Ÿå·¥ç¨‹ä¸­æ€ä¹ˆåšçš„ï¼Œè¯´ä¸€ä¸‹å…·ä½“å®ç°ï¼Ÿ</p></li><li><p>ç¼“å­˜å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿç¼“å­˜ä½¿ç”¨ä¸ä¼šé€ æˆä»€ä¹ˆåæœï¼Ÿ</p></li><li><p>å¦‚ä½•ç†”æ–­ï¼Ÿç†”æ–­æ¡†æ¶éƒ½æœ‰å“ªäº›ï¼Ÿå…·ä½“å®ç°åŸç†çŸ¥é“ä¹ˆï¼Ÿ</p></li><li><p>å¦‚ä½•é™çº§ï¼Ÿ å¦‚ä½•è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿå¦‚ä½•æ•°æ®åº“æ‹†åˆ†ï¼Ÿ</p></li></ol><h2 id="é€šä¿¡åè®®"><a href="#é€šä¿¡åè®®" class="headerlink" title="é€šä¿¡åè®®"></a>é€šä¿¡åè®®</h2><ol><li><p>è¯´ä¸€ä¸‹TCP/IP å››å±‚ï¼Ÿ</p></li><li><p>httpçš„å·¥ä½œæµç¨‹ï¼Ÿ http1.0 http1.1 http2.0å…·ä½“å“ªäº›åŒºåˆ«ï¼Ÿ</p></li><li><p>TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå››å±‚åˆ†æ‰‹çš„å·¥ä½œæµç¨‹ï¼Ÿç”»ä¸€ä¸‹æµç¨‹å›¾ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡äº”æ¬¡æˆ–è€…ä¸¤æ¬¡ï¼Ÿ</p></li><li><p>ç”»ä¸€ä¸‹httpsçš„å·¥ä½œæµç¨‹ï¼Ÿå…·ä½“å¦‚ä½•å®ç°ï¼Ÿå¦‚ä½•é˜²æ­¢è¢«æŠ“åŒ…ï¼Ÿ</p></li></ol><h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><ol><li>45äº¿é˜¿æ‹‰ä¼¯æ•°å­—ï¼Œå¦‚ä½•è¿›è¡Œå»é‡ï¼Ÿå¦‚ä½•æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªæ•°ï¼Ÿ</li></ol><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><ol><li>äºŒå‰æ ‘å’Œçº¢é»‘æ ‘</li></ol><p><a href="https://www.jianshu.com/p/a07d1d4004b0" target="_blank" rel="noopener">åšæ–‡æ¨è</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Interview </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>DubboæœåŠ¡ç«¯å‘å¸ƒï¼ˆè½¬è½½ï¼‰</title>
      <link href="/2018/02/15/dubbo/2018-02-15-Dubbo-Provider/"/>
      <url>/2018/02/15/dubbo/2018-02-15-Dubbo-Provider/</url>
      
        <content type="html"><![CDATA[<p> dubboè‡ªå®šä¹‰æ ‡ç­¾ é‡Œé¢è¯´è¿‡å¯åŠ¨æœåŠ¡æ—¶ä¼šé¦–å…ˆåŠ è½½XMLæ–‡ä»¶ä¸­çš„æ ‡ç­¾ï¼Œè§£æå‡ºæ¥çš„æ ‡ç­¾æ•°æ®ä¼šè£…é…åˆ°å¯¹åº”çš„å®ä½“ç±»ä¸­ï¼Œdubboæ¡†æ¶é‡Œé¢ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹com.alibaba.dubbo.config.spring.schema.DubboNamespaceHandlerç±»çš„å®ç°ã€‚</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class DubboNamespaceHandler extends NamespaceHandlerSupport &#123;  </span><br><span class="line">  </span><br><span class="line">    static &#123;  </span><br><span class="line">        Version.checkDuplicate(DubboNamespaceHandler.class);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void init() &#123;  </span><br><span class="line">        registerBeanDefinitionParser(&quot;application&quot;, new DubboBeanDefinitionParser(ApplicationConfig.class, true));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;module&quot;, new DubboBeanDefinitionParser(ModuleConfig.class, true));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;registry&quot;, new DubboBeanDefinitionParser(RegistryConfig.class, true));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;monitor&quot;, new DubboBeanDefinitionParser(MonitorConfig.class, true));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;provider&quot;, new DubboBeanDefinitionParser(ProviderConfig.class, true));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;consumer&quot;, new DubboBeanDefinitionParser(ConsumerConfig.class, true));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;protocol&quot;, new DubboBeanDefinitionParser(ProtocolConfig.class, true));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;service&quot;, new DubboBeanDefinitionParser(ServiceBean.class, true));  // ServiceBean</span><br><span class="line">        registerBeanDefinitionParser(&quot;reference&quot;, new DubboBeanDefinitionParser(ReferenceBean.class, false));  </span><br><span class="line">        registerBeanDefinitionParser(&quot;annotation&quot;, new DubboBeanDefinitionParser(AnnotationBean.class, true));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ServiceBeanå®ç°äº†springçš„ApplicationListeneræ¥å£ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸€ä¸ªç›‘å¬å™¨ã€‚åœ¨springå®¹å™¨åŠ è½½å®Œæˆåè§¦å‘contextrefreshedeventäº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«å®ç°äº†ApplicationListeneræ¥å£çš„ç±»ç›‘å¬åˆ°ï¼Œæ‰§è¡Œå¯¹åº”çš„onApplicationEventå‡½æ•°ã€‚æˆ‘ä»¬çœ‹çœ‹ServiceBeanç±»çš„ä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void onApplicationEvent(ApplicationEvent event) &#123;  </span><br><span class="line">    if (ContextRefreshedEvent.class.getName().equals(event.getClass().getName())) &#123;  </span><br><span class="line">        if (isDelay() &amp;&amp; ! isExported() &amp;&amp; ! isUnexported()) &#123;  </span><br><span class="line">            if (logger.isInfoEnabled()) &#123;  </span><br><span class="line">                logger.info(&quot;The service ready on spring started. service: &quot; + getInterface());  </span><br><span class="line">            &#125;  </span><br><span class="line">            export();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç›‘å¬æ–¹æ³•æœ€ç»ˆè°ƒç”¨äº†exportæ–¹æ³•æ¥å®ç°æœåŠ¡çš„å‘å¸ƒå¤„ç†ã€‚å› ä¸ºServiceBeanç»§æ‰¿äº†ServiceConfigç±»ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†ServiceConfigä¸­çš„exportæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public synchronized void export() &#123;  </span><br><span class="line">    if (provider != null) &#123;  </span><br><span class="line">        if (export == null) &#123;  </span><br><span class="line">            export = provider.getExport();//æ˜¯å¦æš´éœ²  </span><br><span class="line">        &#125;  </span><br><span class="line">        if (delay == null) &#123;  </span><br><span class="line">            delay = provider.getDelay();//æ˜¯å¦å»¶è¿Ÿæš´éœ²  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    if (export != null &amp;&amp; ! export.booleanValue()) &#123;  </span><br><span class="line">        return;  </span><br><span class="line">    &#125;  </span><br><span class="line">    //æ˜¯å¦å»¶è¿Ÿå‘å¸ƒæœåŠ¡æ¥å£  </span><br><span class="line">    if (delay != null &amp;&amp; delay &gt; 0) &#123;  </span><br><span class="line">        Thread thread = new Thread(new Runnable() &#123;  </span><br><span class="line">            public void run() &#123;  </span><br><span class="line">                try &#123;  </span><br><span class="line">                    Thread.sleep(delay);//å»¶è¿Ÿç¡çœ åè°ƒç”¨doExportå‘å¸ƒæ¥å£  </span><br><span class="line">                &#125; catch (Throwable e) &#123;  </span><br><span class="line">                &#125;  </span><br><span class="line">                doExport();//ç›´æ¥å‘å¸ƒæ¥å£  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">        thread.setDaemon(true);//è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹  </span><br><span class="line">        thread.setName(&quot;DelayExportServiceThread&quot;);  </span><br><span class="line">        thread.start();  </span><br><span class="line">    &#125; else &#123;  </span><br><span class="line">        doExport();//ç›´æ¥å‘å¸ƒæ¥å£  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">protected synchronized void doExport() &#123;</span><br><span class="line">        if(this.unexported) &#123;//å¦‚æœæ˜¯å·²ç»è§£é™¤æš´éœ²çš„æ¥å£åˆ™æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">            throw new IllegalStateException(&quot;Already unexported!&quot;);</span><br><span class="line">        &#125; else if(!this.exported) &#123; //å¦‚æœå·²ç»æš´éœ²åˆ™ä¸éœ€è¦é‡å¤æš´éœ² </span><br><span class="line">            this.exported = true;</span><br><span class="line">            ...</span><br><span class="line">            ...</span><br><span class="line">            ... çœç•¥è·å–æ³¨å†Œä¸­å¿ƒurlã€éå†æ‰€æœ‰protocolã€éå†æ‰€æœ‰æ³¨å†Œä¸­å¿ƒã€ç»™æ³¨å†Œä¸­å¿ƒè®¾ç½®ç›‘æ§urlã€</span><br><span class="line"></span><br><span class="line">                this.checkApplication();</span><br><span class="line">                this.checkRegistry();</span><br><span class="line">                this.checkProtocol();</span><br><span class="line">                appendProperties(this);</span><br><span class="line">                this.checkStubAndMock(this.interfaceClass);</span><br><span class="line">                if(this.path == null || this.path.length() == 0) &#123;</span><br><span class="line">                    this.path = this.interfaceName;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                this.doExportUrls();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                throw new IllegalStateException(&quot;&lt;dubbo:service interface=\&quot;\&quot; /&gt; interface not allow null!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é‡Œé¢åšäº†å¾ˆå¤šé€»è¾‘åˆ¤æ–­ï¼Œä½†æœ€åè¿˜æ˜¯è°ƒç”¨äº†doExportæ–¹æ³•ï¼ŒdoExportåšäº†å¾ˆå¤šé…ç½®ä¸Šæ£€æŸ¥ä»£ç æ¯”è¾ƒé•¿ä¹Ÿéé‡ç‚¹å°±ä¸è´´å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥å»æŸ¥çœ‹ç›¸å…³æºç ã€‚é‡Œé¢è°ƒç”¨doExportUrlsæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private void doExportUrls() &#123;</span><br><span class="line">        List&lt;URL&gt; registryURLs = this.loadRegistries(true);// </span><br><span class="line">        Iterator var2 = this.protocols.iterator();</span><br><span class="line"></span><br><span class="line">        while(var2.hasNext()) &#123;</span><br><span class="line">            ProtocolConfig protocolConfig = (ProtocolConfig)var2.next();</span><br><span class="line">            this.doExportUrlsFor1Protocol(protocolConfig, registryURLs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>loadRegistriesæ–¹æ³•è¿”å›çš„æ˜¯ä¸¤ä¸ªURL,è¿”å›æ³¨å†Œä¸­å¿ƒçš„urlï¼Œä¾‹å¦‚zkçš„urlï¼Œ<code>registry://192.168.14.46:2181/com.alibaba.dubbo.registry.RegistryService?application=demo-provider&amp;dubbo=2.0.0&amp;pid=524&amp;registry=zookeeperÃ—tamp=1498806201853</code></p><p>ä»URLå¯ä»¥çœ‹å‡ºï¼Œdubboå°†æˆ‘ä»¬è®¾ç½®çš„æ³¨å†Œæ ‡ç­¾æ•°æ®å…¨éƒ¨è½¬æ¢URLçš„å½¢å¼ï¼Œæ‰€æœ‰çš„é…ç½®å‚æ•°å‡è·Ÿç€URLåé¢ã€‚è€Œé›†åˆprotocolså±æ€§é‡Œé¢å­˜å‚¨äº†æˆ‘ä»¬é…ç½®çš„åè®®æ•°æ®ã€‚åè®®å¯ä»¥é…ç½®å¤šä¸ªç§ç±»ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨è¿™ä¸ªå¾ªç¯å°†å½“å‰è¿™ä¸ªæœåŠ¡ä»¥æŸç§åè®®åœ¨å¤šä¸ªæ³¨å†Œæœºä¸Šè¿›è¡Œå‘å¸ƒã€‚ä½†æ˜¯æˆ‘æ²¡çœ‹æ‡‚é›†åˆprotocolså¯¹è±¡æ˜¯ä»å“ªé‡Œæ³¨å…¥çš„æ•°æ®ï¼Œç»†èŠ‚çš„æˆ‘å°±æ‡’å¾—ç®¡å•¦ï¼ç»§ç»­å¾€doExportUrlsFor1Protocolæ–¹æ³•ä¸­æŸ¥çœ‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private void doExportUrlsFor1Protocol(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs) &#123;  </span><br><span class="line">        String name = protocolConfig.getName();  </span><br><span class="line">        if (name == null || name.length() == 0) &#123;  </span><br><span class="line">            name = &quot;dubbo&quot;;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        String host = protocolConfig.getHost();  </span><br><span class="line">        if (provider != null &amp;&amp; (host == null || host.length() == 0)) &#123;  </span><br><span class="line">            host = provider.getHost();  </span><br><span class="line">        &#125;  </span><br><span class="line">        boolean anyhost = false;  </span><br><span class="line">        if (NetUtils.isInvalidLocalHost(host)) &#123;  </span><br><span class="line">            anyhost = true;  </span><br><span class="line">            try &#123;  </span><br><span class="line">                host = InetAddress.getLocalHost().getHostAddress();  </span><br><span class="line">            &#125; catch (UnknownHostException e) &#123;  </span><br><span class="line">                logger.warn(e.getMessage(), e);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if (NetUtils.isInvalidLocalHost(host)) &#123;  </span><br><span class="line">                if (registryURLs != null &amp;&amp; registryURLs.size() &gt; 0) &#123;  </span><br><span class="line">                    for (URL registryURL : registryURLs) &#123;  </span><br><span class="line">                        try &#123;  </span><br><span class="line">                            Socket socket = new Socket();  </span><br><span class="line">                            try &#123;  </span><br><span class="line">                                SocketAddress addr = new InetSocketAddress(registryURL.getHost(), registryURL.getPort());  </span><br><span class="line">                                socket.connect(addr, 1000);  </span><br><span class="line">                                host = socket.getLocalAddress().getHostAddress();  </span><br><span class="line">                                break;  </span><br><span class="line">                            &#125; finally &#123;  </span><br><span class="line">                                try &#123;  </span><br><span class="line">                                    socket.close();  </span><br><span class="line">                                &#125; catch (Throwable e) &#123;&#125;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125; catch (Exception e) &#123;  </span><br><span class="line">                            logger.warn(e.getMessage(), e);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                if (NetUtils.isInvalidLocalHost(host)) &#123;  </span><br><span class="line">                    host = NetUtils.getLocalHost();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        Integer port = protocolConfig.getPort();  </span><br><span class="line">        if (provider != null &amp;&amp; (port == null || port == 0)) &#123;  </span><br><span class="line">            port = provider.getPort();  </span><br><span class="line">        &#125;  </span><br><span class="line">        //è·å–åè®®é»˜è®¤çš„ç«¯å£å·  </span><br><span class="line">        final int defaultPort = ExtensionLoader.getExtensionLoader(Protocol.class).getExtension(name).getDefaultPort();  </span><br><span class="line">        if (port == null || port == 0) &#123;  </span><br><span class="line">            port = defaultPort;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if (port == null || port &lt;= 0) &#123;  </span><br><span class="line">            port = getRandomPort(name);//éšæœºç”Ÿæˆç«¯å£  </span><br><span class="line">            if (port == null || port &lt; 0) &#123;  </span><br><span class="line">                port = NetUtils.getAvailablePort(defaultPort);  </span><br><span class="line">                putRandomPort(name, port);  </span><br><span class="line">            &#125;  </span><br><span class="line">            logger.warn(&quot;Use random available port(&quot; + port + &quot;) for protocol &quot; + name);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();  </span><br><span class="line">        if (anyhost) &#123;  </span><br><span class="line">            map.put(Constants.ANYHOST_KEY, &quot;true&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">        map.put(Constants.SIDE_KEY, Constants.PROVIDER_SIDE);  </span><br><span class="line">        map.put(Constants.DUBBO_VERSION_KEY, Version.getVersion());  </span><br><span class="line">        map.put(Constants.TIMESTAMP_KEY, String.valueOf(System.currentTimeMillis()));  </span><br><span class="line">        if (ConfigUtils.getPid() &gt; 0) &#123;  </span><br><span class="line">            map.put(Constants.PID_KEY, String.valueOf(ConfigUtils.getPid()));  </span><br><span class="line">        &#125;  </span><br><span class="line">        appendParameters(map, application);  </span><br><span class="line">        appendParameters(map, module);  </span><br><span class="line">        appendParameters(map, provider, Constants.DEFAULT_KEY);  </span><br><span class="line">        appendParameters(map, protocolConfig);  </span><br><span class="line">        appendParameters(map, this);  </span><br><span class="line">        if (methods != null &amp;&amp; methods.size() &gt; 0) &#123;  </span><br><span class="line">            for (MethodConfig method : methods) &#123;  </span><br><span class="line">                appendParameters(map, method, method.getName());  </span><br><span class="line">                String retryKey = method.getName() + &quot;.retry&quot;;  </span><br><span class="line">                if (map.containsKey(retryKey)) &#123;  </span><br><span class="line">                    String retryValue = map.remove(retryKey);  </span><br><span class="line">                    if (&quot;false&quot;.equals(retryValue)) &#123;  </span><br><span class="line">                        map.put(method.getName() + &quot;.retries&quot;, &quot;0&quot;);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                List&lt;ArgumentConfig&gt; arguments = method.getArguments();  </span><br><span class="line">                if (arguments != null &amp;&amp; arguments.size() &gt; 0) &#123;  </span><br><span class="line">                    for (ArgumentConfig argument : arguments) &#123;  </span><br><span class="line">                        //ç±»å‹è‡ªåŠ¨è½¬æ¢.  </span><br><span class="line">                        if(argument.getType() != null &amp;&amp; argument.getType().length() &gt;0)&#123;  </span><br><span class="line">                            Method[] methods = interfaceClass.getMethods();  </span><br><span class="line">                            //éå†æ‰€æœ‰æ–¹æ³•  </span><br><span class="line">                            if(methods != null &amp;&amp; methods.length &gt; 0)&#123;  </span><br><span class="line">                                for (int i = 0; i &lt; methods.length; i++) &#123;  </span><br><span class="line">                                    String methodName = methods[i].getName();  </span><br><span class="line">                                    //åŒ¹é…æ–¹æ³•åç§°ï¼Œè·å–æ–¹æ³•ç­¾å.  </span><br><span class="line">                                    if(methodName.equals(method.getName()))&#123;  </span><br><span class="line">                                        Class&lt;?&gt;[] argtypes = methods[i].getParameterTypes();  </span><br><span class="line">                                        //ä¸€ä¸ªæ–¹æ³•ä¸­å•ä¸ªcallback  </span><br><span class="line">                                        if (argument.getIndex() != -1 )&#123;  </span><br><span class="line">                                            if (argtypes[argument.getIndex()].getName().equals(argument.getType()))&#123;  </span><br><span class="line">                                                appendParameters(map, argument, method.getName() + &quot;.&quot; + argument.getIndex());  </span><br><span class="line">                                            &#125;else &#123;  </span><br><span class="line">                                                throw new IllegalArgumentException(&quot;argument config error : the index attribute and type attirbute not match :index :&quot;+argument.getIndex() + &quot;, type:&quot; + argument.getType());  </span><br><span class="line">                                            &#125;  </span><br><span class="line">                                        &#125; else &#123;  </span><br><span class="line">                                            //ä¸€ä¸ªæ–¹æ³•ä¸­å¤šä¸ªcallback  </span><br><span class="line">                                            for (int j = 0 ;j&lt;argtypes.length ;j++) &#123;  </span><br><span class="line">                                                Class&lt;?&gt; argclazz = argtypes[j];  </span><br><span class="line">                                                if (argclazz.getName().equals(argument.getType()))&#123;  </span><br><span class="line">                                                    appendParameters(map, argument, method.getName() + &quot;.&quot; + j);  </span><br><span class="line">                                                    if (argument.getIndex() != -1 &amp;&amp; argument.getIndex() != j)&#123;  </span><br><span class="line">                                                        throw new IllegalArgumentException(&quot;argument config error : the index attribute and type attirbute not match :index :&quot;+argument.getIndex() + &quot;, type:&quot; + argument.getType());  </span><br><span class="line">                                                    &#125;  </span><br><span class="line">                                                &#125;  </span><br><span class="line">                                            &#125;  </span><br><span class="line">                                        &#125;  </span><br><span class="line">                                    &#125;  </span><br><span class="line">                                &#125;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;else if(argument.getIndex() != -1)&#123;  </span><br><span class="line">                            appendParameters(map, argument, method.getName() + &quot;.&quot; + argument.getIndex());  </span><br><span class="line">                        &#125;else &#123;  </span><br><span class="line">                            throw new IllegalArgumentException(&quot;argument config must set index or type attribute.eg: &lt;dubbo:argument index=&apos;0&apos; .../&gt; or &lt;dubbo:argument type=xxx .../&gt;&quot;);  </span><br><span class="line">                        &#125;  </span><br><span class="line">  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; // end of methods for  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        if (ProtocolUtils.isGeneric(generic)) &#123;  </span><br><span class="line">            map.put(&quot;generic&quot;, generic);  </span><br><span class="line">            map.put(&quot;methods&quot;, Constants.ANY_VALUE);  </span><br><span class="line">        &#125; else &#123;  </span><br><span class="line">            String revision = Version.getVersion(interfaceClass, version);  </span><br><span class="line">            if (revision != null &amp;&amp; revision.length() &gt; 0) &#123;  </span><br><span class="line">                map.put(&quot;revision&quot;, revision);  </span><br><span class="line">            &#125;  </span><br><span class="line">            //æ ¹æ®æœåŠ¡å®ç°çš„æ¥å£è·å–ç›¸å…³æœåŠ¡æ–¹æ³•  </span><br><span class="line">            String[] methods = Wrapper.getWrapper(interfaceClass).getMethodNames();  </span><br><span class="line">            if(methods.length == 0) &#123;  </span><br><span class="line">                logger.warn(&quot;NO method found in service interface &quot; + interfaceClass.getName());  </span><br><span class="line">                map.put(&quot;methods&quot;, Constants.ANY_VALUE);  </span><br><span class="line">            &#125;  </span><br><span class="line">            else &#123;  </span><br><span class="line">                map.put(&quot;methods&quot;, StringUtils.join(new HashSet&lt;String&gt;(Arrays.asList(methods)), &quot;,&quot;));  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if (! ConfigUtils.isEmpty(token)) &#123;  </span><br><span class="line">            if (ConfigUtils.isDefault(token)) &#123;  </span><br><span class="line">                map.put(&quot;token&quot;, UUID.randomUUID().toString());  </span><br><span class="line">            &#125; else &#123;  </span><br><span class="line">                map.put(&quot;token&quot;, token);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if (&quot;injvm&quot;.equals(protocolConfig.getName())) &#123;  </span><br><span class="line">            protocolConfig.setRegister(false);  </span><br><span class="line">            map.put(&quot;notify&quot;, &quot;false&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">        // å¯¼å‡ºæœåŠ¡  </span><br><span class="line">        String contextPath = protocolConfig.getContextpath();  </span><br><span class="line">        if ((contextPath == null || contextPath.length() == 0) &amp;&amp; provider != null) &#123;  </span><br><span class="line">            contextPath = provider.getContextpath();  </span><br><span class="line">        &#125;  </span><br><span class="line">        //æ ¹æ®Mapä¸­å­˜å‚¨çš„å±æ€§ç»„è£…URLåœ°å€  </span><br><span class="line">        URL url = new URL(name, host, port, (contextPath == null || contextPath.length() == 0 ? &quot;&quot; : contextPath + &quot;/&quot;) + path, map);  </span><br><span class="line">  </span><br><span class="line">        if (ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)  </span><br><span class="line">                .hasExtension(url.getProtocol())) &#123;  </span><br><span class="line">            url = ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)  </span><br><span class="line">                    .getExtension(url.getProtocol()).getConfigurator(url).configure(url);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        String scope = url.getParameter(Constants.SCOPE_KEY);  </span><br><span class="line">        //é…ç½®ä¸ºnoneä¸æš´éœ²  </span><br><span class="line">        if (! Constants.SCOPE_NONE.toString().equalsIgnoreCase(scope)) &#123;  </span><br><span class="line">  </span><br><span class="line">            //é…ç½®ä¸æ˜¯remoteçš„æƒ…å†µä¸‹åšæœ¬åœ°æš´éœ² (é…ç½®ä¸ºremoteï¼Œåˆ™è¡¨ç¤ºåªæš´éœ²è¿œç¨‹æœåŠ¡)  </span><br><span class="line">            if (!Constants.SCOPE_REMOTE.toString().equalsIgnoreCase(scope)) &#123;  </span><br><span class="line">                exportLocal(url);  </span><br><span class="line">            &#125;  </span><br><span class="line">            //å¦‚æœé…ç½®ä¸æ˜¯localåˆ™æš´éœ²ä¸ºè¿œç¨‹æœåŠ¡.(é…ç½®ä¸ºlocalï¼Œåˆ™è¡¨ç¤ºåªæš´éœ²è¿œç¨‹æœåŠ¡)  </span><br><span class="line">            if (! Constants.SCOPE_LOCAL.toString().equalsIgnoreCase(scope) )&#123;  </span><br><span class="line">                if (logger.isInfoEnabled()) &#123;  </span><br><span class="line">                    logger.info(&quot;Export dubbo service &quot; + interfaceClass.getName() + &quot; to url &quot; + url);  </span><br><span class="line">                &#125;  </span><br><span class="line">                if (registryURLs != null &amp;&amp; registryURLs.size() &gt; 0  </span><br><span class="line">                        &amp;&amp; url.getParameter(&quot;register&quot;, true)) &#123;  </span><br><span class="line">                    for (URL registryURL : registryURLs) &#123;  </span><br><span class="line">                        url = url.addParameterIfAbsent(&quot;dynamic&quot;, registryURL.getParameter(&quot;dynamic&quot;));  </span><br><span class="line">                        URL monitorUrl = loadMonitor(registryURL);  </span><br><span class="line">                        if (monitorUrl != null) &#123;  </span><br><span class="line">                            url = url.addParameterAndEncoded(Constants.MONITOR_KEY, monitorUrl.toFullString());  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        if (logger.isInfoEnabled()) &#123;  </span><br><span class="line">                            logger.info(&quot;Register dubbo service &quot; + interfaceClass.getName() + &quot; url &quot; + url + &quot; to registry &quot; + registryURL);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        //é€šè¿‡proxyFactoryå¯¹è±¡ç”Ÿæˆæ¥å£å®ç°ç±»ä»£ç†å¯¹è±¡Invoker  </span><br><span class="line">                        Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, registryURL.addParameterAndEncoded(Constants.EXPORT_KEY, url.toFullString()));  </span><br><span class="line">                        //å°†Invokerå¯¹è±¡å°è£…åˆ°protocolåè®®å¯¹è±¡ä¸­ï¼ŒåŒæ—¶å¼€å¯socketæœåŠ¡ç›‘å¬ç«¯å£ï¼Œè¿™é‡Œsocketé€šä¿¡æ˜¯ä½¿ç”¨nettyæ¡†æ¶æ¥å¤„ç†çš„  </span><br><span class="line">                        Exporter&lt;?&gt; exporter = protocol.export(invoker);  </span><br><span class="line">                        //æ·»åŠ å¯¹è±¡åˆ°é›†åˆ  </span><br><span class="line">                        exporters.add(exporter);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; else &#123;  </span><br><span class="line">                    Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, url);  </span><br><span class="line">  </span><br><span class="line">                    Exporter&lt;?&gt; exporter = protocol.export(invoker);  </span><br><span class="line">                    exporters.add(exporter);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        this.urls.add(url);  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>doExportUrlsFor1Protocolæ–¹æ³•ä¸­ä¸»è¦åšäº†å‡ ä»¶äº‹</p><p>1.æ ¹æ®xmlä¸­dubboæ ‡ç­¾é…ç½®ç»„è£…dubboåè®®URLï¼Œå¦‚æœæ²¡æœ‰é…ç½®ä»»ä½•åè®®ï¼Œé»˜è®¤ä½¿ç”¨äº†dubboåè®®ã€‚æ¯”å¦‚è¿™é‡Œç»„è£…åç«¯URL<br><code>dubbo://192.168.14.46:20880/com.service.interfaces.DubboService?anyhost=true&amp;application=demo-provider&amp;dubbo=2.5.3&amp;interface=com.service.interfaces.DubboService&amp;methods=sayName,sayHello&amp;pid=6844&amp;revision=1.0-SNAPSHOT&amp;side=provider&amp;timestamp=1502851260474</code><br>ç»†çœ‹è¿™é‡Œç»„è£…çš„URLé‡Œé¢æºå¸¦äº†å‘å¸ƒä¸€ä¸ªæ¥å£æœåŠ¡æ‰€æœ‰ç›¸å…³çš„å‚æ•°ï¼ŒåŒ…æ‹¬æ¥å£å…¨é™å®šåï¼Œæ¥å£ç›¸å…³æ–¹æ³•åç§°ï¼Œç‰ˆæœ¬å·ï¼Œæ¨¡å—åç§°</p><p>2.é€šä¿¡åè®®æœªæŒ‡æ˜ç«¯å£æ—¶ï¼Œéšæœºç”Ÿæˆç«¯å£å·</p><p>3.é€šè¿‡proxyFactoryå¯¹è±¡ç”Ÿæˆæ¥å£å®ç°ç±»çš„ä»£ç†å¯¹è±¡invoker</p><p>4.é€šè¿‡protocolå¯¹è±¡å°†invokerå°è£…æˆExporterå¯¹è±¡ï¼ŒåŒæ—¶å¼€å¯äº†socketæœåŠ¡ç›‘å¬ç«¯å£ã€‚è¿™é‡Œsocketé€šä¿¡ä½¿ç”¨çš„æ˜¯nettyæ¡†æ¶ï¼Œ</p><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="http://blog.csdn.net/qiangcai/article/details/73992080" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ENUM æšä¸¾ç±»</title>
      <link href="/2018/02/04/java/2018-02-04-ENUM/"/>
      <url>/2018/02/04/java/2018-02-04-ENUM/</url>
      
        <content type="html"><![CDATA[<p>æšä¸¾ï¼ˆEnumsï¼‰<br>JDK1.5åŠ å…¥äº†ä¸€ä¸ªå…¨æ–°çš„ç±»å‹çš„â€œç±»â€â€“ æšä¸¾ç±»å‹ã€‚ä¸ºæ­¤JDK1.5å¼•å…¥äº†ä¸€ä¸ªæ–°å…³é”®å­—enumã€‚</p><p>å®šä¹‰æšä¸¾ç±»å‹æ—¶æœ¬è´¨ä¸Šå°±æ˜¯å®šä¹‰ä¸€ä¸ªç±»åˆ«ï¼Œåªä¸è¿‡å¾ˆå¤šç»†èŠ‚ç”±ç¼–è¯‘å™¨å¸®æ‚¨å®Œæˆäº†ï¼Œæ‰€ä»¥æŸç§ç¨‹åº¦ä¸Šï¼Œenumå…³é”®å­—çš„ä½œç”¨å°±åƒæ˜¯classæˆ–interfaceã€‚</p><p>å½“æ‚¨ä½¿ç”¨â€œenumâ€å®šä¹‰æšä¸¾ç±»å‹æ—¶ï¼Œå®è´¨ä¸Šæ‚¨å®šä¹‰å‡ºæ¥çš„ç±»å‹ç»§æ‰¿è‡ªjava.lang.Enumç±»å‹ï¼Œè€Œæ¯ä¸ªæšä¸¾çš„æˆå‘˜å…¶å®å°±æ˜¯æ‚¨å®šä¹‰çš„æšä¸¾ç±»å‹çš„ä¸€ä¸ªå®ä¾‹ï¼ˆInstanceï¼‰ï¼Œå®ƒä»¬éƒ½è¢«é¢„è®¾ä¸ºfinalï¼Œæ‰€ä»¥æ‚¨æ— æ³•æ”¹å˜å®ƒä»¬ï¼Œå®ƒä»¬ä¹Ÿæ˜¯staticæˆå‘˜ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥é€šè¿‡ç±»å‹åç§°ç›´æ¥ä½¿ç”¨å®ƒä»¬ï¼Œå½“ç„¶æœ€é‡è¦çš„å®ƒä»¬éƒ½æ˜¯å…¬å¼€çš„publicã€‚æ¢å¥è¯è¯´ï¼Œå½“å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹åï¼Œåœ¨ç¼–è¯‘æ—¶åˆ»å°±èƒ½ç¡®å®šè¯¥æšä¸¾ç±»å‹æœ‰å‡ ä¸ªå®ä¾‹ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆã€‚åœ¨è¿è¡ŒæœŸé—´æˆ‘ä»¬æ— æ³•å†ä½¿ç”¨è¯¥æšä¸¾ç±»å‹åˆ›å»ºæ–°çš„å®ä¾‹äº†ï¼Œè¿™äº›å®ä¾‹åœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»å®Œå…¨ç¡®å®šä¸‹æ¥äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public enum Coin &#123;    </span><br><span class="line">    penny(&quot;PENNY&quot;), nickel(&quot;NICKEL&quot;), dime(&quot;DIME&quot;), quarter(&quot;QUARTER&quot;);</span><br><span class="line">    private String value;</span><br><span class="line">    Coin(String value)&#123;        this.value = value;    &#125;        </span><br><span class="line">    public String getValue()&#123;        return value;    &#125;        </span><br><span class="line">    public static void main(String[] args)&#123;        </span><br><span class="line">        Coin coin = Coin.nickel;        </span><br><span class="line">        System.out.println(coin.getValue());    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æšä¸¾çš„æ„é€ å‡½æ•°å®šä¹‰ Coin(String value)å’Œpenny(â€œPENNYâ€)æ˜¯å¯¹åº”çš„ï¼›<br>æšä¸¾ä¸­ä¹Ÿå¯ä»¥å®šä¹‰å˜é‡ã€æ–¹æ³•ï¼Œè¿˜å¯ä»¥å®šä¹‰mainæ–¹æ³•ã€‚</p><p><a href="http://blog.csdn.net/zlfprogram/article/details/74066800" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HashMapæºç è§£æï¼ˆ1.8ç‰ˆæœ¬ï¼‰</title>
      <link href="/2018/01/26/java/2018-03-30-HashMap/"/>
      <url>/2018/01/26/java/2018-03-30-HashMap/</url>
      
        <content type="html"><![CDATA[<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><h2 id="åˆå§‹åŒ–HashMap"><a href="#åˆå§‹åŒ–HashMap" class="headerlink" title="åˆå§‹åŒ–HashMap"></a>åˆå§‹åŒ–HashMap</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public HashMap(int initialCapacity, float loadFactor) &#123;</span><br><span class="line">    ...</span><br><span class="line">    this.threshold = tableSizeFor(initialCapacity);// è·å–tableSizeï¼Œç”±äºHashMapçš„å®¹é‡æ˜¯2çš„å¹‚ï¼Œæ‰€ä»¥å½“ä¼ å…¥çš„initialCapacityä¸æ˜¯2çš„å¹‚æ—¶ï¼Œè®¡ç®—ä¸€ä¸ªå¤§äºä¸”æœ€é è¿‘initialCapacityçš„2çš„å¹‚ã€‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">public HashMap(int initialCapacity) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ— å‚æ•°æ„é€ å™¨ï¼Œé»˜è®¤è´Ÿè½½å› å­0.75</span><br><span class="line">public HashMap() &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">public HashMap(Map&lt;? extends K, ? extends V&gt; m) &#123;</span><br><span class="line">    this.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">    putMapEntries(m, false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HashMapæä¾›äº†4ä¸ªæ„é€ æ–¹æ³•ï¼Œå‰ä¸¤ä¸ªæ„é€ æ–¹æ³•éƒ½æ˜¯æŒ‡å®šåˆå§‹åŒ–å®¹é‡å¤§å°ã€‚å®¹é‡å¤§å°ä¸ºtableSizeFor(initialCapacity)ã€‚æ— å‚æ•°æ„é€ å™¨ä½¿ç”¨é»˜è®¤çš„capå’Œfactorï¼Œåœ¨ç¬¬ä¸€æ¬¡putæ—¶åˆå§‹åŒ–ã€‚ç¬¬å››ä¸ªæ„é€ å™¨ä¼ å…¥çš„æ˜¯Map,å®¹é‡å¤§å°ä¸ºå¤§äºä¸”æœ€é è¿‘ m.size()/Default_load_factor + 1F è¿™ä¸ªæ•°çš„2çš„å¹‚ã€‚</p><h2 id="HashMapçš„putæ“ä½œ"><a href="#HashMapçš„putæ“ä½œ" class="headerlink" title="HashMapçš„putæ“ä½œ"></a>HashMapçš„putæ“ä½œ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// hashcode å€¼ä¸º32bit </span><br><span class="line"></span><br><span class="line">public V put(K key, V value) &#123;</span><br><span class="line">        return putVal(hash(key), key, value, false, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static final int hash(Object key) &#123;</span><br><span class="line">    int h;</span><br><span class="line">    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);// é¦–å…ˆkey.hashCodeè®¡ç®—å‡º32ä½hashå€¼ï¼Œç„¶åå’Œhashå€¼çš„å16ä½ï¼ˆh&gt;&gt;&gt;16ï¼‰å¼‚æˆ–ï¼Œæœ€åå¾—åˆ°16ä½hashå€¼ï¼Œä¸”ä¿ç•™äº†é«˜ä½ä¿¡æ¯ï¼Œå¢å¼ºäº†éšæœºæ€§ã€‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final V putVal(int hash, K key, V value, boolean onlyIfAbsent,</span><br><span class="line">                   boolean evict) &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;</span><br><span class="line">    if ((tab = table) == null || (n = tab.length) == 0)</span><br><span class="line">        n = (tab = resize()).length;// resize() å¤§å°ä¸ºæ—§è¡¨çš„2å€ï¼Œå› æ­¤nä¸º2çš„xæ¬¡å¹‚ï¼Œxå¤§å°å’Œè¡¨çš„å¤§å°ç›¸å…³</span><br><span class="line">    if ((p = tab[i = (n - 1) &amp; hash]) == null)// åˆ¤æ–­tableä¸­hashåŒ¹é…çš„ä½ç½®ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºnull,å¦‚æœä¸ºnullï¼Œåˆ™æ’å…¥å½“å‰å€¼ã€‚è·å–å½“å‰æ•°æ®è¦æ’å…¥çš„ä½ç½®ï¼ˆn-1ï¼‰&amp; hash,å¹¶åˆ¤æ–­è¿™ä¸ªä½ç½®çš„å€¼æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™æ’å…¥ã€‚åˆå§‹åŒ–hashè¡¨å¤§å°ä¸º16ï¼Œ16ä½çš„hashä¸ å½“å‰æ•°ç»„å¤§å°ä¸ï¼ˆ&amp;ï¼‰è¿ç®—å¾—åˆ°4ä½çš„2è¿›åˆ¶æ•´æ•°ã€‚åˆ¤æ–­NodeèŠ‚ç‚¹æ˜¯å¦ç©ºï¼Œä¸ºç©ºå»ºç«‹NodeèŠ‚ç‚¹ã€‚</span><br><span class="line">        tab[i] = newNode(hash, key, value, null);</span><br><span class="line">    else &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        if (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))// åˆ¤æ–­hashå’Œkeyæ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™e=p;</span><br><span class="line">            e = p;</span><br><span class="line">        else if (p instanceof TreeNode)// å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œç›´æ¥æ’å…¥</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);</span><br><span class="line">        else &#123;// ä¸æ˜¯æ ‘èŠ‚ç‚¹ï¼Œéå†åˆ°æœ€åï¼Œç„¶åæ’å…¥ã€‚å¦‚æœéå†è¿‡ç¨‹ä¸­æœ‰hashå’Œkeyç›¸åŒï¼Œåˆ™è·³å‡ºå¾ªç¯ã€‚å¦‚æœæ’å…¥åé“¾è¡¨é•¿åº¦å¤§äºTREEIFY_THRESHOLDï¼ˆé“¾è¡¨æœ€å¤§å®¹é‡ï¼Œå¦‚æœé‡è¡¨é•¿åº¦å¤§äºè¿™ä¸ªå€¼ï¼Œåˆ™ä½¿ç”¨çº¢é»‘æ ‘æ¥ä»£æ›¿é“¾è¡¨ï¼Œæé«˜æ€§èƒ½ï¼‰</span><br><span class="line">            for (int binCount = 0; ; ++binCount) &#123;</span><br><span class="line">                if ((e = p.next) == null) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, null);</span><br><span class="line">                    if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st </span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                if (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">                    break;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (e != null) &#123; // æ›¿æ¢keyç›¸åŒçš„mapå€¼ï¼Œç„¶åè¿”å›è€çš„å€¼ã€‚</span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            if (!onlyIfAbsent || oldValue == null)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);// æä¾›æ¥å£ç»™LinkedHashMapä½¿ç”¨ï¼Œç”¨äºLRUã€‚</span><br><span class="line">            return oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    if (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HashMap-çš„getæ“ä½œ"><a href="#HashMap-çš„getæ“ä½œ" class="headerlink" title="HashMap çš„getæ“ä½œ"></a>HashMap çš„getæ“ä½œ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">final Node&lt;K,V&gt; getNode(int hash, Object key) &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;</span><br><span class="line">    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;</span><br><span class="line">        (first = tab[(n - 1) &amp; hash]) != null) &#123;// æ ¹æ®hash ä¸è¿ç®—è·å¾—tableçš„ç´¢å¼•ä½ç½®</span><br><span class="line">        if (first.hash == hash &amp;&amp; // always check first node  // åˆ¤æ–­ç¬¬ä¸€ä¸ªæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¾“å‡ºï¼Œå¦åˆ™ç»§ç»­</span><br><span class="line">            ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">            return first;</span><br><span class="line">        if ((e = first.next) != null) &#123;// ç»§ç»­å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œåˆ™ä½¿ç”¨getTreeNodeæŸ¥è¯¢ï¼Œå¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†æŸ¥è¯¢</span><br><span class="line">            if (first instanceof TreeNode)</span><br><span class="line">                return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            do &#123;</span><br><span class="line">                if (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">                    return e;</span><br><span class="line">            &#125; while ((e = e.next) != null);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HashMap-çš„æ‰©å®¹æ“ä½œ"><a href="#HashMap-çš„æ‰©å®¹æ“ä½œ" class="headerlink" title="HashMap çš„æ‰©å®¹æ“ä½œ"></a>HashMap çš„æ‰©å®¹æ“ä½œ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">final Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    int oldCap = (oldTab == null) ? 0 : oldTab.length;// è€çš„hashmapçš„å®¹é‡</span><br><span class="line">    int oldThr = threshold;// è€çš„hashmap æ˜¯å¦éœ€è¦æ‰©å®¹çš„çš„å®¹é‡æ ‡å¿—</span><br><span class="line">    int newCap, newThr = 0;</span><br><span class="line">    if (oldCap &gt; 0) &#123; //å¦‚æœå¤§äº0ä¸”å¤§äºæœ€å¤§å…è®¸å®¹é‡ï¼Œåˆ™è¿”å›æœ€å¤§å…è®¸å®¹é‡ï¼Œå¦åˆ™*2è¿”å›ã€‚</span><br><span class="line">        if (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            return oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; 1; // double threshold</span><br><span class="line">    &#125;</span><br><span class="line">    else if (oldThr &gt; 0) // å¦‚æœè€çš„hashmapå®¹é‡å€¼&lt;0ä¸”å®¹é‡æ ‡å¿—å¤§äº0ï¼Œåˆ™æ–°å®¹é‡ä¸ºå¤§äºä¸”æœ€æ¥è¿‘newCapçš„2çš„å¹‚ã€‚</span><br><span class="line">        newCap = oldThr;// è¿™é‡Œæœªè®¡ç®—2çš„å¹‚ï¼Œåªæ˜¯èµ‹å€¼ã€‚</span><br><span class="line">    else &#123;               // zero initial threshold signifies using defaults</span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    if (newThr == 0) &#123;</span><br><span class="line">        float ft = (float)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (int)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    if (oldTab != null) &#123;</span><br><span class="line">        for (int j = 0; j &lt; oldCap; ++j) &#123;// éå†æ¡¶</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            if ((e = oldTab[j]) != null) &#123;</span><br><span class="line">                oldTab[j] = null;</span><br><span class="line">                if (e.next == null)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - 1)] = e;</span><br><span class="line">                else if (e instanceof TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);</span><br><span class="line">                else &#123; // preserve order</span><br><span class="line">                    Node&lt;K,V&gt; loHead = null, loTail = null;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = null, hiTail = null;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    do &#123;// éå†é€†åº</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        if ((e.hash &amp; oldCap) == 0) &#123;</span><br><span class="line">                            if (loTail == null)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            else</span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        else &#123;</span><br><span class="line">                            if (hiTail == null)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            else</span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; while ((e = next) != null);</span><br><span class="line">                    if (loTail != null) &#123;</span><br><span class="line">                        loTail.next = null;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (hiTail != null) &#123;</span><br><span class="line">                        hiTail.next = null;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ConcurrentHashMap1.8æºç è§£æ</title>
      <link href="/2018/01/26/java/2018-01-26-ConcurrentHashMap/"/>
      <url>/2018/01/26/java/2018-01-26-ConcurrentHashMap/</url>
      
        <content type="html"><![CDATA[<h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p>é‡‡ç”¨Node + CAS + Synchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨è¿›è¡Œå®ç°ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/styles/images/article/concurrenthashmap1.8.png?raw=true" alt="1.8"></p><p>åªæœ‰åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡putæ–¹æ³•æ—¶æ‰ä¼šè°ƒç”¨initTable()åˆå§‹åŒ–Nodeæ•°ç»„ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private final Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; int sc;</span><br><span class="line">    while ((tab = table) == null || tab.length == 0) &#123;</span><br><span class="line">        if ((sc = sizeCtl) &lt; 0)</span><br><span class="line">            Thread.yield(); // lost initialization race; just spin</span><br><span class="line">        else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                if ((tab = table) == null || tab.length == 0) &#123;</span><br><span class="line">                    int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY;</span><br><span class="line">                    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n];// tableè¿˜æ˜¯NODEæ•°ç»„</span><br><span class="line">                    table = tab = nt;</span><br><span class="line">                    sc = n - (n &gt;&gt;&gt; 2);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                sizeCtl = sc;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return tab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>putå®ç°<br>å½“æ‰§è¡Œputæ–¹æ³•æ’å…¥æ•°æ®æ—¶ï¼Œæ ¹æ®keyçš„hashå€¼ï¼Œåœ¨Nodeæ•°ç»„ä¸­æ‰¾åˆ°ç›¸åº”çš„ä½ç½®ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><p>1ã€å¦‚æœç›¸åº”ä½ç½®çš„Nodeè¿˜æœªåˆå§‹åŒ–ï¼Œåˆ™é€šè¿‡CASæ’å…¥ç›¸åº”çš„æ•°æ®ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; // åˆ¤æ–­å½“å‰tableçš„hashä½ç½®æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºé€šè¿‡casç®—æ³•æ’å…¥</span><br><span class="line">    if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null)))</span><br><span class="line">        break;                   // no lock when adding to empty bin</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€å¦‚æœç›¸åº”ä½ç½®çš„Nodeä¸ä¸ºç©ºï¼Œä¸”å½“å‰è¯¥èŠ‚ç‚¹ä¸å¤„äºç§»åŠ¨çŠ¶æ€ï¼Œåˆ™å¯¹è¯¥èŠ‚ç‚¹åŠ synchronizedé”ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹çš„hashä¸å°äº0ï¼Œåˆ™éå†é“¾è¡¨æ›´æ–°èŠ‚ç‚¹æˆ–æ’å…¥æ–°èŠ‚ç‚¹ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if (fh &gt;= 0) &#123;</span><br><span class="line">    binCount = 1;</span><br><span class="line">    for (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">        K ek;</span><br><span class="line">        if (e.hash == hash &amp;&amp;</span><br><span class="line">            ((ek = e.key) == key ||</span><br><span class="line">             (ek != null &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">            oldVal = e.val;</span><br><span class="line">            if (!onlyIfAbsent)</span><br><span class="line">                e.val = value;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;K,V&gt; pred = e;</span><br><span class="line">        if ((e = e.next) == null) &#123;</span><br><span class="line">            pred.next = new Node&lt;K,V&gt;(hash, key, value, null);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯TreeBinç±»å‹çš„èŠ‚ç‚¹ï¼Œè¯´æ˜æ˜¯çº¢é»‘æ ‘ç»“æ„ï¼Œåˆ™é€šè¿‡putTreeValæ–¹æ³•å¾€çº¢é»‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">else if (f instanceof TreeBin) &#123;</span><br><span class="line">    Node&lt;K,V&gt; p;</span><br><span class="line">    binCount = 2;</span><br><span class="line">    if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) &#123;</span><br><span class="line">        oldVal = p.val;</span><br><span class="line">        if (!onlyIfAbsent)</span><br><span class="line">            p.val = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€å¦‚æœbinCountä¸ä¸º0ï¼Œè¯´æ˜putæ“ä½œå¯¹æ•°æ®äº§ç”Ÿäº†å½±å“ï¼Œå¦‚æœå½“å‰é“¾è¡¨çš„ä¸ªæ•°è¾¾åˆ°8ä¸ªï¼Œåˆ™é€šè¿‡treeifyBinæ–¹æ³•è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œå¦‚æœoldValä¸ä¸ºç©ºï¼Œè¯´æ˜æ˜¯ä¸€æ¬¡æ›´æ–°æ“ä½œï¼Œæ²¡æœ‰å¯¹å…ƒç´ ä¸ªæ•°äº§ç”Ÿå½±å“ï¼Œåˆ™ç›´æ¥è¿”å›æ—§å€¼ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if (binCount != 0) &#123;</span><br><span class="line">    if (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">        treeifyBin(tab, i);</span><br><span class="line">    if (oldVal != null)</span><br><span class="line">        return oldVal;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€å¦‚æœæ’å…¥çš„æ˜¯ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œåˆ™æ‰§è¡ŒaddCount()æ–¹æ³•å°è¯•æ›´æ–°å…ƒç´ ä¸ªæ•°baseCountï¼›</p><p>sizeå®ç°<br>1.8ä¸­ä½¿ç”¨ä¸€ä¸ªvolatileç±»å‹çš„å˜é‡baseCountè®°å½•å…ƒç´ çš„ä¸ªæ•°ï¼Œå½“æ’å…¥æ–°æ•°æ®æˆ–åˆ™åˆ é™¤æ•°æ®æ—¶ï¼Œä¼šé€šè¿‡addCount()æ–¹æ³•æ›´æ–°baseCountï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if ((as = counterCells) != null ||</span><br><span class="line">    !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x)) &#123;</span><br><span class="line">    CounterCell a; long v; int m;</span><br><span class="line">    boolean uncontended = true;</span><br><span class="line">    if (as == null || (m = as.length - 1) &lt; 0 ||</span><br><span class="line">        (a = as[ThreadLocalRandom.getProbe() &amp; m]) == null ||</span><br><span class="line">        !(uncontended =</span><br><span class="line">          U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) &#123;</span><br><span class="line">        fullAddCount(x, uncontended);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (check &lt;= 1)</span><br><span class="line">        return;</span><br><span class="line">    s = sumCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ã€åˆå§‹åŒ–æ—¶counterCellsä¸ºç©ºï¼Œåœ¨å¹¶å‘é‡å¾ˆé«˜æ—¶ï¼Œå¦‚æœå­˜åœ¨ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒCASä¿®æ”¹baseCountå€¼ï¼Œåˆ™å¤±è´¥çš„çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œæ–¹æ³•ä½“ä¸­çš„é€»è¾‘ï¼Œä½¿ç”¨CounterCellè®°å½•å…ƒç´ ä¸ªæ•°çš„å˜åŒ–ï¼›</p><p>2ã€å¦‚æœCounterCellæ•°ç»„counterCellsä¸ºç©ºï¼Œè°ƒç”¨fullAddCount()æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶æ’å…¥å¯¹åº”çš„è®°å½•æ•°ï¼Œé€šè¿‡CASè®¾ç½®cellsBusyå­—æ®µï¼Œåªæœ‰è®¾ç½®æˆåŠŸçš„çº¿ç¨‹æ‰èƒ½åˆå§‹åŒ–CounterCellæ•°ç»„ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">else if (cellsBusy == 0 &amp;&amp; counterCells == as &amp;&amp;</span><br><span class="line">         U.compareAndSwapInt(this, CELLSBUSY, 0, 1)) &#123;</span><br><span class="line">    boolean init = false;</span><br><span class="line">    try &#123;                           // Initialize table</span><br><span class="line">        if (counterCells == as) &#123;</span><br><span class="line">            CounterCell[] rs = new CounterCell[2];</span><br><span class="line">            rs[h &amp; 1] = new CounterCell(x);</span><br><span class="line">            counterCells = rs;</span><br><span class="line">            init = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        cellsBusy = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if (init)</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€å¦‚æœé€šè¿‡CASè®¾ç½®cellsBusyå­—æ®µå¤±è´¥çš„è¯ï¼Œåˆ™ç»§ç»­å°è¯•é€šè¿‡CASä¿®æ”¹baseCountå­—æ®µï¼Œå¦‚æœä¿®æ”¹baseCountå­—æ®µæˆåŠŸçš„è¯ï¼Œå°±é€€å‡ºå¾ªç¯ï¼Œå¦åˆ™ç»§ç»­å¾ªç¯æ’å…¥CounterCellå¯¹è±¡ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">else if (U.compareAndSwapLong(this, BASECOUNT, v = baseCount, v + x))</span><br><span class="line">    break;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨1.8ä¸­çš„sizeå®ç°æ¯”1.7ç®€å•å¤šï¼Œå› ä¸ºå…ƒç´ ä¸ªæ•°ä¿å­˜baseCountä¸­ï¼Œéƒ¨åˆ†å…ƒç´ çš„å˜åŒ–ä¸ªæ•°ä¿å­˜åœ¨CounterCellæ•°ç»„ä¸­ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public int size() &#123;</span><br><span class="line">    long n = sumCount();</span><br><span class="line">    return ((n &lt; 0L) ? 0 :</span><br><span class="line">            (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE :</span><br><span class="line">            (int)n);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">final long sumCount() &#123;</span><br><span class="line">    CounterCell[] as = counterCells; CounterCell a;</span><br><span class="line">    long sum = baseCount;</span><br><span class="line">    if (as != null) &#123;</span><br><span class="line">        for (int i = 0; i &lt; as.length; ++i) &#123;</span><br><span class="line">            if ((a = as[i]) != null)</span><br><span class="line">                sum += a.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç´¯åŠ baseCountå’ŒCounterCellæ•°ç»„ä¸­çš„æ•°é‡ï¼Œå³å¯å¾—åˆ°å…ƒç´ çš„æ€»ä¸ªæ•°ï¼›</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å­˜å‚¨è¿‡ç¨‹</title>
      <link href="/2018/01/25/mysql/2018-01-25-Procedures/"/>
      <url>/2018/01/25/mysql/2018-01-25-Procedures/</url>
      
        <content type="html"><![CDATA[<p>å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯ä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„SQLè¯­å¥é›†ï¼Œç»ç¼–è¯‘åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å®šå‚æ•°ï¼ˆå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹å¸¦æœ‰å‚æ•°ï¼‰æ¥è°ƒç”¨æ‰§è¡Œå®ƒã€‚å­˜å‚¨è¿‡ç¨‹æ˜¯å¯ç¼–ç¨‹çš„å‡½æ•°ï¼Œåœ¨æ•°æ®åº“ä¸­åˆ›å»ºå¹¶ä¿å­˜ï¼Œå¯ä»¥ç”±SQLè¯­å¥å’Œæ§åˆ¶ç»“æ„ç»„æˆã€‚å½“æƒ³è¦åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºæˆ–å¹³å°ä¸Šæ‰§è¡Œç›¸åŒçš„å‡½æ•°ï¼Œæˆ–è€…å°è£…ç‰¹å®šåŠŸèƒ½æ—¶ï¼Œå­˜å‚¨è¿‡ç¨‹æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ•°æ®åº“ä¸­çš„å­˜å‚¨è¿‡ç¨‹å¯ä»¥çœ‹åšæ˜¯å¯¹ç¼–ç¨‹ä¸­é¢å‘å¯¹è±¡æ–¹æ³•çš„æ¨¡æ‹Ÿï¼Œå®ƒå…è®¸æ§åˆ¶æ•°æ®çš„è®¿é—®æ–¹å¼ã€‚</p><h2 id="å­˜å‚¨è¿‡ç¨‹ä¼˜ç‚¹"><a href="#å­˜å‚¨è¿‡ç¨‹ä¼˜ç‚¹" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹ä¼˜ç‚¹"></a>å­˜å‚¨è¿‡ç¨‹ä¼˜ç‚¹</h2><ul><li><p>å¢å¼ºSQLè¯­è¨€çš„åŠŸèƒ½å’Œçµæ´»æ€§ï¼šå­˜å‚¨è¿‡ç¨‹å¯ä»¥ç”¨æ§åˆ¶è¯­å¥ç¼–å†™ï¼Œæœ‰å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œå¯ä»¥å®Œæˆå¤æ‚çš„åˆ¤æ–­å’Œè¾ƒå¤æ‚çš„è¿ç®—ã€‚</p></li><li><p>æ ‡å‡†ç»„ä»¶å¼ç¼–ç¨‹ï¼šå­˜å‚¨è¿‡ç¨‹è¢«åˆ›å»ºåï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­è¢«å¤šæ¬¡è°ƒç”¨ï¼Œè€Œä¸å¿…é‡æ–°ç¼–å†™è¯¥å­˜å‚¨è¿‡ç¨‹çš„SQLè¯­å¥ã€‚è€Œä¸”æ•°æ®åº“ä¸“ä¸šäººå‘˜å¯ä»¥éšæ—¶å¯¹å­˜å‚¨è¿‡ç¨‹è¿›è¡Œä¿®æ”¹ï¼Œå¯¹åº”ç”¨ç¨‹åºæºä»£ç æ¯«æ— å½±å“ã€‚</p></li><li><p>è¾ƒå¿«çš„æ‰§è¡Œé€Ÿåº¦ï¼šå¦‚æœæŸä¸€æ“ä½œåŒ…å«å¤§é‡çš„Transaction-SQLä»£ç æˆ–åˆ†åˆ«è¢«å¤šæ¬¡æ‰§è¡Œï¼Œé‚£ä¹ˆå­˜å‚¨è¿‡ç¨‹è¦æ¯”æ‰¹å¤„ç†çš„æ‰§è¡Œé€Ÿåº¦å¿«å¾ˆå¤šã€‚å› ä¸ºå­˜å‚¨è¿‡ç¨‹æ˜¯é¢„ç¼–è¯‘çš„ã€‚åœ¨é¦–æ¬¡è¿è¡Œä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹æ—¶æŸ¥è¯¢ï¼Œä¼˜åŒ–å™¨å¯¹å…¶è¿›è¡Œåˆ†æä¼˜åŒ–ï¼Œå¹¶ä¸”ç»™å‡ºæœ€ç»ˆè¢«å­˜å‚¨åœ¨ç³»ç»Ÿè¡¨ä¸­çš„æ‰§è¡Œè®¡åˆ’ã€‚è€Œæ‰¹å¤„ç†çš„Transaction-SQLè¯­å¥åœ¨æ¯æ¬¡è¿è¡Œæ—¶éƒ½è¦è¿›è¡Œç¼–è¯‘å’Œä¼˜åŒ–ï¼Œé€Ÿåº¦ç›¸å¯¹è¦æ…¢ä¸€äº›ã€‚</p></li><li><p>å‡å°‘ç½‘ç»œæµé‡ï¼šé’ˆå¯¹åŒä¸€ä¸ªæ•°æ®åº“å¯¹è±¡çš„æ“ä½œï¼ˆå¦‚æŸ¥è¯¢ã€ä¿®æ”¹ï¼‰ï¼Œå¦‚æœè¿™ä¸€æ“ä½œæ‰€æ¶‰åŠçš„Transaction-SQLè¯­å¥è¢«ç»„ç»‡è¿›å­˜å‚¨è¿‡ç¨‹ï¼Œé‚£ä¹ˆå½“åœ¨å®¢æˆ·è®¡ç®—æœºä¸Šè°ƒç”¨è¯¥å­˜å‚¨è¿‡ç¨‹æ—¶ï¼Œç½‘ç»œä¸­ä¼ é€çš„åªæ˜¯è¯¥è°ƒç”¨è¯­å¥ï¼Œä»è€Œå¤§å¤§å‡å°‘ç½‘ç»œæµé‡å¹¶é™ä½äº†ç½‘ç»œè´Ÿè½½ã€‚</p></li><li><p>ä½œä¸ºä¸€ç§å®‰å…¨æœºåˆ¶æ¥å……åˆ†åˆ©ç”¨ï¼šé€šè¿‡å¯¹æ‰§è¡ŒæŸä¸€å­˜å‚¨è¿‡ç¨‹çš„æƒé™è¿›è¡Œé™åˆ¶ï¼Œèƒ½å¤Ÿå®ç°å¯¹ç›¸åº”çš„æ•°æ®çš„è®¿é—®æƒé™çš„é™åˆ¶ï¼Œé¿å…äº†éæˆæƒç”¨æˆ·å¯¹æ•°æ®çš„è®¿é—®ï¼Œä¿è¯äº†æ•°æ®çš„å®‰å…¨ã€‚</p></li></ul><h2 id="MySQL-å­˜å‚¨è¿‡ç¨‹è¯­æ³•ç¤ºä¾‹"><a href="#MySQL-å­˜å‚¨è¿‡ç¨‹è¯­æ³•ç¤ºä¾‹" class="headerlink" title="MySQL å­˜å‚¨è¿‡ç¨‹è¯­æ³•ç¤ºä¾‹"></a>MySQL å­˜å‚¨è¿‡ç¨‹è¯­æ³•ç¤ºä¾‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE pf_changeSetYear(IN set_year decimal(4,0), IN dbname varchar(40))</span><br><span class="line">BEGIN</span><br><span class="line">  DECLARE pre_year decimal(4,0);</span><br><span class="line">  DECLARE v_sql varchar(500);</span><br><span class="line">  DECLARE done INT DEFAULT 0;-- å£°æ˜ä¸€ä¸ªæ ‡å¿—doneï¼Œ ç”¨æ¥åˆ¤æ–­æ¸¸æ ‡æ˜¯å¦éå†å®Œæˆ</span><br><span class="line">  DECLARE TT_CURSOR varchar(500);-- æ¥æ”¶æ¸¸æ ‡å€¼çš„å˜é‡</span><br><span class="line">  DECLARE T_CURSOR CURSOR FOR SELECT distinct  TABLE_NAME FROM  INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = dbname and column_name = &apos;SET_YEAR&apos; and table_name in (SELECT table_name FROM INFORMATION_SCHEMA.TABLES where TABLE_SCHEMA =  dbname and table_type = &apos;BASE TABLE&apos;);-- æ¸¸æ ‡</span><br><span class="line">  DECLARE CONTINUE HANDLER FOR NOT FOUND set done = 1;-- åœ¨æ¸¸æ ‡å¾ªç¯åˆ°æœ€åä¼šå°† done è®¾ç½®ä¸º 1</span><br><span class="line">  SET pre_year := set_year - 1;</span><br><span class="line">  OPEN T_CURSOR;-- æ‰“å¼€æ¸¸æ ‡</span><br><span class="line">  loop1:LOOP -- å¼€å§‹å¾ªç¯</span><br><span class="line">     FETCH T_CURSOR INTO TT_CURSOR; -- å°†æ¸¸æ ‡ä¸­çš„å€¼æ”¾åˆ°TT_CURSOR</span><br><span class="line">     IF not done THEN  -- åˆ¤æ–­æ˜¯å¦ç»“æŸ</span><br><span class="line">         LEAVE loop1;</span><br><span class="line">     END IF;</span><br><span class="line">    -- ä¸šåŠ¡é€»è¾‘</span><br><span class="line">    IF (</span><br><span class="line">    TT_CURSOR &lt;&gt; &apos;SYS_YEAR&apos;</span><br><span class="line">    AND TT_CURSOR &lt;&gt; &apos;SYS_WORK_DAY&apos;</span><br><span class="line">    ) THEN</span><br><span class="line">      set v_sql = CONCAT(&apos;UPDATE &apos;,TT_CURSOR,CONCAT(&apos; SET SET_YEAR = &apos;, set_year,CONCAT(&apos; WHERE SET_YEAR  =&apos;, pre_year,&apos; &apos;)));</span><br><span class="line">      SET @v_sql = v_sql;--å¿…é¡»ä½¿ç”¨@v_sqlä»£æ›¿v_sqlå¦åˆ™æ‰§è¡Œæ—¶ä¼šæŠ¥é”™</span><br><span class="line">      prepare stmt from @v_sql;  </span><br><span class="line">      EXECUTE stmt;  </span><br><span class="line">      deallocate prepare stmt;  </span><br><span class="line">    END IF;</span><br><span class="line">  END LOOP;</span><br><span class="line">  CLOSE T_CURSOR;</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h2 id="MySQL-æ–¹æ³•ï¼ˆFunctionï¼‰è¯­æ³•ç¤ºä¾‹"><a href="#MySQL-æ–¹æ³•ï¼ˆFunctionï¼‰è¯­æ³•ç¤ºä¾‹" class="headerlink" title="MySQL æ–¹æ³•ï¼ˆFunctionï¼‰è¯­æ³•ç¤ºä¾‹"></a>MySQL æ–¹æ³•ï¼ˆFunctionï¼‰è¯­æ³•ç¤ºä¾‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE DEFINER=`root`@`localhost` FUNCTION `getChildList`() RETURNS longtext CHARSET utf8</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE sTemp LongText;</span><br><span class="line">DECLARE sTempChd VARCHAR(1000);</span><br><span class="line">SET sTemp = &apos;$&apos;;</span><br><span class="line">SET sTempChd = &apos;&apos;;</span><br><span class="line">SELECT GROUP_CONCAT(parent_id) INTO sTempChd FROM MA_ELE_AGENCYMB;</span><br><span class="line">SELECT GROUP_CONCAT(parent_id) INTO sTemp FROM MA_ELE_AGENCYMB;</span><br><span class="line">        WHILE sTempChd IS NOT NULL DO</span><br><span class="line">       SET sTemp = CONCAT(sTemp,&apos;,&apos;,sTempChd);</span><br><span class="line">       SELECT GROUP_CONCAT(parent_id) INTO sTempChd FROM ma_ele_agency WHERE FIND_IN_SET(chr_id,sTempChd)&gt;0;</span><br><span class="line">        END WHILE;</span><br><span class="line">  RETURN sTemp;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>XSDæ–‡ä»¶è§£æ</title>
      <link href="/2018/01/15/dubbo/2018-01-15-XSD/"/>
      <url>/2018/01/15/dubbo/2018-01-15-XSD/</url>
      
        <content type="html"><![CDATA[<p>ä»ä»Šå¤©å¼€å§‹ï¼Œæ‰“ç®—è¯»ä¸€édubboçš„æºç ï¼Œæºç è§£æä¹Ÿå°†é™†ç»­æ›´æ–°åˆ°<a href="https://github.com/zhongyp/dubbo.git" target="_blank" rel="noopener">github</a>ä¸Šï¼Œä»æœ¬ç¯‡å¼€å§‹æºç è§£æå°±å¼€å§‹å•¦ã€‚</p><p>åœ¨è§£ææºç çš„æ—¶å€™ï¼Œä¸€ç›´å¯¹é…ç½®æ–‡ä»¶çš„è§£æå¥½å¥‡å‘€ï¼Œæ‰€ä»¥å˜ï¼Œæºç è§£æå°±ä»é…ç½®æ–‡ä»¶å¼€å§‹å§ã€‚gogogo</p><p>XSD ï¼ˆxml Schema Definitionï¼‰</p><h2 id="Xml-Schemaçš„ç”¨é€”"><a href="#Xml-Schemaçš„ç”¨é€”" class="headerlink" title="Xml Schemaçš„ç”¨é€”"></a>Xml Schemaçš„ç”¨é€”</h2><ul><li><p>å®šä¹‰ä¸€ä¸ªXmlæ–‡æ¡£ä¸­éƒ½æœ‰ä»€ä¹ˆå…ƒç´ </p></li><li><p>å®šä¹‰ä¸€ä¸ªXmlæ–‡æ¡£ä¸­éƒ½ä¼šæœ‰ä»€ä¹ˆå±æ€§</p></li><li><p>å®šä¹‰æŸä¸ªèŠ‚ç‚¹çš„éƒ½æœ‰ä»€ä¹ˆæ ·çš„å­èŠ‚ç‚¹ï¼Œå¯ä»¥æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹å‡ºç°çš„é¡ºåº</p></li><li><p>å®šä¹‰å…ƒç´ æˆ–è€…å±æ€§çš„æ•°æ®ç±»å‹</p></li><li><p>å®šä¹‰å…ƒç´ æˆ–è€…å±æ€§çš„é»˜è®¤å€¼æˆ–è€…å›ºå®šå€¼</p></li></ul><p>å…·ä½“å®šä¹‰ç¤ºä¾‹<a href="http://www.cnblogs.com/newsouls/archive/2011/10/28/2227765.html" target="_blank" rel="noopener">XSDå®šä¹‰è¯¦è§£</a></p><h2 id="Springé…ç½®æ–‡ä¸­è§£æxsdæ–‡ä»¶ç‰ˆæœ¬"><a href="#Springé…ç½®æ–‡ä¸­è§£æxsdæ–‡ä»¶ç‰ˆæœ¬" class="headerlink" title="Springé…ç½®æ–‡ä¸­è§£æxsdæ–‡ä»¶ç‰ˆæœ¬"></a>Springé…ç½®æ–‡ä¸­è§£æxsdæ–‡ä»¶ç‰ˆæœ¬</h2><p><a href="http://blog.csdn.net/jackyechina/article/details/53125673" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥ï¼šhttp://blog.csdn.net/jackyechina/article/details/53125673</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- åˆå§‹åŒ–Springé…ç½®æ–‡ä»¶å¤´éƒ¨å£°æ˜ --&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;    </span><br><span class="line">&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN 2.0//EN&quot;    </span><br><span class="line">&quot;http://www.springframework.org/dtd/spring-beans-2.0.dtd&quot;&gt;    </span><br><span class="line">&lt;beans&gt;    </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>1ã€ç¬¬ä¸€è¡Œè¡¨ç¤ºxmlå£°æ˜ï¼Œä»»ä½•æ ¼å¼è‰¯å¥½çš„xmlæ–‡æ¡£éƒ½å¿…é¡»ç¬¬ä¸€è¡Œæ˜¯å£°æ˜ã€‚ç›¸å½“äºå‘Šè¯‰è§£æå™¨è¿™ä¸ªæ˜¯xmlæ–‡æ¡£ï¼Œä½ ç»™æˆ‘ç”¨xmlè§£æå™¨è§£æã€‚<br>2ã€dtdå£°æ˜ï¼Œè¡¨ç¤ºè¯¥xmlé‡Œçš„å…ƒç´ å’Œå±æ€§ç­‰éœ€ç¬¦åˆspring-beans-2.0.dtdè¿™ä¸ªæ–‡æ¡£ç±»å‹å®šä¹‰æ ‡å‡†ã€‚DTDï¼šæ–‡ä»¶çš„æ–‡ä»¶å‹åˆ«å®šä¹‰ï¼ˆDocument Type Definitionï¼‰å¯ä»¥çœ‹æˆä¸€ä¸ªæˆ–è€…å¤šä¸ª XML æ–‡ä»¶çš„æ¨¡æ¿ï¼Œåœ¨è¿™é‡Œå¯ä»¥å®šä¹‰ XML æ–‡ä»¶ä¸­çš„å…ƒç´ ã€å…ƒç´ çš„å±æ€§ã€å…ƒç´ çš„æ’åˆ—æ–¹å¼ã€å…ƒç´ åŒ…å«çš„å†…å®¹ç­‰ç­‰ã€‚</p><p>å› ä¸ºDTDçš„ä¸€äº›å±€é™æ€§ï¼Œä»¥åŠXML Schemaå¯¹æ•°æ®ç±»å‹å’Œå‘½åç©ºé—´çš„æ”¯æŒã€‚ç›®å‰å·²ä½¿ç”¨XML Schemaå°† DTD å–è€Œä»£ä¹‹ï¼Œè¢«XML Schema å–ä»£åçš„Spring é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;    </span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;    </span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;    </span><br><span class="line">    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot;    </span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span><br><span class="line">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span><br><span class="line">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">&quot;&gt;    </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>XML Schemaå‘½åç©ºé—´ä½œç”¨ï¼š  </p><p>1ã€é¿å…å‘½åå†²çªï¼ŒåƒJavaä¸­çš„packageä¸€æ ·  </p><p>2ã€å°†ä¸åŒä½œç”¨çš„æ ‡ç­¾åˆ†é—¨åˆ«ç±»ï¼ˆåƒSpringä¸­çš„txå‘½åç©ºé—´é’ˆå¯¹äº‹åŠ¡ç±»çš„æ ‡ç­¾ï¼Œcontextå‘½åç©ºé—´é’ˆå¯¹ç»„ä»¶çš„æ ‡ç­¾ï¼‰  </p><p>ä»£ç è§£é‡Šï¼š  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">å£°æ˜xmlæ–‡ä»¶é»˜è®¤çš„å‘½åç©ºé—´ï¼Œè¡¨ç¤ºæœªä½¿ç”¨å…¶ä»–å‘½åç©ºé—´çš„æ‰€æœ‰æ ‡ç­¾çš„é»˜è®¤å‘½åç©ºé—´ã€‚  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">``` xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br></pre></td></tr></table></figure><p>å£°æ˜XML Schema å®ä¾‹ï¼Œå£°æ˜åå°±å¯ä»¥ä½¿ç”¨ schemaLocation å±æ€§äº†ï¼Œæ­¤å¤„å°±æ˜¯xsiå±æ€§  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">å£°æ˜å‰ç¼€ä¸ºaopçš„å‘½åç©ºé—´ï¼Œåé¢çš„URLç”¨äºæ ‡ç¤ºå‘½åç©ºé—´çš„åœ°å€ä¸ä¼šè¢«è§£æå™¨ç”¨äºæŸ¥æ‰¾ä¿¡æ¯ã€‚å…¶æƒŸä¸€çš„ä½œç”¨æ˜¯èµ‹äºˆå‘½åç©ºé—´ä¸€ä¸ªæƒŸä¸€çš„åç§°ã€‚å½“å‘½åç©ºé—´è¢«å®šä¹‰åœ¨å…ƒç´ çš„å¼€å§‹æ ‡ç­¾ä¸­æ—¶ï¼Œæ‰€æœ‰å¸¦æœ‰ç›¸åŒå‰ç¼€çš„å­å…ƒç´ éƒ½ä¼šä¸åŒä¸€ä¸ªå‘½åç©ºé—´ç›¸å…³è”ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»å‘½åå¯ä»¥çœ‹å‡ºä¸ªå¤§æ¦‚ï¼ŒæŒ‡å®šSchemaçš„ä½ç½®è¿™ä¸ªå±æ€§å¿…é¡»ç»“åˆå‘½åç©ºé—´ä½¿ç”¨ã€‚è¿™ä¸ªå±æ€§æœ‰ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªå€¼è¡¨ç¤ºéœ€è¦ä½¿ç”¨çš„å‘½åç©ºé—´ã€‚ç¬¬äºŒä¸ªå€¼è¡¨ç¤ºä¾›å‘½åç©ºé—´ä½¿ç”¨çš„ XML schema çš„ä½ç½®æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ ·çš„æ ‡ç­¾çš„æ—¶å€™ï¼Œå°±å¼•å…¥ä»€ä¹ˆæ ·çš„å‘½åç©ºé—´å’ŒSchema å®šä¹‰å°±å¯ä»¥äº†ã€‚</p><p>XSDæœ‰æ²¡æœ‰ç‰ˆæœ¬å·çš„åŒºåˆ«</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œnamespaceå¯¹åº”çš„URIæ˜¯ä¸€ä¸ªå­˜æ”¾XSDçš„åœ°å€ï¼Œå°½ç®¡è§„èŒƒæ²¡æœ‰è¿™ä¹ˆè¦æ±‚ã€‚å¦‚æœæ²¡æœ‰æä¾›schemaLocationï¼Œé‚£ä¹ˆSpringçš„XMLè§£æå™¨ä¼šä»namespaceçš„URIé‡ŒåŠ è½½XSDæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æŠŠé…ç½®æ–‡ä»¶æ”¹æˆè¿™ä¸ªæ ·å­ï¼Œä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;    </span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans/spring-beans.xsd&quot;    </span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</span><br></pre></td></tr></table></figure><p>schemaLocationæä¾›äº†ä¸€ä¸ªxml namespaceåˆ°å¯¹åº”çš„XSDæ–‡ä»¶çš„ä¸€ä¸ªæ˜ å°„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨xsi:schemaLocationåé¢é…ç½®çš„å­—ç¬¦ä¸²éƒ½æ˜¯æˆå¯¹çš„ï¼Œå‰é¢çš„æ˜¯namespaceçš„URIï¼Œåé¢æ˜¯xsdæ–‡ä»¶çš„URIã€‚æ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans    </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans.xsd    </span><br><span class="line">http://www.springframework.org/schema/security    </span><br><span class="line">http://www.springframework.org/schema/security/spring-security.xsd&quot;</span><br></pre></td></tr></table></figure><p>Springé»˜è®¤åœ¨å¯åŠ¨æ—¶æ˜¯è¦åŠ è½½XSDæ–‡ä»¶æ¥éªŒè¯xmlæ–‡ä»¶çš„ï¼Œæ‰€ä»¥å¦‚æœæœ‰çš„æ—¶å€™æ–­ç½‘äº†ï¼Œæˆ–è€…ä¸€äº›å¼€æºè½¯ä»¶åˆ‡æ¢åŸŸåï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“ç¢°åˆ°åº”ç”¨å¯åŠ¨ä¸äº†ã€‚æˆ‘è®°å¾—å½“æ—¶Oracleæ”¶è´­Sunå…¬å¸æ—¶ï¼Œé‡åˆ°è¿‡è¿™ä¸ªæƒ…å†µã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼ŒSpringæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œé»˜è®¤ä»æœ¬åœ°åŠ è½½XSDæ–‡ä»¶ã€‚æ‰“å¼€spring-context-3.2.0.RELEASE.jarï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸¤ä¸ªç‰¹åˆ«çš„æ–‡ä»¶ï¼š</p><p>spring.handlers<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http\://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler    </span><br><span class="line">http\://www.springframework.org/schema/jee=org.springframework.ejb.config.JeeNamespaceHandler    </span><br><span class="line">http\://www.springframework.org/schema/lang=org.springframework.scripting.config.LangNamespaceHandler    </span><br><span class="line">http\://www.springframework.org/schema/task=org.springframework.scheduling.config.TaskNamespaceHandler    </span><br><span class="line">http\://www.springframework.org/schema/cache=org.springframework.cache.config.CacheNamespaceHandler</span><br></pre></td></tr></table></figure></p><p>spring.schemas<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http\://www.springframework.org/schema/context/spring-context-2.5.xsd=org/springframework/context/config/spring-context-2.5.xsd    </span><br><span class="line">http\://www.springframework.org/schema/context/spring-context-3.0.xsd=org/springframework/context/config/spring-context-3.0.xsd    </span><br><span class="line">http\://www.springframework.org/schema/context/spring-context-3.1.xsd=org/springframework/context/config/spring-context-3.1.xsd    </span><br><span class="line">http\://www.springframework.org/schema/context/spring-context-3.2.xsd=org/springframework/context/config/spring-context-3.2.xsd    </span><br><span class="line">http\://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context-3.2.xsd    </span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">å†æ‰“å¼€jaråŒ…é‡Œçš„org/springframework/context/config/ ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢æœ‰</span><br><span class="line">spring-context-2.5.xsd</span><br><span class="line">spring-context-3.0.xsd</span><br><span class="line">spring-context-3.1.xsd</span><br><span class="line">spring-context-3.2.xsd</span><br><span class="line">å¾ˆæ˜æ˜¾ï¼Œå¯ä»¥æƒ³åˆ°Springæ˜¯æŠŠXSDæ–‡ä»¶æ”¾åˆ°æœ¬åœ°äº†ï¼Œå†åœ¨spring.schemasé‡Œåšäº†ä¸€ä¸ªæ˜ å°„ï¼Œä¼˜å…ˆä»æœ¬åœ°é‡ŒåŠ è½½XSDæ–‡ä»¶ã€‚å¹¶ä¸”Springå¾ˆè´´å¿ƒï¼ŒæŠŠæ—§ç‰ˆæœ¬çš„XSDæ–‡ä»¶ä¹Ÿå…¨æ”¾äº†ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢å‡çº§äº†Springç‰ˆæœ¬ï¼Œè€Œé…ç½®æ–‡ä»¶é‡Œç”¨çš„è¿˜æ˜¯æ—§ç‰ˆæœ¬çš„XSDæ–‡ä»¶ï¼Œç„¶åæ–­ç½‘äº†ï¼Œåº”ç”¨å¯åŠ¨ä¸äº†ã€‚</span><br><span class="line">æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰é…ç½®ç‰ˆæœ¬å·æ—¶ï¼Œç”¨çš„å°±æ˜¯å½“å‰ç‰ˆæœ¬çš„XSDæ–‡ä»¶ï¼š</span><br></pre></td></tr></table></figure></p><p>http\://<a href="http://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context-3.2.xsd" target="_blank" rel="noopener">www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context-3.2.xsd</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç»“è®ºï¼šä¸è¦åœ¨Springçš„é…ç½®é‡Œï¼Œé…ç½®ä¸ŠXSDçš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é…ç½®ç‰ˆæœ¬å·ï¼Œå–çš„å°±æ˜¯å½“å‰jaré‡Œçš„XSDæ–‡ä»¶ï¼Œå‡å°‘äº†å„ç§é£é™©ã€‚è€Œä¸”è¿™æ ·çº¦å®šå¤§äºé…ç½®çš„æ–¹å¼å¾ˆä¼˜é›…ã€‚</span><br><span class="line">åŒæ ·ï¼Œæˆ‘ä»¬æ‰“å¼€dubboçš„jaråŒ…ï¼Œå¯ä»¥åœ¨å®ƒçš„spring.schemasæ–‡ä»¶é‡Œçœ‹åˆ°æœ‰è¿™æ ·çš„é…ç½®ï¼š</span><br></pre></td></tr></table></figure></p><p>http\://code.alibabatech.com/schema/dubbo/dubbo.xsd=META-INF/dubbo.xsd<br><code>`</code></p><p>æ‰€ä»¥ï¼ŒSpringåœ¨åŠ è½½dubboæ—¶ï¼Œä¼šä»dubboçš„jaré‡ŒåŠ è½½dubbo.xsdã€‚</p><p><a href="https://github.com/zhongyp/bodu/tree/master/bodu-dubbo/src/main/java/com/bodu/dubbo/xsd" target="_blank" rel="noopener">æ‰©å±•Springçš„è‡ªå®šä¹‰æ ‡ç­¾æºç </a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¯¹Spring çš„IOCçš„è®¤è¯†</title>
      <link href="/2018/01/15/spring/2018-01-15-Spring/"/>
      <url>/2018/01/15/spring/2018-01-15-Spring/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-Beançš„åˆå§‹åŒ–æºç è§£æ"><a href="#Spring-Beançš„åˆå§‹åŒ–æºç è§£æ" class="headerlink" title="Spring Beançš„åˆå§‹åŒ–æºç è§£æ"></a>Spring Beançš„åˆå§‹åŒ–æºç è§£æ</h2><p>Iocâ€”Inversion of Controlï¼Œå³â€œæ§åˆ¶åè½¬â€ï¼Œä¸æ˜¯ä»€ä¹ˆæŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ã€‚åœ¨Javaå¼€å‘ä¸­ï¼ŒIocæ„å‘³ç€å°†ä½ è®¾è®¡å¥½çš„å¯¹è±¡äº¤ç»™å®¹å™¨æ§åˆ¶ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„åœ¨ä½ çš„å¯¹è±¡å†…éƒ¨ç›´æ¥æ§åˆ¶ã€‚å¦‚ä½•ç†è§£å¥½Iocå‘¢ï¼Ÿç†è§£å¥½Iocçš„å…³é”®æ˜¯è¦æ˜ç¡®â€œè°æ§åˆ¶è°ï¼Œæ§åˆ¶ä»€ä¹ˆï¼Œä¸ºä½•æ˜¯åè½¬ï¼ˆæœ‰åè½¬å°±åº”è¯¥æœ‰æ­£è½¬äº†ï¼‰ï¼Œå“ªäº›æ–¹é¢åè½¬äº†â€ï¼Œé‚£æˆ‘ä»¬æ¥æ·±å…¥åˆ†æä¸€ä¸‹ï¼š</p><ul><li><p>è°æ§åˆ¶è°ï¼Œæ§åˆ¶ä»€ä¹ˆï¼šä¼ ç»ŸJava SEç¨‹åºè®¾è®¡ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨é€šè¿‡newè¿›è¡Œåˆ›å»ºå¯¹è±¡ï¼Œæ˜¯ç¨‹åºä¸»åŠ¨å»åˆ›å»ºä¾èµ–å¯¹è±¡ï¼›è€ŒIoCæ˜¯æœ‰ä¸“é—¨ä¸€ä¸ªå®¹å™¨æ¥åˆ›å»ºè¿™äº›å¯¹è±¡ï¼Œå³ç”±Iocå®¹å™¨æ¥æ§åˆ¶å¯¹ è±¡çš„åˆ›å»ºï¼›è°æ§åˆ¶è°ï¼Ÿå½“ç„¶æ˜¯IoC å®¹å™¨æ§åˆ¶äº†å¯¹è±¡ï¼›æ§åˆ¶ä»€ä¹ˆï¼Ÿé‚£å°±æ˜¯ä¸»è¦æ§åˆ¶äº†å¤–éƒ¨èµ„æºè·å–ï¼ˆä¸åªæ˜¯å¯¹è±¡åŒ…æ‹¬æ¯”å¦‚æ–‡ä»¶ç­‰ï¼‰ã€‚</p></li><li><p>ä¸ºä½•æ˜¯åè½¬ï¼Œå“ªäº›æ–¹é¢åè½¬äº†ï¼šæœ‰åè½¬å°±æœ‰æ­£è½¬ï¼Œä¼ ç»Ÿåº”ç”¨ç¨‹åºæ˜¯ç”±æˆ‘ä»¬è‡ªå·±åœ¨å¯¹è±¡ä¸­ä¸»åŠ¨æ§åˆ¶å»ç›´æ¥è·å–ä¾èµ–å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ­£è½¬ï¼›è€Œåè½¬åˆ™æ˜¯ç”±å®¹å™¨æ¥å¸®å¿™åˆ›å»ºåŠæ³¨å…¥ä¾èµ–å¯¹è±¡ï¼›ä¸ºä½•æ˜¯åè½¬ï¼Ÿå› ä¸ºç”±å®¹å™¨å¸®æˆ‘ä»¬æŸ¥æ‰¾åŠæ³¨å…¥ä¾èµ–å¯¹è±¡ï¼Œå¯¹è±¡åªæ˜¯è¢«åŠ¨çš„æ¥å—ä¾èµ–å¯¹è±¡ï¼Œæ‰€ä»¥æ˜¯åè½¬ï¼›å“ªäº›æ–¹é¢åè½¬äº†ï¼Ÿä¾èµ–å¯¹è±¡çš„è·å–è¢«åè½¬äº†ã€‚</p></li></ul><h2 id="IoC-æ§åˆ¶åè½¬"><a href="#IoC-æ§åˆ¶åè½¬" class="headerlink" title="IoC(æ§åˆ¶åè½¬)"></a>IoC(æ§åˆ¶åè½¬)</h2><p>ã€€ã€€é¦–å…ˆæƒ³è¯´è¯´IoCï¼ˆInversion of Controlï¼Œæ§åˆ¶åè½¬ï¼‰ã€‚è¿™æ˜¯springçš„æ ¸å¿ƒï¼Œè´¯ç©¿å§‹ç»ˆã€‚æ‰€è°“IoCï¼Œå¯¹äºspringæ¡†æ¶æ¥è¯´ï¼Œå°±æ˜¯ç”±springæ¥è´Ÿè´£æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡é—´çš„å…³ç³»ã€‚åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨å¦å¤–çš„å¯¹è±¡ï¼Œå°±å¿…é¡»å¾—åˆ°å®ƒï¼ˆè‡ªå·±newä¸€ä¸ªï¼Œæˆ–è€…ä»JNDIä¸­æŸ¥è¯¢ä¸€ä¸ªï¼‰ï¼Œä½¿ç”¨å®Œä¹‹åè¿˜è¦å°†å¯¹è±¡é”€æ¯ï¼ˆæ¯”å¦‚Connectionç­‰ï¼‰ï¼Œå¯¹è±¡å§‹ç»ˆä¼šå’Œå…¶ä»–çš„æ¥å£æˆ–ç±»è—•åˆèµ·æ¥ã€‚</p><h2 id="DI-ä¾èµ–æ³¨å…¥"><a href="#DI-ä¾èµ–æ³¨å…¥" class="headerlink" title="DI(ä¾èµ–æ³¨å…¥)"></a>DI(ä¾èµ–æ³¨å…¥)</h2><p>ã€€ã€€IoCçš„ä¸€ä¸ªé‡ç‚¹æ˜¯åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼ŒåŠ¨æ€çš„å‘æŸä¸ªå¯¹è±¡æä¾›å®ƒæ‰€éœ€è¦çš„å…¶ä»–å¯¹è±¡ã€‚è¿™ä¸€ç‚¹æ˜¯é€šè¿‡DIï¼ˆDependency Injectionï¼Œä¾èµ–æ³¨å…¥ï¼‰æ¥å®ç°çš„ã€‚æ¯”å¦‚å¯¹è±¡Aéœ€è¦æ“ä½œæ•°æ®åº“ï¼Œä»¥å‰æˆ‘ä»¬æ€»æ˜¯è¦åœ¨Aä¸­è‡ªå·±ç¼–å†™ä»£ç æ¥è·å¾—ä¸€ä¸ªConnectionå¯¹è±¡ï¼Œæœ‰äº† springæˆ‘ä»¬å°±åªéœ€è¦å‘Šè¯‰springï¼ŒAä¸­éœ€è¦ä¸€ä¸ªConnectionï¼Œè‡³äºè¿™ä¸ªConnectionæ€ä¹ˆæ„é€ ï¼Œä½•æ—¶æ„é€ ï¼ŒAä¸éœ€è¦çŸ¥é“ã€‚åœ¨ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œspringä¼šåœ¨é€‚å½“çš„æ—¶å€™åˆ¶é€ ä¸€ä¸ªConnectionï¼Œç„¶ååƒæ‰“é’ˆä¸€æ ·ï¼Œæ³¨å°„åˆ°Aå½“ä¸­ï¼Œè¿™æ ·å°±å®Œæˆäº†å¯¹å„ä¸ªå¯¹è±¡ä¹‹é—´å…³ç³»çš„æ§åˆ¶ã€‚Aéœ€è¦ä¾èµ– Connectionæ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œè€Œè¿™ä¸ªConnectionæ˜¯ç”±springæ³¨å…¥åˆ°Aä¸­çš„ï¼Œä¾èµ–æ³¨å…¥çš„åå­—å°±è¿™ä¹ˆæ¥çš„ã€‚é‚£ä¹ˆDIæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ Java 1.3ä¹‹åä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯åå°„ï¼ˆreflectionï¼‰ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€çš„ç”Ÿæˆå¯¹è±¡ã€æ‰§è¡Œå¯¹è±¡çš„æ–¹æ³•ã€æ”¹å˜å¯¹è±¡çš„å±æ€§ï¼Œspringå°±æ˜¯é€šè¿‡åå°„æ¥å®ç°æ³¨å…¥çš„ã€‚</p><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/xdp-gacl/p/4249939.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring Beanå®¹å™¨åŠ è½½Beanæºç è§£æï¼ˆè½¬è½½ï¼‰</title>
      <link href="/2018/01/15/spring/2018-01-15-SpringInit/"/>
      <url>/2018/01/15/spring/2018-01-15-SpringInit/</url>
      
        <content type="html"><![CDATA[<h2 id="Springåˆå§‹åŒ–"><a href="#Springåˆå§‹åŒ–" class="headerlink" title="Springåˆå§‹åŒ–"></a>Springåˆå§‹åŒ–</h2><p>Springåˆå§‹åŒ–ç±»å…³ç³»å›¾</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/styles/images/article/springinit.png?raw=true" alt="Springåˆå§‹åŒ–ç±»å…³ç³»å›¾"></p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/styles/images/article/springinit1.png?raw=true" alt="Springåˆå§‹åŒ–ç±»å…³ç³»å›¾"></p><p>DefaultResourceLoaderï¼Œè¯¥ç±»è®¾ç½®classLoaderï¼Œå¹¶ä¸”å°†é…ç½®æ–‡ä»¶ å°è£…ä¸ºResourceæ–‡ä»¶ã€‚</p><p>AbstractApplicationContextï¼Œè¯¥ç±»å®Œæˆäº†å¤§éƒ¨åˆ†çš„IOCå®¹å™¨åˆå§‹åŒ–å·¥ä½œï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ‰©å±•æ¥å£ç•™ç»™å­ç±»å»é‡è½½ã€‚è¯¥ç±»çš„refresh()å‡½æ•°æ˜¯æ ¸å¿ƒåˆå§‹åŒ–æ“ä½œã€‚</p><p>AbstractRefreshableApplicationContextï¼Œè¯¥ç±»æ”¯æŒåˆ·æ–°BeanFactoryã€‚</p><p>AbstractRefreshableConfigApplicationContextï¼Œè¯¥ç±»ä¿å­˜äº†é…ç½®æ–‡ä»¶è·¯å¾„</p><p>AbstractXmlApplicationContextï¼šè¯¥ç±»æ”¯æŒè§£æbeanå®šä¹‰æ–‡ä»¶</p><p>æœ€åClassPathXmlApplicationContext:åªæä¾›äº†ä¸€ä¸ªç®€å•çš„æ„é€ å‡½æ•°</p><p>Spring å°†ç±»èŒè´£åˆ†å¼€ï¼Œå½¢æˆèŒè´£é“¾ï¼Œæ¯ä¸€å±‚æ¬¡çš„æ‰©å±• éƒ½åªæ˜¯æ·»åŠ äº†æŸä¸ªåŠŸèƒ½</p><p>ç„¶åçˆ¶ç±»å®šä¹‰å¤§é‡çš„æ¨¡æ¿ï¼Œè®©å­ç±»å®ç°ï¼Œçˆ¶ç±»å±‚å±‚ä¼ é€’åˆ°å­ç±» ç›´åˆ°æŸä¸ªå­ç±»é‡è½½äº†æŠ½è±¡æ–¹æ³•ã€‚è¿™é‡Œåº”ç”¨åˆ°äº†èŒè´£é“¾è®¾è®¡æ¨¡å¼å’Œæ¨¡æ¿è®¾è®¡æ¨¡å¼ï¼ŒIOCæ˜¯ä¸ªå®¹å™¨å·¥å‚è®¾è®¡æ¨¡å¼ã€‚</p><p>æµ‹è¯•ç¨‹åºï¼š</p><p>Beané…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=&quot;test&quot; class=&quot;com.bodu.spring.demo.Test&quot;&gt;&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;spring-beans.xml&quot;);</span><br><span class="line">Test test = (Test) ctx.getBean(&quot;test&quot;);</span><br><span class="line">test.getTestName();</span><br></pre></td></tr></table></figure><p>å¼€å§‹è·Ÿæºç å•¦ï¼ï¼ï¼</p><p>Springåˆå§‹åŒ–æ—¶ï¼Œå…ˆåˆå§‹åŒ–Beanå®¹å™¨</p><p>æµ‹è¯•ä»£ç é€šè¿‡new ClassPathXmlApplicationContext(â€œspring-beans.xmlâ€)ï¼Œåˆå§‹åŒ–ClassPathXmlApplicationContextå®ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public ClassPathXmlApplicationContext(String[] configLocations, boolean refresh, ApplicationContext parent) throws BeansException &#123;</span><br><span class="line">super(parent);// æŠŠApplicationContextä½œä¸ºçˆ¶å®¹å™¨ï¼Œä¸Šè¿°æµ‹è¯•ç±»ä¸­ç”±äºç›´æ¥è½½å…¥çš„xml,æ²¡æœ‰çˆ¶å®¹å™¨æ‰€ä»¥å®é™…ä¼ äº†null</span><br><span class="line">this.setConfigLocations(configLocations);// æ›¿æ¢$&#123;&#125;åè®¾ç½®é…ç½®è·¯å¾„</span><br><span class="line">if(refresh) &#123;</span><br><span class="line">this.refresh();// è¿™ä¸ªä¼šç›´æ¥è®¿é—®è‡³AbstractApplicationContextç±»çš„refreshæ–¹æ³•,è¿™ä¸ªæ˜¯å®¹å™¨åˆ›å»ºçš„æ ¸å¿ƒæ–¹æ³•</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AbstractRefreshableConfigApplicationContextç±» setConfigLocations()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void setConfigLocations(String... locations) &#123;</span><br><span class="line">    if(locations != null) &#123; // åˆ¤æ–­locationsénull</span><br><span class="line">        Assert.noNullElements(locations, &quot;Config locations must not be null&quot;);// æ–­è¨€locationså…ƒç´ éç©º</span><br><span class="line">        this.configLocations = new String[locations.length];</span><br><span class="line"></span><br><span class="line">        for(int i = 0; i &lt; locations.length; ++i) &#123;</span><br><span class="line">            this.configLocations[i] = this.resolvePath(locations[i]).trim();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        this.configLocations = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>refresh()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void refresh() throws BeansException, IllegalStateException &#123;</span><br><span class="line"></span><br><span class="line">Object var1 = this.startupShutdownMonitor;</span><br><span class="line">// åŒæ­¥é”ï¼Œå¯¹ä¸€ä¸ªå…¨å±€å¯¹è±¡æˆ–è€…ç±»åŠ é”æ—¶ï¼Œå¯¹è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½èµ·ä½œç”¨</span><br><span class="line">synchronized(this.startupShutdownMonitor) &#123;</span><br><span class="line">// åˆ·æ–°å‰çš„å‡†å¤‡å·¥ä½œï¼Œå‡†å¤‡åˆ·æ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¾‹å¦‚å¯¹ç³»ç»Ÿå±æ€§æˆ–è€…ç¯å¢ƒå˜é‡è¿›è¡Œå‡†å¤‡åŠéªŒè¯ã€‚</span><br><span class="line">this.prepareRefresh();</span><br><span class="line">//é¦–å…ˆè°ƒç”¨AbstractRefreshableApplicationContextçš„refreshBeanFactory()è§£æxml</span><br><span class="line">//ç„¶åè°ƒç”¨AbstractXmlApplicationContext/XmlWebApplicationContext.loadBeanDefinitions()æ–¹æ³•ï¼ŒåŠ è½½beanä¿¡æ¯</span><br><span class="line">// å‘Šè¯‰å­ç±»åˆ·æ–°å†…éƒ¨beanå·¥å‚</span><br><span class="line">ConfigurableListableBeanFactory beanFactory = this.obtainFreshBeanFactory();</span><br><span class="line">//ä¸ºBeanFactoryé…ç½®å®¹å™¨ç‰¹æ€§ï¼Œä¾‹å¦‚ç±»åŠ è½½å™¨ã€äº‹ä»¶å¤„ç†å™¨ç­‰.</span><br><span class="line">this.prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">    //è®¾ç½®BeanFactoryçš„åç½®å¤„ç†. ç©ºæ–¹æ³•ï¼Œç•™ç»™å­ç±»æ‹“å±•ç”¨ã€‚</span><br><span class="line">this.postProcessBeanFactory(beanFactory);</span><br><span class="line">//åœ¨ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨factoryå·¥å‚çš„æ—¶å€™æ³¨å†Œbeançš„ å®ä¾‹å¯¹è±¡ï¼Œ//è°ƒç”¨BeanFactoryçš„åå¤„ç†å™¨, è¿™äº›åå¤„ç†å™¨æ˜¯åœ¨Beanå®šä¹‰ä¸­å‘å®¹å™¨æ³¨å†Œçš„. </span><br><span class="line">this.invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">// æ³¨å†Œbeançš„è¿‡ç¨‹å½“ä¸­æ‹¦æˆªæ‰€æœ‰beançš„åˆ›å»ºï¼Œ//æ³¨å†ŒBeançš„åå¤„ç†å™¨, åœ¨Beanåˆ›å»ºè¿‡ç¨‹ä¸­è°ƒç”¨.</span><br><span class="line">this.registerBeanPostProcessors(beanFactory);</span><br><span class="line">//åˆå§‹åŒ–ä¸Šä¸‹æ–‡ä¸­çš„æ¶ˆæ¯æºï¼Œå³ä¸åŒè¯­è¨€çš„æ¶ˆæ¯ä½“è¿›è¡Œå›½é™…åŒ–å¤„ç†</span><br><span class="line">this.initMessageSource();</span><br><span class="line">//åˆå§‹åŒ–äº‹ç‰©ä¼ æ’­å±æ€§ï¼Œ//åˆå§‹åŒ–ApplicationEventMulticaster bean,åº”ç”¨äº‹ä»¶å¹¿æ’­å™¨</span><br><span class="line">this.initApplicationEventMulticaster();</span><br><span class="line">// åœ¨ç‰¹å®šä¸Šä¸‹æ–‡åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Šbeanå­ç±»ã€‚//åˆå§‹åŒ–å…¶å®ƒç‰¹æ®Šçš„Beanï¼Œ ç©ºæ–¹æ³•ï¼Œç•™ç»™å­ç±»æ‹“å±•ç”¨ã€‚</span><br><span class="line">this.onRefresh();</span><br><span class="line">// æ£€æŸ¥ä¾¦å¬å™¨beanå¹¶æ³¨å†Œã€‚//æ£€æŸ¥å¹¶å‘å®¹å™¨æ³¨å†Œç›‘å¬å™¨Bean</span><br><span class="line">this.registerListeners();</span><br><span class="line">// å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™(non-lazy-init)å•ä¾‹.//å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„(non-lazy-init) å•ä¾‹Bean.</span><br><span class="line">this.finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">// æœ€åä¸€æ­¥:å‘å¸ƒå¯¹åº”çš„äº‹ä»¶ã€‚//å‘å¸ƒå®¹å™¨äº‹ä»¶, ç»“æŸrefreshè¿‡ç¨‹. </span><br><span class="line">this.finishRefresh();</span><br><span class="line">&#125; catch (BeansException var9) &#123;</span><br><span class="line">if(this.logger.isWarnEnabled()) &#123;</span><br><span class="line">this.logger.warn(&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot; + var9);</span><br><span class="line">&#125;</span><br><span class="line">            // é”€æ¯å·²ç»åˆ›å»ºçš„å•ä¾‹å¯¹è±¡é¿å…æµªè´¹èµ„æº</span><br><span class="line">this.destroyBeans();</span><br><span class="line">//å–æ¶ˆrefreshæ“ä½œ, é‡ç½®activeæ ‡å¿—. </span><br><span class="line">this.cancelRefresh(var9);</span><br><span class="line">// å¼‚å¸¸ä¼ æ’­åˆ°è°ƒç”¨è€…</span><br><span class="line">throw var9;</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    // åœ¨spring æ ¸å¿ƒåŒ…é‡Œé‡ç½®äº†å†…å­˜ï¼ˆç¼“å­˜ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å…ƒæ•°æ®å•ä¾‹beanå¯¹è±¡äº†</span><br><span class="line">this.resetCommonCaches();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AbstractRefreshableApplicationContextç±»</p><p style="color:red">refreshæ–¹æ³•ä¸­obtainFreshBeanFactoryæ–¹æ³•è°ƒç”¨äº†refreshBeanFactoryï¼Œè¯¥æ–¹æ³•ä½¿ç”¨DefaultListableBeanFactoryå»å®šä½resourcesèµ„æº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">protected final void refreshBeanFactory() throws BeansException &#123;</span><br><span class="line">    if(this.hasBeanFactory()) &#123;</span><br><span class="line">        this.destroyBeans();//å…ˆæ¶ˆé™¤æ‰€æœ‰å·²ç»å­˜åœ¨çš„bean</span><br><span class="line">        this.closeBeanFactory();// beanFactory = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;//åˆ›å»ºå¹¶è®¾ç½®DefaultListableBeanFactoryåŒæ—¶è°ƒç”¨loadBeanDefinitionsè½½å…¥loadBeanDefinition</span><br><span class="line">        // å®ä¾‹åŒ–ä¸€ä¸ªå·¥å‚ï¼Œè¿™é‡Œæ˜¯DefaultListableBeanFactory</span><br><span class="line">        DefaultListableBeanFactory beanFactory = this.createBeanFactory();</span><br><span class="line">        </span><br><span class="line">        beanFactory.setSerializationId(this.getId());</span><br><span class="line">        this.customizeBeanFactory(beanFactory);</span><br><span class="line">        // XmlWebApplicationContextæ–¹æ³•</span><br><span class="line">        // åœ¨æœ¬ç±»ä¸­æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦å­ç±»AbstractXmlApplicationContextä¸­å®ç°</span><br><span class="line">        this.loadBeanDefinitions(beanFactory);</span><br><span class="line">        Object var2 = this.beanFactoryMonitor;</span><br><span class="line">        synchronized(this.beanFactoryMonitor) &#123; // åŒæ­¥é”ï¼Œåˆ·æ–°beanFactoryå®ä¾‹</span><br><span class="line">            this.beanFactory = beanFactory;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (IOException var5) &#123;</span><br><span class="line">        throw new ApplicationContextException(&quot;I/O error parsing bean definition source for &quot; + this.getDisplayName(), var5);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">protected DefaultListableBeanFactory createBeanFactory() &#123;</span><br><span class="line">    return new DefaultListableBeanFactory(this.getInternalParentBeanFactory());// æ ¹æ®beanFactoryçš„çˆ¶ç±»ï¼Œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AbstractXmlApplicationContextç±»</p><p style="color:red">loadBeanDefinitionså…¶å…·ä½“å®ç°åœ¨AbstractXmlApplicationContextä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªReaderä½œä¸ºå…¥å‚æ‰§è¡Œè½½å…¥è¿‡ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException &#123;</span><br><span class="line">// //è¿™å’Œåœ¨BeanFactoryä¸­çš„åŠ è½½è¿‡ç¨‹ä¸€æ ·ï¼Œä¹Ÿæ˜¯å§”æ‰˜ç»™XmlBeanDefinitionReaderå»è¯»å–é…ç½®æ–‡ä»¶ï¼Œ</span><br><span class="line">XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);</span><br><span class="line">beanDefinitionReader.setEnvironment(this.getEnvironment());</span><br><span class="line">beanDefinitionReader.setResourceLoader(this);</span><br><span class="line">beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));</span><br><span class="line">this.initBeanDefinitionReader(beanDefinitionReader);</span><br><span class="line">// åŠ è½½Beanå®šä¹‰</span><br><span class="line">this.loadBeanDefinitions(beanDefinitionReader);// æ ¸å¿ƒæ–¹æ³•</span><br><span class="line">&#125;</span><br><span class="line">// getConfigResourcesé‡‡ç”¨æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œå…·ä½“çš„å®ç°ç”±å­ç±»å®Œæˆï¼Œå®é™…ä¸Šè¿™é‡ŒgetConfigResourcesè°ƒç”¨çš„å°±æ˜¯å­ç±»ClassPathXmlApplicationContextçš„getConfigResourcesæ–¹æ³•ã€‚ClassPathXmlApplicationContextç»§æ‰¿äº†DefaultResourceLoaderï¼Œå…·å¤‡äº†ResourceåŠ è½½èµ„æºçš„åŠŸèƒ½ã€‚è‡³æ­¤å®Œæˆäº†Resourceå®šä½ï¼</span><br><span class="line">protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException &#123;</span><br><span class="line">Resource[] configResources = this.getConfigResources();</span><br><span class="line">if(configResources != null) &#123;</span><br><span class="line">// è¯»å–é…ç½®æ–‡ä»¶éƒ½æ˜¯ç”¨çš„è¿™ä¸ªæ–¹æ³•ï¼Œå’ŒBeanFactoryæ˜¯ä¸€æ ·çš„ï¼Œ</span><br><span class="line">reader.loadBeanDefinitions(configResources);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String[] configLocations = this.getConfigLocations();</span><br><span class="line">// FileSystemXmlApplicationContextç±»</span><br><span class="line">if(configLocations != null) &#123;</span><br><span class="line">reader.loadBeanDefinitions(configLocations);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p style="color:red">è¿™é‡Œæ”¯æŒ2ç§æ¨¡å¼ï¼š1.æ¨¡æ¿åŒ¹é…å¤šèµ„æºï¼Œç”ŸæˆResource[]ã€‚2.è½½å…¥å•ä¸ªèµ„æºurlç»å¯¹åœ°å€ï¼Œç”Ÿæˆä¸€ä¸ªResource</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public int loadBeanDefinitions(String location, Set&lt;Resource&gt; actualResources) throws BeanDefinitionStoreException &#123;</span><br><span class="line">    ResourceLoader resourceLoader = getResourceLoader();//è·å–ResourceLoaderèµ„æºåŠ è½½å™¨</span><br><span class="line">    if (resourceLoader == null) &#123;</span><br><span class="line">        throw new BeanDefinitionStoreException(</span><br><span class="line">                &quot;Cannot import bean definitions from location [&quot; + location + &quot;]: no ResourceLoader available&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 1.åŒ¹é…æ¨¡æ¿è§£æ ClassPathXmlApplicationContextæ˜¯ResourcePatternResolveræ¥å£çš„å®ä¾‹</span><br><span class="line">    if (resourceLoader instanceof ResourcePatternResolver) &#123;</span><br><span class="line">       </span><br><span class="line">        try &#123;//æ¥å£ResourcePatternResolver</span><br><span class="line">            Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location);</span><br><span class="line">            int loadCount = loadBeanDefinitions(resources);</span><br><span class="line">            if (actualResources != null) &#123;</span><br><span class="line">                for (Resource resource : resources) &#123;</span><br><span class="line">                    actualResources.add(resource);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(&quot;Loaded &quot; + loadCount + &quot; bean definitions from location pattern [&quot; + location + &quot;]&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            return loadCount;</span><br><span class="line">        &#125;</span><br><span class="line">        catch (IOException ex) &#123;</span><br><span class="line">            throw new BeanDefinitionStoreException(</span><br><span class="line">                    &quot;Could not resolve bean definition resource pattern [&quot; + location + &quot;]&quot;, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // 2.è½½å…¥å•ä¸ªèµ„æºurlç»å¯¹åœ°å€</span><br><span class="line">        Resource resource = resourceLoader.getResource(location);</span><br><span class="line">        int loadCount = loadBeanDefinitions(resource);</span><br><span class="line">        if (actualResources != null) &#123;</span><br><span class="line">            actualResources.add(resource);</span><br><span class="line">        &#125;</span><br><span class="line">        if (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(&quot;Loaded &quot; + loadCount + &quot; bean definitions from location [&quot; + location + &quot;]&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return loadCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>invokeBeanFactoryPostProcessorsæ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">protected void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) &#123;</span><br><span class="line">PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, this.getBeanFactoryPostProcessors());</span><br><span class="line">if(beanFactory.getTempClassLoader() == null &amp;&amp; beanFactory.containsBean(&quot;loadTimeWeaver&quot;)) &#123;</span><br><span class="line">beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));</span><br><span class="line">beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PostProcessorRegistrationDelegateç±»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">public static void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors) &#123;</span><br><span class="line">    Set&lt;String&gt; processedBeans = new HashSet();</span><br><span class="line">    int var9;</span><br><span class="line">    ArrayList currentRegistryProcessors;</span><br><span class="line">    String[] postProcessorNames;</span><br><span class="line">    if(beanFactory instanceof BeanDefinitionRegistry) &#123;</span><br><span class="line">        BeanDefinitionRegistry registry = (BeanDefinitionRegistry)beanFactory;</span><br><span class="line">        List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = new LinkedList();</span><br><span class="line">        List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = new LinkedList();</span><br><span class="line">        Iterator var6 = beanFactoryPostProcessors.iterator();</span><br><span class="line"></span><br><span class="line">        while(var6.hasNext()) &#123;</span><br><span class="line">            BeanFactoryPostProcessor postProcessor = (BeanFactoryPostProcessor)var6.next();</span><br><span class="line">            if(postProcessor instanceof BeanDefinitionRegistryPostProcessor) &#123;</span><br><span class="line">                BeanDefinitionRegistryPostProcessor registryProcessor = (BeanDefinitionRegistryPostProcessor)postProcessor;</span><br><span class="line">                registryProcessor.postProcessBeanDefinitionRegistry(registry);</span><br><span class="line">                registryProcessors.add(registryProcessor);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                regularPostProcessors.add(postProcessor);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        currentRegistryProcessors = new ArrayList();</span><br><span class="line">        </span><br><span class="line">        // ä¸åˆå§‹åŒ–factoryBeansï¼šæˆ‘ä»¬éœ€è¦æŠŠæ‰€ä»¥æ²¡æœ‰åˆå§‹åŒ–çš„beanè®©beanå·¥å‚å¤„ç†ä»–ä»¬ï¼Œå•ä¾‹BeanDefinitionRegistryPostProcessorsä¹‹é—´å®ç°PriorityOrderedæ¥å£ã€åºåˆ—åŒ–æ¥å£</span><br><span class="line">        postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);</span><br><span class="line">        String[] var18 = postProcessorNames;</span><br><span class="line">        var9 = postProcessorNames.length;</span><br><span class="line"></span><br><span class="line">        int var10;</span><br><span class="line">        String ppName;</span><br><span class="line">        for(var10 = 0; var10 &lt; var9; ++var10) &#123;</span><br><span class="line">            ppName = var18[var10];</span><br><span class="line">            if(beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;</span><br><span class="line">                currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</span><br><span class="line">                processedBeans.add(ppName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sortPostProcessors(currentRegistryProcessors, beanFactory);</span><br><span class="line">        registryProcessors.addAll(currentRegistryProcessors);</span><br><span class="line">        invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</span><br><span class="line">        currentRegistryProcessors.clear();</span><br><span class="line">        postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);</span><br><span class="line">        var18 = postProcessorNames;</span><br><span class="line">        var9 = postProcessorNames.length;</span><br><span class="line"></span><br><span class="line">        for(var10 = 0; var10 &lt; var9; ++var10) &#123;</span><br><span class="line">            ppName = var18[var10];</span><br><span class="line">            if(!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;</span><br><span class="line">                currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</span><br><span class="line">                processedBeans.add(ppName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sortPostProcessors(currentRegistryProcessors, beanFactory);</span><br><span class="line">        registryProcessors.addAll(currentRegistryProcessors);</span><br><span class="line">        invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</span><br><span class="line">        currentRegistryProcessors.clear();</span><br><span class="line">        boolean reiterate = true;</span><br><span class="line"></span><br><span class="line">        while(reiterate) &#123;</span><br><span class="line">            reiterate = false;</span><br><span class="line">            postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);</span><br><span class="line">            String[] var21 = postProcessorNames;</span><br><span class="line">            var10 = postProcessorNames.length;</span><br><span class="line"></span><br><span class="line">            for(int var28 = 0; var28 &lt; var10; ++var28) &#123;</span><br><span class="line">                String ppName = var21[var28];</span><br><span class="line">                if(!processedBeans.contains(ppName)) &#123;</span><br><span class="line">                    currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</span><br><span class="line">                    processedBeans.add(ppName);</span><br><span class="line">                    reiterate = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sortPostProcessors(currentRegistryProcessors, beanFactory);</span><br><span class="line">            registryProcessors.addAll(currentRegistryProcessors);</span><br><span class="line">            invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</span><br><span class="line">            currentRegistryProcessors.clear();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        invokeBeanFactoryPostProcessors((Collection)registryProcessors, (ConfigurableListableBeanFactory)beanFactory);</span><br><span class="line">        invokeBeanFactoryPostProcessors((Collection)regularPostProcessors, (ConfigurableListableBeanFactory)beanFactory);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        invokeBeanFactoryPostProcessors((Collection)beanFactoryPostProcessors, (ConfigurableListableBeanFactory)beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, true, false);</span><br><span class="line">    List&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList();</span><br><span class="line">    List&lt;String&gt; orderedPostProcessorNames = new ArrayList();</span><br><span class="line">    currentRegistryProcessors = new ArrayList();</span><br><span class="line">    postProcessorNames = postProcessorNames;</span><br><span class="line">    int var22 = postProcessorNames.length;</span><br><span class="line"></span><br><span class="line">    String ppName;</span><br><span class="line">    for(var9 = 0; var9 &lt; var22; ++var9) &#123;</span><br><span class="line">        ppName = postProcessorNames[var9];</span><br><span class="line">        if(!processedBeans.contains(ppName)) &#123;</span><br><span class="line">            if(beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;</span><br><span class="line">                priorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));</span><br><span class="line">            &#125; else if(beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;</span><br><span class="line">                orderedPostProcessorNames.add(ppName);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                currentRegistryProcessors.add(ppName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sortPostProcessors(priorityOrderedPostProcessors, beanFactory);</span><br><span class="line">    invokeBeanFactoryPostProcessors((Collection)priorityOrderedPostProcessors, (ConfigurableListableBeanFactory)beanFactory);</span><br><span class="line">    List&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = new ArrayList();</span><br><span class="line">    Iterator var23 = orderedPostProcessorNames.iterator();</span><br><span class="line"></span><br><span class="line">    while(var23.hasNext()) &#123;</span><br><span class="line">        String postProcessorName = (String)var23.next();</span><br><span class="line">        orderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sortPostProcessors(orderedPostProcessors, beanFactory);</span><br><span class="line">    invokeBeanFactoryPostProcessors((Collection)orderedPostProcessors, (ConfigurableListableBeanFactory)beanFactory);</span><br><span class="line">    List&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = new ArrayList();</span><br><span class="line">    Iterator var26 = currentRegistryProcessors.iterator();</span><br><span class="line"></span><br><span class="line">    while(var26.hasNext()) &#123;</span><br><span class="line">        ppName = (String)var26.next();</span><br><span class="line">        nonOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    invokeBeanFactoryPostProcessors((Collection)nonOrderedPostProcessors, (ConfigurableListableBeanFactory)beanFactory);</span><br><span class="line">    beanFactory.clearMetadataCache();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>AbstractApplicationContextç±»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">protected void prepareRefresh() &#123;</span><br><span class="line">    this.startupDate = System.currentTimeMillis();//è·å–æ—¶é—´</span><br><span class="line">    //AtomicBooleanæ˜¯java.util.concurrent.atomicåŒ…ä¸‹çš„åŸå­å˜é‡ï¼Œè¿™ä¸ªåŒ…é‡Œé¢æä¾›äº†ä¸€ç»„åŸå­ç±»ã€‚å…¶åŸºæœ¬çš„ç‰¹æ€§å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™äº›ç±»çš„å®ä¾‹åŒ…å«çš„æ–¹æ³•æ—¶ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œå³å½“æŸä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤æ—¶ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œè€Œåˆ«çš„çº¿ç¨‹å°±åƒè‡ªæ—‹é”ä¸€æ ·ï¼Œä¸€ç›´ç­‰åˆ°è¯¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰ç”±JVMä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè¿™åªæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„ç†è§£ã€‚å®é™…ä¸Šæ˜¯å€ŸåŠ©ç¡¬ä»¶çš„ç›¸å…³æŒ‡ä»¤æ¥å®ç°çš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹(æˆ–è€…è¯´åªæ˜¯åœ¨ç¡¬ä»¶çº§åˆ«ä¸Šé˜»å¡äº†)ã€‚</span><br><span class="line">    this.closed.set(false);</span><br><span class="line">    this.active.set(true);</span><br><span class="line">    if(this.logger.isInfoEnabled()) &#123;</span><br><span class="line">        this.logger.info(&quot;Refreshing &quot; + this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.initPropertySources();// ç©ºæ–¹æ³•</span><br><span class="line">    // æ ¡éªŒæ‰€æœ‰å¯è§£æçš„æ ¹æ®éœ€è¦æ ‡è®°çš„å±æ€§</span><br><span class="line">    this.getEnvironment().validateRequiredProperties();// æ ¡éªŒåœ¨æ¥å£ConfigurablePropertyResolveræ¥å£ä¸­å®šä¹‰ï¼Œæœªæ‰¾åˆ°å®ç°ç±»</span><br><span class="line">    this.earlyApplicationEvents = new LinkedHashSet();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected ConfigurableListableBeanFactory obtainFreshBeanFactory() &#123;</span><br><span class="line">    this.refreshBeanFactory();// æ–°å®ä¾‹åŒ–ä¸€ä¸ªbeanFactory</span><br><span class="line">    ConfigurableListableBeanFactory beanFactory = this.getBeanFactory();// è·å–beanFactory</span><br><span class="line">    if(this.logger.isDebugEnabled()) &#123;</span><br><span class="line">        this.logger.debug(&quot;Bean factory for &quot; + this.getDisplayName() + &quot;: &quot; + beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return beanFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>FileSystemXmlApplicationContext</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public FileSystemXmlApplicationContext(String[] configLocations, boolean refresh, ApplicationContext parent) throws BeansException &#123;</span><br><span class="line">super(parent);</span><br><span class="line">this.setConfigLocations(configLocations);</span><br><span class="line">if(refresh) &#123;</span><br><span class="line">this.refresh();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ClassPathXmlApplicationContextå’ŒFileSystemXmlApplicationContextçš„åŒºåˆ«"><a href="#ClassPathXmlApplicationContextå’ŒFileSystemXmlApplicationContextçš„åŒºåˆ«" class="headerlink" title="ClassPathXmlApplicationContextå’ŒFileSystemXmlApplicationContextçš„åŒºåˆ«"></a>ClassPathXmlApplicationContextå’ŒFileSystemXmlApplicationContextçš„åŒºåˆ«</h2><p>ClassPathXmlApplicationContext</p><p>ClassPathXmlApplicationContext[åªèƒ½è¯»æ”¾åœ¨web-info/classesç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶]ï¼Œclasspath:å‰ç¼€æ˜¯ä¸éœ€è¦çš„,é»˜è®¤å°±æ˜¯æŒ‡é¡¹ç›®çš„classpathè·¯å¾„ä¸‹é¢;å¦‚æœè¦ä½¿ç”¨ç»å¯¹è·¯å¾„,éœ€è¦åŠ ä¸Šfile:å‰ç¼€è¡¨ç¤ºè¿™æ˜¯ç»å¯¹è·¯å¾„;<br>å¯¹äºFileSystemXmlApplicationContextï¼Œé»˜è®¤è¡¨ç¤ºçš„æ˜¯ä¸¤ç§ï¼Œå¦‚æœè¦ä½¿ç”¨classpathè·¯å¾„,éœ€è¦å‰ç¼€classpath: </p><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="http://www.cnblogs.com/dennyzhangdd/p/7652075.html" target="_blank" rel="noopener">åªä¼šä¸€ç‚¹Java</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Dubboå®¢æˆ·ç«¯æ¶ˆè´¹ï¼ˆè½¬è½½ï¼‰</title>
      <link href="/2018/01/14/dubbo/2018-02-14-Dubbo-Consumer/"/>
      <url>/2018/01/14/dubbo/2018-02-14-Dubbo-Consumer/</url>
      
        <content type="html"><![CDATA[<p>å¼€å‘ä¸€ä¸ªç®€å•çš„RPCæ¡†æ¶ï¼Œé‡ç‚¹éœ€è¦è€ƒè™‘çš„æ˜¯ä¸¤ç‚¹ï¼Œå³ç¼–è§£ç æ–¹å¼å’Œåº•å±‚é€šè®¯åè®®çš„é€‰å‹ï¼Œç¼–è§£ç æ–¹å¼æŒ‡çš„æ˜¯éœ€è¦ä¼ è¾“çš„æ•°æ®åœ¨è°ƒç”¨æ–¹å°†ä»¥ä»€ä¹ˆç»„ç»‡å½¢å¼æ‹†è§£æˆå­—èŠ‚æµå¹¶åœ¨æœåŠ¡æä¾›æ–¹ä»¥ä»€ä¹ˆå½¢å¼è§£æå‡ºæ¥ã€‚ç¼–è§£ç æ–¹å¼çš„è®¾è®¡éœ€è¦è€ƒè™‘åˆ°åæœŸçš„ç‰ˆæœ¬å‡çº§ï¼Œæ‰€ä»¥å¾ˆå¤šRPCåè®®åœ¨è®¾è®¡æ—¶éƒ½ä¼šå¸¦ä¸Šå½“å‰åè®®çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚è€Œåº•å±‚é€šè®¯åè®®çš„é€‰å‹éƒ½å¤§åŒå°å¼‚ï¼Œä¸€èˆ¬éƒ½æ˜¯TCPï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©å»ºç«‹äºTCPä¹‹ä¸Šæ›´é«˜çº§çš„åè®®ï¼Œæ¯”å¦‚Avroã€Thriftå’ŒHTTPç­‰ï¼‰ï¼Œåœ¨Javaè¯­è¨€ä¸­å°±æ˜¯æŒ‡å¥—æ¥å­—Socketï¼Œå½“ç„¶ï¼Œåœ¨Nettyå‡ºç°åï¼Œå¾ˆå°‘RPCæ¡†æ¶ä¼šç›´æ¥ä»¥è‡ªå·±å†™Socketä½œä¸ºé»˜è®¤å®ç°çš„é€šè®¯æ–¹å¼ï¼Œä½†é€šå¸¸ä¹Ÿä¼šè‡ªå·±å®ç°ä¸€ä¸ªaioã€nioæˆ–bioç‰ˆæœ¬ç»™é‚£äº›â€œä¸æ–¹ä¾¿â€ä¾èµ–Nettyåº“çš„åº”ç”¨ç³»ç»Ÿæ¥ä½¿ç”¨ã€‚</p><p> åœ¨Dubboçš„æºç ä¸­ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬æ¨¡å—dubbo-rpcï¼Œå…¶ä¸­ï¼Œæœ€é‡è¦çš„åº”è¯¥æ˜¯Protocolå’ŒInvokerä¸¤ä¸ªæ¥å£ï¼Œä»£è¡¨ç€åè®®ï¼ˆç¼–è§£ç æ–¹å¼ï¼‰å’Œè°ƒç”¨è¿‡ç¨‹ï¼ˆé€šè®¯æ–¹å¼ï¼‰ã€‚Invokeræ¥å£ç»§æ‰¿äºNodeæ¥å£ï¼ŒNodeæ¥å£è§„èŒƒäº†Dubboä½“ç³»ä¸­å„ç»„ä»¶ä¹‹é—´é€šè®¯çš„åŸºæœ¬è¦ç´ ï¼š </p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public interface Node &#123;  </span><br><span class="line">    // åè®®æ•°æ®è½½ä½“  </span><br><span class="line">    URL getUrl();  </span><br><span class="line">    // çŠ¶æ€ç›‘æµ‹ï¼Œå½“å‰æ˜¯å¦å¯ç”¨  </span><br><span class="line">    boolean isAvailable();  </span><br><span class="line">    // é”€æ¯æ–¹æ³•  </span><br><span class="line">    void destroy();  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">public interface Invoker&lt;T&gt; extends Node &#123;  </span><br><span class="line">    // è·å–è°ƒç”¨çš„æ¥å£  </span><br><span class="line">    Class&lt;T&gt; getInterface();  </span><br><span class="line">    // è°ƒç”¨è¿‡ç¨‹  </span><br><span class="line">    Result invoke(Invocation invocation) throws RpcException;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springåœ¨åˆå§‹åŒ–IOCå®¹å™¨ï¼Œé€šè¿‡DubboNamespaceHandlerç±»æ¥è§£ædubboç›¸å…³æ ‡ç­¾ï¼Œåœ¨è§£æå®¢æˆ·ç«¯æ ‡ç­¾dubbo:referenceæ—¶ï¼Œæ ‡ç­¾è§£æå‡ºæ¥çš„ç›¸å…³å±æ€§éƒ½æ˜¯å­˜å‚¨åˆ°ReferenceBeanç±»ä¸­ï¼Œå› ä¸ºReferenceBeanç±»å®ç°äº†InitializingBeanæ¥å£ï¼Œæ‰€ä»¥åœ¨è®¾ç½®æ ‡ç­¾æ‰€æœ‰å±æ€§åä¼šè°ƒç”¨afterPropertiesSetæ–¹æ³•ï¼Œå…³äºæ ‡ç­¾beanè½½ä½“ç±»å®ç°springæ¡†æ¶çš„InitializingBeanæ¥å£ç›¸å…³çŸ¥è¯†å¯ä»¥è‡ªå·±ç™¾åº¦äº†è§£ä¸‹ï¼Œæœ‰å¾ˆå¤šå†™çš„æ¯”è¾ƒå¥½çš„æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸åœ¨ç»†è¯´ã€‚å…·ä½“çœ‹afterPropertiesSetæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@SuppressWarnings(&#123; &quot;unchecked&quot;&#125;)  </span><br><span class="line">    public void afterPropertiesSet() throws Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        //åˆ¤æ–­å½“å‰ConsumerConfigæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ä»springå®¹å™¨ä¸­å–ç›¸å…³çš„ConsumerConfigå¯¹è±¡ï¼Œå¹¶è®¾ç½®åˆ°å½“å‰å±æ€§ä¸­  </span><br><span class="line">        if (getConsumer() == null) &#123;  </span><br><span class="line">            Map&lt;String, ConsumerConfig&gt; consumerConfigMap = applicationContext == null ? null  : BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, ConsumerConfig.class, false, false);  </span><br><span class="line">            if (consumerConfigMap != null &amp;&amp; consumerConfigMap.size() &gt; 0) &#123;  </span><br><span class="line">                ConsumerConfig consumerConfig = null;  </span><br><span class="line">                for (ConsumerConfig config : consumerConfigMap.values()) &#123;  </span><br><span class="line">                    if (config.isDefault() == null || config.isDefault().booleanValue()) &#123;  </span><br><span class="line">                        if (consumerConfig != null) &#123;  </span><br><span class="line">                            throw new IllegalStateException(&quot;Duplicate consumer configs: &quot; + consumerConfig + &quot; and &quot; + config);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        consumerConfig = config;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                if (consumerConfig != null) &#123;  </span><br><span class="line">                    //è®¾ç½®å½“å‰ConsumerConfigå¯¹è±¡  </span><br><span class="line">                    setConsumer(consumerConfig);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        //åˆ¤æ–­å½“å‰ApplicationConfigæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ä»springå®¹å™¨ä¸­è·å–ï¼Œå¹¶å…³è”åˆ°å½“å‰ç±»çš„å±æ€§ä¸­  </span><br><span class="line">        if (getApplication() == null  </span><br><span class="line">                &amp;&amp; (getConsumer() == null || getConsumer().getApplication() == null)) &#123;  </span><br><span class="line">            Map&lt;String, ApplicationConfig&gt; applicationConfigMap = applicationContext == null ? null : BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, ApplicationConfig.class, false, false);  </span><br><span class="line">            if (applicationConfigMap != null &amp;&amp; applicationConfigMap.size() &gt; 0) &#123;  </span><br><span class="line">                ApplicationConfig applicationConfig = null;  </span><br><span class="line">                for (ApplicationConfig config : applicationConfigMap.values()) &#123;  </span><br><span class="line">                    if (config.isDefault() == null || config.isDefault().booleanValue()) &#123;  </span><br><span class="line">                        if (applicationConfig != null) &#123;  </span><br><span class="line">                            throw new IllegalStateException(&quot;Duplicate application configs: &quot; + applicationConfig + &quot; and &quot; + config);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        applicationConfig = config;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                if (applicationConfig != null) &#123;  </span><br><span class="line">                    //è®¾ç½®å½“å‰ApplicationConfigå±æ€§  </span><br><span class="line">                    setApplication(applicationConfig);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        //åˆ¤æ–­å½“å‰ModuleConfigæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ä»springå®¹å™¨ä¸­è·å–ï¼Œå¹¶å…³è”åˆ°å½“å‰ç±»å±æ€§ä¸­  </span><br><span class="line">        if (getModule() == null  </span><br><span class="line">                &amp;&amp; (getConsumer() == null || getConsumer().getModule() == null)) &#123;  </span><br><span class="line">            Map&lt;String, ModuleConfig&gt; moduleConfigMap = applicationContext == null ? null : BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, ModuleConfig.class, false, false);  </span><br><span class="line">            if (moduleConfigMap != null &amp;&amp; moduleConfigMap.size() &gt; 0) &#123;  </span><br><span class="line">                ModuleConfig moduleConfig = null;  </span><br><span class="line">                for (ModuleConfig config : moduleConfigMap.values()) &#123;  </span><br><span class="line">                    if (config.isDefault() == null || config.isDefault().booleanValue()) &#123;  </span><br><span class="line">                        if (moduleConfig != null) &#123;  </span><br><span class="line">                            throw new IllegalStateException(&quot;Duplicate module configs: &quot; + moduleConfig + &quot; and &quot; + config);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        moduleConfig = config;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                if (moduleConfig != null) &#123;  </span><br><span class="line">                    //è®¾ç½®å½“å‰ModuleConfigå¯¹è±¡  </span><br><span class="line">                    setModule(moduleConfig);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        //åˆ¤æ–­å½“å‰List&lt;RegistryConfig&gt;æ³¨å†Œä¸­å¿ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ä»springå®¹å™¨ä¸­è·å–ï¼Œå¹¶å…³è”åˆ°å½“å‰ç±»å±æ€§ä¸­  </span><br><span class="line">        if ((getRegistries() == null || getRegistries().size() == 0)  </span><br><span class="line">                &amp;&amp; (getConsumer() == null || getConsumer().getRegistries() == null || getConsumer().getRegistries().size() == 0)  </span><br><span class="line">                &amp;&amp; (getApplication() == null || getApplication().getRegistries() == null || getApplication().getRegistries().size() == 0)) &#123;  </span><br><span class="line">            Map&lt;String, RegistryConfig&gt; registryConfigMap = applicationContext == null ? null : BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, RegistryConfig.class, false, false);  </span><br><span class="line">            if (registryConfigMap != null &amp;&amp; registryConfigMap.size() &gt; 0) &#123;  </span><br><span class="line">                List&lt;RegistryConfig&gt; registryConfigs = new ArrayList&lt;RegistryConfig&gt;();  </span><br><span class="line">                for (RegistryConfig config : registryConfigMap.values()) &#123;  </span><br><span class="line">                    if (config.isDefault() == null || config.isDefault().booleanValue()) &#123;  </span><br><span class="line">                        registryConfigs.add(config);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                if (registryConfigs != null &amp;&amp; registryConfigs.size() &gt; 0) &#123;  </span><br><span class="line">                    //è®¾ç½®å½“å‰çš„æ³¨å†Œä¸­å¿ƒ  </span><br><span class="line">                    super.setRegistries(registryConfigs);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        //åˆ¤æ–­å½“å‰MonitorConfigç›‘æ§ä¸­å¿ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ä»springå®¹å™¨ä¸­è·å–  </span><br><span class="line">        if (getMonitor() == null  </span><br><span class="line">                &amp;&amp; (getConsumer() == null || getConsumer().getMonitor() == null)  </span><br><span class="line">                &amp;&amp; (getApplication() == null || getApplication().getMonitor() == null)) &#123;  </span><br><span class="line">            Map&lt;String, MonitorConfig&gt; monitorConfigMap = applicationContext == null ? null : BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, MonitorConfig.class, false, false);  </span><br><span class="line">            if (monitorConfigMap != null &amp;&amp; monitorConfigMap.size() &gt; 0) &#123;  </span><br><span class="line">                MonitorConfig monitorConfig = null;  </span><br><span class="line">                for (MonitorConfig config : monitorConfigMap.values()) &#123;  </span><br><span class="line">                    if (config.isDefault() == null || config.isDefault().booleanValue()) &#123;  </span><br><span class="line">                        if (monitorConfig != null) &#123;  </span><br><span class="line">                            throw new IllegalStateException(&quot;Duplicate monitor configs: &quot; + monitorConfig + &quot; and &quot; + config);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        monitorConfig = config;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                if (monitorConfig != null) &#123;  </span><br><span class="line">                    //è®¾ç½®å½“å‰çš„ç›‘æ§ä¸­å¿ƒ  </span><br><span class="line">                    setMonitor(monitorConfig);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        Boolean b = isInit();  </span><br><span class="line">        if (b == null &amp;&amp; getConsumer() != null) &#123;  </span><br><span class="line">            b = getConsumer().isInit();  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        //æ˜¯å¦å®¹å™¨å¯åŠ¨åŠ è½½æ—¶ï¼Œç«‹å³åˆå§‹åŒ–ï¼Œé»˜è®¤æ˜¯ä¸ç«‹åˆ»åˆå§‹åŒ–å¤„ç†ï¼Œå¯ä»¥é€šè¿‡åœ¨dubbo:referenceæ ‡ç­¾é‡Œé¢é…ç½®init=trueæ¥è®¾ç½®  </span><br><span class="line">        if (b != null &amp;&amp; b.booleanValue()) &#123;  </span><br><span class="line">            getObject();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>getObjectä¸­è°ƒç”¨init(),initæ€»ä½“æ€è·¯å°±æ˜¯å†æ¬¡æ£€æµ‹äº†Consumerï¼ŒApplicationï¼ŒModuleï¼ŒRegistriesç­‰é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†é…ç½®ä¿¡æ¯å…¨éƒ¨å­˜å…¥åˆ°Mapä¸­ã€‚æ³¨æ„æœ€åä¸€æ®µä»£ç  ref = createProxy(map); çœ‹ä»£ç åº”è¯¥å°±èƒ½ç†è§£å®ƒçš„ä½œç”¨åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶ä¼ å…¥äº†å‰é¢å­˜è¿›æ‰€æœ‰å‚æ•°çš„mapå±æ€§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private T createProxy(Map&lt;String, String&gt; map) &#123;  </span><br><span class="line">       //æ ¹æ®mapä¸­çš„å±æ€§å€¼ç”ŸæˆURLå¯¹è±¡  </span><br><span class="line">       URL tmpUrl = new URL(&quot;temp&quot;, &quot;localhost&quot;, 0, map);  </span><br><span class="line">       final boolean isJvmRefer;  </span><br><span class="line">       if (isInjvm() == null) &#123;  </span><br><span class="line">           if (url != null &amp;&amp; url.length() &gt; 0) &#123; //æŒ‡å®šURLçš„æƒ…å†µä¸‹ï¼Œä¸åšæœ¬åœ°å¼•ç”¨  </span><br><span class="line">               isJvmRefer = false;  </span><br><span class="line">           &#125; else if (InjvmProtocol.getInjvmProtocol().isInjvmRefer(tmpUrl)) &#123;  </span><br><span class="line">               //é»˜è®¤æƒ…å†µä¸‹å¦‚æœæœ¬åœ°æœ‰æœåŠ¡æš´éœ²ï¼Œåˆ™å¼•ç”¨æœ¬åœ°æœåŠ¡.  </span><br><span class="line">               isJvmRefer = true;  </span><br><span class="line">           &#125; else &#123;  </span><br><span class="line">               isJvmRefer = false;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125; else &#123;  </span><br><span class="line">           isJvmRefer = isInjvm().booleanValue();  </span><br><span class="line">       &#125;  </span><br><span class="line">         </span><br><span class="line">       if (isJvmRefer) &#123;  </span><br><span class="line">           URL url = new URL(Constants.LOCAL_PROTOCOL, NetUtils.LOCALHOST, 0, interfaceClass.getName()).addParameters(map);  </span><br><span class="line">           invoker = refprotocol.refer(interfaceClass, url);  </span><br><span class="line">           if (logger.isInfoEnabled()) &#123;  </span><br><span class="line">               logger.info(&quot;Using injvm service &quot; + interfaceClass.getName());  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125; else &#123;  </span><br><span class="line"> </span><br><span class="line">           //åˆ¤æ–­å½“å‰å®¢æˆ·ç«¯æ˜¯å¦æ˜¯ç‚¹å¯¹ç‚¹ç›´è¿ï¼Œç›´è¿ä¼šè·³è¿‡æ³¨å†Œä¸­å¿ƒ  </span><br><span class="line">           //ç›´è¿æˆ–è€…æ³¨å†Œè¿æ¥çš„urléƒ½ä¼šå­˜å‚¨åœ¨urlsä¸­  </span><br><span class="line">           if (url != null &amp;&amp; url.length() &gt; 0) &#123; // ç”¨æˆ·æŒ‡å®šURLï¼ŒæŒ‡å®šçš„URLå¯èƒ½æ˜¯å¯¹ç‚¹å¯¹ç›´è¿åœ°å€ï¼Œä¹Ÿå¯èƒ½æ˜¯æ³¨å†Œä¸­å¿ƒURL  </span><br><span class="line">               String[] us = Constants.SEMICOLON_SPLIT_PATTERN.split(url);  </span><br><span class="line">               if (us != null &amp;&amp; us.length &gt; 0) &#123;  </span><br><span class="line">                   for (String u : us) &#123;  </span><br><span class="line">                       URL url = URL.valueOf(u);  </span><br><span class="line">                       if (url.getPath() == null || url.getPath().length() == 0) &#123;  </span><br><span class="line">                           url = url.setPath(interfaceName);  </span><br><span class="line">                       &#125;  </span><br><span class="line">                       if (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) &#123;  </span><br><span class="line">                           urls.add(url.addParameterAndEncoded(Constants.REFER_KEY, StringUtils.toQueryString(map)));  </span><br><span class="line">                       &#125; else &#123;  </span><br><span class="line">                           urls.add(ClusterUtils.mergeUrl(url, map));  </span><br><span class="line">                       &#125;  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125; else &#123;  </span><br><span class="line">               // é€šè¿‡æ³¨å†Œä¸­å¿ƒé…ç½®æ‹¼è£…URL  </span><br><span class="line">               List&lt;URL&gt; us = loadRegistries(false);  </span><br><span class="line">               if (us != null &amp;&amp; us.size() &gt; 0) &#123;  </span><br><span class="line">                   for (URL u : us) &#123;  </span><br><span class="line">                       URL monitorUrl = loadMonitor(u);  </span><br><span class="line">                       if (monitorUrl != null) &#123;  </span><br><span class="line">                           map.put(Constants.MONITOR_KEY, URL.encode(monitorUrl.toFullString()));  </span><br><span class="line">                       &#125;  </span><br><span class="line">                       urls.add(u.addParameterAndEncoded(Constants.REFER_KEY, StringUtils.toQueryString(map)));  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">               if (urls == null || urls.size() == 0) &#123;  </span><br><span class="line">                   throw new IllegalStateException(&quot;No such any registry to reference &quot; + interfaceName  + &quot; on the consumer &quot; + NetUtils.getLocalHost() + &quot; use dubbo version &quot; + Version.getVersion() + &quot;, please config &lt;dubbo:registry address=\&quot;...\&quot; /&gt; to your spring config.&quot;);  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">           if (urls.size() == 1) &#123;  </span><br><span class="line">               //åªæœ‰ä¸€ä¸ªæ³¨å†ŒæœåŠ¡å™¨æ—¶ï¼Œç”Ÿæˆå®¢æˆ·ç«¯çš„ä»£ç†invoker  </span><br><span class="line">               invoker = refprotocol.refer(interfaceClass, urls.get(0));  </span><br><span class="line">           &#125; else &#123;  </span><br><span class="line"> </span><br><span class="line">               //å½“æœ‰å¤šä¸ªæ³¨å†ŒæœåŠ¡å™¨æ—¶ï¼Œç”Ÿæˆå¤šä¸ªå®¢æˆ·ç«¯ä»£ç†  </span><br><span class="line">               List&lt;Invoker&lt;?&gt;&gt; invokers = new ArrayList&lt;Invoker&lt;?&gt;&gt;();  </span><br><span class="line">               URL registryURL = null;  </span><br><span class="line">               for (URL url : urls) &#123;  </span><br><span class="line">                   //å¤šä¸ªæœåŠ¡ç«¯ï¼Œç”Ÿæˆå¤šä¸ªå¯¹åº”çš„invokerå¯¹è±¡  </span><br><span class="line">                   invokers.add(refprotocol.refer(interfaceClass, url));  </span><br><span class="line">                   if (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) &#123;  </span><br><span class="line">                       registryURL = url; // ç”¨äº†æœ€åä¸€ä¸ªæ³¨å†ŒæœåŠ¡å™¨ä½œä¸ºæ³¨å†Œä¸­å¿ƒ registry url  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">               if (registryURL != null) &#123; // æœ‰ æ³¨å†Œä¸­å¿ƒåè®®çš„URL  </span><br><span class="line">                   // å¯¹æœ‰æ³¨å†Œä¸­å¿ƒçš„é›†ç¾¤ åªç”¨ AvailableCluster  </span><br><span class="line">                   URL u = registryURL.addParameter(Constants.CLUSTER_KEY, AvailableCluster.NAME);   </span><br><span class="line">                   invoker = cluster.join(new StaticDirectory(u, invokers));  </span><br><span class="line">               &#125;  else &#123; // ä¸æ˜¯ æ³¨å†Œä¸­å¿ƒçš„URL  </span><br><span class="line">                   invoker = cluster.join(new StaticDirectory(invokers));  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line"> </span><br><span class="line">       Boolean c = check;  </span><br><span class="line">       if (c == null &amp;&amp; consumer != null) &#123;  </span><br><span class="line">           c = consumer.isCheck();  </span><br><span class="line">       &#125;  </span><br><span class="line">       if (c == null) &#123;  </span><br><span class="line">           c = true; // default true  </span><br><span class="line">       &#125;  </span><br><span class="line">       if (c &amp;&amp; ! invoker.isAvailable()) &#123;  </span><br><span class="line">           throw new IllegalStateException(&quot;Failed to check the status of the service &quot; + interfaceName + &quot;. No provider available for the service &quot; + (group == null ? &quot;&quot; : group + &quot;/&quot;) + interfaceName + (version == null ? &quot;&quot; : &quot;:&quot; + version) + &quot; from the url &quot; + invoker.getUrl() + &quot; to the consumer &quot; + NetUtils.getLocalHost() + &quot; use dubbo version &quot; + Version.getVersion());  </span><br><span class="line">       &#125;  </span><br><span class="line">       if (logger.isInfoEnabled()) &#123;  </span><br><span class="line">           logger.info(&quot;Refer dubbo service &quot; + interfaceClass.getName() + &quot; from url &quot; + invoker.getUrl());  </span><br><span class="line">       &#125;  </span><br><span class="line">       // åˆ›å»ºæœåŠ¡ä»£ç†  </span><br><span class="line">       return (T) proxyFactory.getProxy(invoker);  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ³•ä¸­ä¸»è¦åšäº†ä¸€ä»¶äº‹æƒ…å°±æ˜¯åˆ›å»ºå®¢æˆ·ç«¯æ¥å£çš„invokerå¯¹è±¡ï¼Œæˆ‘ä»¬é‡ç‚¹è§£æè¿™æ®µä»£ç  invoker = refprotocol.refer(interfaceClass, url);Protocolæœ‰å¾ˆå¤šä¸ªå®ç°ç±»ï¼Œä½†æ˜¯ReferenceConfigä½œä¸ºæœåŠ¡æä¾›æ–¹çš„ä¸€ä¸ªæ¥å£å®ä¾‹ï¼Œæ­¤æ—¶å¹¶ä¸çŸ¥é“è¯¥è°ƒç”¨å“ªä¸ªå®ç°ç±»ï¼Œå½“ç”Ÿæˆä¸€ä¸ªrefprotocolæ¥ä»£è¡¨æ‰€æœ‰çš„å®ç°ç±»ï¼Œå½“è°ƒç”¨åˆ°è¯¥ç±»ä¸­çš„exportæ–¹æ³•çš„æ—¶å€™ï¼Œå†æ ¹æ®æ–¹æ³•çš„å‚æ•°æ¥å†³å®šè°ƒç”¨åˆ°å“ªä¸ªå…·ä½“çš„å®ç°ç±»ä¸­ï¼Œç›¸å½“äºä¸€ç§é«˜çº§åˆ«çš„ä»£ç†ã€‚</p><p>refprotocolå¯¹è±¡æ˜¯ä»€ä¹ˆæ€ä¹ˆåˆ›å»ºçš„ï¼Œåˆ›å»ºä»£ç å¦‚ä¸‹ <code>Protocol refprotocol = ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension();</code>å…·ä½“å¦‚ä½•åˆ›å»ºå‡ºæ¥çš„åé¢ä¸“é—¨é€šè¿‡ç« èŠ‚æ¥è®²è§£ï¼Œ è¿™é‡Œæˆ‘å°±é»˜è®¤refprotocolå±æ€§æ˜¯DubboProtocolç±»äº†ï¼ŒæŸ¥çœ‹è¯¥ç±»çš„referæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">public &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; serviceType, URL url) throws RpcException &#123;  </span><br><span class="line">  </span><br><span class="line">        // modified by lishen  </span><br><span class="line">        optimizeSerialization(url);  </span><br><span class="line">  </span><br><span class="line">        // create rpc invoker.  </span><br><span class="line">        DubboInvoker&lt;T&gt; invoker = new DubboInvoker&lt;T&gt;(serviceType, url, getClients(url), invokers);  </span><br><span class="line">        invokers.add(invoker);  </span><br><span class="line">        return invoker;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>invokerå¯¹è±¡åŸæ¥å°±æ˜¯DubboInvokerç±»ã€‚å› ä¸ºDubboInvokerç»§æ‰¿äº†AbstractInvokerç±»ï¼Œå®ƒé‡å†™äº†çˆ¶ç±»çš„doInvokeæ–¹æ³•ã€‚åœ¨çœ‹çœ‹AbstractInvokerä»£ç ï¼Œå®ƒçš„invokeæ–¹æ³•ä¸­æœ€ç»ˆè¿˜æ˜¯æ‰§è¡Œäº†doInvokeæ–¹æ³•ï¼Œå› ä¸ºå½“å‰ç±»çš„doInvokeæ˜¯æŠ½è±¡çš„ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯æ‰§è¡Œäº†DubboInvokerä¸­çš„doInvokeæ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">public class DubboInvoker&lt;T&gt; extends AbstractInvoker&lt;T&gt; &#123;  </span><br><span class="line">  </span><br><span class="line">        private final ExchangeClient[]      clients;  </span><br><span class="line">  </span><br><span class="line">        private final AtomicPositiveInteger index = new AtomicPositiveInteger();  </span><br><span class="line">  </span><br><span class="line">        private final String                version;  </span><br><span class="line">          </span><br><span class="line">        private final ReentrantLock     destroyLock = new ReentrantLock();  </span><br><span class="line">          </span><br><span class="line">        private final Set&lt;Invoker&lt;?&gt;&gt; invokers;  </span><br><span class="line">          </span><br><span class="line">        public DubboInvoker(Class&lt;T&gt; serviceType, URL url, ExchangeClient[] clients)&#123;  </span><br><span class="line">            this(serviceType, url, clients, null);  </span><br><span class="line">        &#125;  </span><br><span class="line">          </span><br><span class="line">        public DubboInvoker(Class&lt;T&gt; serviceType, URL url, ExchangeClient[] clients, Set&lt;Invoker&lt;?&gt;&gt; invokers)&#123;  </span><br><span class="line">            super(serviceType, url, new String[] &#123;Constants.INTERFACE_KEY, Constants.GROUP_KEY, Constants.TOKEN_KEY, Constants.TIMEOUT_KEY&#125;);  </span><br><span class="line">            this.clients = clients;  </span><br><span class="line">            // get version.  </span><br><span class="line">            this.version = url.getParameter(Constants.VERSION_KEY, &quot;0.0.0&quot;);  </span><br><span class="line">            this.invokers = invokers;   </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        @Override  </span><br><span class="line">        protected Result doInvoke(final Invocation invocation) throws Throwable &#123;  </span><br><span class="line">            RpcInvocation inv = (RpcInvocation) invocation;  </span><br><span class="line">            final String methodName = RpcUtils.getMethodName(invocation);  </span><br><span class="line">            inv.setAttachment(Constants.PATH_KEY, getUrl().getPath());  </span><br><span class="line">            inv.setAttachment(Constants.VERSION_KEY, version);  </span><br><span class="line">              </span><br><span class="line">            ExchangeClient currentClient;  </span><br><span class="line">            if (clients.length == 1) &#123;  </span><br><span class="line">                currentClient = clients[0];  </span><br><span class="line">            &#125; else &#123;  </span><br><span class="line">                currentClient = clients[index.getAndIncrement() % clients.length];  </span><br><span class="line">            &#125;  </span><br><span class="line">            try &#123;  </span><br><span class="line">                boolean isAsync = RpcUtils.isAsync(getUrl(), invocation);  </span><br><span class="line">                boolean isOneway = RpcUtils.isOneway(getUrl(), invocation);  </span><br><span class="line">                int timeout = getUrl().getMethodParameter(methodName, Constants.TIMEOUT_KEY,Constants.DEFAULT_TIMEOUT);  </span><br><span class="line">                if (isOneway) &#123;  </span><br><span class="line">                    //åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œä¸éœ€è¦ç­‰å¾…åé¦ˆæ¥å£ï¼Œæ‰€ä»¥ç»“æœå§‹ç»ˆæœªNULL  </span><br><span class="line">                    boolean isSent = getUrl().getMethodParameter(methodName, Constants.SENT_KEY, false);  </span><br><span class="line">                    currentClient.send(inv, isSent);  </span><br><span class="line">                    RpcContext.getContext().setFuture(null);  </span><br><span class="line">                    return new RpcResult();  </span><br><span class="line">                &#125; else if (isAsync) &#123;  </span><br><span class="line">                    //å¼‚æ­¥è¯·æ±‚  </span><br><span class="line">                    ResponseFuture future = currentClient.request(inv, timeout) ;  </span><br><span class="line">                    RpcContext.getContext().setFuture(new FutureAdapter&lt;Object&gt;(future));  </span><br><span class="line">                    return new RpcResult();  </span><br><span class="line">                &#125; else &#123;  </span><br><span class="line">                    //é»˜è®¤é˜»å¡è¯·æ±‚  </span><br><span class="line">                    RpcContext.getContext().setFuture(null);  </span><br><span class="line">                    return (Result) currentClient.request(inv, timeout).get();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; catch (TimeoutException e) &#123;  </span><br><span class="line">                throw new RpcException(RpcException.TIMEOUT_EXCEPTION, &quot;Invoke remote method timeout. method: &quot; + invocation.getMethodName() + &quot;, provider: &quot; + getUrl() + &quot;, cause: &quot; + e.getMessage(), e);  </span><br><span class="line">            &#125; catch (RemotingException e) &#123;  </span><br><span class="line">                throw new RpcException(RpcException.NETWORK_EXCEPTION, &quot;Failed to invoke remote method: &quot; + invocation.getMethodName() + &quot;, provider: &quot; + getUrl() + &quot;, cause: &quot; + e.getMessage(), e);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">          </span><br><span class="line">        @Override  </span><br><span class="line">        public boolean isAvailable() &#123;  </span><br><span class="line">            if (!super.isAvailable())  </span><br><span class="line">                return false;  </span><br><span class="line">            for (ExchangeClient client : clients)&#123;  </span><br><span class="line">                if (client.isConnected() &amp;&amp; !client.hasAttribute(Constants.CHANNEL_ATTRIBUTE_READONLY_KEY))&#123;  </span><br><span class="line">                    //cannot write == not Available ?  </span><br><span class="line">                    return true ;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            return false;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        public void destroy() &#123;  </span><br><span class="line">            //é˜²æ­¢clientè¢«å…³é—­å¤šæ¬¡.åœ¨connect per jvmçš„æƒ…å†µä¸‹ï¼Œclient.closeæ–¹æ³•ä¼šè°ƒç”¨è®¡æ•°å™¨-1ï¼Œå½“è®¡æ•°å™¨å°äºç­‰äº0çš„æƒ…å†µä¸‹ï¼Œæ‰çœŸæ­£å…³é—­  </span><br><span class="line">            if (super.isDestroyed())&#123;  </span><br><span class="line">                return ;  </span><br><span class="line">            &#125; else &#123;  </span><br><span class="line">                //dubbo check ,é¿å…å¤šæ¬¡å…³é—­  </span><br><span class="line">                destroyLock.lock();  </span><br><span class="line">                try&#123;  </span><br><span class="line">                    if (super.isDestroyed())&#123;  </span><br><span class="line">                        return ;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    super.destroy();  </span><br><span class="line">                    if (invokers != null)&#123;  </span><br><span class="line">                        invokers.remove(this);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    for (ExchangeClient client : clients) &#123;  </span><br><span class="line">                        try &#123;  </span><br><span class="line">                            client.close();  </span><br><span class="line">                        &#125; catch (Throwable t) &#123;  </span><br><span class="line">                            logger.warn(t.getMessage(), t);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                      </span><br><span class="line">                &#125;finally &#123;  </span><br><span class="line">                    destroyLock.unlock();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„çœ‹doInvokeæ–¹æ³•ä¸­çš„å®ç°ï¼Œä»ExchangeClient clients[]æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªå¯¹è±¡currentClientå°†å®¢æˆ·ç«¯æ¥å£è¯·æ±‚ä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯å¤„ç†ã€‚æ³¨æ„äº†è¿™é‡Œçš„ExchangeClientä¿å­˜çš„æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹çš„socketé“¾æ¥å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯nettyçš„å®¢æˆ·ç«¯å¯¹è±¡ã€‚ åœ¨å‘é€è¯·æ±‚å¤„ç†æœ‰3ä¸ªé€»è¾‘åˆ¤æ–­</p><p>1.åªè´Ÿè´£å‘é€è¯·æ±‚ï¼Œä¸éœ€è¦ç­‰å¾…åé¦ˆæ¶ˆæ¯</p><p>2.å¼‚æ­¥è¯·æ±‚</p><p>3.é»˜è®¤æ˜¯é˜»å¡çš„è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public abstract class AbstractProxyFactory implements ProxyFactory &#123;  </span><br><span class="line">  </span><br><span class="line">        public &lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker) throws RpcException &#123;  </span><br><span class="line">            Class&lt;?&gt;[] interfaces = null;  </span><br><span class="line">            String config = invoker.getUrl().getParameter(&quot;interfaces&quot;);  </span><br><span class="line">            if (config != null &amp;&amp; config.length() &gt; 0) &#123;  </span><br><span class="line">                String[] types = Constants.COMMA_SPLIT_PATTERN.split(config);  </span><br><span class="line">                if (types != null &amp;&amp; types.length &gt; 0) &#123;  </span><br><span class="line">                    interfaces = new Class&lt;?&gt;[types.length + 2];  </span><br><span class="line">                    interfaces[0] = invoker.getInterface();  </span><br><span class="line">                    interfaces[1] = EchoService.class;  </span><br><span class="line">                    for (int i = 0; i &lt; types.length; i ++) &#123;  </span><br><span class="line">                        interfaces[i + 1] = ReflectUtils.forName(types[i]);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            if (interfaces == null) &#123;  </span><br><span class="line">                interfaces = new Class&lt;?&gt;[] &#123;invoker.getInterface(), EchoService.class&#125;;  </span><br><span class="line">            &#125;  </span><br><span class="line">            return getProxy(invoker, interfaces);  </span><br><span class="line">        &#125;  </span><br><span class="line">          </span><br><span class="line">        public abstract &lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] types);  </span><br><span class="line">  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å›åˆ°ä»£ç†çš„åˆ›å»ºæ–¹æ³•ReferenceConfig.createProxyä¸­æœ€åä¸€è¡Œçš„ä»£ç return (T) proxyFactory.getProxy(invoker); æœ€åè¿˜æ˜¯æ‰§è¡Œäº†æŠ½è±¡çš„getProxyæ–¹æ³•ã€‚å› ä¸ºJavassistProxyFactoryç±»ç»§æ‰¿äº†AbstractProxyFactoryï¼Œå¹¶é‡å†™äº†getProxyæ–¹æ³•æ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯æ‰§è¡Œäº†JavassistProxyFactoryç±»ä¸­çš„getProxyæ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@SuppressWarnings(&quot;unchecked&quot;)  </span><br><span class="line">    public &lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] interfaces) &#123;  </span><br><span class="line">        return (T) Proxy.getProxy(interfaces).newInstance(new InvokerInvocationHandler(invoker));  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://blog.csdn.net/qiangcai/article/details/77581201" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ListIteratorå’ŒIteratorçš„åŒºåˆ«</title>
      <link href="/2018/01/12/java/2018-01-12-listirerator/"/>
      <url>/2018/01/12/java/2018-01-12-listirerator/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨ä½¿ç”¨List,Setçš„æ—¶å€™ï¼Œä¸ºäº†å®ç°å¯¹å…¶æ•°æ®çš„éå†ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°äº†Iterator(è¿­ä»£å™¨)ã€‚ä½¿ç”¨è¿­ä»£å™¨ï¼Œä½ ä¸éœ€è¦å¹²æ¶‰å…¶éå†çš„è¿‡ç¨‹ï¼Œåªéœ€è¦æ¯æ¬¡å–å‡ºä¸€ä¸ªä½ æƒ³è¦çš„æ•°æ®è¿›è¡Œå¤„ç†å°±å¯ä»¥äº†ã€‚</p><p>ä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿæ˜¯æœ‰ä¸åŒçš„ã€‚Listå’ŒSetéƒ½æœ‰iterator()æ¥å–å¾—å…¶è¿­ä»£å™¨ã€‚å¯¹Listæ¥è¯´ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡listIterator()å–å¾—å…¶è¿­ä»£å™¨ï¼Œä¸¤ç§è¿­ä»£å™¨åœ¨æœ‰äº›æ—¶å€™æ˜¯ä¸èƒ½é€šç”¨çš„ï¼ŒIteratorå’ŒListIteratorä¸»è¦åŒºåˆ«åœ¨ä»¥ä¸‹æ–¹é¢ï¼š</p><ul><li><p>ListIteratoræœ‰add()æ–¹æ³•ï¼Œå¯ä»¥å‘Listä¸­æ·»åŠ å¯¹è±¡ï¼Œè€ŒIteratorä¸èƒ½</p></li><li><p>ListIteratorå’ŒIteratoréƒ½æœ‰hasNext()å’Œnext()æ–¹æ³•ï¼Œå¯ä»¥å®ç°é¡ºåºå‘åéå†ï¼Œä½†æ˜¯ListIteratoræœ‰hasPrevious()å’Œprevious()æ–¹æ³•ï¼Œå¯ä»¥å®ç°é€†å‘ï¼ˆé¡ºåºå‘å‰ï¼‰éå†ã€‚Iteratorå°±ä¸å¯ä»¥ã€‚</p></li><li><p>ListIteratorå¯ä»¥å®šä½å½“å‰çš„ç´¢å¼•ä½ç½®ï¼ŒnextIndex()å’ŒpreviousIndex()å¯ä»¥å®ç°ã€‚Iteratoræ²¡æœ‰æ­¤åŠŸèƒ½ã€‚</p></li><li><p>éƒ½å¯å®ç°åˆ é™¤å¯¹è±¡ï¼Œä½†æ˜¯ListIteratorå¯ä»¥å®ç°å¯¹è±¡çš„ä¿®æ”¹ï¼Œset()æ–¹æ³•å¯ä»¥å®ç°ã€‚Iieratorä»…èƒ½éå†ï¼Œä¸èƒ½ä¿®æ”¹ã€‚</p></li><li><p>ä½¿ç”¨èŒƒå›´ä¸åŒï¼ŒIteratorå¯ä»¥åº”ç”¨äºæ‰€æœ‰çš„é›†åˆï¼ŒSetã€Listå’ŒMapå’Œè¿™äº›é›†åˆçš„å­ç±»å‹ã€‚è€ŒListIteratoråªèƒ½ç”¨äºListåŠå…¶å­ç±»å‹ã€‚</p></li></ul><p>å› ä¸ºListIteratorçš„è¿™äº›åŠŸèƒ½ï¼Œå¯ä»¥å®ç°å¯¹LinkedListç­‰Listæ•°æ®ç»“æ„çš„æ“ä½œã€‚å…¶å®ï¼Œæ•°ç»„å¯¹è±¡ä¹Ÿå¯ä»¥ç”¨è¿­ä»£å™¨æ¥å®ç°ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Vectoræºç è§£æ</title>
      <link href="/2018/01/12/java/2018-01-12-Vector/"/>
      <url>/2018/01/12/java/2018-01-12-Vector/</url>
      
        <content type="html"><![CDATA[<h2 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h2><pre><code>Vectoræºç è§£æçš„ä¸å¤ªç»†è‡´ï¼Œå› ä¸ºå¤§å¤šæ•°å’ŒArrayListç±»ä¼¼ï¼Œåªä¸è¿‡åŠ äº†SyncchronizedåŒæ­¥</code></pre><p>Vector æ˜¯çŸ¢é‡é˜Ÿåˆ—ï¼Œå®ƒæ˜¯JDK1.0ç‰ˆæœ¬æ·»åŠ çš„ç±»ã€‚ç»§æ‰¿äºAbstractListï¼Œå®ç°äº†List, RandomAccess, Cloneableè¿™äº›æ¥å£ã€‚</p><p>Vector ç»§æ‰¿äº†AbstractListï¼Œå®ç°äº†Listï¼›æ‰€ä»¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ”¯æŒç›¸å…³çš„æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€éå†ç­‰åŠŸèƒ½ã€‚</p><p>Vector å®ç°äº†RandmoAccessæ¥å£ï¼Œå³æä¾›äº†éšæœºè®¿é—®åŠŸèƒ½ã€‚RandmoAccessæ˜¯javaä¸­ç”¨æ¥è¢«Listå®ç°ï¼Œä¸ºListæä¾›å¿«é€Ÿè®¿é—®åŠŸèƒ½çš„ã€‚åœ¨Vectorä¸­ï¼Œæˆ‘ä»¬å³å¯ä»¥é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡ï¼›è¿™å°±æ˜¯å¿«é€Ÿéšæœºè®¿é—®ã€‚</p><p>Vector å®ç°äº†Cloneableæ¥å£ï¼Œå³å®ç°clone()å‡½æ•°ã€‚å®ƒèƒ½è¢«å…‹éš†ã€‚</p><p>ArrayListå’ŒVectorä¸åŒï¼ŒVectorä¸­çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›ä½†æ˜¯ï¼ŒVectorä¸æ”¯æŒåºåˆ—åŒ–ï¼Œå³æ²¡æœ‰å®ç°java.io.Serializableæ¥å£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br></pre></td><td class="code"><pre><span class="line">public class Vector&lt;E&gt;</span><br><span class="line">        extends AbstractList&lt;E&gt;</span><br><span class="line">        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br><span class="line">&#123;</span><br><span class="line">    // æ•°æ®å­˜å‚¨æ•°ç»„  </span><br><span class="line">    protected Object[] elementData;</span><br><span class="line"></span><br><span class="line">    // å…ƒç´ æ•°é‡  </span><br><span class="line">    protected int elementCount;</span><br><span class="line"></span><br><span class="line">    // å®¹é‡å¢é•¿ç³»æ•°  </span><br><span class="line">    protected int capacityIncrement;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private static final long serialVersionUID = -2767605614048989439L;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public Vector(int initialCapacity, int capacityIncrement) &#123;</span><br><span class="line">        super();</span><br><span class="line">        if (initialCapacity &lt; 0)</span><br><span class="line">            throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+</span><br><span class="line">                    initialCapacity);</span><br><span class="line">        this.elementData = new Object[initialCapacity];</span><br><span class="line">        this.capacityIncrement = capacityIncrement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public Vector(int initialCapacity) &#123;</span><br><span class="line">        this(initialCapacity, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public Vector() &#123;</span><br><span class="line">        this(10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public Vector(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        elementData = c.toArray();</span><br><span class="line">        elementCount = elementData.length;</span><br><span class="line">        // c.toArray might (incorrectly) not return Object[] (see 6260652)</span><br><span class="line">        if (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, elementCount, Object[].class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å¤åˆ¶æ•°ç»„  </span><br><span class="line">    public synchronized void copyInto(Object[] anArray) &#123;</span><br><span class="line">        System.arraycopy(elementData, 0, anArray, 0, elementCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç¼©å°æ•°ç»„è‡³å…ƒç´ æ•°é‡å¤§å°  </span><br><span class="line">    public synchronized void trimToSize() &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        int oldCapacity = elementData.length;</span><br><span class="line">        if (elementCount &lt; oldCapacity) &#123;</span><br><span class="line">            elementData = Arrays.copyOf(elementData, elementCount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç¡®å®šæ•°ç»„æœ€å°å®¹é‡&gt;minCapacity  </span><br><span class="line">    public synchronized void ensureCapacity(int minCapacity) &#123;</span><br><span class="line">        if (minCapacity &gt; 0) &#123;</span><br><span class="line">            modCount++;</span><br><span class="line">            ensureCapacityHelper(minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç¡®å®šæ•°ç»„æœ€å°å®¹é‡&gt;minCapacity    </span><br><span class="line">    private void ensureCapacityHelper(int minCapacity) &#123;</span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        if (minCapacity - elementData.length &gt; 0)</span><br><span class="line">            grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;</span><br><span class="line">    // æ•°ç»„å®¹é‡çš„å¢é•¿æ–¹å¼</span><br><span class="line">    private void grow(int minCapacity) &#123;</span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        int oldCapacity = elementData.length;</span><br><span class="line">        int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ?</span><br><span class="line">                capacityIncrement : oldCapacity);</span><br><span class="line">        if (newCapacity - minCapacity &lt; 0)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    // åˆ¤æ–­minCapacityæ˜¯å¦å¤§äºMax_ARRAY_SIZEï¼Œå¤§äº=Integer.MAX_VALUEã€‚</span><br><span class="line">    private static int hugeCapacity(int minCapacity) &#123;</span><br><span class="line">        if (minCapacity &lt; 0) // overflow</span><br><span class="line">            throw new OutOfMemoryError();</span><br><span class="line">        return (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">                Integer.MAX_VALUE :</span><br><span class="line">                MAX_ARRAY_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æŒ‡å®šæ•°ç»„å®¹é‡  </span><br><span class="line">    public synchronized void setSize(int newSize) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        if (newSize &gt; elementCount) &#123;</span><br><span class="line">            ensureCapacityHelper(newSize);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (int i = newSize ; i &lt; elementCount ; i++) &#123;</span><br><span class="line">                elementData[i] = null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        elementCount = newSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized int capacity() &#123;</span><br><span class="line">        return elementData.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized int size() &#123;</span><br><span class="line">        return elementCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean isEmpty() &#123;</span><br><span class="line">        return elementCount == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›â€œVectorä¸­å…¨éƒ¨å…ƒç´ å¯¹åº”çš„Enumerationâ€  </span><br><span class="line">    public Enumeration&lt;E&gt; elements() &#123;</span><br><span class="line">        return new Enumeration&lt;E&gt;() &#123;</span><br><span class="line">            int count = 0;</span><br><span class="line"></span><br><span class="line">            public boolean hasMoreElements() &#123;</span><br><span class="line">                return count &lt; elementCount;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public E nextElement() &#123;</span><br><span class="line">                synchronized (Vector.this) &#123;</span><br><span class="line">                    if (count &lt; elementCount) &#123;</span><br><span class="line">                        return elementData(count++);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                throw new NoSuchElementException(&quot;Vector Enumeration&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public boolean contains(Object o) &#123;</span><br><span class="line">        return indexOf(o, 0) &gt;= 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public int indexOf(Object o) &#123;</span><br><span class="line">        return indexOf(o, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized int indexOf(Object o, int index) &#123;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (int i = index ; i &lt; elementCount ; i++)</span><br><span class="line">                if (elementData[i]==null)</span><br><span class="line">                    return i;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (int i = index ; i &lt; elementCount ; i++)</span><br><span class="line">                if (o.equals(elementData[i]))</span><br><span class="line">                    return i;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized int lastIndexOf(Object o) &#123;</span><br><span class="line">        return lastIndexOf(o, elementCount-1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized int lastIndexOf(Object o, int index) &#123;</span><br><span class="line">        if (index &gt;= elementCount)</span><br><span class="line">            throw new IndexOutOfBoundsException(index + &quot; &gt;= &quot;+ elementCount);</span><br><span class="line"></span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (int i = index; i &gt;= 0; i--)</span><br><span class="line">                if (elementData[i]==null)</span><br><span class="line">                    return i;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (int i = index; i &gt;= 0; i--)</span><br><span class="line">                if (o.equals(elementData[i]))</span><br><span class="line">                    return i;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized E elementAt(int index) &#123;</span><br><span class="line">        if (index &gt;= elementCount) &#123;</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index + &quot; &gt;= &quot; + elementCount);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return elementData(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized E firstElement() &#123;</span><br><span class="line">        if (elementCount == 0) &#123;</span><br><span class="line">            throw new NoSuchElementException();</span><br><span class="line">        &#125;</span><br><span class="line">        return elementData(0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized E lastElement() &#123;</span><br><span class="line">        if (elementCount == 0) &#123;</span><br><span class="line">            throw new NoSuchElementException();</span><br><span class="line">        &#125;</span><br><span class="line">        return elementData(elementCount - 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized void setElementAt(E obj, int index) &#123;</span><br><span class="line">        if (index &gt;= elementCount) &#123;</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index + &quot; &gt;= &quot; +</span><br><span class="line">                    elementCount);</span><br><span class="line">        &#125;</span><br><span class="line">        elementData[index] = obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized void removeElementAt(int index) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        if (index &gt;= elementCount) &#123;</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index + &quot; &gt;= &quot; +</span><br><span class="line">                    elementCount);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (index &lt; 0) &#123;</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index);</span><br><span class="line">        &#125;</span><br><span class="line">        int j = elementCount - index - 1;</span><br><span class="line">        if (j &gt; 0) &#123;</span><br><span class="line">            System.arraycopy(elementData, index + 1, elementData, index, j);</span><br><span class="line">        &#125;</span><br><span class="line">        elementCount--;</span><br><span class="line">        elementData[elementCount] = null;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized void insertElementAt(E obj, int index) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        if (index &gt; elementCount) &#123;</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index</span><br><span class="line">                    + &quot; &gt; &quot; + elementCount);</span><br><span class="line">        &#125;</span><br><span class="line">        ensureCapacityHelper(elementCount + 1);</span><br><span class="line">        System.arraycopy(elementData, index, elementData, index + 1, elementCount - index);</span><br><span class="line">        elementData[index] = obj;</span><br><span class="line">        elementCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized void addElement(E obj) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        ensureCapacityHelper(elementCount + 1);</span><br><span class="line">        elementData[elementCount++] = obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean removeElement(Object obj) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        int i = indexOf(obj);</span><br><span class="line">        if (i &gt;= 0) &#123;</span><br><span class="line">            removeElementAt(i);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized void removeAllElements() &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        // Let gc do its work</span><br><span class="line">        for (int i = 0; i &lt; elementCount; i++)</span><br><span class="line">            elementData[i] = null;</span><br><span class="line"></span><br><span class="line">        elementCount = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized Object clone() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">            Vector&lt;E&gt; v = (Vector&lt;E&gt;) super.clone();</span><br><span class="line">            v.elementData = Arrays.copyOf(elementData, elementCount);</span><br><span class="line">            v.modCount = 0;</span><br><span class="line">            return v;</span><br><span class="line">        &#125; catch (CloneNotSupportedException e) &#123;</span><br><span class="line">            // this shouldn&apos;t happen, since we are Cloneable</span><br><span class="line">            throw new InternalError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized Object[] toArray() &#123;</span><br><span class="line">        return Arrays.copyOf(elementData, elementCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public synchronized &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">        if (a.length &lt; elementCount)</span><br><span class="line">            return (T[]) Arrays.copyOf(elementData, elementCount, a.getClass());</span><br><span class="line"></span><br><span class="line">        System.arraycopy(elementData, 0, a, 0, elementCount);</span><br><span class="line"></span><br><span class="line">        if (a.length &gt; elementCount)</span><br><span class="line">            a[elementCount] = null;</span><br><span class="line"></span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Positional Access Operations</span><br><span class="line"></span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    E elementData(int index) &#123;</span><br><span class="line">        return (E) elementData[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized E get(int index) &#123;</span><br><span class="line">        if (index &gt;= elementCount)</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index);</span><br><span class="line"></span><br><span class="line">        return elementData(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized E set(int index, E element) &#123;</span><br><span class="line">        if (index &gt;= elementCount)</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index);</span><br><span class="line"></span><br><span class="line">        E oldValue = elementData(index);</span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        return oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean add(E e) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        ensureCapacityHelper(elementCount + 1);</span><br><span class="line">        elementData[elementCount++] = e;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public boolean remove(Object o) &#123;</span><br><span class="line">        return removeElement(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public void add(int index, E element) &#123;</span><br><span class="line">        insertElementAt(element, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized E remove(int index) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        if (index &gt;= elementCount)</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index);</span><br><span class="line">        E oldValue = elementData(index);</span><br><span class="line"></span><br><span class="line">        int numMoved = elementCount - index - 1;</span><br><span class="line">        if (numMoved &gt; 0)</span><br><span class="line">            System.arraycopy(elementData, index+1, elementData, index,</span><br><span class="line">                    numMoved);</span><br><span class="line">        elementData[--elementCount] = null; // Let gc do its work</span><br><span class="line"></span><br><span class="line">        return oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public void clear() &#123;</span><br><span class="line">        removeAllElements();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Bulk Operations</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean containsAll(Collection&lt;?&gt; c) &#123;</span><br><span class="line">        return super.containsAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean addAll(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        int numNew = a.length;</span><br><span class="line">        ensureCapacityHelper(elementCount + numNew);</span><br><span class="line">        System.arraycopy(a, 0, elementData, elementCount, numNew);</span><br><span class="line">        elementCount += numNew;</span><br><span class="line">        return numNew != 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean removeAll(Collection&lt;?&gt; c) &#123;</span><br><span class="line">        return super.removeAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean retainAll(Collection&lt;?&gt; c) &#123;</span><br><span class="line">        return super.retainAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        if (index &lt; 0 || index &gt; elementCount)</span><br><span class="line">            throw new ArrayIndexOutOfBoundsException(index);</span><br><span class="line"></span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        int numNew = a.length;</span><br><span class="line">        ensureCapacityHelper(elementCount + numNew);</span><br><span class="line"></span><br><span class="line">        int numMoved = elementCount - index;</span><br><span class="line">        if (numMoved &gt; 0)</span><br><span class="line">            System.arraycopy(elementData, index, elementData, index + numNew,</span><br><span class="line">                    numMoved);</span><br><span class="line"></span><br><span class="line">        System.arraycopy(a, 0, elementData, index, numNew);</span><br><span class="line">        elementCount += numNew;</span><br><span class="line">        return numNew != 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized boolean equals(Object o) &#123;</span><br><span class="line">        return super.equals(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized int hashCode() &#123;</span><br><span class="line">        return super.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized String toString() &#123;</span><br><span class="line">        return super.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized List&lt;E&gt; subList(int fromIndex, int toIndex) &#123;</span><br><span class="line">        return Collections.synchronizedList(super.subList(fromIndex, toIndex),</span><br><span class="line">                this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    protected synchronized void removeRange(int fromIndex, int toIndex) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        int numMoved = elementCount - toIndex;</span><br><span class="line">        System.arraycopy(elementData, toIndex, elementData, fromIndex,</span><br><span class="line">                numMoved);</span><br><span class="line"></span><br><span class="line">        // Let gc do its work</span><br><span class="line">        int newElementCount = elementCount - (toIndex-fromIndex);</span><br><span class="line">        while (elementCount != newElementCount)</span><br><span class="line">            elementData[--elementCount] = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private void writeObject(java.io.ObjectOutputStream s)</span><br><span class="line">            throws java.io.IOException &#123;</span><br><span class="line">        final java.io.ObjectOutputStream.PutField fields = s.putFields();</span><br><span class="line">        final Object[] data;</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            fields.put(&quot;capacityIncrement&quot;, capacityIncrement);</span><br><span class="line">            fields.put(&quot;elementCount&quot;, elementCount);</span><br><span class="line">            data = elementData.clone();</span><br><span class="line">        &#125;</span><br><span class="line">        fields.put(&quot;elementData&quot;, data);</span><br><span class="line">        s.writeFields();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized ListIterator&lt;E&gt; listIterator(int index) &#123;</span><br><span class="line">        if (index &lt; 0 || index &gt; elementCount)</span><br><span class="line">            throw new IndexOutOfBoundsException(&quot;Index: &quot;+index);</span><br><span class="line">        return new ListItr(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized ListIterator&lt;E&gt; listIterator() &#123;</span><br><span class="line">        return new ListItr(0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public synchronized Iterator&lt;E&gt; iterator() &#123;</span><br><span class="line">        return new Itr();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private class Itr implements Iterator&lt;E&gt; &#123;</span><br><span class="line">        int cursor;       // index of next element to return</span><br><span class="line">        int lastRet = -1; // index of last element returned; -1 if no such</span><br><span class="line">        int expectedModCount = modCount;</span><br><span class="line"></span><br><span class="line">        public boolean hasNext() &#123;</span><br><span class="line">            // Racy but within spec, since modifications are checked</span><br><span class="line">            // within or after synchronization in next/previous</span><br><span class="line">            return cursor != elementCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public E next() &#123;</span><br><span class="line">            synchronized (Vector.this) &#123;</span><br><span class="line">                checkForComodification();</span><br><span class="line">                int i = cursor;</span><br><span class="line">                if (i &gt;= elementCount)</span><br><span class="line">                    throw new NoSuchElementException();</span><br><span class="line">                cursor = i + 1;</span><br><span class="line">                return elementData(lastRet = i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void remove() &#123;</span><br><span class="line">            if (lastRet == -1)</span><br><span class="line">                throw new IllegalStateException();</span><br><span class="line">            synchronized (Vector.this) &#123;</span><br><span class="line">                checkForComodification();</span><br><span class="line">                Vector.this.remove(lastRet);</span><br><span class="line">                expectedModCount = modCount;</span><br><span class="line">            &#125;</span><br><span class="line">            cursor = lastRet;</span><br><span class="line">            lastRet = -1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        final void checkForComodification() &#123;</span><br><span class="line">            if (modCount != expectedModCount)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    final class ListItr extends Itr implements ListIterator&lt;E&gt; &#123;</span><br><span class="line">        ListItr(int index) &#123;</span><br><span class="line">            super();</span><br><span class="line">            cursor = index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean hasPrevious() &#123;</span><br><span class="line">            return cursor != 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int nextIndex() &#123;</span><br><span class="line">            return cursor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int previousIndex() &#123;</span><br><span class="line">            return cursor - 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public E previous() &#123;</span><br><span class="line">            synchronized (Vector.this) &#123;</span><br><span class="line">                checkForComodification();</span><br><span class="line">                int i = cursor - 1;</span><br><span class="line">                if (i &lt; 0)</span><br><span class="line">                    throw new NoSuchElementException();</span><br><span class="line">                cursor = i;</span><br><span class="line">                return elementData(lastRet = i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void set(E e) &#123;</span><br><span class="line">            if (lastRet == -1)</span><br><span class="line">                throw new IllegalStateException();</span><br><span class="line">            synchronized (Vector.this) &#123;</span><br><span class="line">                checkForComodification();</span><br><span class="line">                Vector.this.set(lastRet, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void add(E e) &#123;</span><br><span class="line">            int i = cursor;</span><br><span class="line">            synchronized (Vector.this) &#123;</span><br><span class="line">                checkForComodification();</span><br><span class="line">                Vector.this.add(i, e);</span><br><span class="line">                expectedModCount = modCount;</span><br><span class="line">            &#125;</span><br><span class="line">            cursor = i + 1;</span><br><span class="line">            lastRet = -1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Java æ·±æ‹·è´å’Œæµ…æ‹·è´</title>
      <link href="/2018/01/12/java/2018-01-12-Clone/"/>
      <url>/2018/01/12/java/2018-01-12-Clone/</url>
      
        <content type="html"><![CDATA[<p>æ€»ç»“ï¼šæµ…æ‹·è´æ˜¯æŒ‡åœ¨æ‹·è´å¯¹è±¡æ—¶ï¼Œå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ä¼šé‡æ–°å¤åˆ¶ä¸€ä»½ï¼Œè€Œå¯¹äºå¼•ç”¨ç±»å‹çš„å˜é‡åªæ˜¯å¯¹å¼•ç”¨è¿›è¡Œæ‹·è´ï¼Œ</p><p>æ²¡æœ‰å¯¹å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡è¿›è¡Œæ‹·è´ã€‚</p><p>è€Œæ·±æ‹·è´æ˜¯æŒ‡åœ¨æ‹·è´å¯¹è±¡æ—¶ï¼ŒåŒæ—¶ä¼šå¯¹å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡è¿›è¡Œæ‹·è´ã€‚</p><p>åŒºåˆ«å°±åœ¨äºæ˜¯å¦å¯¹  å¯¹è±¡ä¸­çš„å¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å¯¹è±¡è¿›è¡Œæ‹·è´ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä¸‹å®ä¾‹ä¹Ÿç®—æ˜¯æµ…æ‹·è´ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class Address implements Cloneable &#123;</span><br><span class="line">private String add;</span><br><span class="line">    </span><br><span class="line">    Private Data date;</span><br><span class="line"></span><br><span class="line">public String getAdd() &#123;</span><br><span class="line">return add;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    public Date getDate()&#123;</span><br><span class="line">    </span><br><span class="line">        return this.date;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    public void setDate(Date date)&#123;</span><br><span class="line">        this.date = date;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">public void setAdd(String add) &#123;</span><br><span class="line">this.add = add;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public Object clone() &#123;</span><br><span class="line">Address addr = null;</span><br><span class="line">try&#123;</span><br><span class="line">addr = (Address)super.clone();</span><br><span class="line">&#125;catch(CloneNotSupportedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">//addr.setDate(this.getDate().clone());å¦‚æœæ²¡æœ‰è¿™å¥ï¼Œaddrå¯¹è±¡å’ŒåŸæœ‰å¯¹è±¡å¯¹Dateå¯¹è±¡å¼•ç”¨è¿˜æ˜¯ä¸€ä¸ªï¼Œå±äºæµ…æ‹·è´ã€‚</span><br><span class="line">return addr;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>LinkedListæºç è§£æ</title>
      <link href="/2018/01/12/java/2018-01-12-LinkedList/"/>
      <url>/2018/01/12/java/2018-01-12-LinkedList/</url>
      
        <content type="html"><![CDATA[<h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><p>LinkedList æ˜¯ä¸€ä¸ªç»§æ‰¿äºAbstractSequentialListçš„åŒå‘é“¾è¡¨ã€‚å®ƒä¹Ÿå¯ä»¥è¢«å½“ä½œå †æ ˆã€é˜Ÿåˆ—æˆ–åŒç«¯é˜Ÿåˆ—è¿›è¡Œæ“ä½œã€‚</p><p>LinkedList æ˜¯Listå’ŒDequeæ¥å£çš„åŒå‘é“¾è¡¨çš„å®ç°ã€‚å®ç°äº†æ‰€æœ‰å¯é€‰åˆ—è¡¨æ“ä½œï¼Œå¹¶å…è®¸åŒ…æ‹¬nullå€¼ã€‚</p><p>LinkedList å…¶é¡ºåºè®¿é—®éå¸¸é«˜æ•ˆï¼Œè€Œéšæœºè®¿é—®æ•ˆç‡æ¯”è¾ƒä½ã€‚</p><p>LinkedList å®ç°äº†Cloneableæ¥å£ï¼Œå³è¦†ç›–äº†å‡½æ•°clone()ï¼Œèƒ½å…‹éš†ã€‚</p><p>LinkedList å®ç°java.io.Serializableæ¥å£ï¼Œè¿™æ„å‘³ç€LinkedListæ”¯æŒåºåˆ—åŒ–ï¼Œèƒ½é€šè¿‡åºåˆ—åŒ–å»ä¼ è¾“ã€‚</p><p>LinkedList æ˜¯éåŒæ­¥çš„ã€‚</p><p>å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªLinkedListå®ä¾‹ï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡åŒæ­¥é‚£äº›ç”¨æ¥å°è£…åˆ—è¡¨çš„ å¯¹è±¡æ¥å®ç°çš„ã€‚ä½†å¦‚æœæ²¡æœ‰è¿™æ ·çš„å¯¹è±¡å­˜åœ¨ï¼Œåˆ™è¯¥åˆ—è¡¨éœ€è¦è¿ç”¨{@link Collections#synchronizedList Collections.synchronizedList}æ¥è¿›è¡Œâ€œåŒ…è£…â€ï¼Œè¯¥æ–¹æ³•æœ€å¥½æ˜¯åœ¨åˆ›å»ºåˆ—è¡¨å¯¹è±¡æ—¶å®Œæˆï¼Œä¸ºäº†é¿å…å¯¹åˆ—è¡¨è¿›è¡Œçªå‘çš„éåŒæ­¥æ“ä½œã€‚</p><p><code>List list = Collections.synchronizedList(new LinkedList(...));</code></p><p>ä½¿ç”¨synchronizedListåœ¨è¿­ä»£çš„æ—¶å€™ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±åŠ ä¸Šçº¿ç¨‹é”æ§åˆ¶ä»£ç ï¼Œå› ä¸ºåœ¨æ•´ä¸ªè¿­ä»£çš„è¿‡ç¨‹ä¸­å¦‚æœåœ¨å¾ªç¯å¤–é¢ä¸åŠ åŒæ­¥ä»£ç ï¼Œåœ¨ä¸€æ¬¡æ¬¡è¿­ä»£ä¹‹é—´ï¼Œå…¶ä»–çº¿ç¨‹å¯¹äºè¿™ä¸ªå®¹å™¨çš„addæˆ–è€…removeä¼šå½±å“æ•´ä¸ªè¿­ä»£çš„é¢„æœŸæ•ˆæœï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨æˆ·åœ¨æ•´ä¸ªå¾ªç¯å¤–é¢åŠ ä¸Šsynchronized(list);</p><p>ç±»ä¸­çš„iterator()æ–¹æ³•å’ŒlistIterator()æ–¹æ³•è¿”å›çš„iteratorsè¿­ä»£å™¨æ˜¯fail-fastçš„ï¼šå½“æŸä¸€ä¸ªçº¿ç¨‹Aé€šè¿‡iteratorå»éå†æŸé›†åˆçš„è¿‡ç¨‹ä¸­ï¼Œè‹¥è¯¥é›†åˆçš„å†…å®¹è¢«å…¶ä»–çº¿ç¨‹æ‰€æ”¹å˜äº†ï¼›é‚£ä¹ˆçº¿ç¨‹Aè®¿é—®é›†åˆæ—¶ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œäº§ç”Ÿfail-fastäº‹ä»¶ã€‚</p><p><img src="https://images0.cnblogs.com/blog/497634/201401/272345393446232.jpg" alt="LinkedListå…³ç³»å›¾"></p><p><a href="https://images0.cnblogs.com/blog/497634/201401/272345393446232.jpg" target="_blank" rel="noopener">å›¾ç‰‡åœ°å€ï¼šhttps://images0.cnblogs.com/blog/497634/201401/272345393446232.jpg</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br></pre></td><td class="code"><pre><span class="line">public class LinkedList&lt;E&gt;</span><br><span class="line">        extends AbstractSequentialList&lt;E&gt;</span><br><span class="line">        implements List&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable</span><br><span class="line">&#123;</span><br><span class="line">    // </span><br><span class="line">    transient int size = 0;</span><br><span class="line"></span><br><span class="line">    // é¦–èŠ‚ç‚¹  </span><br><span class="line">    transient Node&lt;E&gt; first;</span><br><span class="line"></span><br><span class="line">    // å°¾èŠ‚ç‚¹  </span><br><span class="line">    transient Node&lt;E&gt; last;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public LinkedList() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public LinkedList(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        this();</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä½¿ç”¨å‚æ•°ä½œä¸ºé¦–èŠ‚ç‚¹  </span><br><span class="line">    private void linkFirst(E e) &#123;</span><br><span class="line">        final Node&lt;E&gt; f = first; // è·å–å½“å‰é¦–èŠ‚ç‚¹</span><br><span class="line">        final Node&lt;E&gt; newNode = new Node&lt;&gt;(null, e, f); // ä½¿ç”¨å‚æ•°åˆ›å»ºèŠ‚ç‚¹ï¼ŒnextæŒ‡å‘få³åŸé¦–èŠ‚ç‚¹</span><br><span class="line">        first = newNode; // è®¾ç½®é¦–èŠ‚ç‚¹</span><br><span class="line">        if (f == null) // ç»´æŠ¤åŒå‘é“¾è¡¨</span><br><span class="line">            last = newNode;</span><br><span class="line">        else</span><br><span class="line">            f.prev = newNode;</span><br><span class="line">        size++; // ç»´æŠ¤é“¾è¡¨å¤§å°</span><br><span class="line">        modCount++;// è®°å½•è¢«æ”¹åŠ¨æ¬¡æ•°</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    void linkLast(E e) &#123;</span><br><span class="line">        final Node&lt;E&gt; l = last;</span><br><span class="line">        final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null);</span><br><span class="line">        last = newNode;</span><br><span class="line">        if (l == null)</span><br><span class="line">            first = newNode;</span><br><span class="line">        else</span><br><span class="line">            l.next = newNode;</span><br><span class="line">        size++;</span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å°†å‚æ•°eæ’å…¥èŠ‚ç‚¹succå‰é¢  </span><br><span class="line">    void linkBefore(E e, Node&lt;E&gt; succ) &#123;</span><br><span class="line">        // assert succ != null;</span><br><span class="line">        final Node&lt;E&gt; pred = succ.prev;// è·å–succçš„prevèŠ‚ç‚¹</span><br><span class="line">        final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ);// ä½¿ç”¨å‚æ•°æ–°å»ºèŠ‚ç‚¹ï¼Œå¹¶æŠŠprevæŒ‡å‘predï¼ŒnextæŒ‡å‘succ</span><br><span class="line">        succ.prev = newNode;</span><br><span class="line">        if (pred == null) </span><br><span class="line">            first = newNode;</span><br><span class="line">        else</span><br><span class="line">            pred.next = newNode;</span><br><span class="line">        size++;</span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     //åˆ é™¤é¦–èŠ‚ç‚¹å¹¶è¿”å›åˆ é™¤å‰é¦–èŠ‚ç‚¹çš„å€¼ï¼Œå†…éƒ¨ä½¿ç”¨  </span><br><span class="line">    private E unlinkFirst(Node&lt;E&gt; f) &#123;</span><br><span class="line">        // assert f == first &amp;&amp; f != null;</span><br><span class="line">        final E element = f.item;</span><br><span class="line">        final Node&lt;E&gt; next = f.next;</span><br><span class="line">        f.item = null;</span><br><span class="line">        f.next = null; // help GC</span><br><span class="line">        first = next;</span><br><span class="line">        if (next == null)</span><br><span class="line">            last = null;</span><br><span class="line">        else</span><br><span class="line">            next.prev = null;</span><br><span class="line">        size--;</span><br><span class="line">        modCount++;</span><br><span class="line">        return element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //åˆ é™¤å°¾èŠ‚ç‚¹å¹¶è¿”å›åˆ é™¤å‰å°¾èŠ‚ç‚¹çš„å€¼ï¼Œå†…éƒ¨ä½¿ç”¨  </span><br><span class="line">    private E unlinkLast(Node&lt;E&gt; l) &#123;</span><br><span class="line">        // assert l == last &amp;&amp; l != null;</span><br><span class="line">        final E element = l.item;</span><br><span class="line">        final Node&lt;E&gt; prev = l.prev;</span><br><span class="line">        l.item = null;</span><br><span class="line">        l.prev = null; // help GC</span><br><span class="line">        last = prev;</span><br><span class="line">        if (prev == null)</span><br><span class="line">            first = null;</span><br><span class="line">        else</span><br><span class="line">            prev.next = null;</span><br><span class="line">        size--;</span><br><span class="line">        modCount++;</span><br><span class="line">        return element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //åˆ é™¤æŒ‡å®šèŠ‚ç‚¹å¹¶è¿”å›è¢«åˆ é™¤çš„å…ƒç´ å€¼  </span><br><span class="line">    E unlink(Node&lt;E&gt; x) &#123;</span><br><span class="line">        // assert x != null;</span><br><span class="line">        final E element = x.item;</span><br><span class="line">        final Node&lt;E&gt; next = x.next;</span><br><span class="line">        final Node&lt;E&gt; prev = x.prev;</span><br><span class="line"></span><br><span class="line">        if (prev == null) &#123;</span><br><span class="line">            first = next;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            prev.next = next;</span><br><span class="line">            x.prev = null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (next == null) &#123;</span><br><span class="line">            last = prev;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            next.prev = prev;</span><br><span class="line">            x.next = null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        x.item = null;</span><br><span class="line">        size--;</span><br><span class="line">        modCount++;</span><br><span class="line">        return element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public E getFirst() &#123;</span><br><span class="line">        final Node&lt;E&gt; f = first;</span><br><span class="line">        if (f == null)</span><br><span class="line">            throw new NoSuchElementException();</span><br><span class="line">        return f.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public E getLast() &#123;</span><br><span class="line">        final Node&lt;E&gt; l = last;</span><br><span class="line">        if (l == null)</span><br><span class="line">            throw new NoSuchElementException();</span><br><span class="line">        return l.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public E removeFirst() &#123;</span><br><span class="line">        final Node&lt;E&gt; f = first;</span><br><span class="line">        if (f == null)</span><br><span class="line">            throw new NoSuchElementException();</span><br><span class="line">        return unlinkFirst(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public E removeLast() &#123;</span><br><span class="line">        final Node&lt;E&gt; l = last;</span><br><span class="line">        if (l == null)</span><br><span class="line">            throw new NoSuchElementException();</span><br><span class="line">        return unlinkLast(l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public void addFirst(E e) &#123;</span><br><span class="line">        linkFirst(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public void addLast(E e) &#123;</span><br><span class="line">        linkLast(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public boolean contains(Object o) &#123;</span><br><span class="line">        return indexOf(o) != -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public int size() &#123;</span><br><span class="line">        return size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">        linkLast(e);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ é™¤æŒ‡å®šå…ƒç´   </span><br><span class="line">    public boolean remove(Object o) &#123;// éå†åˆ é™¤</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123;</span><br><span class="line">                if (x.item == null) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123;</span><br><span class="line">                if (o.equals(x.item)) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public boolean addAll(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        return addAll(size, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä»indexå¤„å¼€å§‹æ·»åŠ é›†åˆ  </span><br><span class="line">    public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        int numNew = a.length;</span><br><span class="line">        if (numNew == 0)</span><br><span class="line">            return false;// cä¸ºç©ºè¿”å›false</span><br><span class="line"></span><br><span class="line">        Node&lt;E&gt; pred, succ; // å£°æ˜ä¸¤ä¸ªå˜é‡ï¼Œpredæ˜¯è®°å½•indexä¹‹å‰çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œsuccæ˜¯è®°å½•indexä½ç½®çš„èŠ‚ç‚¹ã€‚</span><br><span class="line">        if (index == size) &#123;</span><br><span class="line">            succ = null;</span><br><span class="line">            pred = last;</span><br><span class="line">        &#125; else &#123; </span><br><span class="line">            succ = node(index);</span><br><span class="line">            pred = succ.prev;</span><br><span class="line">        &#125;</span><br><span class="line">        // éå†é›†åˆï¼Œå°†é›†åˆä¸­çš„å…ƒç´ ä¸€ä¸ªä¸€ä¸ªçš„æ·»åŠ åˆ°predèŠ‚ç‚¹åé¢</span><br><span class="line">        for (Object o : a) &#123;</span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;) E e = (E) o;</span><br><span class="line">            Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, null);</span><br><span class="line">            if (pred == null)</span><br><span class="line">                first = newNode;</span><br><span class="line">            else</span><br><span class="line">                pred.next = newNode;</span><br><span class="line">            pred = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        // åŠ ä¸ŠsuccèŠ‚ç‚¹ï¼Œå¦‚æœsuccèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™åˆ·æ–°lastèŠ‚ç‚¹ï¼Œå¦åˆ™ç›´æ¥æ·»åŠ succå³å¯</span><br><span class="line">        if (succ == null) &#123;</span><br><span class="line">            last = pred;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            pred.next = succ;</span><br><span class="line">            succ.prev = pred;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        size += numNew;</span><br><span class="line">        modCount++;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public void clear() &#123;</span><br><span class="line">        // Clearing all of the links between nodes is &quot;unnecessary&quot;, but:</span><br><span class="line">        // - helps a generational GC if the discarded nodes inhabit</span><br><span class="line">        //   more than one generation</span><br><span class="line">        // - is sure to free memory even if there is a reachable Iterator</span><br><span class="line">        for (Node&lt;E&gt; x = first; x != null; ) &#123;</span><br><span class="line">            Node&lt;E&gt; next = x.next;</span><br><span class="line">            x.item = null;</span><br><span class="line">            x.next = null;</span><br><span class="line">            x.prev = null;</span><br><span class="line">            x = next;</span><br><span class="line">        &#125;</span><br><span class="line">        first = last = null;</span><br><span class="line">        size = 0;</span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    public E get(int index) &#123;</span><br><span class="line">        checkElementIndex(index);</span><br><span class="line">        return node(index).item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public E set(int index, E element) &#123;</span><br><span class="line">        checkElementIndex(index);</span><br><span class="line">        Node&lt;E&gt; x = node(index);</span><br><span class="line">        E oldVal = x.item;</span><br><span class="line">        x.item = element;</span><br><span class="line">        return oldVal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public void add(int index, E element) &#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">        if (index == size)</span><br><span class="line">            linkLast(element);</span><br><span class="line">        else</span><br><span class="line">            linkBefore(element, node(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public E remove(int index) &#123;</span><br><span class="line">        checkElementIndex(index);</span><br><span class="line">        return unlink(node(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private boolean isElementIndex(int index) &#123;</span><br><span class="line">        return index &gt;= 0 &amp;&amp; index &lt; size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private boolean isPositionIndex(int index) &#123;</span><br><span class="line">        return index &gt;= 0 &amp;&amp; index &lt;= size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private String outOfBoundsMsg(int index) &#123;</span><br><span class="line">        return &quot;Index: &quot;+index+&quot;, Size: &quot;+size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void checkElementIndex(int index) &#123;</span><br><span class="line">        if (!isElementIndex(index))</span><br><span class="line">            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void checkPositionIndex(int index) &#123;</span><br><span class="line">        if (!isPositionIndex(index))</span><br><span class="line">            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›é“¾è¡¨indexä½ç½®çš„NodeèŠ‚ç‚¹ï¼Œ </span><br><span class="line">    Node&lt;E&gt; node(int index) &#123;</span><br><span class="line">        // assert isElementIndex(index);</span><br><span class="line"></span><br><span class="line">        if (index &lt; (size &gt;&gt; 1)) &#123; // äºŒåˆ†éå†</span><br><span class="line">            Node&lt;E&gt; x = first;</span><br><span class="line">            for (int i = 0; i &lt; index; i++)</span><br><span class="line">                x = x.next;</span><br><span class="line">            return x;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Node&lt;E&gt; x = last;</span><br><span class="line">            for (int i = size - 1; i &gt; index; i--)</span><br><span class="line">                x = x.prev;</span><br><span class="line">            return x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int indexOf(Object o) &#123;</span><br><span class="line">        int index = 0;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123;</span><br><span class="line">                if (x.item == null)</span><br><span class="line">                    return index;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123;</span><br><span class="line">                if (o.equals(x.item))</span><br><span class="line">                    return index;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public int lastIndexOf(Object o) &#123;</span><br><span class="line">        int index = size;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123;</span><br><span class="line">                index--;</span><br><span class="line">                if (x.item == null)</span><br><span class="line">                    return index;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123;</span><br><span class="line">                index--;</span><br><span class="line">                if (o.equals(x.item))</span><br><span class="line">                    return index;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æä¾›æ™®é€šé˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥å®ç°æ ˆï¼ŒFIFOï¼ŒFILO</span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œè·å¾—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¸ä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰</span><br><span class="line">    public E peek() &#123;</span><br><span class="line">        final Node&lt;E&gt; f = first;</span><br><span class="line">        return (f == null) ? null : f.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œä¸åˆ é™¤å…ƒç´ ï¼Œè‹¥ä¸ºnullä¼šæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯è¿”å›null   </span><br><span class="line">    public E element() &#123;</span><br><span class="line">        return getFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œå­˜åœ¨çš„è¯ä¼šè¿”å›å€¼å¹¶ç§»é™¤è¿™ä¸ªå…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰  </span><br><span class="line">    public E poll() &#123;</span><br><span class="line">        final Node&lt;E&gt; f = first;</span><br><span class="line">        return (f == null) ? null : unlinkFirst(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯è¿”å›nullï¼Œå­˜åœ¨çš„è¯ä¼šè¿”å›å€¼å¹¶ç§»é™¤è¿™ä¸ªå…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰  </span><br><span class="line">    public E remove() &#123;</span><br><span class="line">        return removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å…¥é˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œå§‹ç»ˆè¿”å›true  </span><br><span class="line">    public boolean offer(E e) &#123;</span><br><span class="line">        return add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Deque operations</span><br><span class="line">    //å…¥é˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œå§‹ç»ˆè¿”å›true  </span><br><span class="line">    public boolean offerFirst(E e) &#123;</span><br><span class="line">        addFirst(e);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å…¥é˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œå§‹ç»ˆè¿”å›true  </span><br><span class="line">    public boolean offerLast(E e) &#123;</span><br><span class="line">        addLast(e);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œè·å¾—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¸ä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰  </span><br><span class="line">    public E peekFirst() &#123;</span><br><span class="line">        final Node&lt;E&gt; f = first;</span><br><span class="line">        return (f == null) ? null : f.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œè·å¾—æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¸ä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰  </span><br><span class="line">    public E peekLast() &#123;</span><br><span class="line">        final Node&lt;E&gt; l = last;</span><br><span class="line">        return (l == null) ? null : l.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œè·å¾—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰  </span><br><span class="line">    public E pollFirst() &#123;</span><br><span class="line">        final Node&lt;E&gt; f = first;</span><br><span class="line">        return (f == null) ? null : unlinkFirst(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºé˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œè·å¾—æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰</span><br><span class="line">    public E pollLast() &#123;</span><br><span class="line">        final Node&lt;E&gt; l = last;</span><br><span class="line">        return (l == null) ? null : unlinkLast(l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å…¥æ ˆï¼Œä»å‰é¢æ·»åŠ   </span><br><span class="line">    public void push(E e) &#123;</span><br><span class="line">        addFirst(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡ºæ ˆï¼Œè¿”å›æ ˆé¡¶å…ƒç´ ï¼Œä»å‰é¢ç§»é™¤ï¼ˆä¼šåˆ é™¤ï¼‰  </span><br><span class="line">    public E pop() &#123;</span><br><span class="line">        return removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ–¹æ³•åˆ é™¤æŒ‡å®šå…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°åœ¨è¯¥åˆ—è¡¨ä¸­(éå†ä»å¤´éƒ¨åˆ°å°¾éƒ¨åˆ—è¡¨æ—¶)ã€‚å¦‚æœåˆ—è¡¨ä¸­ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œå®ƒæ˜¯ä¸å˜çš„ã€‚  </span><br><span class="line">    public boolean removeFirstOccurrence(Object o) &#123;</span><br><span class="line">        return remove(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ–¹æ³•åˆ é™¤æŒ‡å®šå…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°åœ¨è¯¥åˆ—è¡¨ä¸­(éå†ä»å°¾éƒ¨åˆ°å¤´éƒ¨åˆ—è¡¨æ—¶)ã€‚å¦‚æœåˆ—è¡¨ä¸­ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œå®ƒæ˜¯ä¸å˜çš„ã€‚  </span><br><span class="line">    public boolean removeLastOccurrence(Object o) &#123;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123;</span><br><span class="line">                if (x.item == null) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123;</span><br><span class="line">                if (o.equals(x.item)) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›è¿­ä»£å™¨  </span><br><span class="line">    public ListIterator&lt;E&gt; listIterator(int index) &#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        return new ListItr(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿­ä»£å™¨çš„ç±» å…³äºListIterator å’Œ Iteratorçš„åŒºåˆ«å¯ä»¥è®¿é—® http://zhongyp.me/2018/01/12/listirerator/</span><br><span class="line">    private class ListItr implements ListIterator&lt;E&gt; &#123;</span><br><span class="line">        private Node&lt;E&gt; lastReturned = null;</span><br><span class="line">        private Node&lt;E&gt; next;</span><br><span class="line">        private int nextIndex;</span><br><span class="line">        private int expectedModCount = modCount;</span><br><span class="line"></span><br><span class="line">        ListItr(int index) &#123;</span><br><span class="line">            // assert isPositionIndex(index);</span><br><span class="line">            next = (index == size) ? null : node(index);</span><br><span class="line">            nextIndex = index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean hasNext() &#123;</span><br><span class="line">            return nextIndex &lt; size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public E next() &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            if (!hasNext())</span><br><span class="line">                throw new NoSuchElementException();</span><br><span class="line"></span><br><span class="line">            lastReturned = next;</span><br><span class="line">            next = next.next;</span><br><span class="line">            nextIndex++;</span><br><span class="line">            return lastReturned.item;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean hasPrevious() &#123;</span><br><span class="line">            return nextIndex &gt; 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public E previous() &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            if (!hasPrevious())</span><br><span class="line">                throw new NoSuchElementException();</span><br><span class="line"></span><br><span class="line">            lastReturned = next = (next == null) ? last : next.prev;</span><br><span class="line">            nextIndex--;</span><br><span class="line">            return lastReturned.item;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int nextIndex() &#123;</span><br><span class="line">            return nextIndex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int previousIndex() &#123;</span><br><span class="line">            return nextIndex - 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void remove() &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            if (lastReturned == null)</span><br><span class="line">                throw new IllegalStateException();</span><br><span class="line"></span><br><span class="line">            Node&lt;E&gt; lastNext = lastReturned.next;</span><br><span class="line">            unlink(lastReturned);</span><br><span class="line">            if (next == lastReturned)</span><br><span class="line">                next = lastNext;</span><br><span class="line">            else</span><br><span class="line">                nextIndex--;</span><br><span class="line">            lastReturned = null;</span><br><span class="line">            expectedModCount++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void set(E e) &#123;</span><br><span class="line">            if (lastReturned == null)</span><br><span class="line">                throw new IllegalStateException();</span><br><span class="line">            checkForComodification();</span><br><span class="line">            lastReturned.item = e;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void add(E e) &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            lastReturned = null;</span><br><span class="line">            if (next == null)</span><br><span class="line">                linkLast(e);</span><br><span class="line">            else</span><br><span class="line">                linkBefore(e, next);</span><br><span class="line">            nextIndex++;</span><br><span class="line">            expectedModCount++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        final void checkForComodification() &#123;</span><br><span class="line">            if (modCount != expectedModCount)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class Node&lt;E&gt; &#123;</span><br><span class="line">        E item;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line">        Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">        Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">            this.item = element;</span><br><span class="line">            this.next = next;</span><br><span class="line">            this.prev = prev;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨åœ¨æ­¤åŒç«¯é˜Ÿåˆ—ä»¥é€†å‘é¡ºåºçš„å…ƒç´   </span><br><span class="line">    public Iterator&lt;E&gt; descendingIterator() &#123;</span><br><span class="line">        return new DescendingIterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private class DescendingIterator implements Iterator&lt;E&gt; &#123;</span><br><span class="line">        private final ListItr itr = new ListItr(size());</span><br><span class="line">        public boolean hasNext() &#123;</span><br><span class="line">            return itr.hasPrevious();</span><br><span class="line">        &#125;</span><br><span class="line">        public E next() &#123;</span><br><span class="line">            return itr.previous();</span><br><span class="line">        &#125;</span><br><span class="line">        public void remove() &#123;</span><br><span class="line">            itr.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // LinkedListçš„ Cloneæ–¹æ³•åªæ˜¯ç®€å•çš„å°†åŸæ¥æ¯ä¸ª nodeçš„ itemæ”¾åˆ°å…‹éš†åçš„å¯¹è±¡ä¸­ï¼Œå’Œ ArrayListçš„ cloneæ–¹æ³•ä¸€æ ·ï¼Œ LinkedListçš„ Cloneæ–¹æ³•ä¹Ÿåªæ˜¯æµ…å¤åˆ¶ï¼Œå¦‚æœå…ƒç´ ä¸ºå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆä¿®æ”¹åŸ listçš„å€¼ä¼šå½±å“å…‹éš†çš„ listçš„å€¼ã€‚</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    private LinkedList&lt;E&gt; superClone() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return (LinkedList&lt;E&gt;) super.clone();// è°ƒç”¨åº•å±‚c++ è·å–å…‹éš†å¯¹è±¡</span><br><span class="line">        &#125; catch (CloneNotSupportedException e) &#123;</span><br><span class="line">            throw new InternalError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public Object clone() &#123;</span><br><span class="line">        LinkedList&lt;E&gt; clone = superClone();</span><br><span class="line"></span><br><span class="line">        // Put clone into &quot;virgin&quot; state</span><br><span class="line">        clone.first = clone.last = null;</span><br><span class="line">        clone.size = 0;</span><br><span class="line">        clone.modCount = 0;</span><br><span class="line"></span><br><span class="line">        // Initialize clone with our elements</span><br><span class="line">        for (Node&lt;E&gt; x = first; x != null; x = x.next)</span><br><span class="line">            clone.add(x.item);</span><br><span class="line"></span><br><span class="line">        return clone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    public Object[] toArray() &#123;</span><br><span class="line">        Object[] result = new Object[size];</span><br><span class="line">        int i = 0;</span><br><span class="line">        for (Node&lt;E&gt; x = first; x != null; x = x.next)</span><br><span class="line">            result[i++] = x.item;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">        if (a.length &lt; size)</span><br><span class="line">            a = (T[])java.lang.reflect.Array.newInstance(</span><br><span class="line">                    a.getClass().getComponentType(), size);</span><br><span class="line">        int i = 0;</span><br><span class="line">        Object[] result = a;</span><br><span class="line">        for (Node&lt;E&gt; x = first; x != null; x = x.next)</span><br><span class="line">            result[i++] = x.item;</span><br><span class="line"></span><br><span class="line">        if (a.length &gt; size)</span><br><span class="line">            a[size] = null;</span><br><span class="line"></span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * åºåˆ—åŒ–</span><br><span class="line">     */</span><br><span class="line">    private static final long serialVersionUID = 876323262645176354L;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    private void writeObject(java.io.ObjectOutputStream s)</span><br><span class="line">            throws java.io.IOException &#123;</span><br><span class="line">        // Write out any hidden serialization magic</span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">        // Write out size</span><br><span class="line">        s.writeInt(size);</span><br><span class="line"></span><br><span class="line">        // Write out all elements in the proper order.</span><br><span class="line">        for (Node&lt;E&gt; x = first; x != null; x = x.next)</span><br><span class="line">            s.writeObject(x.item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    private void readObject(java.io.ObjectInputStream s)</span><br><span class="line">            throws java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line">        // Read in any hidden serialization magic</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        // Read in size</span><br><span class="line">        int size = s.readInt();</span><br><span class="line"></span><br><span class="line">        // Read in all elements in the proper order.</span><br><span class="line">        for (int i = 0; i &lt; size; i++)</span><br><span class="line">            linkLast((E)s.readObject());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ArrayListæºç è§£æ</title>
      <link href="/2018/01/10/java/2018-01-11-ArrayList/"/>
      <url>/2018/01/10/java/2018-01-11-ArrayList/</url>
      
        <content type="html"><![CDATA[<h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><p>ArrayListæºç ä¸­å¤šæ¬¡ç”¨åˆ°Arrays.copyOf()å’ŒSystem.arraycopy(),æœ¬æ–‡ä¸å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œè§£è¯»ï¼Œè¯¦ç»†äº†è§£å¯ä»¥è®¿é—®<a href="http://blog.csdn.net/shijinupc/article/details/7827507" target="_blank" rel="noopener">Arrays.copyof(Â·Â·Â·)ä¸System.arraycopy(Â·Â·Â·)åŒºåˆ«</a></p><p>ArrayListç»§æ‰¿AbstractListç±»ï¼Œå®ç°Listï¼ŒRandomAccessï¼ŒCloneableï¼ŒSerializableæ¥å£ã€‚AbstractListæä¾› List æ¥å£çš„éª¨å¹²å®ç°ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†å®ç°ç”±â€œéšæœºè®¿é—®â€æ•°æ®å­˜å‚¨ï¼ˆå¦‚æ•°ç»„ï¼‰æ”¯æŒçš„æ¥å£æ‰€éœ€çš„å·¥ä½œã€‚å¯¹äºè¿ç»­çš„è®¿é—®æ•°æ®ï¼ˆå¦‚é“¾è¡¨ï¼‰ï¼Œåº”ä¼˜å…ˆä½¿ç”¨AbstractSequentialListï¼Œè€Œéæ­¤ç±»ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ¦‚è¿°ï¼š</span><br><span class="line"> *  Listæ¥å£å¯è°ƒæ•´å¤§å°çš„æ•°ç»„å®ç°ã€‚å®ç°æ‰€æœ‰å¯é€‰çš„Listæ“ä½œï¼Œå¹¶å…è®¸æ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬nullï¼Œå…ƒç´ å¯é‡å¤ã€‚</span><br><span class="line"> *  é™¤äº†åˆ—è¡¨æ¥å£å¤–ï¼Œè¯¥ç±»æä¾›äº†ä¸€ç§æ–¹æ³•æ¥æ“ä½œè¯¥æ•°ç»„çš„å¤§å°æ¥å­˜å‚¨è¯¥åˆ—è¡¨ä¸­çš„æ•°ç»„çš„å¤§å°ã€‚</span><br><span class="line"> * </span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦ï¼š</span><br><span class="line"> *  æ–¹æ³•sizeã€isEmptyã€getã€setã€iteratorå’ŒlistIteratorçš„è°ƒç”¨æ˜¯å¸¸æ•°æ—¶é—´çš„ã€‚</span><br><span class="line"> *  æ·»åŠ åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚å…¶ä»–æ‰€æœ‰æ“ä½œä¹Ÿéƒ½æ˜¯çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚</span><br><span class="line"> *</span><br><span class="line"> * å®¹é‡ï¼š</span><br><span class="line"> *  æ¯ä¸ªArrayListéƒ½æœ‰å®¹é‡ï¼Œå®¹é‡å¤§å°è‡³å°‘ä¸ºListå…ƒç´ çš„é•¿åº¦ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º10ã€‚</span><br><span class="line"> *  å®¹é‡å¯ä»¥è‡ªåŠ¨å¢é•¿ã€‚</span><br><span class="line"> *  å¦‚æœæå‰çŸ¥é“æ•°ç»„å…ƒç´ è¾ƒå¤šï¼Œå¯ä»¥åœ¨æ·»åŠ å…ƒç´ å‰é€šè¿‡è°ƒç”¨ensureCapacity()æ–¹æ³•æå‰å¢åŠ å®¹é‡ä»¥å‡å°åæœŸå®¹é‡è‡ªåŠ¨å¢é•¿çš„å¼€é”€ã€‚</span><br><span class="line"> *  ä¹Ÿå¯ä»¥é€šè¿‡å¸¦åˆå§‹å®¹é‡çš„æ„é€ å™¨åˆå§‹åŒ–è¿™ä¸ªå®¹é‡ã€‚</span><br><span class="line"> *</span><br><span class="line"> * çº¿ç¨‹ä¸å®‰å…¨ï¼š</span><br><span class="line"> *  ArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</span><br><span class="line"> *  å¦‚æœéœ€è¦åº”ç”¨åˆ°å¤šçº¿ç¨‹ä¸­ï¼Œéœ€è¦åœ¨å¤–éƒ¨åšåŒæ­¥</span><br><span class="line"> *</span><br><span class="line"> * modCountï¼š</span><br><span class="line"> *  å®šä¹‰åœ¨AbstractListä¸­ï¼šprotected transient int modCount = 0;</span><br><span class="line"> *  å·²ä»ç»“æ„ä¸Šä¿®æ”¹æ­¤åˆ—è¡¨çš„æ¬¡æ•°ã€‚ä»ç»“æ„ä¸Šä¿®æ”¹æ˜¯æŒ‡æ›´æ”¹åˆ—è¡¨çš„å¤§å°ï¼Œæˆ–è€…æ‰“ä¹±åˆ—è¡¨ï¼Œä»è€Œä½¿æ­£åœ¨è¿›è¡Œçš„è¿­ä»£äº§ç”Ÿé”™è¯¯çš„ç»“æœã€‚</span><br><span class="line"> *  æ­¤å­—æ®µç”±iteratorå’Œlistiteratoræ–¹æ³•è¿”å›çš„è¿­ä»£å™¨å’Œåˆ—è¡¨è¿­ä»£å™¨å®ç°ä½¿ç”¨ã€‚</span><br><span class="line"> *  å¦‚æœæ„å¤–æ›´æ”¹äº†æ­¤å­—æ®µä¸­çš„å€¼ï¼Œåˆ™è¿­ä»£å™¨ï¼ˆæˆ–åˆ—è¡¨è¿­ä»£å™¨ï¼‰å°†æŠ›å‡ºconcurrentmodificationexceptionæ¥å“åº”nextã€removeã€previousã€setæˆ–addæ“ä½œã€‚</span><br><span class="line"> *  åœ¨è¿­ä»£æœŸé—´é¢ä¸´å¹¶å‘ä¿®æ”¹æ—¶ï¼Œå®ƒæä¾›äº†å¿«é€Ÿå¤±è´¥ è¡Œä¸ºï¼Œè€Œä¸æ˜¯éç¡®å®šæ€§è¡Œä¸ºã€‚</span><br><span class="line"> *  fail-fast æœºåˆ¶æ˜¯javaé›†åˆ(Collection)ä¸­çš„ä¸€ç§é”™è¯¯æœºåˆ¶ã€‚å½“å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªé›†åˆçš„å†…å®¹è¿›è¡Œæ“ä½œæ—¶ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿfail-fastäº‹ä»¶ã€‚ä¾‹å¦‚ï¼šå½“æŸä¸€ä¸ªçº¿ç¨‹Aé€šè¿‡iteratorå»éå†æŸé›†åˆçš„è¿‡ç¨‹ä¸­ï¼Œè‹¥è¯¥é›†åˆçš„å†…å®¹è¢«å…¶ä»–çº¿ç¨‹æ‰€æ”¹å˜äº†ï¼›é‚£ä¹ˆçº¿ç¨‹Aè®¿é—®é›†åˆæ—¶ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œäº§ç”Ÿfail-fastäº‹ä»¶ã€‚</span><br><span class="line"> *  å­ç±»æ˜¯å¦ä½¿ç”¨æ­¤å­—æ®µæ˜¯å¯é€‰çš„ã€‚</span><br><span class="line"> *  å¦‚æœå­ç±»å¸Œæœ›æä¾›å¿«é€Ÿå¤±è´¥è¿­ä»£å™¨ï¼ˆå’Œåˆ—è¡¨è¿­ä»£å™¨ï¼‰ï¼Œåˆ™å®ƒåªéœ€åœ¨å…¶ add(int,e)å’Œremove(int)æ–¹æ³•ï¼ˆä»¥åŠå®ƒæ‰€é‡å†™çš„ã€å¯¼è‡´åˆ—è¡¨ç»“æ„ä¸Šä¿®æ”¹çš„ä»»ä½•å…¶ä»–æ–¹æ³•ï¼‰ä¸­å¢åŠ æ­¤å­—æ®µã€‚</span><br><span class="line"> *  å¯¹add(int, e)æˆ–remove(int)çš„å•ä¸ªè°ƒç”¨å‘æ­¤å­—æ®µæ·»åŠ çš„æ•°é‡ä¸å¾—è¶…è¿‡ 1ï¼Œå¦åˆ™è¿­ä»£å™¨ï¼ˆå’Œåˆ—è¡¨è¿­ä»£å™¨ï¼‰å°†æŠ›å‡ºè™šå‡çš„ concurrentmodificationexceptionsã€‚</span><br><span class="line"> *  å¦‚æœæŸä¸ªå®ç°ä¸å¸Œæœ›æä¾›å¿«é€Ÿå¤±è´¥è¿­ä»£å™¨ï¼Œåˆ™å¯ä»¥å¿½ç•¥æ­¤å­—æ®µã€‚</span><br><span class="line"> *</span><br><span class="line"> * transientï¼š</span><br><span class="line"> *  é»˜è®¤æƒ…å†µä¸‹,å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½å°†è¢«æŒä¹…åŒ–.åœ¨æŸäº›æƒ…å†µä¸‹,å¦‚æœä½ æƒ³é¿å…æŒä¹…åŒ–å¯¹è±¡çš„ä¸€äº›æˆå‘˜å˜é‡,ä½ å¯ä»¥ä½¿ç”¨transientå…³é”®å­—æ¥æ ‡è®°ä»–ä»¬,transientä¹Ÿæ˜¯javaä¸­çš„ä¿ç•™å­—(JDK 1.8)</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span><br><span class="line">        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br><span class="line">&#123;</span><br><span class="line">//</span><br><span class="line">    private static final long serialVersionUID = 8683452581122892189L;</span><br><span class="line"></span><br><span class="line">    // é»˜è®¤åˆå§‹åŒ–é•¿åº¦</span><br><span class="line">    private static final int DEFAULT_CAPACITY = 10;</span><br><span class="line"></span><br><span class="line">    // å½“ä½¿ç”¨new ArrayList()åˆ›å»ºå¯¹è±¡æ—¶ï¼Œè¿”å›EMPTY_ELEMENTDATAè¿™ä¸ªæ•°ç»„å¯¹è±¡ã€‚</span><br><span class="line">    private static final Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    // ä¸å¯åºåˆ—åŒ–çš„æ•°ç»„å£°æ˜</span><br><span class="line">    private transient Object[] elementData;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    private int size;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public ArrayList(int initialCapacity) &#123;</span><br><span class="line">        super();</span><br><span class="line">        if (initialCapacity &lt; 0)</span><br><span class="line">            throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+</span><br><span class="line">                                               initialCapacity);</span><br><span class="line">        this.elementData = new Object[initialCapacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public ArrayList() &#123;</span><br><span class="line">        super();</span><br><span class="line">        this.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">     public ArrayList(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        elementData = c.toArray();</span><br><span class="line">        size = elementData.length;</span><br><span class="line">        // c.toArray might (incorrectly) not return Object[] (see 6260652)</span><br><span class="line">        if (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size, Object[].class);//æ­¤å¤„ä½¿ç”¨Arrayså·¥å…·ç±»çš„copyOfå¤åˆ¶æ•°ç»„</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è°ƒæ•´ArrayListå®ä¾‹ä¸ºå½“å‰å®¹é‡å¤§å°ã€‚</span><br><span class="line">    public void trimToSize() &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        if (size &lt; elementData.length) &#123;</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //ä½¿ç”¨æŒ‡å®šå‚æ•°è®¾ç½®æ•°ç»„å®¹é‡</span><br><span class="line">    public void ensureCapacity(int minCapacity) &#123;</span><br><span class="line">        int minExpand = (elementData != EMPTY_ELEMENTDATA)</span><br><span class="line">            // any size if real element table</span><br><span class="line">            ? 0</span><br><span class="line">            // larger than default for empty table. It&apos;s already supposed to be</span><br><span class="line">            // at default size.</span><br><span class="line">            : DEFAULT_CAPACITY;</span><br><span class="line"></span><br><span class="line">        if (minCapacity &gt; minExpand) &#123;</span><br><span class="line">            ensureExplicitCapacity(minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">//ç”¨äºæ·»åŠ å…ƒç´ æ—¶ï¼Œç¡®ä¿æ•°ç»„å®¹é‡</span><br><span class="line">    private void ensureCapacityInternal(int minCapacity) &#123;</span><br><span class="line">        if (elementData == EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ensureExplicitCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">//å¦‚æœå‚æ•°å¤§äºæ•°ç»„å®¹é‡ï¼Œå°±å¢åŠ æ•°ç»„å®¹é‡</span><br><span class="line">    private void ensureExplicitCapacity(int minCapacity) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line"></span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        if (minCapacity - elementData.length &gt; 0)</span><br><span class="line">            grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æ•°ç»„çš„æœ€å¤§å®¹é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡º(VMå†…å­˜é™åˆ¶)</span><br><span class="line">    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;</span><br><span class="line"></span><br><span class="line">    //å¢åŠ å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒå¯ä»¥è‡³å°‘æŒæœ‰ç”±å‚æ•°æŒ‡å®šçš„å…ƒç´ çš„æ•°ç›®</span><br><span class="line">    private void grow(int minCapacity) &#123;</span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        int oldCapacity = elementData.length;</span><br><span class="line">        int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);// æ–°çš„ç©ºé—´å¤§å°ä¸ºè€ç©ºé—´+ è€ç©ºé—´å¤§å°äºŒè¿›åˆ¶å·¦ç§»ä¸€ä½ï¼Œä¸¾ä¾‹æ¯”å¦‚è€ç©ºé—´ä¸º15,15&gt;&gt;1ï¼Œç»“æœä¸º7ï¼Œå¤§è‡´æ˜¯1/2</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        // minCapacity is usually close to size, so this is a win:</span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//æ£€æŸ¥æ˜¯å¦æº¢å‡ºï¼Œè‹¥æ²¡æœ‰æº¢å‡ºï¼Œè¿”å›æœ€å¤§æ•´æ•°å€¼(javaä¸­çš„intä¸º4å­—èŠ‚ï¼Œæ‰€ä»¥æœ€å¤§ä¸º0x7fffffff)æˆ–é»˜è®¤æœ€å¤§å€¼</span><br><span class="line">    private static int hugeCapacity(int minCapacity) &#123;</span><br><span class="line">        if (minCapacity &lt; 0) // overflow</span><br><span class="line">            throw new OutOfMemoryError();</span><br><span class="line">        return (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">            Integer.MAX_VALUE :</span><br><span class="line">            MAX_ARRAY_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public int size() &#123;</span><br><span class="line">        return size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public boolean isEmpty() &#123;</span><br><span class="line">        return size == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public boolean contains(Object o) &#123;</span><br><span class="line">        return indexOf(o) &gt;= 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public int indexOf(Object o) &#123;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (int i = 0; i &lt; size; i++)</span><br><span class="line">                if (elementData[i]==null)</span><br><span class="line">                    return i;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (int i = 0; i &lt; size; i++)</span><br><span class="line">                if (o.equals(elementData[i]))</span><br><span class="line">                    return i;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public int lastIndexOf(Object o) &#123;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (int i = size-1; i &gt;= 0; i--)</span><br><span class="line">                if (elementData[i]==null)</span><br><span class="line">                    return i;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (int i = size-1; i &gt;= 0; i--)</span><br><span class="line">                if (o.equals(elementData[i]))</span><br><span class="line">                    return i;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public Object clone() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">                ArrayList&lt;E&gt; v = (ArrayList&lt;E&gt;) super.clone();</span><br><span class="line">            v.elementData = Arrays.copyOf(elementData, size);</span><br><span class="line">            v.modCount = 0;</span><br><span class="line">            return v;</span><br><span class="line">        &#125; catch (CloneNotSupportedException e) &#123;</span><br><span class="line">            // this shouldn&apos;t happen, since we are Cloneable</span><br><span class="line">            throw new InternalError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›Object[]</span><br><span class="line">    public Object[] toArray() &#123;</span><br><span class="line">        return Arrays.copyOf(elementData, size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä½¿ç”¨è¿è¡Œæ—¶ç¡®å®šç±»å‹ï¼Œè¯¥æ•°ç»„åŒ…å«åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆä»ç¬¬ä¸€åˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰</span><br><span class="line">    //è¿”å›çš„æ•°ç»„å®¹é‡ç”±å‚æ•°å’Œæœ¬æ•°ç»„ä¸­è¾ƒå¤§å€¼ç¡®å®š</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">        if (a.length &lt; size)</span><br><span class="line">            // Make a new array of a&apos;s runtime type, but my contents:</span><br><span class="line">            return (T[]) Arrays.copyOf(elementData, size, a.getClass());</span><br><span class="line">        System.arraycopy(elementData, 0, a, 0, size);</span><br><span class="line">        if (a.length &gt; size)</span><br><span class="line">            a[size] = null;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Positional Access Operations</span><br><span class="line"></span><br><span class="line">// è¿”å›æŒ‡å®šä½ç½®çš„å€¼ï¼Œå› ä¸ºæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥é€Ÿåº¦ç‰¹åˆ«å¿«</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    E elementData(int index) &#123;</span><br><span class="line">        return (E) elementData[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›æŒ‡å®šä½ç½®çš„å€¼ï¼Œå› ä¸ºæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥é€Ÿåº¦ç‰¹åˆ«å¿«</span><br><span class="line">    public E get(int index) &#123;</span><br><span class="line">        rangeCheck(index);</span><br><span class="line"></span><br><span class="line">        return elementData(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è®¾ç½®åˆ¶å®šæœªçŸ¥çš„å€¼</span><br><span class="line">    public E set(int index, E element) &#123;</span><br><span class="line">        rangeCheck(index);</span><br><span class="line"></span><br><span class="line">        E oldValue = elementData(index);</span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        return oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ–°æ·»åŠ å€¼</span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">        ensureCapacityInternal(size + 1);  // Increments modCount!!</span><br><span class="line">        elementData[size++] = e;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ–°å¢åŠ æŒ‡å®šæœªçŸ¥çš„å€¼</span><br><span class="line">    public void add(int index, E element) &#123;</span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">        ensureCapacityInternal(size + 1);  // Increments modCount!!</span><br><span class="line">        System.arraycopy(elementData, index, elementData, index + 1,</span><br><span class="line">                         size - index);</span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ é™¤æŒ‡å®šä½ç½®çš„å€¼</span><br><span class="line">    public E remove(int index) &#123;</span><br><span class="line">        rangeCheck(index);// æ£€æŸ¥indexèŒƒå›´</span><br><span class="line"></span><br><span class="line">        modCount++;</span><br><span class="line">        E oldValue = elementData(index);// æŸ¥æ‰¾indexä½ç½®ä¸Šçš„å€¼</span><br><span class="line"></span><br><span class="line">        int numMoved = size - index - 1;</span><br><span class="line">        // å¦‚æœindexä¸æ˜¯æœ€åä½ç½®çš„ç´¢å¼•ï¼Œåˆ™ä»åŸåˆ—è¡¨index+1ä½ç½®å¤åˆ¶numMovedä¸ªæ•°å€¼åˆ°æ–°åˆ—è¡¨ä»indexå¼€å§‹</span><br><span class="line">        if (numMoved &gt; 0)</span><br><span class="line">            System.arraycopy(elementData, index+1, elementData, index,</span><br><span class="line">                             numMoved);</span><br><span class="line">        elementData[--size] = null; // clear to let GC do its work</span><br><span class="line"></span><br><span class="line">        return oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ é™¤listä¸­ç¬¬ä¸€ä¸ªå€¼ä¸ºoçš„å¯¹è±¡</span><br><span class="line">    public boolean remove(Object o) &#123;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            for (int index = 0; index &lt; size; index++)</span><br><span class="line">                if (elementData[index] == null) &#123;</span><br><span class="line">                    fastRemove(index);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (int index = 0; index &lt; size; index++)</span><br><span class="line">                if (o.equals(elementData[index])) &#123;</span><br><span class="line">                    fastRemove(index);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä¸éœ€è¦åˆ¤æ–­indexæ˜¯å¦å­˜åœ¨ä¸”ä¸ç”¨è¿”å›æ—§å€¼</span><br><span class="line">    private void fastRemove(int index) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        int numMoved = size - index - 1;</span><br><span class="line">        if (numMoved &gt; 0)</span><br><span class="line">            System.arraycopy(elementData, index+1, elementData, index,</span><br><span class="line">                             numMoved);</span><br><span class="line">        elementData[--size] = null; // clear to let GC do its work</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ¸…ç©ºæ•°ç»„ï¼Œèµ‹å€¼ä¸ºnullï¼Œæ–¹ä¾¿åƒåœ¾å›æ”¶ï¼Œsizeå½’0</span><br><span class="line">    public void clear() &#123;</span><br><span class="line">        modCount++;</span><br><span class="line"></span><br><span class="line">        // clear to let GC do its work</span><br><span class="line">        for (int i = 0; i &lt; size; i++)</span><br><span class="line">            elementData[i] = null;</span><br><span class="line"></span><br><span class="line">        size = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ é›†åˆåˆ°æœ«ç«¯ï¼Œå½“é›†åˆä¸ºç©ºæ—¶è¿”å›false</span><br><span class="line">    public boolean addAll(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        int numNew = a.length;</span><br><span class="line">        ensureCapacityInternal(size + numNew);  // Increments modCount</span><br><span class="line">        System.arraycopy(a, 0, elementData, size, numNew);</span><br><span class="line">        size += numNew;</span><br><span class="line">        return numNew != 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //  ä»æŒ‡å®šæœªçŸ¥å¼€å§‹æ·»åŠ é›†åˆ</span><br><span class="line">    public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        int numNew = a.length;</span><br><span class="line">        ensureCapacityInternal(size + numNew);  // Increments modCount</span><br><span class="line"></span><br><span class="line">        int numMoved = size - index;</span><br><span class="line">        if (numMoved &gt; 0)</span><br><span class="line">            System.arraycopy(elementData, index, elementData, index + numNew,</span><br><span class="line">                             numMoved);</span><br><span class="line"></span><br><span class="line">        System.arraycopy(a, 0, elementData, index, numNew);</span><br><span class="line">        size += numNew;</span><br><span class="line">        return numNew != 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ é™¤æŒ‡å®šèŒƒå›´çš„å…ƒç´ </span><br><span class="line">    protected void removeRange(int fromIndex, int toIndex) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        int numMoved = size - toIndex;</span><br><span class="line">        System.arraycopy(elementData, toIndex, elementData, fromIndex,</span><br><span class="line">                         numMoved);</span><br><span class="line"></span><br><span class="line">        // clear to let GC do its work</span><br><span class="line">        int newSize = size - (toIndex-fromIndex);</span><br><span class="line">        for (int i = newSize; i &lt; size; i++) &#123;</span><br><span class="line">            elementData[i] = null;</span><br><span class="line">        &#125;</span><br><span class="line">        size = newSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ£€æŸ¥indexæ˜¯å¦è¶…å‡ºsize</span><br><span class="line">    private void rangeCheck(int index) &#123;</span><br><span class="line">        if (index &gt;= size)</span><br><span class="line">            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ£€æŸ¥æ˜¯å¦æº¢å‡ºåˆ—è¡¨èŒƒå›´</span><br><span class="line">    private void rangeCheckForAdd(int index) &#123;</span><br><span class="line">        if (index &gt; size || index &lt; 0)</span><br><span class="line">            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æŠ›å‡ºå¼‚å¸¸è¯¦æƒ…</span><br><span class="line">    private String outOfBoundsMsg(int index) &#123;</span><br><span class="line">        return &quot;Index: &quot;+index+&quot;, Size: &quot;+size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ é™¤cé›†åˆä¸­åŒ…å«çš„å…ƒç´ </span><br><span class="line">    public boolean removeAll(Collection&lt;?&gt; c) &#123;</span><br><span class="line">        return batchRemove(c, false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä»…ä¿ç•™cé›†åˆå†…å­˜åœ¨çš„å…ƒç´ </span><br><span class="line">    public boolean retainAll(Collection&lt;?&gt; c) &#123;</span><br><span class="line">        return batchRemove(c, true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ ¹æ®complementæ ‡è¯†å†³å®šæ˜¯å¦æ‰¹é‡ä»… ä¿ç•™/åˆ é™¤ é›†åˆcä¸­åŒ…å«çš„å…ƒç´ </span><br><span class="line">    private boolean batchRemove(Collection&lt;?&gt; c, boolean complement) &#123;</span><br><span class="line">        final Object[] elementData = this.elementData;</span><br><span class="line">        int r = 0, w = 0;</span><br><span class="line">        boolean modified = false;</span><br><span class="line">        try &#123;</span><br><span class="line">            for (; r &lt; size; r++)</span><br><span class="line">                if (c.contains(elementData[r]) == complement)// å¦‚æœcomplement=false,ä»…ä¿ç•™écé›†åˆä¸­çš„å…ƒç´ ï¼Œä¸ºtrueæ—¶ï¼Œä»…ä¿ç•™cé›†åˆä¸­çš„å…ƒç´ ã€‚</span><br><span class="line">                    elementData[w++] = elementData[r];</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            // Preserve behavioral compatibility with AbstractCollection,</span><br><span class="line">            // even if c.contains() throws.</span><br><span class="line">            if (r != size) &#123;// å¦‚æœræ²¡æœ‰éå†åˆ°size-1ï¼Œåˆ™æŠŠä»råˆ°size-1çš„å€¼å¤åˆ¶åˆ°æ–°æ•°ç»„ï¼Œè¿™ä¸ªåœ°æ–¹ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šè¿è¡Œï¼Œæœ‰å¾…æ¢ç©¶</span><br><span class="line">                System.arraycopy(elementData, r,</span><br><span class="line">                                 elementData, w,</span><br><span class="line">                                 size - r);</span><br><span class="line">                w += size - r;</span><br><span class="line">            &#125;</span><br><span class="line">            if (w != size) &#123;// cé›†åˆå°äºå½“å‰é›†åˆæ—¶ï¼Œéƒ½ä¼šè¿è¡Œ</span><br><span class="line">                // clear to let GC do its work</span><br><span class="line">                for (int i = w; i &lt; size; i++)</span><br><span class="line">                    elementData[i] = null;// å°†wåˆ°size-1åˆ—è¡¨ä¸Šçš„å€¼ç½®ç©ºï¼Œæ–¹ä¾¿åƒåœ¾å›æ”¶</span><br><span class="line">                modCount += size - w;//è®°å½•æ”¹åŠ¨çš„æ¬¡æ•°</span><br><span class="line">                size = w;</span><br><span class="line">                modified = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return modified;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åºåˆ—åŒ–å†™</span><br><span class="line">    private void writeObject(java.io.ObjectOutputStream s)</span><br><span class="line">        throws java.io.IOException&#123;</span><br><span class="line">        // Write out element count, and any hidden stuff</span><br><span class="line">        int expectedModCount = modCount;// ç”¨äºåˆ¤æ–­åœ¨å†™å…¥æµæœŸé—´æ˜¯å¦è¢«æ›´æ”¹çš„æ ‡è¯†</span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">        // Write out size as capacity for behavioural compatibility with clone()</span><br><span class="line">        s.writeInt(size);</span><br><span class="line"></span><br><span class="line">        // Write out all elements in the proper order.</span><br><span class="line">        for (int i=0; i&lt;size; i++) &#123;</span><br><span class="line">            s.writeObject(elementData[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (modCount != expectedModCount) &#123;// å°†åˆ—è¡¨å†™å…¥IOæµåï¼Œåˆ¤æ–­åœ¨æ­¤æœŸé—´åˆ—è¡¨æ˜¯å¦åˆ«æ›´æ”¹ï¼Œå¦‚æœè¢«æ›´æ”¹åˆ™æŠ¥é”™ã€‚</span><br><span class="line">            throw new ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä»æµä¸­è¯»å–å€¼æ”¾åˆ°æ–°å»ºçš„æ•°ç»„å¯¹è±¡ä¸­</span><br><span class="line">    private void readObject(java.io.ObjectInputStream s)</span><br><span class="line">        throws java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line">        elementData = EMPTY_ELEMENTDATA;// å…ˆå£°æ˜ä¸€ä¸ªç©ºæ•°ç»„</span><br><span class="line"></span><br><span class="line">        // Read in size, and any hidden stuff</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        // Read in capacity</span><br><span class="line">        s.readInt(); // ignored</span><br><span class="line"></span><br><span class="line">        if (size &gt; 0) &#123;</span><br><span class="line">            // be like clone(), allocate array based upon size not capacity</span><br><span class="line">            ensureCapacityInternal(size);// è¯»ç©ºæ•°ç»„æ‰©å®¹</span><br><span class="line"></span><br><span class="line">            Object[] a = elementData;</span><br><span class="line">            // Read in all elements in the proper order.</span><br><span class="line">            for (int i=0; i&lt;size; i++) &#123;</span><br><span class="line">                a[i] = s.readObject();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›ListIterator index</span><br><span class="line">    public ListIterator&lt;E&gt; listIterator(int index) &#123;</span><br><span class="line">        if (index &lt; 0 || index &gt; size)</span><br><span class="line">            throw new IndexOutOfBoundsException(&quot;Index: &quot;+index);</span><br><span class="line">        return new ListItr(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›ListIterator 0</span><br><span class="line">    public ListIterator&lt;E&gt; listIterator() &#123;</span><br><span class="line">        return new ListItr(0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public Iterator&lt;E&gt; iterator() &#123;</span><br><span class="line">        return new Itr();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   // Itrç±»ï¼Œç”¨äºIteratoréå†</span><br><span class="line">    private class Itr implements Iterator&lt;E&gt; &#123;</span><br><span class="line">        int cursor;       // index of next element to return</span><br><span class="line">        int lastRet = -1; // index of last element returned; -1 if no such</span><br><span class="line">        int expectedModCount = modCount;</span><br><span class="line"></span><br><span class="line">        public boolean hasNext() &#123;</span><br><span class="line">            return cursor != size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">        public E next() &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            int i = cursor;</span><br><span class="line">            if (i &gt;= size)</span><br><span class="line">                throw new NoSuchElementException();</span><br><span class="line">            Object[] elementData = ArrayList.this.elementData;</span><br><span class="line">            if (i &gt;= elementData.length)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">            cursor = i + 1;</span><br><span class="line">            return (E) elementData[lastRet = i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void remove() &#123;</span><br><span class="line">            if (lastRet &lt; 0)</span><br><span class="line">                throw new IllegalStateException();</span><br><span class="line">            checkForComodification();</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                ArrayList.this.remove(lastRet);</span><br><span class="line">                cursor = lastRet;</span><br><span class="line">                lastRet = -1;</span><br><span class="line">                expectedModCount = modCount;</span><br><span class="line">            &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        final void checkForComodification() &#123;</span><br><span class="line">            if (modCount != expectedModCount)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ListItrerator ä¸åŒäºItr,å¯å‘å‰å‘åéå†ï¼Œåœ¨éå†æœŸé—´å¯ä»¥ä¿®æ”¹ï¼Œ</span><br><span class="line">    private class ListItr extends Itr implements ListIterator&lt;E&gt; &#123;</span><br><span class="line">        ListItr(int index) &#123;</span><br><span class="line">            super();</span><br><span class="line">            cursor = index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean hasPrevious() &#123;</span><br><span class="line">            return cursor != 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int nextIndex() &#123;</span><br><span class="line">            return cursor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int previousIndex() &#123;</span><br><span class="line">            return cursor - 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">        public E previous() &#123;</span><br><span class="line">            checkForComodification(); //æ£€æŸ¥æ˜¯å¦è¢«ä¿®æ”¹</span><br><span class="line">            int i = cursor - 1;</span><br><span class="line">            if (i &lt; 0)</span><br><span class="line">                throw new NoSuchElementException();</span><br><span class="line">            Object[] elementData = ArrayList.this.elementData;// æ­¤å¤„è¿™æ ·å¤åˆ¶å¼•ç”¨è€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ï¼ŒåŸå› æ˜¯ï¼šå†…éƒ¨ç±»æ˜¯é€šè¿‡ä¿ç•™æŒ‡å‘å¤–éƒ¨ç±»çš„æŒ‡é’ˆè®¿é—®å¤–éƒ¨ç±»å­—æ®µçš„ï¼Œæ˜¾å¼å†™å‡ºæ¥å°±æ˜¯ltr.ArrayList.this.elementDataï¼Œå¤åˆ¶å¼•ç”¨å°±æ˜¯ä¸ºäº†å‡å°‘å¤šæ¬¡æŒ‡é’ˆå¼•ç”¨</span><br><span class="line">            if (i &gt;= elementData.length)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">            cursor = i;</span><br><span class="line">            return (E) elementData[lastRet = i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void set(E e) &#123;</span><br><span class="line">            if (lastRet &lt; 0)</span><br><span class="line">                throw new IllegalStateException();</span><br><span class="line">            checkForComodification();</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                ArrayList.this.set(lastRet, e);</span><br><span class="line">            &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void add(E e) &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                int i = cursor;</span><br><span class="line">                ArrayList.this.add(i, e);</span><br><span class="line">                cursor = i + 1;</span><br><span class="line">                lastRet = -1;</span><br><span class="line">                expectedModCount = modCount;</span><br><span class="line">            &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›æŒ‡å®šèŒƒå›´çš„å­æ•°ç»„</span><br><span class="line">    // JDKä¸­ï¼ŒListæ¥å£æœ‰ä¸€ä¸ªå®ä¾‹æ–¹æ³•List&lt;E&gt; subList(int fromIndex, int toIndex)ï¼Œ</span><br><span class="line">    // å…¶ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªä»¥fromIndexä¸ºèµ·å§‹ç´¢å¼•ï¼ˆåŒ…å«ï¼‰ï¼Œä»¥toIndexä¸ºç»ˆæ­¢ç´¢å¼•ï¼ˆä¸åŒ…å«ï¼‰çš„å­åˆ—è¡¨ï¼ˆListï¼‰ã€‚ </span><br><span class="line">    // ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿”å›çš„è¿™ä¸ªå­åˆ—è¡¨çš„å¹•åå…¶å®è¿˜æ˜¯åŸåˆ—è¡¨ï¼›</span><br><span class="line">    // ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®æ”¹è¿™ä¸ªå­åˆ—è¡¨ï¼Œå°†å¯¼è‡´åŸåˆ—è¡¨ä¹Ÿå‘ç”Ÿæ”¹å˜ï¼›åä¹‹äº¦ç„¶ã€‚</span><br><span class="line">    public List&lt;E&gt; subList(int fromIndex, int toIndex) &#123;</span><br><span class="line">        subListRangeCheck(fromIndex, toIndex, size);</span><br><span class="line">        return new SubList(this, 0, fromIndex, toIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static void subListRangeCheck(int fromIndex, int toIndex, int size) &#123;</span><br><span class="line">        if (fromIndex &lt; 0)</span><br><span class="line">            throw new IndexOutOfBoundsException(&quot;fromIndex = &quot; + fromIndex);</span><br><span class="line">        if (toIndex &gt; size)</span><br><span class="line">            throw new IndexOutOfBoundsException(&quot;toIndex = &quot; + toIndex);</span><br><span class="line">        if (fromIndex &gt; toIndex)</span><br><span class="line">            throw new IllegalArgumentException(&quot;fromIndex(&quot; + fromIndex +</span><br><span class="line">                                               &quot;) &gt; toIndex(&quot; + toIndex + &quot;)&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private class SubList extends AbstractList&lt;E&gt; implements RandomAccess &#123;</span><br><span class="line">        private final AbstractList&lt;E&gt; parent;</span><br><span class="line">        private final int parentOffset;</span><br><span class="line">        private final int offset;</span><br><span class="line">        int size;</span><br><span class="line"></span><br><span class="line">        SubList(AbstractList&lt;E&gt; parent,</span><br><span class="line">                int offset, int fromIndex, int toIndex) &#123;</span><br><span class="line">            this.parent = parent;</span><br><span class="line">            this.parentOffset = fromIndex;</span><br><span class="line">            this.offset = offset + fromIndex;</span><br><span class="line">            this.size = toIndex - fromIndex;</span><br><span class="line">            this.modCount = ArrayList.this.modCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public E set(int index, E e) &#123;</span><br><span class="line">            rangeCheck(index);</span><br><span class="line">            checkForComodification();</span><br><span class="line">            E oldValue = ArrayList.this.elementData(offset + index);</span><br><span class="line">            ArrayList.this.elementData[offset + index] = e;</span><br><span class="line">            return oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public E get(int index) &#123;</span><br><span class="line">            rangeCheck(index);</span><br><span class="line">            checkForComodification();</span><br><span class="line">            return ArrayList.this.elementData(offset + index);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int size() &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            return this.size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void add(int index, E e) &#123;</span><br><span class="line">            rangeCheckForAdd(index);</span><br><span class="line">            checkForComodification();</span><br><span class="line">            parent.add(parentOffset + index, e);</span><br><span class="line">            this.modCount = parent.modCount;</span><br><span class="line">            this.size++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public E remove(int index) &#123;</span><br><span class="line">            rangeCheck(index);</span><br><span class="line">            checkForComodification();</span><br><span class="line">            E result = parent.remove(parentOffset + index);</span><br><span class="line">            this.modCount = parent.modCount;</span><br><span class="line">            this.size--;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected void removeRange(int fromIndex, int toIndex) &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            parent.removeRange(parentOffset + fromIndex,</span><br><span class="line">                               parentOffset + toIndex);</span><br><span class="line">            this.modCount = parent.modCount;</span><br><span class="line">            this.size -= toIndex - fromIndex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean addAll(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">            return addAll(this.size, c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">            rangeCheckForAdd(index);</span><br><span class="line">            int cSize = c.size();</span><br><span class="line">            if (cSize==0)</span><br><span class="line">                return false;</span><br><span class="line"></span><br><span class="line">            checkForComodification();</span><br><span class="line">            parent.addAll(parentOffset + index, c);</span><br><span class="line">            this.modCount = parent.modCount;</span><br><span class="line">            this.size += cSize;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Iterator&lt;E&gt; iterator() &#123;</span><br><span class="line">            return listIterator();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public ListIterator&lt;E&gt; listIterator(final int index) &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            rangeCheckForAdd(index);</span><br><span class="line">            final int offset = this.offset;</span><br><span class="line"></span><br><span class="line">            return new ListIterator&lt;E&gt;() &#123;</span><br><span class="line">                int cursor = index;</span><br><span class="line">                int lastRet = -1;</span><br><span class="line">                int expectedModCount = ArrayList.this.modCount;</span><br><span class="line"></span><br><span class="line">                public boolean hasNext() &#123;</span><br><span class="line">                    return cursor != SubList.this.size;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">                public E next() &#123;</span><br><span class="line">                    checkForComodification();</span><br><span class="line">                    int i = cursor;</span><br><span class="line">                    if (i &gt;= SubList.this.size)</span><br><span class="line">                        throw new NoSuchElementException();</span><br><span class="line">                    Object[] elementData = ArrayList.this.elementData;</span><br><span class="line">                    if (offset + i &gt;= elementData.length)</span><br><span class="line">                        throw new ConcurrentModificationException();</span><br><span class="line">                    cursor = i + 1;</span><br><span class="line">                    return (E) elementData[offset + (lastRet = i)];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public boolean hasPrevious() &#123;</span><br><span class="line">                    return cursor != 0;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">                public E previous() &#123;</span><br><span class="line">                    checkForComodification();</span><br><span class="line">                    int i = cursor - 1;</span><br><span class="line">                    if (i &lt; 0)</span><br><span class="line">                        throw new NoSuchElementException();</span><br><span class="line">                    Object[] elementData = ArrayList.this.elementData;</span><br><span class="line">                    if (offset + i &gt;= elementData.length)</span><br><span class="line">                        throw new ConcurrentModificationException();</span><br><span class="line">                    cursor = i;</span><br><span class="line">                    return (E) elementData[offset + (lastRet = i)];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public int nextIndex() &#123;</span><br><span class="line">                    return cursor;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public int previousIndex() &#123;</span><br><span class="line">                    return cursor - 1;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public void remove() &#123;</span><br><span class="line">                    if (lastRet &lt; 0)</span><br><span class="line">                        throw new IllegalStateException();</span><br><span class="line">                    checkForComodification();</span><br><span class="line"></span><br><span class="line">                    try &#123;</span><br><span class="line">                        SubList.this.remove(lastRet);</span><br><span class="line">                        cursor = lastRet;</span><br><span class="line">                        lastRet = -1;</span><br><span class="line">                        expectedModCount = ArrayList.this.modCount;</span><br><span class="line">                    &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">                        throw new ConcurrentModificationException();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public void set(E e) &#123;</span><br><span class="line">                    if (lastRet &lt; 0)</span><br><span class="line">                        throw new IllegalStateException();</span><br><span class="line">                    checkForComodification();</span><br><span class="line"></span><br><span class="line">                    try &#123;</span><br><span class="line">                        ArrayList.this.set(offset + lastRet, e);</span><br><span class="line">                    &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">                        throw new ConcurrentModificationException();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public void add(E e) &#123;</span><br><span class="line">                    checkForComodification();</span><br><span class="line"></span><br><span class="line">                    try &#123;</span><br><span class="line">                        int i = cursor;</span><br><span class="line">                        SubList.this.add(i, e);</span><br><span class="line">                        cursor = i + 1;</span><br><span class="line">                        lastRet = -1;</span><br><span class="line">                        expectedModCount = ArrayList.this.modCount;</span><br><span class="line">                    &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">                        throw new ConcurrentModificationException();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                final void checkForComodification() &#123;</span><br><span class="line">                    if (expectedModCount != ArrayList.this.modCount)</span><br><span class="line">                        throw new ConcurrentModificationException();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public List&lt;E&gt; subList(int fromIndex, int toIndex) &#123;</span><br><span class="line">            subListRangeCheck(fromIndex, toIndex, size);</span><br><span class="line">            return new SubList(this, offset, fromIndex, toIndex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void rangeCheck(int index) &#123;</span><br><span class="line">            if (index &lt; 0 || index &gt;= this.size)</span><br><span class="line">                throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void rangeCheckForAdd(int index) &#123;</span><br><span class="line">            if (index &lt; 0 || index &gt; this.size)</span><br><span class="line">                throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private String outOfBoundsMsg(int index) &#123;</span><br><span class="line">            return &quot;Index: &quot;+index+&quot;, Size: &quot;+this.size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void checkForComodification() &#123;</span><br><span class="line">            if (ArrayList.this.modCount != this.modCount)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Setå¸¸ç”¨é›†åˆç±»æºç è§£è¯»</title>
      <link href="/2018/01/10/java/2018-01-10-Set/"/>
      <url>/2018/01/10/java/2018-01-10-Set/</url>
      
        <content type="html"><![CDATA[<h2 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h2><p>HashSetç»§æ‰¿AbstractSetç±»ï¼Œå®ç°Setã€Cloneableã€Serializableæ¥å£ã€‚å…¶ä¸­AbstractSetæä¾› Set æ¥å£çš„éª¨å¹²å®ç°ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†å®ç°æ­¤æ¥å£æ‰€éœ€çš„å·¥ä½œã€‚Setæ¥å£æ˜¯ä¸€ç§ä¸åŒ…æ‹¬é‡å¤å…ƒç´ çš„Collectionï¼Œå®ƒç»´æŒå®ƒè‡ªå·±çš„å†…éƒ¨æ’åºï¼Œæ‰€ä»¥éšæœºè®¿é—®æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">    // åºåˆ—åŒ–çš„ID</span><br><span class="line">    static final long serialVersionUID = -5024744406713321676L;</span><br><span class="line"></span><br><span class="line">    // å£°æ˜ä¸å¯åºåˆ—åŒ–çš„HashMapï¼Œä¸å¯åºåˆ—åŒ–çš„åŸå› æ˜¯å› ä¸ºåœ¨å­˜å‚¨å€¼çš„æ—¶å€™ï¼Œvalueå­˜å‚¨çš„æ˜¯Objectå¯¹è±¡ï¼ŒObjectä¸å¯åºåˆ—åŒ–ã€‚å› æ­¤åªèƒ½ä½¿ç”¨è‡ªå·±çš„åºåˆ—åŒ–æ–¹æ³•ã€‚</span><br><span class="line">    private transient HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line">    // Dummy value to associate with an Object in the backing Map</span><br><span class="line">    // å®šä¹‰map valueçš„Objectå¯¹è±¡</span><br><span class="line">    private static final Object PRESENT = new Object();</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public HashSet() &#123;</span><br><span class="line">        map = new HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public HashSet(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        map = new HashMap&lt;&gt;(Math.max((int) (c.size()/.75f) + 1, 16));</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public HashSet(int initialCapacity, float loadFactor) &#123;</span><br><span class="line">        map = new HashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public HashSet(int initialCapacity) &#123;</span><br><span class="line">        map = new HashMap&lt;&gt;(initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è®¿é—®ä¸ºåŒ…æƒé™ï¼Œä¸»è¦æ˜¯ç”¨æ¥æ”¯æŒLinkedHashSetçš„</span><br><span class="line">    HashSet(int initialCapacity, float loadFactor, boolean dummy) &#123;</span><br><span class="line">        map = new LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public Iterator&lt;E&gt; iterator() &#123;</span><br><span class="line">        return map.keySet().iterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public int size() &#123;</span><br><span class="line">        return map.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public boolean isEmpty() &#123;</span><br><span class="line">        return map.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public boolean contains(Object o) &#123;</span><br><span class="line">        return map.containsKey(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">        return map.put(e, PRESENT)==null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public boolean remove(Object o) &#123;</span><br><span class="line">        return map.remove(o)==PRESENT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public void clear() &#123;</span><br><span class="line">        map.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public Object clone() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            HashSet&lt;E&gt; newSet = (HashSet&lt;E&gt;) super.clone();</span><br><span class="line">            newSet.map = (HashMap&lt;E, Object&gt;) map.clone();</span><br><span class="line">            return newSet;</span><br><span class="line">        &#125; catch (CloneNotSupportedException e) &#123;</span><br><span class="line">            throw new InternalError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //åºåˆ—åŒ–çš„å†™</span><br><span class="line">    private void writeObject(java.io.ObjectOutputStream s)</span><br><span class="line">        throws java.io.IOException &#123;</span><br><span class="line">        // Write out any hidden serialization magic</span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">        // Write out HashMap capacity and load factor</span><br><span class="line">        s.writeInt(map.capacity());</span><br><span class="line">        s.writeFloat(map.loadFactor());</span><br><span class="line"></span><br><span class="line">        // Write out size</span><br><span class="line">        s.writeInt(map.size());</span><br><span class="line"></span><br><span class="line">        // Write out all elements in the proper order.</span><br><span class="line">        for (E e : map.keySet())</span><br><span class="line">            s.writeObject(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //åºåˆ—åŒ–çš„è¯»</span><br><span class="line">    private void readObject(java.io.ObjectInputStream s)</span><br><span class="line">        throws java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line">        // Read in any hidden serialization magic</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        // Read in HashMap capacity and load factor and create backing HashMap</span><br><span class="line">        int capacity = s.readInt();</span><br><span class="line">        float loadFactor = s.readFloat();</span><br><span class="line">        map = (((HashSet)this) instanceof LinkedHashSet ?</span><br><span class="line">               new LinkedHashMap&lt;E,Object&gt;(capacity, loadFactor) :</span><br><span class="line">               new HashMap&lt;E,Object&gt;(capacity, loadFactor));</span><br><span class="line"></span><br><span class="line">        // Read in size</span><br><span class="line">        int size = s.readInt();</span><br><span class="line"></span><br><span class="line">        // Read in all elements in the proper order.</span><br><span class="line">        for (int i=0; i&lt;size; i++) &#123;</span><br><span class="line">            E e = (E) s.readObject();</span><br><span class="line">            map.put(e, PRESENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## LinkedHashSet</span><br><span class="line"></span><br><span class="line">LinkedHashSetæ˜¯å…·æœ‰å¯é¢„çŸ¥è¿­ä»£é¡ºåºçš„Setæ¥å£çš„å“ˆå¸Œè¡¨å’Œé“¾æ¥åˆ—è¡¨å®ç°ã€‚æ­¤å®ç°ä¸HashSetçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œåè€…ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡Œäºæ‰€æœ‰æ¡ç›®çš„åŒé‡é“¾æ¥åˆ—è¡¨ã€‚æ­¤é“¾æ¥åˆ—è¡¨å®šä¹‰äº†è¿­ä»£é¡ºåºï¼Œè¯¥è¿­ä»£é¡ºåºå¯ä¸ºæ’å…¥é¡ºåºæˆ–æ˜¯è®¿é—®é¡ºåºã€‚</span><br></pre></td></tr></table></figure><p>private static final long serialVersionUID = -2851667679971038690L;</p><pre><code>public LinkedHashSet(int initialCapacity, float loadFactor) {    super(initialCapacity, loadFactor, true);}public LinkedHashSet(int initialCapacity) {    super(initialCapacity, .75f, true);}public LinkedHashSet() {    super(16, .75f, true);}public LinkedHashSet(Collection&lt;? extends E&gt; c) {    super(Math.max(2*c.size(), 11), .75f, true);    addAll(c);}</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## TreeSet</span><br><span class="line"></span><br><span class="line">TreeMapæ˜¯ä¸€ä¸ªæœ‰åºçš„äºŒå‰æ ‘ï¼Œé‚£ä¹ˆåŒç†TreeSetåŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰åºçš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯æä¾›æœ‰åºçš„Seté›†åˆã€‚é€šè¿‡æºç æˆ‘ä»¬çŸ¥é“TreeSetåŸºç¡€AbstractSetï¼Œå®ç°NavigableSetã€Cloneableã€Serializableæ¥å£ã€‚å…¶ä¸­AbstractSetæä¾› Set æ¥å£çš„éª¨å¹²å®ç°ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†å®ç°æ­¤æ¥å£æ‰€éœ€çš„å·¥ä½œã€‚NavigableSetæ˜¯æ‰©å±•çš„ SortedSetï¼Œå…·æœ‰äº†ä¸ºç»™å®šæœç´¢ç›®æ ‡æŠ¥å‘Šæœ€æ¥è¿‘åŒ¹é…é¡¹çš„å¯¼èˆªæ–¹æ³•ï¼Œè¿™å°±æ„å‘³ç€å®ƒæ”¯æŒä¸€ç³»åˆ—çš„å¯¼èˆªæ–¹æ³•ã€‚æ¯”å¦‚æŸ¥æ‰¾ä¸æŒ‡å®šç›®æ ‡æœ€åŒ¹é…é¡¹ã€‚Cloneableæ”¯æŒå…‹éš†ï¼ŒSerializableæ”¯æŒåºåˆ—åŒ–ã€‚</span><br></pre></td></tr></table></figure><p>public class TreeSet<e> extends AbstractSet<e><br>    implements NavigableSet<e>, Cloneable, java.io.Serializable<br>{</e></e></e></p><pre><code>private transient NavigableMap&lt;E,Object&gt; m;// Dummy value to associate with an Object in the backing Mapprivate static final Object PRESENT = new Object();TreeSet(NavigableMap&lt;E,Object&gt; m) {    this.m = m;}public TreeSet() {    this(new TreeMap&lt;E,Object&gt;());}public TreeSet(Comparator&lt;? super E&gt; comparator) {    this(new TreeMap&lt;&gt;(comparator));}public TreeSet(Collection&lt;? extends E&gt; c) {    this();    addAll(c);}public TreeSet(SortedSet&lt;E&gt; s) {    this(s.comparator());    addAll(s);}public Iterator&lt;E&gt; iterator() {    return m.navigableKeySet().iterator();}// è¿”å›åœ¨æ­¤ set å…ƒç´ ä¸ŠæŒ‰é™åºè¿›è¡Œè¿­ä»£çš„è¿­ä»£å™¨ã€‚public Iterator&lt;E&gt; descendingIterator() {    return m.descendingKeySet().iterator();}// è¿”å›æ­¤ set ä¸­æ‰€åŒ…å«å…ƒç´ çš„é€†åºè§†å›¾ã€‚public NavigableSet&lt;E&gt; descendingSet() {    return new TreeSet&lt;&gt;(m.descendingMap());}public int size() {    return m.size();}public boolean isEmpty() {    return m.isEmpty();}public boolean contains(Object o) {    return m.containsKey(o);}public boolean add(E e) {    return m.put(e, PRESENT)==null;}public boolean remove(Object o) {    return m.remove(o)==PRESENT;}public void clear() {    m.clear();}public  boolean addAll(Collection&lt;? extends E&gt; c) {    // Use linear-time version if applicable    if (m.size()==0 &amp;&amp; c.size() &gt; 0 &amp;&amp;        c instanceof SortedSet &amp;&amp;        m instanceof TreeMap) {        SortedSet&lt;? extends E&gt; set = (SortedSet&lt;? extends E&gt;) c;        TreeMap&lt;E,Object&gt; map = (TreeMap&lt;E, Object&gt;) m;        Comparator&lt;? super E&gt; cc = (Comparator&lt;? super E&gt;) set.comparator();        Comparator&lt;? super E&gt; mc = map.comparator();        if (cc==mc || (cc != null &amp;&amp; cc.equals(mc))) {            map.addAllForTreeSet(set, PRESENT);            return true;        }    }    return super.addAll(c);}// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾public NavigableSet&lt;E&gt; subSet(E fromElement, boolean fromInclusive,                              E toElement,   boolean toInclusive) {    return new TreeSet&lt;&gt;(m.subMap(fromElement, fromInclusive,                                   toElement,   toInclusive));}//  è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾public NavigableSet&lt;E&gt; headSet(E toElement, boolean inclusive) {    return new TreeSet&lt;&gt;(m.headMap(toElement, inclusive));}// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾public NavigableSet&lt;E&gt; tailSet(E fromElement, boolean inclusive) {    return new TreeSet&lt;&gt;(m.tailMap(fromElement, inclusive));}// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾public SortedSet&lt;E&gt; subSet(E fromElement, E toElement) {    return subSet(fromElement, true, toElement, false);}// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾ï¼Œå…¶å…ƒç´ ä¸¥æ ¼å°äº toElementã€‚public SortedSet&lt;E&gt; headSet(E toElement) {    return headSet(toElement, false);}// è¿”å›æ­¤ set çš„éƒ¨åˆ†è§†å›¾public SortedSet&lt;E&gt; tailSet(E fromElement) {    return tailSet(fromElement, true);}public Comparator&lt;? super E&gt; comparator() {    return m.comparator();}// è¿”å›æ­¤ set ä¸­å½“å‰ç¬¬ä¸€ä¸ªï¼ˆæœ€ä½ï¼‰å…ƒç´ ã€‚public E first() {    return m.firstKey();}// è¿”å›æ­¤ set ä¸­å½“å‰æœ€åï¼ˆæœ€é«˜ï¼‰ä¸€ä¸ªå…ƒç´ public E last() {    return m.lastKey();}// NavigableSet API methods// è¿”å›æ­¤ set ä¸­ä¸¥æ ¼å°äºç»™å®šå…ƒç´ çš„æœ€å¤§å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚public E lower(E e) {    return m.lowerKey(e);}// è¿”å›æ­¤ set ä¸­å°äºç­‰äºç»™å®šå…ƒç´ çš„æœ€å¤§å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚public E floor(E e) {    return m.floorKey(e);}// è¿”å›æ­¤ set ä¸­å¤§äºç­‰äºç»™å®šå…ƒç´ çš„æœ€å°å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚public E ceiling(E e) {    return m.ceilingKey(e);}// è¿”å›æ­¤ set ä¸­ä¸¥æ ¼å¤§äºç»™å®šå…ƒç´ çš„æœ€å°å…ƒç´ ï¼›å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚public E higher(E e) {    return m.higherKey(e);}// è·å–å¹¶ç§»é™¤ç¬¬ä¸€ä¸ªï¼ˆæœ€ä½ï¼‰å…ƒç´ ï¼›å¦‚æœæ­¤ set ä¸ºç©ºï¼Œåˆ™è¿”å› nullã€‚public E pollFirst() {    Map.Entry&lt;E,?&gt; e = m.pollFirstEntry();    return (e == null) ? null : e.getKey();}// è·å–å¹¶ç§»é™¤æœ€åä¸€ä¸ªï¼ˆæœ€é«˜ï¼‰å…ƒç´ ï¼›å¦‚æœæ­¤ set ä¸ºç©ºï¼Œåˆ™è¿”å› nullã€‚public E pollLast() {    Map.Entry&lt;E,?&gt; e = m.pollLastEntry();    return (e == null) ? null : e.getKey();}public Object clone() {    TreeSet&lt;E&gt; clone = null;    try {        clone = (TreeSet&lt;E&gt;) super.clone();    } catch (CloneNotSupportedException e) {        throw new InternalError();    }    clone.m = new TreeMap&lt;&gt;(m);    return clone;}private void writeObject(java.io.ObjectOutputStream s)    throws java.io.IOException {    // Write out any hidden stuff    s.defaultWriteObject();    // Write out Comparator    s.writeObject(m.comparator());    // Write out size    s.writeInt(m.size());    // Write out all elements in the proper order.    for (E e : m.keySet())        s.writeObject(e);}private void readObject(java.io.ObjectInputStream s)    throws java.io.IOException, ClassNotFoundException {    // Read in any hidden stuff    s.defaultReadObject();    // Read in Comparator    Comparator&lt;? super E&gt; c = (Comparator&lt;? super E&gt;) s.readObject();    // Create backing TreeMap    TreeMap&lt;E,Object&gt; tm;    if (c==null)        tm = new TreeMap&lt;&gt;();    else        tm = new TreeMap&lt;&gt;(c);    m = tm;    // Read in size    int size = s.readInt();    tm.readTreeSet(size, s, PRESENT);}private static final long serialVersionUID = -2479143000061671589L;</code></pre><p>}</p><p><code>`</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼åŸç†åŠåº”ç”¨åœºæ™¯</title>
      <link href="/2018/01/10/java/2018-01-10-Pattern/"/>
      <url>/2018/01/10/java/2018-01-10-Pattern/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/zhongyp/Demo/tree/master/src/main/java/com/zhongyp/advanced/pattern" target="_blank" rel="noopener">æœ¬ç¯‡åšå®¢ä¸­æ¶‰åŠçš„æ‰€æœ‰è®¾è®¡æ¨¡å¼æºç éƒ½è¿™åœ¨é‡Œï¼Œç‚¹å‡»å³å¯è®¿é—®</a></p><h2 id="æ·±å…¥æµ…å‡ºè®¾è®¡æ¨¡å¼éµå¾ªçš„è®¾è®¡æ¨¡å¼åŸåˆ™ï¼š"><a href="#æ·±å…¥æµ…å‡ºè®¾è®¡æ¨¡å¼éµå¾ªçš„è®¾è®¡æ¨¡å¼åŸåˆ™ï¼š" class="headerlink" title="æ·±å…¥æµ…å‡ºè®¾è®¡æ¨¡å¼éµå¾ªçš„è®¾è®¡æ¨¡å¼åŸåˆ™ï¼š"></a>æ·±å…¥æµ…å‡ºè®¾è®¡æ¨¡å¼éµå¾ªçš„è®¾è®¡æ¨¡å¼åŸåˆ™ï¼š</h2><ul><li><p>å°è£…å˜åŒ–ï¼š æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–çš„åœ°æ–¹ï¼ŒæŠŠä»–ä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚</p></li><li><p>åˆæˆæœç”¨åŸåˆ™ï¼šå¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ï¼Œç»„åˆä½¿ç³»ç»Ÿå…·æœ‰å¼¹æ€§ï¼Œä¸ä»…å¯ä»¥å°†ç®—æ³•å°è£…æˆç±»ï¼Œè¿˜å¯ä»¥åœ¨è¿è¡Œæ˜¯åŠ¨æ€çš„æ”¹å˜è¡Œä¸ºã€‚</p></li><li><p>ä¾èµ–å€’è½¬åŸåˆ™ï¼šé’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸é’ˆå¯¹å®ç°ç¼–ç¨‹ï¼Œ ç¨‹åºåˆ©ç”¨å¤šæ€é’ˆå¯¹è¶…ç±»å‹ï¼ˆsupertypeï¼‰ç¼–ç¨‹ï¼Œæ‰§è¡Œæ—¶ä¼šæ ¹æ®å®é™…çŠ¶å†µæ‰§è¡Œåˆ°çœŸæ­£çš„è¡Œä¸ºï¼Œä¸ä¼šè¢«ç»‘æ­»åœ¨è¶…ç±»å‹çš„è¡Œä¸ºä¸Šã€‚</p></li><li><p>æ¥å£éš”ç¦»åŸåˆ™ï¼šä¸ºäº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›</p></li><li><p>é‡Œå¼ä»£æ¢åŸåˆ™ï¼šä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚</p></li><li><p>å¼€é—­åŸåˆ™OCPï¼šç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</p></li><li><p>ä¾èµ–æŠ½è±¡ï¼Œä¸è¦ä¾èµ–å…·ä½“ç±»ã€‚</p></li><li><p>æœ€å°‘çŸ¥é“åŸåˆ™ï¼šåªå’Œæœ‹å‹äº¤è°ˆã€‚ </p></li><li><p>ç±»åº”è¯¥åªæœ‰ä¸€ä¸ªæ”¹å˜çš„ç†ç”±ã€‚</p></li></ul><h2 id="ç­–ç•¥æ¨¡å¼-stragety"><a href="#ç­–ç•¥æ¨¡å¼-stragety" class="headerlink" title="ç­–ç•¥æ¨¡å¼(stragety)"></a>ç­–ç•¥æ¨¡å¼(stragety)</h2><p>å®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚ä½“ç°å°è£…å˜åŒ–ã€å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ã€é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p><p>Strategyæ¨¡å¼æœ‰ä¸‹é¢çš„ä¸€äº›ä¼˜ç‚¹ï¼š</p><ul><li><p>ç›¸å…³ç®—æ³•ç³»åˆ— Strategyç±»å±‚æ¬¡ä¸ºContextå®šä¹‰äº†ä¸€ç³»åˆ—çš„å¯ä¾›é‡ç”¨çš„ç®—æ³•æˆ–è¡Œä¸ºã€‚ ç»§æ‰¿æœ‰åŠ©äºæå–å‡ºè¿™äº›ç®—æ³•ä¸­çš„å…¬å…±åŠŸèƒ½ã€‚</p></li><li><p>æä¾›äº†å¯ä»¥æ›¿æ¢ç»§æ‰¿å…³ç³»çš„åŠæ³•ï¼š ç»§æ‰¿æä¾›äº†å¦ä¸€ç§æ”¯æŒå¤šç§ç®—æ³•æˆ–è¡Œä¸ºçš„æ–¹æ³•ã€‚ä½ å¯ä»¥ç›´æ¥ç”Ÿæˆä¸€ä¸ªContextç±»çš„å­ç±»ï¼Œä»è€Œç»™å®ƒä»¥ä¸åŒçš„è¡Œä¸ºã€‚ä½†è¿™ä¼šå°†è¡Œä¸ºç¡¬è¡Œç¼–åˆ¶åˆ° Contextä¸­ï¼Œè€Œå°†ç®—æ³•çš„å®ç°ä¸Contextçš„å®ç°æ··åˆèµ·æ¥,ä»è€Œä½¿Contextéš¾ä»¥ç†è§£ã€éš¾ä»¥ç»´æŠ¤å’Œéš¾ä»¥æ‰©å±•ï¼Œè€Œä¸”è¿˜ä¸èƒ½åŠ¨æ€åœ°æ”¹å˜ç®—æ³•ã€‚æœ€åä½ å¾—åˆ°ä¸€å †ç›¸å…³çš„ç±» , å®ƒä»¬ä¹‹é—´çš„å”¯ä¸€å·®åˆ«æ˜¯å®ƒä»¬æ‰€ä½¿ç”¨çš„ç®—æ³•æˆ–è¡Œä¸ºã€‚ å°†ç®—æ³•å°è£…åœ¨ç‹¬ç«‹çš„Strategyç±»ä¸­ä½¿å¾—ä½ å¯ä»¥ç‹¬ç«‹äºå…¶Contextæ”¹å˜å®ƒï¼Œä½¿å®ƒæ˜“äºåˆ‡æ¢ã€æ˜“äºç†è§£ã€æ˜“äºæ‰©å±•ã€‚</p></li><li><p>æ¶ˆé™¤äº†ä¸€äº›if elseæ¡ä»¶è¯­å¥ ï¼šStrategyæ¨¡å¼æä¾›äº†ç”¨æ¡ä»¶è¯­å¥é€‰æ‹©æ‰€éœ€çš„è¡Œä¸ºä»¥å¤–çš„å¦ä¸€ç§é€‰æ‹©ã€‚å½“ä¸åŒçš„è¡Œä¸ºå †ç Œåœ¨ä¸€ä¸ªç±»ä¸­æ—¶ ,å¾ˆéš¾é¿å…ä½¿ç”¨æ¡ä»¶è¯­å¥æ¥é€‰æ‹©åˆé€‚çš„è¡Œä¸ºã€‚å°†è¡Œä¸ºå°è£…åœ¨ä¸€ä¸ªä¸ªç‹¬ç«‹çš„Strategyç±»ä¸­æ¶ˆé™¤äº†è¿™äº›æ¡ä»¶è¯­å¥ã€‚å«æœ‰è®¸å¤šæ¡ä»¶è¯­å¥çš„ä»£ç é€šå¸¸æ„å‘³ç€éœ€è¦ä½¿ç”¨Strategyæ¨¡å¼ã€‚</p></li><li><p>å®ç°çš„é€‰æ‹© Strategyæ¨¡å¼å¯ä»¥æä¾›ç›¸åŒè¡Œä¸ºçš„ä¸åŒå®ç°ã€‚å®¢æˆ·å¯ä»¥æ ¹æ®ä¸åŒæ—¶é—´ /ç©ºé—´æƒè¡¡å–èˆè¦æ±‚ä»ä¸åŒç­–ç•¥ä¸­è¿›è¡Œé€‰æ‹©ã€‚</p></li></ul><p>Strategyæ¨¡å¼ç¼ºç‚¹:</p><ul><li><p>å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»:  æœ¬æ¨¡å¼æœ‰ä¸€ä¸ªæ½œåœ¨çš„ç¼ºç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªå®¢æˆ·è¦é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„Strategyå°±å¿…é¡»çŸ¥é“è¿™äº›Strategyåˆ°åº•æœ‰ä½•ä¸åŒã€‚æ­¤æ—¶å¯èƒ½ä¸å¾—ä¸å‘å®¢æˆ·æš´éœ²å…·ä½“çš„å®ç°é—®é¢˜ã€‚å› æ­¤ä»…å½“è¿™äº›ä¸åŒè¡Œä¸ºå˜ä½“ä¸å®¢æˆ·ç›¸å…³çš„è¡Œä¸ºæ—¶ , æ‰éœ€è¦ä½¿ç”¨Strategyæ¨¡å¼ã€‚</p></li><li><p>Strategyå’ŒContextä¹‹é—´çš„é€šä¿¡å¼€é”€ ï¼šæ— è®ºå„ä¸ªConcreteStrategyå®ç°çš„ç®—æ³•æ˜¯ç®€å•è¿˜æ˜¯å¤æ‚, å®ƒä»¬éƒ½å…±äº«Strategyå®šä¹‰çš„æ¥å£ã€‚å› æ­¤å¾ˆå¯èƒ½æŸäº› ConcreteStrategyä¸ä¼šéƒ½ç”¨åˆ°æ‰€æœ‰é€šè¿‡è¿™ä¸ªæ¥å£ä¼ é€’ç»™å®ƒä»¬çš„ä¿¡æ¯ï¼›ç®€å•çš„ ConcreteStrategyå¯èƒ½ä¸ä½¿ç”¨å…¶ä¸­çš„ä»»ä½•ä¿¡æ¯ï¼è¿™å°±æ„å‘³ç€æœ‰æ—¶Contextä¼šåˆ›å»ºå’Œåˆå§‹åŒ–ä¸€äº›æ°¸è¿œä¸ä¼šç”¨åˆ°çš„å‚æ•°ã€‚å¦‚æœå­˜åœ¨è¿™æ ·é—®é¢˜ , é‚£ä¹ˆå°†éœ€è¦åœ¨Strategyå’ŒContextä¹‹é—´æ›´è¿›è¡Œç´§å¯†çš„è€¦åˆã€‚</p></li><li><p>ç­–ç•¥æ¨¡å¼å°†é€ æˆäº§ç”Ÿå¾ˆå¤šç­–ç•¥ç±»ï¼šå¯ä»¥é€šè¿‡ä½¿ç”¨äº«å…ƒæ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¯¹è±¡çš„æ•°é‡ã€‚ å¢åŠ äº†å¯¹è±¡çš„æ•°ç›® Strategyå¢åŠ äº†ä¸€ä¸ªåº”ç”¨ä¸­çš„å¯¹è±¡çš„æ•°ç›®ã€‚æœ‰æ—¶ä½ å¯ä»¥å°† Strategyå®ç°ä¸ºå¯ä¾›å„Contextå…±äº«çš„æ— çŠ¶æ€çš„å¯¹è±¡æ¥å‡å°‘è¿™ä¸€å¼€é”€ã€‚ä»»ä½•å…¶ä½™çš„çŠ¶æ€éƒ½ç”± Contextç»´æŠ¤ã€‚Contextåœ¨æ¯ä¸€æ¬¡å¯¹Strategyå¯¹è±¡çš„è¯·æ±‚ä¸­éƒ½å°†è¿™ä¸ªçŠ¶æ€ä¼ é€’è¿‡å»ã€‚å…±äº«çš„ Strategyä¸åº”åœ¨å„æ¬¡è°ƒç”¨ä¹‹é—´ç»´æŠ¤çŠ¶æ€ã€‚</p></li></ul><p>åº”ç”¨åœºæ™¯ï¼šæ¯”è¾ƒå™¨Comparatorå’Œå¸ƒå±€ç®¡ç†å™¨LayoutManager</p><ul><li><p>åœ¨è¯¥æ¯”è¾ƒæ¶æ„ä¸­ï¼ŒComparatorå°±æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ç­–ç•¥ï¼›ä¸€ä¸ªç±»å®ç°è¯¥ç»“æ„ï¼Œå¹¶å®ç°é‡Œé¢çš„compareæ–¹æ³•ï¼Œè¯¥ç±»æˆä¸ºå…·ä½“ç­–ç•¥ç±»ï¼›Collectionsç±»å°±æ˜¯ç¯å¢ƒè§’è‰²ï¼Œä»–å°†é›†åˆçš„æ¯”è¾ƒå°è£…æˆé™æ€æ–¹æ³•å¯¹å¤–æä¾›apiã€‚</p></li><li><p>åœ¨Java SEå¼€å‘ä¸­ï¼Œç”¨æˆ·éœ€è¦å¯¹å®¹å™¨å¯¹è±¡Containerä¸­çš„æˆå‘˜å¯¹è±¡å¦‚æŒ‰é’®ã€æ–‡æœ¬æ¡†ç­‰GUIæ§ä»¶è¿›è¡Œå¸ƒå±€(Layout)ï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç”±å®¢æˆ·ç«¯åŠ¨æ€å†³å®šä¸€ä¸ªContainerå¯¹è±¡å¦‚ä½•å¸ƒå±€ï¼ŒJavaè¯­è¨€åœ¨JDKä¸­æä¾›äº†å‡ ç§ä¸åŒçš„å¸ƒå±€æ–¹å¼ï¼Œå°è£…åœ¨ä¸åŒçš„ç±»ä¸­ï¼Œå¦‚BorderLayoutã€FlowLayoutã€GridLayoutã€GridBagLayoutå’ŒCardLayoutç­‰ã€‚</p></li></ul><h2 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h2><p>åœ¨å¯¹è±¡ä¹‹é—´å®šä¹‰ä¸€å¯¹å¤šçš„ä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œä¾èµ–ä»–çš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚ä½“ç°å°è£…å˜åŒ–ã€é’ˆå¯¹æ¥å£ç¼–ç¨‹ã€å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ã€äº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡</p><p>ç±»å›¾ï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/observer.png?raw=true" alt="è§‚å¯Ÿè€…æ¨¡å¼"></p><p>JDKè‡ªå¸¦çš„è§‚å¯Ÿè€…å®ç°ï¼š</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/jdkobserver.png?raw=true" alt="è§‚å¯Ÿè€…æ¨¡å¼"></p><p>æºç è§åšæ–‡æœ€ä¸Šæ–¹æºç è¿æ¥ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼çš„æ•ˆæœæœ‰ä»¥ä¸‹çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>è§‚å¯Ÿè€…æ¨¡å¼åœ¨è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆã€‚è¢«è§‚å¯Ÿè€…è§’è‰²æ‰€çŸ¥é“çš„åªæ˜¯ä¸€ä¸ªå…·ä½“è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ªå…·ä½“è§‚å¯Ÿè€…éƒ½ç¬¦åˆä¸€ä¸ªæŠ½è±¡è§‚å¯Ÿè€…çš„æ¥å£ã€‚è¢«è§‚å¯Ÿè€…å¹¶ä¸è®¤è¯†ä»»ä½•ä¸€ä¸ªå…·ä½“è§‚å¯Ÿè€…ï¼Œå®ƒåªçŸ¥é“å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„æ¥å£ã€‚</p></li><li><p>ç”±äºè¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…æ²¡æœ‰ç´§å¯†åœ°è€¦åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥å±äºä¸åŒçš„æŠ½è±¡åŒ–å±‚æ¬¡ã€‚å¦‚æœè¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…éƒ½è¢«æ‰”åˆ°ä¸€èµ·ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å¿…ç„¶è·¨è¶ŠæŠ½è±¡åŒ–å’Œå…·ä½“åŒ–å±‚æ¬¡ã€‚</p></li><li><p>è§‚å¯Ÿè€…æ¨¡å¼æ”¯æŒå¹¿æ’­é€šè®¯ã€‚è¢«è§‚å¯Ÿè€…ä¼šå‘æ‰€æœ‰çš„ç™»è®°è¿‡çš„è§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ï¼Œ</p></li></ul><p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰ä¸‹é¢çš„ç¼ºç‚¹ï¼š</p><ul><li><p>å¦‚æœä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯¹è±¡æœ‰å¾ˆå¤šçš„ç›´æ¥å’Œé—´æ¥çš„è§‚å¯Ÿè€…çš„è¯ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚</p></li><li><p>å¦‚æœåœ¨è¢«è§‚å¯Ÿè€…ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè¢«è§‚å¯Ÿè€…ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚åœ¨ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ˜¯è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸€ç‚¹ã€‚</p></li><li><p>å¦‚æœå¯¹è§‚å¯Ÿè€…çš„é€šçŸ¥æ˜¯é€šè¿‡å¦å¤–çš„çº¿ç¨‹è¿›è¡Œå¼‚æ­¥æŠ•é€’çš„è¯ï¼Œç³»ç»Ÿå¿…é¡»ä¿è¯æŠ•é€’æ˜¯ä»¥è‡ªæ°çš„æ–¹å¼è¿›è¡Œçš„ã€‚</p></li><li><p>è™½ç„¶è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥éšæ—¶ä½¿è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶ä½¿è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ã€‚</p></li></ul><p>åº”ç”¨åœºæ™¯ï¼š</p><p>springçš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ä½¿ç”¨çš„æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Œé€šè¿‡ApplicationEventæŠ½è±¡ç±»å’ŒApplicationListeneræ¥å£,å¯ä»¥å®ç°ApplicationContextäº‹ä»¶å¤„ç†ï¼Œç›‘å¬å™¨åœ¨å¤„ç†Eventæ—¶,é€šå¸¸ä¼šè¿›è¡Œåˆ¤æ–­ä¼ å…¥çš„Eventæ˜¯ä¸æ˜¯è‡ªå·±æ‰€æƒ³è¦å¤„ç†çš„,ä½¿ç”¨instanceofå…³é”®å­—ï¼ŒApplicationEventMulticasteräº‹ä»¶å¹¿æ’­å™¨å®ç°äº†ç›‘å¬å™¨çš„æ³¨å†Œ,ä¸€èˆ¬ä¸éœ€è¦æˆ‘ä»¬å®ç°,åªéœ€è¦æ˜¾ç¤ºçš„è°ƒç”¨applicationcontext.publisherEventæ–¹æ³•å³å¯ã€‚</p><h2 id="è£…é¥°è€…æ¨¡å¼"><a href="#è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è£…é¥°è€…æ¨¡å¼"></a>è£…é¥°è€…æ¨¡å¼</h2><p>åŠ¨æ€çš„å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œè‹¥è¦æ‰©å±•åŠŸèƒ½ï¼Œè£…é¥°è€…æä¾›äº†æ¯”é›†æˆæ›´å…·æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>åŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œå°±æ‰©å±•åŠŸèƒ½è€Œè¨€ï¼Œæ¯”ç”Ÿæˆå­ç±»æ–¹å¼æ›´ä¸ºçµæ´»ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>åˆ©ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œå¸¸å¸¸é€ æˆè®¾è®¡ä¸­æœ‰å¤§é‡çš„å°ç±»ï¼Œæ•°é‡å®åœ¨å¤ªå¤šï¼Œå¯èƒ½ä¼šé€ æˆä½¿ç”¨æ­¤APIç¨‹åºå‘˜çš„å›°æ‰°ã€‚</li></ul><p>åº”ç”¨åœºæ™¯</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/IO.png?raw=true" alt="IO"></p><p>FileInputStreamã€StringBufferInputStreamã€ByteArrayInputStreamä¸ºè¢«è£…é¥°çš„ç»„ä»¶ç±»ã€‚</p><p>PushbackInputStreamã€BufferInputStreamã€DataInputStreamã€LineNumberInputStreamä¸ºå…·ä½“è£…é¥°è€…ç±»ã€‚</p><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><p>ä¸‰ç§å½¢æ€ï¼š</p><ul><li>ç®€å•å·¥å‚æ¨¡å¼ï¼šåˆç§°é™æ€å·¥å‚æ–¹æ³• (å¯¹äºå¢åŠ æ–°çš„äº§å“ï¼Œæ— èƒ½ä¸ºåŠ›)</li></ul><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/simplefactory.png?raw=true" alt="ç±»å›¾"></p><ul><li>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šåˆç§°å¤šæ€æ€§å·¥å‚æ¨¡å¼æˆ–è™šæ‹Ÿæ„é€ å­æ¨¡å¼ (æ”¯æŒå¢åŠ ä»»æ„äº§å“)</li></ul><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/functionfactory.png?raw=true" alt="ç±»å›¾"></p><ul><li>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šåˆç§°å·¥å…·ç®±æ¨¡å¼ (å¯¹äºå¢åŠ æ–°çš„äº§å“ï¼Œæ— èƒ½ä¸ºåŠ›ï¼›æ”¯æŒå¢åŠ äº§å“æ—)</li></ul><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/abstractfactory.png?raw=true" alt="ç±»å›¾"></p><h2 id="å•ä»¶æ¨¡å¼"><a href="#å•ä»¶æ¨¡å¼" class="headerlink" title="å•ä»¶æ¨¡å¼"></a>å•ä»¶æ¨¡å¼</h2><p>ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚</p><p>å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼<br>å•ä¾‹æ¨¡å¼çš„å®ç°æœ‰å¤šç§æ–¹å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨</li></ul><p>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼šæ˜¯</p><p>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼šå¦</p><p>å®ç°éš¾åº¦ï¼šæ˜“</p><p>æè¿°ï¼šè¿™ç§æ–¹å¼æ˜¯æœ€åŸºæœ¬çš„å®ç°æ–¹å¼ï¼Œè¿™ç§å®ç°æœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¸æ”¯æŒå¤šçº¿ç¨‹ã€‚å› ä¸ºæ²¡æœ‰åŠ é” synchronizedï¼Œæ‰€ä»¥ä¸¥æ ¼æ„ä¹‰ä¸Šå®ƒå¹¶ä¸ç®—å•ä¾‹æ¨¡å¼ã€‚</p><p>è¿™ç§æ–¹å¼ lazy loading å¾ˆæ˜æ˜¾ï¼Œä¸è¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¤šçº¿ç¨‹ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</p><p>ä»£ç å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;  </span><br><span class="line">    private static Singleton instance;  </span><br><span class="line">    private Singleton ()&#123;&#125;  </span><br><span class="line">  </span><br><span class="line">    public static Singleton getInstance() &#123;  </span><br><span class="line">    if (instance == null) &#123;  </span><br><span class="line">        instance = new Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    return instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä»‹ç»çš„å‡ ç§å®ç°æ–¹å¼éƒ½æ”¯æŒå¤šçº¿ç¨‹ï¼Œä½†æ˜¯åœ¨æ€§èƒ½ä¸Šæœ‰æ‰€å·®å¼‚ã€‚</p><ul><li>æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨</li></ul><p>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼šæ˜¯</p><p>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼šæ˜¯</p><p>å®ç°éš¾åº¦ï¼šæ˜“</p><p>æè¿°ï¼šè¿™ç§æ–¹å¼å…·å¤‡å¾ˆå¥½çš„ lazy loadingï¼Œèƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ä¸­å¾ˆå¥½çš„å·¥ä½œï¼Œä½†æ˜¯ï¼Œæ•ˆç‡å¾ˆä½ï¼Œ99% æƒ…å†µä¸‹ä¸éœ€è¦åŒæ­¥ã€‚</p><p>ä¼˜ç‚¹ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨æ‰åˆå§‹åŒ–ï¼Œé¿å…å†…å­˜æµªè´¹ã€‚</p><p>ç¼ºç‚¹ï¼šå¿…é¡»åŠ é” synchronized æ‰èƒ½ä¿è¯å•ä¾‹ï¼Œä½†åŠ é”ä¼šå½±å“æ•ˆç‡ã€‚</p><p>getInstance() çš„æ€§èƒ½å¯¹åº”ç”¨ç¨‹åºä¸æ˜¯å¾ˆå…³é”®ï¼ˆè¯¥æ–¹æ³•ä½¿ç”¨ä¸å¤ªé¢‘ç¹ï¼‰ã€‚</p><p>ä»£ç å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;  </span><br><span class="line">    private static Singleton instance;  </span><br><span class="line">    private Singleton ()&#123;&#125;  </span><br><span class="line">    public static synchronized Singleton getInstance() &#123;  </span><br><span class="line">    if (instance == null) &#123;  </span><br><span class="line">        instance = new Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    return instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¥¿æ±‰å¼</li></ul><p>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼šå¦</p><p>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼šæ˜¯</p><p>å®ç°éš¾åº¦ï¼šæ˜“</p><p>æè¿°ï¼šè¿™ç§æ–¹å¼æ¯”è¾ƒå¸¸ç”¨ï¼Œä½†å®¹æ˜“äº§ç”Ÿåƒåœ¾å¯¹è±¡ã€‚</p><p>ä¼˜ç‚¹ï¼šæ²¡æœ‰åŠ é”ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šæé«˜ã€‚</p><p>ç¼ºç‚¹ï¼šç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜ã€‚</p><p>å®ƒåŸºäº classloder æœºåˆ¶é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜ï¼Œä¸è¿‡ï¼Œinstance åœ¨ç±»è£…è½½æ—¶å°±å®ä¾‹åŒ–ï¼Œè™½ç„¶å¯¼è‡´ç±»è£…è½½çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œåœ¨å•ä¾‹æ¨¡å¼ä¸­å¤§å¤šæ•°éƒ½æ˜¯è°ƒç”¨ getInstance æ–¹æ³•ï¼Œ ä½†æ˜¯ä¹Ÿä¸èƒ½ç¡®å®šæœ‰å…¶ä»–çš„æ–¹å¼ï¼ˆæˆ–è€…å…¶ä»–çš„é™æ€æ–¹æ³•ï¼‰å¯¼è‡´ç±»è£…è½½ï¼Œè¿™æ—¶å€™åˆå§‹åŒ– instance æ˜¾ç„¶æ²¡æœ‰è¾¾åˆ° lazy loading çš„æ•ˆæœã€‚</p><p>ä»£ç å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;  </span><br><span class="line">    private static Singleton instance = new Singleton();  </span><br><span class="line">    private Singleton ()&#123;&#125;  </span><br><span class="line">    public static Singleton getInstance() &#123;  </span><br><span class="line">    return instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŒæ£€é”/åŒé‡æ ¡éªŒé”ï¼ˆDCLï¼Œå³ double-checked lockingï¼‰</li></ul><p>JDK ç‰ˆæœ¬ï¼šJDK1.5 èµ·</p><p>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼šæ˜¯</p><p>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼šæ˜¯</p><p>å®ç°éš¾åº¦ï¼šè¾ƒå¤æ‚</p><p>æè¿°ï¼šè¿™ç§æ–¹å¼é‡‡ç”¨åŒé”æœºåˆ¶ï¼Œå®‰å…¨ä¸”åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹èƒ½ä¿æŒé«˜æ€§èƒ½ã€‚</p><p>getInstance() çš„æ€§èƒ½å¯¹åº”ç”¨ç¨‹åºå¾ˆå…³é”®ã€‚</p><p>ä»£ç å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;  </span><br><span class="line">    private volatile static Singleton singleton;  </span><br><span class="line">    private Singleton ()&#123;&#125;  </span><br><span class="line">    public static Singleton getSingleton() &#123;  </span><br><span class="line">    if (singleton == null) &#123;  </span><br><span class="line">        synchronized (Singleton.class) &#123;  </span><br><span class="line">        if (singleton == null) &#123;  </span><br><span class="line">            singleton = new Singleton();  </span><br><span class="line">        &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    return singleton;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç™»è®°å¼/é™æ€å†…éƒ¨ç±»</li></ul><p>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼šæ˜¯</p><p>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼šæ˜¯</p><p>å®ç°éš¾åº¦ï¼šä¸€èˆ¬</p><p>æè¿°ï¼šè¿™ç§æ–¹å¼èƒ½è¾¾åˆ°åŒæ£€é”æ–¹å¼ä¸€æ ·çš„åŠŸæ•ˆï¼Œä½†å®ç°æ›´ç®€å•ã€‚å¯¹é™æ€åŸŸä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ï¼Œåº”ä½¿ç”¨è¿™ç§æ–¹å¼è€Œä¸æ˜¯åŒæ£€é”æ–¹å¼ã€‚è¿™ç§æ–¹å¼åªé€‚ç”¨äºé™æ€åŸŸçš„æƒ…å†µï¼ŒåŒæ£€é”æ–¹å¼å¯åœ¨å®ä¾‹åŸŸéœ€è¦å»¶è¿Ÿåˆå§‹åŒ–æ—¶ä½¿ç”¨ã€‚</p><p>è¿™ç§æ–¹å¼åŒæ ·åˆ©ç”¨äº† classloder æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ– instance æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒè·Ÿç¬¬ 3 ç§æ–¹å¼ä¸åŒçš„æ˜¯ï¼šç¬¬ 3 ç§æ–¹å¼åªè¦ Singleton ç±»è¢«è£…è½½äº†ï¼Œé‚£ä¹ˆ instance å°±ä¼šè¢«å®ä¾‹åŒ–ï¼ˆæ²¡æœ‰è¾¾åˆ° lazy loading æ•ˆæœï¼‰ï¼Œè€Œè¿™ç§æ–¹å¼æ˜¯ Singleton ç±»è¢«è£…è½½äº†ï¼Œinstance ä¸ä¸€å®šè¢«åˆå§‹åŒ–ã€‚å› ä¸º SingletonHolder ç±»æ²¡æœ‰è¢«ä¸»åŠ¨ä½¿ç”¨ï¼Œåªæœ‰é€šè¿‡æ˜¾å¼è°ƒç”¨ getInstance æ–¹æ³•æ—¶ï¼Œæ‰ä¼šæ˜¾å¼è£…è½½ SingletonHolder ç±»ï¼Œä»è€Œå®ä¾‹åŒ– instanceã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœå®ä¾‹åŒ– instance å¾ˆæ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥æƒ³è®©å®ƒå»¶è¿ŸåŠ è½½ï¼Œå¦å¤–ä¸€æ–¹é¢ï¼Œåˆä¸å¸Œæœ›åœ¨ Singleton ç±»åŠ è½½æ—¶å°±å®ä¾‹åŒ–ï¼Œå› ä¸ºä¸èƒ½ç¡®ä¿ Singleton ç±»è¿˜å¯èƒ½åœ¨å…¶ä»–çš„åœ°æ–¹è¢«ä¸»åŠ¨ä½¿ç”¨ä»è€Œè¢«åŠ è½½ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å®ä¾‹åŒ– instance æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œè¿™ç§æ–¹å¼ç›¸æ¯”ç¬¬ 3 ç§æ–¹å¼å°±æ˜¾å¾—å¾ˆåˆç†ã€‚</p><p>ä»£ç å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;  </span><br><span class="line">    private static class SingletonHolder &#123;  </span><br><span class="line">    private static final Singleton INSTANCE = new Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    private Singleton ()&#123;&#125;  </span><br><span class="line">    public static final Singleton getInstance() &#123;  </span><br><span class="line">    return SingletonHolder.INSTANCE;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æšä¸¾</li></ul><p>JDK ç‰ˆæœ¬ï¼šJDK1.5 èµ·</p><p>æ˜¯å¦ Lazy åˆå§‹åŒ–ï¼šå¦</p><p>æ˜¯å¦å¤šçº¿ç¨‹å®‰å…¨ï¼šæ˜¯</p><p>å®ç°éš¾åº¦ï¼šæ˜“</p><p>æè¿°ï¼šè¿™ç§å®ç°æ–¹å¼è¿˜æ²¡æœ‰è¢«å¹¿æ³›é‡‡ç”¨ï¼Œä½†è¿™æ˜¯å®ç°å•ä¾‹æ¨¡å¼çš„æœ€ä½³æ–¹æ³•ã€‚å®ƒæ›´ç®€æ´ï¼Œè‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ã€‚</p><p>è¿™ç§æ–¹å¼æ˜¯ Effective Java ä½œè€… Josh Bloch æå€¡çš„æ–¹å¼ï¼Œå®ƒä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜è‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œé˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ã€‚ä¸è¿‡ï¼Œç”±äº JDK1.5 ä¹‹åæ‰åŠ å…¥ enum ç‰¹æ€§ï¼Œç”¨è¿™ç§æ–¹å¼å†™ä¸å…è®©äººæ„Ÿè§‰ç”Ÿç–ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œä¹Ÿå¾ˆå°‘ç”¨ã€‚</p><p>ä¸èƒ½é€šè¿‡ reflection attack æ¥è°ƒç”¨ç§æœ‰æ„é€ æ–¹æ³•ã€‚</p><p>ä»£ç å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public enum EnumTest &#123;</span><br><span class="line"></span><br><span class="line">    INSTANCE;</span><br><span class="line">    private Test test;</span><br><span class="line"></span><br><span class="line">    private EnumTest()&#123;</span><br><span class="line">        test = new Test();</span><br><span class="line">    &#125;</span><br><span class="line">    public Test getInstance()&#123;</span><br><span class="line">        return test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Test&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://zhongyp.me/2018/02/04/ENUM/">è¯¦ç»†äº†è§£</a></p><p>ç»éªŒä¹‹è°ˆï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨ç¬¬ 1 ç§å’Œç¬¬ 2 ç§æ‡’æ±‰æ–¹å¼ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ 3 ç§é¥¿æ±‰æ–¹å¼ã€‚åªæœ‰åœ¨è¦æ˜ç¡®å®ç° lazy loading æ•ˆæœæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ç¬¬ 5 ç§ç™»è®°æ–¹å¼ã€‚å¦‚æœæ¶‰åŠåˆ°ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ç¬¬ 6 ç§æšä¸¾æ–¹å¼ã€‚å¦‚æœæœ‰å…¶ä»–ç‰¹æ®Šçš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ 4 ç§åŒæ£€é”æ–¹å¼ã€‚</p><h2 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h2><p>å°†è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è¯·æ±‚ï¼Œé˜Ÿåˆ—æˆ–è€…æ—¥å¿—æ¥å‚æ•°åŒ–å…¶ä»–å¯¹è±¡ã€‚å‘½ä»¤æ¨¡å¼ä¹Ÿæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/command.png?raw=true" alt="ç±»å›¾"></p><p>ä¼˜ç‚¹</p><ul><li>ç±»é—´è§£è€¦ï¼šè°ƒç”¨è€…è§’è‰²ä¸æ¥æ”¶è€…è§’è‰²ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ï¼Œè°ƒç”¨è€…å®ç°åŠŸèƒ½æ—¶åªéœ€è°ƒç”¨Command æŠ½è±¡ç±»çš„executeæ–¹æ³•å°±å¯ä»¥ï¼Œä¸éœ€è¦äº†è§£åˆ°åº•æ˜¯å“ªä¸ªæ¥æ”¶è€…æ‰§è¡Œã€‚</li><li>å¯æ‰©å±•æ€§ï¼šCommandçš„å­ç±»å¯ä»¥éå¸¸å®¹æ˜“åœ°æ‰©å±•ï¼Œè€Œè°ƒç”¨è€…Invokerå’Œé«˜å±‚æ¬¡çš„æ¨¡å—Clientä¸äº§ç”Ÿä¸¥ é‡çš„ä»£ç è€¦åˆã€‚</li><li>å‘½ä»¤æ¨¡å¼ç»“åˆå…¶ä»–æ¨¡å¼ä¼šæ›´ä¼˜ç§€ï¼šå‘½ä»¤æ¨¡å¼å¯ä»¥ç»“åˆè´£ä»»é“¾æ¨¡å¼ï¼Œå®ç°å‘½ä»¤æ—è§£æä»»åŠ¡ï¼›ç»“åˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œåˆ™å¯ä»¥å‡å°‘ Commandå­ç±»çš„è†¨èƒ€é—®é¢˜ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>å‘½ä»¤æ¨¡å¼ä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œè¯·çœ‹Commandçš„å­ç±»ï¼šå¦‚æœæœ‰Nä¸ªå‘½ä»¤ï¼Œé—®é¢˜å°±å‡ºæ¥ äº†ï¼ŒCommandçš„å­ç±»å°±å¯ä¸æ˜¯å‡ ä¸ªï¼Œè€Œæ˜¯Nä¸ªï¼Œè¿™ä¸ªç±»è†¨èƒ€å¾—éå¸¸å¤§ï¼Œè¿™ä¸ªå°±éœ€è¦è¯»è€…åœ¨é¡¹ ç›®ä¸­æ…é‡è€ƒè™‘ä½¿ç”¨ã€‚</li></ul><h2 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h2><p>æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ã€‚å¤–è§‚å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/facade.png?raw=true" alt="ç±»å›¾"></p><p>ä¼˜ç‚¹</p><ul><li><p>æ¾æ•£è€¦åˆ</p></li><li><p>ä½¿å¾—å®¢æˆ·ç«¯å’Œå­ç³»ç»Ÿä¹‹é—´è§£è€¦ï¼Œè®©å­ç³»ç»Ÿå†…éƒ¨çš„æ¨¡å—åŠŸèƒ½æ›´å®¹æ˜“æ‰©å±•å’Œç»´æŠ¤ï¼›</p></li><li><p>ç®€å•æ˜“ç”¨</p></li><li><p>å®¢æˆ·ç«¯æ ¹æœ¬ä¸éœ€è¦çŸ¥é“å­ç³»ç»Ÿå†…éƒ¨çš„å®ç°ï¼Œæˆ–è€…æ ¹æœ¬ä¸éœ€è¦çŸ¥é“å­ç³»ç»Ÿå†…éƒ¨çš„æ„æˆï¼Œå®ƒåªéœ€è¦è·ŸFacadeç±»äº¤äº’å³å¯ã€‚</p></li><li><p>æ›´å¥½çš„åˆ’åˆ†è®¿é—®å±‚æ¬¡</p></li><li><p>æœ‰äº›æ–¹æ³•æ˜¯å¯¹ç³»ç»Ÿå¤–çš„ï¼Œæœ‰äº›æ–¹æ³•æ˜¯ç³»ç»Ÿå†…éƒ¨ç›¸äº’äº¤äº’çš„ä½¿ç”¨çš„ã€‚å­ç³»ç»ŸæŠŠé‚£äº›æš´éœ²ç»™å¤–éƒ¨çš„åŠŸèƒ½é›†ä¸­åˆ°é—¨é¢ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼Œå¾ˆå¥½çš„éšè—äº†å­ç³»ç»Ÿå†…éƒ¨çš„ç»†èŠ‚ã€‚</p></li></ul><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p>å°†ä¸€ä¸ªç±»çš„æ¥å£ï¼Œè½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨è®©åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚</p><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿ç”¨å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æ­¥éª¤ã€‚</p><p>ä¼˜ç‚¹</p><ul><li><p>å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚æŠŠè®¤ä¸ºä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°çˆ¶ç±»ä¸­å®ç°ï¼Œè€Œå¯å˜éƒ¨åˆ†çš„åˆ™å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥ç»§ç»­æ‰©å±•ã€‚</p></li><li><p>æå–å…¬å…±éƒ¨åˆ†ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚</p></li><li><p>è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚</p></li></ul><p>ç¼ºç‚¹</p><ul><li>æŒ‰ç…§è®¾è®¡ä¹ æƒ¯ï¼ŒæŠ½è±¡ç±»è´Ÿè´£å£°æ˜æœ€æŠ½è±¡ã€æœ€ä¸€èˆ¬çš„äº‹ç‰©å±æ€§å’Œæ–¹æ³•ï¼Œå®ç°ç±»è´Ÿè´£å®Œæˆå…·ä½“çš„äº‹åŠ¡å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯æ¨¡æ¿æ–¹å¼æ­£å¥½ç›¸åï¼Œå­ç±»æ‰§è¡Œçš„ç»“æœå½±å“äº†çˆ¶ç±»çš„ç»“æœï¼Œä¼šå¢åŠ ä»£ç é˜…è¯»çš„éš¾åº¦ã€‚</li></ul><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯é€šè¿‡çˆ¶ç±»å»ºç«‹æ¡†æ¶ï¼Œå­ç±»åœ¨é‡å†™äº†çˆ¶ç±»éƒ¨åˆ†æ–¹æ³•ä¹‹åï¼Œåœ¨è°ƒç”¨ä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ï¼Œäº§ç”Ÿä¸åŒçš„æ•ˆæœï¼Œé€šè¿‡ä¿®æ”¹å­ç±»ï¼Œå½±å“çˆ¶ç±»è¡Œä¸ºçš„ç»“æœï¼Œæ¨¡æ¿æ–¹æ³•åœ¨ä¸€äº›å¼€æºæ¡†æ¶ä¸­åº”ç”¨éå¸¸å¤šï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç„¶åå¼€æºæ¡†æ¶å†™äº†ä¸€å †å­ç±»ï¼Œå¦‚æœéœ€è¦æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥ç»§æ‰¿æ­¤æŠ½è±¡ç±»ï¼Œç„¶åè¦†å†™protectedåŸºæœ¬æ–¹æ³•ï¼Œç„¶ååœ¨è°ƒç”¨ä¸€ä¸ªç±»ä¼¼TemplateMethod()çš„æ¨¡æ¿æ–¹æ³•ï¼Œå®Œæˆæ‰©å±•å¼€å‘ã€‚</p><h2 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h2><p>æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²å…¶å†…éƒ¨çš„è¡¨ç¤ºã€‚</p><p>åº”ç”¨å®ä¾‹ï¼šJAVA ä¸­çš„ iteratorã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡ã€‚</p></li><li><p>è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»ã€‚ </p></li><li><p>åœ¨åŒä¸€ä¸ªèšåˆä¸Šå¯ä»¥æœ‰å¤šä¸ªéå†ã€‚ </p></li><li><p>åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ã€‚</p></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç”±äºè¿­ä»£å™¨æ¨¡å¼å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®çš„èŒè´£åˆ†ç¦»ï¼Œå¢åŠ æ–°çš„èšåˆç±»éœ€è¦å¯¹åº”å¢åŠ æ–°çš„è¿­ä»£å™¨ç±»ï¼Œç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼š </p><ul><li><p>è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºã€‚ </p></li><li><p>éœ€è¦ä¸ºèšåˆå¯¹è±¡æä¾›å¤šç§éå†æ–¹å¼ã€‚ </p></li><li><p>ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚</p></li></ul><p>æ³¨æ„äº‹é¡¹ï¼šè¿­ä»£å™¨æ¨¡å¼å°±æ˜¯åˆ†ç¦»äº†é›†åˆå¯¹è±¡çš„éå†è¡Œä¸ºï¼ŒæŠ½è±¡å‡ºä¸€ä¸ªè¿­ä»£å™¨ç±»æ¥è´Ÿè´£ï¼Œè¿™æ ·æ—¢å¯ä»¥åšåˆ°ä¸æš´éœ²é›†åˆçš„å†…éƒ¨ç»“æ„ï¼Œåˆå¯è®©å¤–éƒ¨ä»£ç é€æ˜åœ°è®¿é—®é›†åˆå†…éƒ¨çš„æ•°æ®ã€‚</p><h2 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h2><p>å…è®¸ä½ å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„æ¥è¡¨ç°â€œæ•´ä½“/éƒ¨åˆ†â€å±‚æ¬¡ç»“æ„ã€‚ç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡åŠå¯¹è±¡ç»„åˆã€‚</p><p>åº”ç”¨å®ä¾‹ï¼š </p><ul><li><p>ç®—æœ¯è¡¨è¾¾å¼åŒ…æ‹¬æ“ä½œæ•°ã€æ“ä½œç¬¦å’Œå¦ä¸€ä¸ªæ“ä½œæ•°ï¼Œå…¶ä¸­ï¼Œå¦ä¸€ä¸ªæ“ä½œç¬¦ä¹Ÿå¯ä»¥æ˜¯æ“ä½œæ ‘ã€æ“ä½œç¬¦å’Œå¦ä¸€ä¸ªæ“ä½œæ•°ã€‚ </p></li><li><p>åœ¨ JAVA AWT å’Œ SWING ä¸­ï¼Œå¯¹äº Button å’Œ Checkbox æ˜¯æ ‘å¶ï¼ŒContainer æ˜¯æ ‘æã€‚</p></li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>é«˜å±‚æ¨¡å—è°ƒç”¨ç®€å•ã€‚</p></li><li><p>èŠ‚ç‚¹è‡ªç”±å¢åŠ ã€‚</p></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>åœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼æ—¶ï¼Œå…¶å¶å­å’Œæ ‘æçš„å£°æ˜éƒ½æ˜¯å®ç°ç±»ï¼Œè€Œä¸æ˜¯æ¥å£ï¼Œè¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼šéƒ¨åˆ†ã€æ•´ä½“åœºæ™¯ï¼Œå¦‚æ ‘å½¢èœå•ï¼Œæ–‡ä»¶ã€æ–‡ä»¶å¤¹çš„ç®¡ç†ã€‚</p><p>æ³¨æ„äº‹é¡¹ï¼šå®šä¹‰æ—¶ä¸ºå…·ä½“ç±»ã€‚</p><h2 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h2><p>æŠ½è±¡å˜åŒ–ï¼Œå°è£…å„è‡ªå˜åŒ–</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/bridge.png?raw=true" alt="ç±»å›¾"></p><h2 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h2><p>å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚</p><p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/state.png?raw=true" alt="ç±»å›¾"></p><p>Stateæ¨¡å¼å°†æ‰€æœ‰ä¸ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºéƒ½æ”¾å…¥ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚å› ä¸ºæ‰€æœ‰ä¸çŠ¶æ€ç›¸å…³çš„ä»£ç éƒ½å­˜åœ¨äºæŸä¸€ä¸ªStateå­ç±»ä¸­, æ‰€ä»¥é€šè¿‡å®šä¹‰æ–°çš„å­ç±»å¯ä»¥å¾ˆå®¹æ˜“çš„å¢åŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢ã€‚å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨æ•°æ®å€¼å®šä¹‰å†…éƒ¨çŠ¶æ€å¹¶ä¸”è®© Contextæ“ä½œæ¥æ˜¾å¼åœ°æ£€æŸ¥è¿™äº›æ•°æ®ã€‚ä½†è¿™æ ·å°†ä¼šä½¿æ•´ä¸ªContextçš„å®ç°ä¸­éå¸ƒçœ‹èµ·æ¥å¾ˆç›¸ä¼¼çš„æ¡ä»¶if elseè¯­å¥æˆ–switch caseè¯­å¥ã€‚å¢åŠ ä¸€ä¸ªæ–°çš„çŠ¶æ€å¯èƒ½éœ€è¦æ”¹å˜è‹¥å¹²ä¸ªæ“ä½œ, è¿™å°±ä½¿å¾—ç»´æŠ¤å˜å¾—å¤æ‚äº†ã€‚Stateæ¨¡å¼é¿å…äº†è¿™ä¸ªé—®é¢˜, ä½†å¯èƒ½ä¼šå¼•å…¥å¦ä¸€ä¸ªé—®é¢˜, å› ä¸ºè¯¥æ¨¡å¼å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å¸ƒåœ¨å¤šä¸ªStateå­ç±»ä¸­ã€‚è¿™å°±å¢åŠ äº†å­ç±»çš„æ•°ç›®ï¼Œç›¸å¯¹äºå•ä¸ªç±»çš„å®ç°æ¥è¯´ä¸å¤Ÿç´§å‡‘ã€‚ä½†æ˜¯å¦‚æœæœ‰è®¸å¤šçŠ¶æ€æ—¶è¿™æ ·çš„åˆ†å¸ƒå®é™…ä¸Šæ›´å¥½ä¸€äº›, å¦åˆ™éœ€è¦ä½¿ç”¨å·¨å¤§çš„æ¡ä»¶è¯­å¥ã€‚æ­£å¦‚å¾ˆé•¿çš„è¿‡ç¨‹ä¸€æ ·ï¼Œå·¨å¤§çš„æ¡ä»¶è¯­å¥æ˜¯ä¸å—æ¬¢è¿çš„ã€‚å®ƒä»¬å½¢æˆä¸€å¤§æ•´å—å¹¶ä¸”ä½¿å¾—ä»£ç ä¸å¤Ÿæ¸…æ™°ï¼Œè¿™åˆä½¿å¾—å®ƒä»¬éš¾ä»¥ä¿®æ”¹å’Œæ‰©å±•ã€‚ Stateæ¨¡å¼æä¾›äº†ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ¥ç»„ç»‡ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„ä»£ç ã€‚å†³å®šçŠ¶æ€è½¬ç§»çš„é€»è¾‘ä¸åœ¨å•å—çš„ i fæˆ–s w i t c hè¯­å¥ä¸­, è€Œæ˜¯åˆ†å¸ƒåœ¨Stateå­ç±»ä¹‹é—´ã€‚å°†æ¯ä¸€ä¸ªçŠ¶æ€è½¬æ¢å’ŒåŠ¨ä½œå°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå°±æŠŠç€çœ¼ç‚¹ä»æ‰§è¡ŒçŠ¶æ€æé«˜åˆ°æ•´ä¸ªå¯¹è±¡çš„çŠ¶æ€ã€‚è¿™å°†ä½¿ä»£ç ç»“æ„åŒ–å¹¶ä½¿å…¶æ„å›¾æ›´åŠ æ¸…æ™°ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>å®ƒå°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–ï¼Œå¹¶ä¸”å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å‰²å¼€æ¥ã€‚</p></li><li><p>å®ƒä½¿å¾—çŠ¶æ€è½¬æ¢æ˜¾å¼åŒ–: å½“ä¸€ä¸ªå¯¹è±¡ä»…ä»¥å†…éƒ¨æ•°æ®å€¼æ¥å®šä¹‰å½“å‰çŠ¶æ€æ—¶ , å…¶çŠ¶æ€ä»…è¡¨ç°ä¸ºå¯¹ä¸€äº›å˜é‡çš„èµ‹å€¼ï¼Œè¿™ä¸å¤Ÿæ˜ç¡®ã€‚ä¸ºä¸åŒçš„çŠ¶æ€å¼•å…¥ç‹¬ç«‹çš„å¯¹è±¡ä½¿å¾—è½¬æ¢å˜å¾—æ›´åŠ æ˜ç¡®ã€‚è€Œä¸”, Stateå¯¹è±¡å¯ä¿è¯Contextä¸ä¼šå‘ç”Ÿå†…éƒ¨çŠ¶æ€ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå› ä¸ºä» Contextçš„è§’åº¦çœ‹ï¼ŒçŠ¶æ€è½¬æ¢æ˜¯åŸå­çš„â€”åªéœ€é‡æ–°ç»‘å®šä¸€ä¸ªå˜é‡(å³Contextçš„Stateå¯¹è±¡å˜é‡)ï¼Œè€Œæ— éœ€ä¸ºå¤šä¸ªå˜é‡èµ‹å€¼</p></li><li><p>Stateå¯¹è±¡å¯è¢«å…±äº« å¦‚æœStateå¯¹è±¡æ²¡æœ‰å®ä¾‹å˜é‡â€”å³å®ƒä»¬è¡¨ç¤ºçš„çŠ¶æ€å®Œå…¨ä»¥å®ƒä»¬çš„ç±»å‹æ¥ç¼–ç â€”é‚£ä¹ˆå„Contextå¯¹è±¡å¯ä»¥å…±äº«ä¸€ä¸ªStateå¯¹è±¡ã€‚å½“çŠ¶æ€ä»¥è¿™ç§æ–¹å¼è¢«å…±äº«æ—¶, å®ƒä»¬å¿…ç„¶æ˜¯æ²¡æœ‰å†…éƒ¨çŠ¶æ€, åªæœ‰è¡Œä¸ºçš„è½»é‡çº§å¯¹è±¡ã€‚</p></li></ul><p>ç¼ºç‚¹:</p><ul><li><p>çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚</p></li><li><p>çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚</p></li></ul><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p>ä¸ºå¦ä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«æˆ–è€…å ä½ç¬¦ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>åªæœ‰çœŸæ­£å»è°ƒç”¨çš„æ—¶å€™æ‰ä¼šåˆ›å»ºå®ä¾‹ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼Œç¨‹åºä¸ä¼šçœŸæ­£çš„è°ƒç”¨è¢«è°ƒç”¨å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ç§æƒ…å†µæ— éœ€å»åˆ›å»ºè¢«è°ƒç”¨è¿™å¯¹è±¡çš„å®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç†æ¨¡å¼å¯ä»¥è°ƒç¨‹åºçš„æ€§èƒ½ã€‚å®è§‚ä¸Šå‡å°‘äº†ç³»ç»Ÿå¼€é”€ã€‚</li></ul><p>åº”ç”¨ï¼šhibernateå»¶æ—¶åŠ è½½</p><p>åŠ¨æ€ä»£ç†æ¨¡å¼ç±»å›¾</p><p><a href="https://www.cnblogs.com/cenyu/p/6289209.html" target="_blank" rel="noopener">ä»£ç†æ¨¡å¼</a></p><h2 id="å¤åˆæ¨¡å¼"><a href="#å¤åˆæ¨¡å¼" class="headerlink" title="å¤åˆæ¨¡å¼"></a>å¤åˆæ¨¡å¼</h2><p>å¤åˆæ¨¡å¼ç»“åˆä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„æ¨¡å¼ï¼Œç»„åˆä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè§£å†³ä¸€å†å‘ç”Ÿçš„ä¸€èˆ¬æ€§é—®é¢˜</p><p><a href="http://blog.csdn.net/yujin753/article/details/45675375" target="_blank" rel="noopener">è¯¦ç»†äº†è§£</a></p><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/littlejava/p/5701935.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p><p><a href="http://www.runoob.com/design-pattern/singleton-pattern.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç®—æ³•ï¼ˆAlgorithmï¼‰</title>
      <link href="/2018/01/10/algorithm/2018-01-10-Algorithm/"/>
      <url>/2018/01/10/algorithm/2018-01-10-Algorithm/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/zhongyp/Demo/tree/master/src/main/java/com/zhongyp/algorithm" target="_blank" rel="noopener">æœ¬æ–‡çš„æ‰€æœ‰ç®—æ³•ä»£ç å‡åœ¨githubä¸Šä¿å­˜ï¼Œç‚¹å‡»æ­¤é“¾æ¥å³å¯è®¿é—®</a></p><p>ç®—æ³•çš„åˆ†ç±»ä»¥åŠç»å…¸ç®—æ³•é¢˜çš„ä»£ç å®ç°ï¼Œä¿®ç‚¼å†…åŠŸ</p><h2 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * å…ˆåºã€ä¸­åºéå†äºŒå‰æ ‘</span><br><span class="line"> * å…ˆåºï¼šæ ¹å·¦å³</span><br><span class="line"> * ä¸­åºï¼šå·¦æ ¹å³</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">// æ ‡è®°å…ˆåºç´¢å¼•ä½ç½®</span><br><span class="line">int count = 0;</span><br><span class="line">public  Tree buildTreeByPreMid(int[] a, int s1, int e1,int[] b, int s2, int e2)&#123;</span><br><span class="line"></span><br><span class="line">    if(s1&gt;e1||s2&gt;e2)&#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    Tree tree = new Tree();</span><br><span class="line">     tree.value = a[count];</span><br><span class="line">    // indexä¸ºa[s1]åœ¨bä¸­çš„ç´¢å¼•</span><br><span class="line">    int index = getIndex(b, a[count]);</span><br><span class="line">    count++;</span><br><span class="line">    // countæ ‡è¯†å·¦å­æ ‘å…ˆåºçš„èµ·ç‚¹ï¼Œs1+indexä¸ºå·¦å­æ ‘å…ˆåºçš„ç»ˆç‚¹ï¼Œs2,index-1åˆ†åˆ«ä¸ºå·¦å­æ ‘ä¸­åºçš„èµ·ç‚¹å’Œç»ˆç‚¹</span><br><span class="line">    tree.left = buildTreeByPreMid(a, count, s1+index, b, s2, index-1);</span><br><span class="line">    tree.right = buildTreeByPreMid(a, count, s1+e2-index, b, index+1, e2);</span><br><span class="line"></span><br><span class="line">    return tree;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * ä¸­åºã€ååº æ„å»ºäºŒå‰æ ‘</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">int count1 = 7;</span><br><span class="line">public Tree buildTreeByMidLast(int[] a, int s1, int e1,int[] b, int s2, int e2)&#123;</span><br><span class="line">    if(s1&gt;e1||s2&gt;e2)&#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    Tree tree = new Tree();</span><br><span class="line">    tree.value = a[e1];</span><br><span class="line">    int index = getIndex(b, a[e1]);</span><br><span class="line">    count1--;</span><br><span class="line">    tree.right = buildTreeByMidLast(a, count1+index-e2+1, count1, b, index+1, e2);</span><br><span class="line">    tree.left = buildTreeByMidLast(a, s1, count1, b, s2, index-1);</span><br><span class="line">    return tree;</span><br><span class="line">&#125;</span><br><span class="line">private int getIndex(int[] b,int value)&#123;</span><br><span class="line">    int count = 0;</span><br><span class="line">    for(int tmp:b)&#123;</span><br><span class="line">        if(tmp==value)&#123;</span><br><span class="line">            return count;</span><br><span class="line">        &#125;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">// å…ˆåº</span><br><span class="line">public void printPre(Tree tree)&#123;</span><br><span class="line">    if(tree != null)&#123;</span><br><span class="line">        System.out.print(tree.value);</span><br><span class="line">    &#125;</span><br><span class="line">    if(tree.left != null)&#123;</span><br><span class="line">        printPre(tree.left);</span><br><span class="line">    &#125;</span><br><span class="line">    if(tree.right != null)&#123;</span><br><span class="line">        printPre(tree.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// ä¸­åº</span><br><span class="line">public void printMid(Tree tree)&#123;</span><br><span class="line">    if(tree.left != null)&#123;</span><br><span class="line">        printMid(tree.left);</span><br><span class="line">    &#125;</span><br><span class="line">    if (tree != null)&#123;</span><br><span class="line">        System.out.print(tree.value);</span><br><span class="line">    &#125;</span><br><span class="line">    if(tree.right != null)&#123;</span><br><span class="line">        printMid(tree.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// ååº</span><br><span class="line">public void printLast(Tree tree)&#123;</span><br><span class="line">    if(tree.left != null)&#123;</span><br><span class="line">        printLast(tree.left);</span><br><span class="line">    &#125;</span><br><span class="line">    if(tree.right != null)&#123;</span><br><span class="line">        printLast(tree.right);</span><br><span class="line">    &#125;</span><br><span class="line">    if (tree != null)&#123;</span><br><span class="line">        System.out.print(tree.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * </span><br><span class="line"> * 1.å°†èŠ‚ç‚¹æ”¾å…¥é˜Ÿåˆ—</span><br><span class="line"> * 2.å–å‡ºé˜Ÿåˆ—ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line"> * 3.å°†å–å‡ºçš„èŠ‚ç‚¹çš„å·¦å³èŠ‚ç‚¹ä¸€æ¬¡æ”¾å…¥é˜Ÿåˆ—</span><br><span class="line"> * é€’å½’</span><br><span class="line"> */</span><br><span class="line">public void printLevel(Tree tree)&#123;</span><br><span class="line">    if(tree == null)&#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    Tree current;</span><br><span class="line">    LinkedList list = new LinkedList();</span><br><span class="line">    list.offer(tree);</span><br><span class="line">    while(!list.isEmpty())&#123;</span><br><span class="line">        current = (Tree)list.poll();</span><br><span class="line">        System.out.print(current.value);</span><br><span class="line">        if(current.left != null)&#123;</span><br><span class="line">            list.offer(current.left);</span><br><span class="line">        &#125;</span><br><span class="line">        if(current.right != null)&#123;</span><br><span class="line">            list.offer(current.right);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// äºŒå‰æ ‘å¶å­èŠ‚ç‚¹ä¸ªæ•°</span><br><span class="line">int count2 = 0;</span><br><span class="line">public void sumLeaf(Tree tree)&#123;</span><br><span class="line">    if(tree.left == null&amp;&amp;tree.right == null)&#123;</span><br><span class="line">        count2++;</span><br><span class="line">    &#125;</span><br><span class="line">    if(tree.left != null)&#123;</span><br><span class="line">        sumLeaf(tree.left);</span><br><span class="line">    &#125;</span><br><span class="line">    if(tree.right != null)&#123;</span><br><span class="line">        sumLeaf(tree.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// äºŒå‰æ ‘çš„é«˜åº¦</span><br><span class="line">public int hightTree(Tree tree)&#123;</span><br><span class="line">    if(tree == null)&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if(tree.left == null &amp;&amp; tree.right == null)&#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    int l_hight = hightTree(tree.left);</span><br><span class="line">    int r_hight = hightTree(tree.right);</span><br><span class="line">    return l_hight&gt;r_hight?l_hight+1:r_hight+1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ±‚ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</span><br><span class="line">public void commonParent(int value1, int value2)&#123;</span><br><span class="line">    if(root == null || p == root || q == root) &#123;</span><br><span class="line">        return root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Tree l = lowestCommonAncestor(root.left,p,q);</span><br><span class="line">    Tree r = lowestCommonAncestor(root.right,p,q);</span><br><span class="line"></span><br><span class="line">    if(l!= null &amp;&amp; r!= null) &#123;</span><br><span class="line">        return root;</span><br><span class="line">    &#125;</span><br><span class="line">    return l != null?l:r;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è·¯å¾„å€¼</span><br><span class="line">Stack&lt;Integer&gt; stack = new Stack();</span><br><span class="line">public void FindPath(Tree tree, int sum, int current)&#123;</span><br><span class="line">    if(tree==null)&#123;</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    current+=tree.value;</span><br><span class="line">    stack.push(tree.value);</span><br><span class="line">    if(current==sum)&#123;</span><br><span class="line">        System.out.println(&quot;PATH:&quot;);</span><br><span class="line">        for(int val : stack)&#123;</span><br><span class="line">            System.out.print(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(current&lt;sum)&#123;</span><br><span class="line">        if(tree.left != null)&#123;</span><br><span class="line">            FindPath(tree.left,sum,current);</span><br><span class="line">        &#125;</span><br><span class="line">        if(tree.right != null)&#123;</span><br><span class="line">            FindPath(tree.right,sum,current);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    current -= tree.value;</span><br><span class="line">    stack.pop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><ol><li>é“¾è¡¨é€†åºï¼ˆä¸å¯ä½¿ç”¨å…¶ä»–ç©ºé—´ï¼‰</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * éé€’å½’</span><br><span class="line"> */</span><br><span class="line">public Node reverse(Node node)&#123;</span><br><span class="line">    Node init = null;</span><br><span class="line">    while(node != null)&#123;</span><br><span class="line">        Node node1 = init;</span><br><span class="line">        Node node2 = node;</span><br><span class="line">        node = node.next;</span><br><span class="line">        node2.next = node1;</span><br><span class="line">        init = node2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return init;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * é€’å½’æ–¹å¼</span><br><span class="line"> * @param node1</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public Node reverse1(Node node1)&#123;</span><br><span class="line"></span><br><span class="line">    Node init = node1.next;</span><br><span class="line">    if(init != null)&#123;</span><br><span class="line">        Node node2= reverse1(init);</span><br><span class="line">        Node tmp = getLastNode(node2);</span><br><span class="line">        node1.next = null;</span><br><span class="line">        tmp.next = node1;</span><br><span class="line">        return node2;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return node1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åå¤§ç»å…¸æ’åºç®—æ³•"><a href="#åå¤§ç»å…¸æ’åºç®—æ³•" class="headerlink" title="åå¤§ç»å…¸æ’åºç®—æ³•"></a>åå¤§ç»å…¸æ’åºç®—æ³•</h2><ul><li>æ’å…¥æ’åºï¼š ç›´æ¥æ’å…¥ï¼Œå¸Œå°”æ’åº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line">     * ç›´æ¥æ’å…¥æ’åºç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚</span><br><span class="line">     * æœ€å¥½çš„æƒ…å†µï¼Œè¦æ¯”è¾ƒçš„æ— åºåºåˆ—åŸæœ¬å°±æ˜¯é¡ºåºæœ‰åºçš„ï¼Œé‚£ä¹ˆè¦æ¯”è¾ƒçš„æ¬¡æ•°æ˜¯n-1ï¼Œç§»åŠ¨äº†0æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦O(n)ã€‚</span><br><span class="line">     * æœ€åçš„æƒ…å†µï¼Œè¦æ¯”è¾ƒçš„æ— åºåºåˆ—åŸæœ¬å°±æ˜¯é€†åºæœ‰åºçš„ï¼Œé‚£ä¹ˆè¦æ¯”è¾ƒçš„æ¬¡æ•°æ˜¯(n+2)(n-1)/2ï¼Œç§»åŠ¨çš„æ¬¡æ•°(n+4)(n-1)/2ï¼Œæ—¶é—´å¤æ‚åº¦O(nÂ²)ã€‚</span><br><span class="line">     * ç›´æ¥æ’å…¥æ’åºçš„å¹³å‡å¤æ‚åº¦ä¸ºO(nÂ²)ã€‚</span><br><span class="line">     * ç›´æ¥æ’å…¥æ’åºæ˜¯ç¨³å®šçš„ã€‚</span><br><span class="line">     * @param num</span><br><span class="line">     */</span><br><span class="line">public void directInsert(int[] num)&#123;</span><br><span class="line">    for(int i=1; i&lt;num.length; i++)&#123;</span><br><span class="line">        for(int j=0;j&lt;i;j++)&#123;</span><br><span class="line">            if(num[i]&lt;num[j])&#123;</span><br><span class="line">                int a = num[j];</span><br><span class="line">                num[j] = num[i];</span><br><span class="line">                num[i] = a;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    for(int val:num)&#123;</span><br><span class="line">        System.out.print(val + &quot; &quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">     * å¸Œå°”æ’åºåœ¨æœ€åçš„æƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´æ˜¯O(nÂ²)ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(n^1.3)ã€‚</span><br><span class="line">     * å¸Œå°”æ’åºå¯¹äºå¤šè¾¾å‡ åƒä¸ªæ•°æ®é¡¹çš„ï¼Œä¸­ç­‰å¤§å°è§„æ¨¡çš„æ•°ç»„æ’åºè¡¨ç°è‰¯å¥½ã€‚</span><br><span class="line">     * å¸Œå°”æ’åºä¸åƒå¿«é€Ÿæ’åºå’Œå…¶å®ƒæ—¶é—´å¤æ‚åº¦ä¸ºO(nlog2n)çš„æ’åºç®—æ³•é‚£ä¹ˆå¿«ï¼Œå› æ­¤å¯¹éå¸¸å¤§çš„æ–‡ä»¶æ’åºï¼Œå®ƒä¸æ˜¯æœ€ä¼˜é€‰æ‹©ã€‚</span><br><span class="line">     * ä½†æ˜¯ï¼Œå¸Œå°”æ’åºæ¯”é€‰æ‹©æ’åºå’Œæ’å…¥æ’åºè¿™ç§æ—¶é—´å¤æ‚åº¦ä¸ºO(nÂ²)çš„æ’åºç®—æ³•è¿˜æ˜¯è¦å¿«å¾—å¤šï¼Œå¹¶ä¸”å®ƒéå¸¸å®¹æ˜“å®ç°ã€‚</span><br><span class="line">     * å®ƒåœ¨æœ€åæƒ…å†µä¸‹çš„æ‰§è¡Œæ•ˆç‡å’Œåœ¨å¹³å‡æƒ…å†µä¸‹çš„æ‰§è¡Œæ•ˆç‡ç›¸æ¯”æ²¡æœ‰å·®å¾ˆå¤šã€‚</span><br><span class="line">     * æ­¤å¤–å¸Œå°”æ’åºæ˜¯ä¸ç¨³å®šçš„(æŒ‡åœ¨å¤šæ¬¡æ’å…¥æ’åºä¸­ï¼Œç›¸åŒå…ƒç´ å¯èƒ½åœ¨æ’å…¥æ’åºä¸­ç§»åŠ¨ï¼Œå¯¼è‡´ç¨³å®šæ€§è¢«ç ´å)ã€‚</span><br><span class="line">     * @param num</span><br><span class="line">     */</span><br><span class="line">public void hillSort(int[] num)&#123;</span><br><span class="line">    int gap = 5;</span><br><span class="line">    while(gap&gt;0)&#123;</span><br><span class="line">        for(int i=0; i&lt;num.length-gap; i++)&#123;</span><br><span class="line">            if(num[i]&gt;num[i+gap])&#123;</span><br><span class="line">                int a = num[i];</span><br><span class="line">                num[i] = num[i+gap];</span><br><span class="line">                num[i+gap] = a;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        gap = gap/2;</span><br><span class="line">    &#125;</span><br><span class="line">    for(int val:num)&#123;</span><br><span class="line">        System.out.print(val + &quot; &quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€‰æ‹©æ’åºï¼š ç®€å•é€‰æ‹©æ’åºï¼Œå †æ’åº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">     * é€‰æ‹©æ’åº</span><br><span class="line">     * @param num</span><br><span class="line">     */</span><br><span class="line">    public void simpleSort(int[] num)&#123;</span><br><span class="line">        for(int i=0;i&lt;num.length;i++)&#123;</span><br><span class="line">            int index = i;</span><br><span class="line">            for(int j=i;j&lt;num.length-1;j++)&#123;</span><br><span class="line">                if(num[index]&gt;num[j+1])&#123;</span><br><span class="line">                    index = j+1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            int a = num[i];</span><br><span class="line">            num[i] = num[index];</span><br><span class="line">            num[index] = a;</span><br><span class="line">        &#125;</span><br><span class="line">        for(int val:num)&#123;</span><br><span class="line">            System.out.print(val + &quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å †æ’åº</span><br><span class="line">     *</span><br><span class="line">     * å †æ˜¯å…·æœ‰ä»¥ä¸‹æ€§è´¨çš„å®Œå…¨äºŒå‰æ ‘ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå¤§é¡¶å †ï¼›æˆ–è€…æ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå°é¡¶å †ã€‚</span><br><span class="line">     *</span><br><span class="line">     * @param num</span><br><span class="line">     * @param index</span><br><span class="line">     */</span><br><span class="line">    public void heapSort(int[] num, int index)&#123;</span><br><span class="line"></span><br><span class="line">        for(int i=index/2;i&gt;-1;i--)&#123;</span><br><span class="line">            if((2*i)&lt;index&amp;&amp;num[i]&lt;num[2*i])&#123;</span><br><span class="line">                int a = num[i];</span><br><span class="line">                num[i] = num[2*i];</span><br><span class="line">                num[2*i] = a;</span><br><span class="line">            &#125;</span><br><span class="line">            if((2*i+1)&lt;index&amp;&amp;num[i]&lt;num[2*i+1])&#123;</span><br><span class="line">                int a = num[i];</span><br><span class="line">                num[i] = num[2*i+1];</span><br><span class="line">                num[2*i+1] = a;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        int a = num[index];</span><br><span class="line">        num[index] = num[0];</span><br><span class="line">        num[0] = a;</span><br><span class="line">        index = index-1;</span><br><span class="line">        if(index&gt;0)&#123;</span><br><span class="line">            heapSort(num,index);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>äº¤æ¢æ’åºï¼š å†’æ³¡æ’åºï¼Œå¿«é€Ÿæ’åº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    // å†’æ³¡æ’åº</span><br><span class="line">    public static void bubbleSort()&#123;</span><br><span class="line">//        int[] arr = &#123;3,5,7,1,4&#125;;</span><br><span class="line">        int[] arr = &#123;1,2,3,4,5&#125;;</span><br><span class="line">        int i,j,temp,len=arr.length;</span><br><span class="line">        //æ˜¯å¦å·²ç»å®Œæˆæ’åºçš„æ ‡å¿—</span><br><span class="line">        boolean flag;</span><br><span class="line">        //æ’åº</span><br><span class="line">        for(i=0;i&lt;arr.length-1;i++)&#123;</span><br><span class="line">            flag = true;</span><br><span class="line">            for(j=i+1;j&lt;arr.length;j++)&#123;</span><br><span class="line">                if(arr[j]&lt;arr[i])&#123;</span><br><span class="line">                    temp = arr[i];</span><br><span class="line">                    arr[i] = arr[j];</span><br><span class="line">                    arr[j] = temp;</span><br><span class="line">                    flag = false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if(flag)&#123;</span><br><span class="line">                System.out.println(&quot;ç¬¬&quot; + (i+1) + &quot;è¶Ÿç»“æŸäº†&quot;);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //éå†è¾“å‡ºæ•°ç»„</span><br><span class="line">        for(int o:arr)&#123;</span><br><span class="line">            System.out.print(&quot; &quot; + o);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // å¿«é€Ÿæ’åº</span><br><span class="line">    public static void quickSort(int[] num,int start, int end)&#123;</span><br><span class="line">            int sys = num[start];</span><br><span class="line">            int left = start;</span><br><span class="line">            int right = end;</span><br><span class="line"></span><br><span class="line">            while(start&lt;end)&#123;</span><br><span class="line">                if(num[end]&lt;sys)&#123;</span><br><span class="line">                    num[start] = num[end];</span><br><span class="line">                    start++;</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    end--;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                if(sys&lt;num[start])&#123;</span><br><span class="line">                    num[end] = num[start];</span><br><span class="line">                    end--;</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    start++;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            num[start] = sys;</span><br><span class="line">            if(left&lt;start-1)&#123;</span><br><span class="line">                quickSort(num,left,start-1);</span><br><span class="line">            &#125;</span><br><span class="line">            if(right&gt;end+1)&#123;</span><br><span class="line">                quickSort(num,end+1,right);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>å½’å¹¶æ’åº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">static int[] sort(int[] a, int start, int end)&#123;</span><br><span class="line"></span><br><span class="line">    int mid ;</span><br><span class="line">    if(start&lt;end)&#123;</span><br><span class="line">        mid = (start + end)/2;</span><br><span class="line">        a = sort(a, start, mid);</span><br><span class="line">        a = sort(a, mid+1, end);</span><br><span class="line">        a = merge(a, start, mid, end);</span><br><span class="line">    &#125;</span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int[] merge(int[] a, int start, int mid, int end)&#123;</span><br><span class="line">    int i = 0;</span><br><span class="line">    int j = 0;</span><br><span class="line">    int[] c = new int[a.length];</span><br><span class="line">    while((start+i)&lt;=mid&amp;&amp;(mid+1+j)&lt;=end)&#123;</span><br><span class="line">        if(a[start+i]&gt;a[mid+1+j])&#123;</span><br><span class="line">            c[i+j] = a[mid+1+j];</span><br><span class="line">            j++;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            c[i+j] = a[start+i];</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    while((start+i)&lt;=mid)&#123;</span><br><span class="line">        c[i+j] = a[start+i];</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    while((mid+1+j)&lt;=end)&#123;</span><br><span class="line">        c[i+j] = a[mid+1+j];</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    for(int k=0;k&lt;=(i+j-1);k++)&#123;</span><br><span class="line">        a[start+k] = c[k];</span><br><span class="line">    &#125;</span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŸºæ•°æ’åº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public int[] radixSort(int[] A, int n) &#123;</span><br><span class="line">    int length = n;</span><br><span class="line">    int divisor = 1;// å®šä¹‰æ¯ä¸€è½®çš„é™¤æ•°ï¼Œ1,10,100...</span><br><span class="line">    int[][] bucket = new int[10][length];// å®šä¹‰äº†10ä¸ªæ¡¶ï¼Œä»¥é˜²æ¯ä¸€ä½éƒ½ä¸€æ ·å…¨éƒ¨æ”¾å…¥ä¸€ä¸ªæ¡¶ä¸­</span><br><span class="line">    int[] count = new int[10];// ç»Ÿè®¡æ¯ä¸ªæ¡¶ä¸­å®é™…å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°</span><br><span class="line">    int digit;// è·å–å…ƒç´ ä¸­å¯¹åº”ä½ä¸Šçš„æ•°å­—ï¼Œå³è£…å…¥é‚£ä¸ªæ¡¶</span><br><span class="line">    for (int i = 1; i &lt;= 3; i++) &#123;// ç»è¿‡4æ¬¡è£…é€šæ“ä½œï¼Œæ’åºå®Œæˆ</span><br><span class="line">        for (int temp : A) &#123;// è®¡ç®—å…¥æ¡¶</span><br><span class="line">            digit = (temp / divisor) % 10;</span><br><span class="line">            bucket[digit][count[digit]++] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        int k = 0;// è¢«æ’åºæ•°ç»„çš„ä¸‹æ ‡</span><br><span class="line">        for (int b = 0; b &lt; 10; b++) &#123;// ä»0åˆ°9å·æ¡¶æŒ‰ç…§é¡ºåºå–å‡º</span><br><span class="line">            if (count[b] == 0)// å¦‚æœè¿™ä¸ªæ¡¶ä¸­æ²¡æœ‰å…ƒç´ æ”¾å…¥ï¼Œé‚£ä¹ˆè·³è¿‡</span><br><span class="line">            continue;</span><br><span class="line">            for (int w = 0; w &lt; count[b]; w++) &#123;</span><br><span class="line">                A[k++] = bucket[b][w];</span><br><span class="line">            &#125;</span><br><span class="line">            count[b] = 0;// æ¡¶ä¸­çš„å…ƒç´ å·²ç»å…¨éƒ¨å–å‡ºï¼Œè®¡æ•°å™¨å½’é›¶</span><br><span class="line">        &#125;</span><br><span class="line">        divisor *= 10;</span><br><span class="line">    &#125;</span><br><span class="line">    return A;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‰‘æŒ‡offfer-æ‰€æœ‰ç®—æ³•"><a href="#å‰‘æŒ‡offfer-æ‰€æœ‰ç®—æ³•" class="headerlink" title="å‰‘æŒ‡offfer æ‰€æœ‰ç®—æ³•"></a>å‰‘æŒ‡offfer æ‰€æœ‰ç®—æ³•</h2><p>ç¬¬01-10é¢˜</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜02ï¼šå®ç°Singleton æ¨¡å¼â€”â€”ä¸ƒç§å®ç°æ–¹å¼ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜03ï¼šäºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜04ï¼šæ›¿æ¢ç©ºæ ¼ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜05ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜06ï¼šé‡å»ºäºŒå‰æ ‘ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜07ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜08ï¼šæ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜09ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜10ï¼šäºŒè¿›åˆ¶ä¸­1 çš„ä¸ªæ•°ã€‘</p><p>ç¬¬11-20é¢˜</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜11ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜12ï¼šæ‰“å°1 åˆ°æœ€å¤§çš„n ä½æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜13ï¼šåœ¨Oï¼ˆ1ï¼‰æ—¶é—´åˆ é™¤é“¾è¡¨ç»“ç‚¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜14ï¼šè°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜15ï¼šé“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜16ï¼šåè½¬é“¾è¡¨ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜17ï¼šåˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜18ï¼šæ ‘çš„å­ç»“æ„ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜19ï¼šäºŒå‰æ ‘çš„é•œåƒã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜20ï¼šé¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µã€‘</p><p>ç¬¬21-30é¢˜</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜21ï¼šåŒ…å«minå‡½æ•°çš„é’±ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜22ï¼šæ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜23ï¼šä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜24ï¼šäºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜25ï¼šäºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜26ï¼šå¤æ‚é“¾è¡¨çš„å¤åˆ¶ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜27ï¼šäºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜28ï¼šå­—ç¬¦ä¸²çš„æ’åˆ—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜29ï¼šæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜30ï¼šæœ€å°çš„kä¸ªæ•°ã€‘</p><p>ç¬¬31-40é¢˜</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜31ï¼šè¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜32ï¼šæ±‚ä»1åˆ°nçš„æ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜33ï¼šæŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜34ï¼šä¸‘æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜35ï¼šç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜36ï¼šæ•°ç»„ä¸­çš„é€†åºå¯¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜37ï¼šä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜38ï¼šæ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜39ï¼šäºŒå‰æ ‘çš„æ·±åº¦ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜40ï¼šæ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‘</p><p>ç¬¬41-50é¢˜</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜41ï¼šå’Œä¸ºs çš„ä¸¤ä¸ªæ•°å­—vs å’Œä¸ºs çš„è¿ç»­æ­£æ•°åºåˆ—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜42ï¼šç¿»è½¬å•è¯é¡ºåºvså·¦æ—‹è½¬å­—ç¬¦ä¸²ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜43 : n ä¸ªé”»å­çš„ç‚¹æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜44ï¼šæ‰‘å…‹ç‰Œçš„é¡ºå­ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜45ï¼šåœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—(çº¦ç‘Ÿå¤«ç¯é—®é¢˜)ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜47ï¼šä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜49ï¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜50ï¼šæ ‘ä¸­ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆã€‘</p><p>ç¬¬51-60é¢˜</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜51ï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜52ï¼šæ„å»ºä¹˜ç§¯æ•°ç»„ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜53ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜54ï¼šè¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜55ï¼šå­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜56ï¼šé“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜57ï¼šåˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜58ï¼šäºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜59ï¼šå¯¹ç§°çš„äºŒå‰æ ‘ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜60ï¼šæŠŠäºŒå‰æ ‘æ‰“å°å‡ºå¤šè¡Œã€‘</p><p>ç¬¬61-67é¢˜</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜61ï¼šæŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜62ï¼šåºåˆ—åŒ–äºŒå‰æ ‘ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜63ï¼šäºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªç»“ç‚¹ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜64ï¼šæ•°æ®æµä¸­çš„ä¸­ä½æ•°ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜65ï¼šæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜66ï¼šçŸ©é˜µä¸­çš„è·¯å¾„ã€‘</p><p>ã€å‰‘æŒ‡Offerå­¦ä¹ ã€‘ã€é¢è¯•é¢˜67ï¼šæœºå™¨äººçš„è¿åŠ¨èŒƒå›´ã€‘</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li><p>å¹¶æŸ¥é›†</p></li><li><p>KMP</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaé›†åˆæ¡†æ¶</title>
      <link href="/2018/01/06/java/2018-01-06-Collection/"/>
      <url>/2018/01/06/java/2018-01-06-Collection/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/zhongyp/jekyll.github.io/blob/master/files/collections.png?raw=true" alt="é›†åˆæ¡†æ¶"></p><p><a href="https://github.com/zhongyp/jekyll.github.io/blob/master/files/collections.png?raw=true" target="_blank" rel="noopener">ç‚¹å‡»æ”¾å¤§</a></p><h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><ul><li><p><a href="http://zhongyp.me/2018/01/10/Set">Setæºç è§£æï¼šhttp://zhongyp.me/2018/01/10/Set</a></p><ul><li><p>HashSetï¼šåº•å±‚å®ç°æ˜¯HashMapï¼Œæ²¡æœ‰ç‰¹æ®Šçš„ç‰¹æ€§ã€‚</p></li><li><p>LinkedHashSetï¼šåº•å±‚å®ç°LinkedHashMap,ç‰¹æ€§ä¸ºç»´æŠ¤äº†ä¸€ä¸ªå•é“¾è¡¨ï¼Œè®¿é—®é¡ºåºä¸ºæ’å…¥é¡ºåºã€‚</p></li><li><p>TreeSetï¼šåº•å±‚åŸºäºTreeMap, ç‰¹æ€§ä¸ºæ˜¯ä¸€ä¸ªæœ‰åºçš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯æä¾›æœ‰åºçš„Seté›†åˆã€‚åŒæ—¶å®ç°NavigableSetæ¥å£ï¼Œè¯¥æ¥å£æ‰©å±•çš„ SortedSetï¼Œå…·æœ‰äº†ä¸ºç»™å®šæœç´¢ç›®æ ‡æŠ¥å‘Šæœ€æ¥è¿‘åŒ¹é…é¡¹çš„å¯¼èˆªæ–¹æ³•ï¼Œè¿™å°±æ„å‘³ç€å®ƒæ”¯æŒä¸€ç³»åˆ—çš„å¯¼èˆªæ–¹æ³•ã€‚æ¯”å¦‚æŸ¥æ‰¾ä¸æŒ‡å®šç›®æ ‡æœ€åŒ¹é…é¡¹ï¼Œå¦‚ï¼šlowerï¼Œfloor,ceilingç­‰æ–¹æ³•ã€‚</p></li></ul></li></ul><ul><li><p>Listæºç è§£æ</p><ul><li><p><a href="http://zhongyp.me/2018/01/10/ArrayList/">ArrayList</a> ï¼šåº•å±‚æ•°ç»„ï¼Œç‰¹æ€§ä¸ºå®ç°RandomAccessæ¥å£ï¼Œå¯ä»¥å¯¹å…ƒç´ è¿›è¡Œå¿«é€Ÿè®¿é—®ã€‚</p></li><li><p><a href="http://zhongyp.me/2018/01/12/LinkedList/">LinkedList</a> ï¼šæ˜¯ä¸€ä¸ªç»§æ‰¿äºAbstractSequentialListçš„åŒå‘é“¾è¡¨ã€‚å®ƒä¹Ÿå¯ä»¥è¢«å½“ä½œå †æ ˆã€é˜Ÿåˆ—æˆ–åŒç«¯é˜Ÿåˆ—è¿›è¡Œæ“ä½œã€‚å®ç° List æ¥å£ï¼Œèƒ½å¯¹å®ƒè¿›è¡Œé˜Ÿåˆ—æ“ä½œã€‚å®ç°äº†Cloneableæ¥å£ï¼Œå³è¦†ç›–äº†å‡½æ•°clone()ï¼Œèƒ½å…‹éš†ã€‚ LinkedList æ˜¯éåŒæ­¥çš„ã€‚</p></li><li><p><a href="http://zhongyp.me/2018/01/12/Vector/">Vector</a> ï¼šåº•å±‚æ•°ç»„ï¼Œä¸è¿‡æ˜¯ArrayListçš„åŒæ­¥ç‰ˆæœ¬ã€‚ä¸è¿‡ä¸èƒ½åºåˆ—åŒ–ï¼Œæ²¡æœ‰å®ç°Serializableçš„readObjectæ–¹æ³•ã€‚</p></li></ul></li><li><p><a href="">Queueæºç è§£æï¼š</a></p><ul><li><p>PriorityQueue </p></li><li><p><a href="http://zhongyp.me/2018/01/12/LinkedList/">LinkedList</a> ï¼šæ˜¯ä¸€ä¸ªç»§æ‰¿äºAbstractSequentialListçš„åŒå‘é“¾è¡¨ã€‚å®ƒä¹Ÿå¯ä»¥è¢«å½“ä½œå †æ ˆã€é˜Ÿåˆ—æˆ–åŒç«¯é˜Ÿåˆ—è¿›è¡Œæ“ä½œã€‚å®ç° List æ¥å£ï¼Œèƒ½å¯¹å®ƒè¿›è¡Œé˜Ÿåˆ—æ“ä½œã€‚å®ç°äº†Cloneableæ¥å£ï¼Œå³è¦†ç›–äº†å‡½æ•°clone()ï¼Œèƒ½å…‹éš†ã€‚ LinkedList æ˜¯éåŒæ­¥çš„ã€‚</p></li><li><p>ArrayQueue</p></li></ul></li></ul><h2 id="Mapæºç è§£æ"><a href="#Mapæºç è§£æ" class="headerlink" title="Mapæºç è§£æ"></a><a href="">Mapæºç è§£æ</a></h2><ul><li><p>EnumMap</p></li><li><p>IdentityHashMap</p></li><li><p>HashMap </p></li><li><p>HashTable</p></li><li><p><a href="https://www.cnblogs.com/zaizhoumo/p/7709755.html" target="_blank" rel="noopener">ConcurrentHashMap</a></p></li><li><p>LinkedHashMap</p></li><li><p>WeakHashMap</p></li><li><p>TreeMap</p></li></ul><h2 id="Concurrentæºç è§£æï¼š"><a href="#Concurrentæºç è§£æï¼š" class="headerlink" title="Concurrentæºç è§£æï¼š"></a><a href="">Concurrentæºç è§£æï¼š</a></h2><ul><li><p>é˜»å¡é˜Ÿåˆ— BlockingQueue</p></li><li><p>æ•°ç»„é˜»å¡é˜Ÿåˆ— ArrayBlockingQueue</p></li><li><p>å»¶è¿Ÿé˜Ÿåˆ— DelayQueue</p></li><li><p>é“¾é˜»å¡é˜Ÿåˆ— LinkedBlockingQueue</p></li><li><p>å…·æœ‰ä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ— PriorityBlockingQueue</p></li><li><p>åŒæ­¥é˜Ÿåˆ— SynchronousQueue</p></li><li><p>é˜»å¡åŒç«¯é˜Ÿåˆ— BlockingDeque</p></li><li><p>é“¾é˜»å¡åŒç«¯é˜Ÿåˆ— LinkedBlockingDeque</p></li><li><p>å¹¶å‘ Map(æ˜ å°„) ConcurrentMap</p></li><li><p>å¹¶å‘å¯¼èˆªæ˜ å°„ ConcurrentNavigableMap</p></li><li><p>é—­é” CountDownLatch</p></li><li><p>æ …æ  CyclicBarrier</p></li><li><p>äº¤æ¢æœº Exchanger</p></li><li><p>ä¿¡å·é‡ Semaphore</p></li><li><p>æ‰§è¡Œå™¨æœåŠ¡ ExecutorService</p></li><li><p>çº¿ç¨‹æ± æ‰§è¡Œè€… ThreadPoolExecutor</p></li><li><p>å®šæ—¶æ‰§è¡Œè€…æœåŠ¡ ScheduledExecutorService</p></li><li><p>ä½¿ç”¨ ForkJoinPool è¿›è¡Œåˆ†å‰å’Œåˆå¹¶</p></li><li><p>é” Lock</p></li><li><p>è¯»å†™é” ReadWriteLock</p></li><li><p>åŸå­æ€§å¸ƒå°” AtomicBoolean</p></li><li><p>åŸå­æ€§æ•´å‹ AtomicInteger </p></li><li><p>åŸå­æ€§é•¿æ•´å‹ AtomicLong</p></li><li><p>åŸå­æ€§å¼•ç”¨å‹ AtomicReference</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaå†…å­˜æ¨¡å‹</title>
      <link href="/2018/01/04/concurrent/2018-03-04-JavaMemModel/"/>
      <url>/2018/01/04/concurrent/2018-03-04-JavaMemModel/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h1><p>Javaå†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ï¼šJMMï¼‰ï¼Œä¸‹æ–‡ä¸­å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼ŒJMMå³ä»£è¡¨â€œJavaå†…å­˜æ¨¡å‹â€ã€‚</p><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œéœ€è¦å¤„ç†ä¸¤ä¸ªå…³é”®çš„é—®é¢˜ï¼šçº¿ç¨‹ä¹‹é—´ä»¥ä½•ç§æœºåˆ¶äº¤æ¢ä¿¡æ¯ï¼ˆé€šä¿¡ï¼‰åŠå¦‚ä½•æ§åˆ¶ä¸åŒçº¿ç¨‹ä¹‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶ï¼ˆåŒæ­¥ï¼‰ã€‚<br>çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚<br>å…±äº«å†…å­˜æ¨¡å‹ï¼šçº¿ç¨‹ä¹‹é—´é€šè¿‡è¯»-å†™å†…å­˜ä¸­çš„å…¬å…±çŠ¶æ€è¿›è¡Œéšå¼é€šä¿¡ã€‚<br>æ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼šçº¿ç¨‹ä¹‹é—´æ²¡æœ‰å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡å‘é€æ¶ˆæ¯æ¥æ˜¾ç¤ºçš„è¿›è¡Œé€šä¿¡ã€‚<br><strong><em>Javaå¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹</em></strong>ã€‚<br>æ³¨ï¼š<br>åŒæ­¥ï¼šæŒ‡ç¨‹åºä¸­ç”¨äºæ§åˆ¶ä¸åŒçº¿ç¨‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶ï¼Œæ„å‘³ç€æŸç§å½¢å¼çš„åŸå­æ€§æˆ–è€…äº’æ–¥ã€‚<br>å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹ä¸­ï¼ŒåŒæ­¥æ˜¯æ˜¾å¼ï¼Œç¨‹åºå‘˜å¿…é¡»æ˜¾ç¤ºçš„æŒ‡å®šæŸä¸ªæ–¹æ³•æˆ–æŸæ®µä»£ç éœ€è¦åœ¨çº¿ç¨‹ä¹‹é—´äº’æ–¥æ‰§è¡Œã€‚æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯çš„å‘é€å¿…é¡»åœ¨æ¶ˆæ¯çš„æ¥æ”¶ä¹‹å‰ï¼Œå› æ­¤åŒæ­¥æ˜¯éšå¼çš„ã€‚</p><h2 id="2-JMMçš„è®¾è®¡"><a href="#2-JMMçš„è®¾è®¡" class="headerlink" title="2. JMMçš„è®¾è®¡"></a>2. JMMçš„è®¾è®¡</h2><h3 id="2-1-Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„"><a href="#2-1-Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„" class="headerlink" title="2.1 Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„"></a>2.1 Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„</h3><p><img src="/media/jvm-1.8.png" alt="jmmæŠ½è±¡ç»“æ„"><br>å¯¹äºä¸Šå›¾å„ä¸ªæ¨¡å—ä¸å¤ªç†è§£çš„å¯ä»¥çœ‹ä¸‹<a href="https://zhongyp.me/2018/03/27/jvm/2018-03-27-JVM/">JVM</a>ï¼Œé‡Œé¢æœ‰å¯¹å„ä¸ªæ¨¡å—çš„è®²è§£ã€‚<br>Javaçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ˜¯ç”±Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Model,ç®€ç§°ï¼šJMMï¼‰æ§åˆ¶ï¼ŒJMMå†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚JMMé€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’ï¼Œæä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚JMMå±äºè¯­è¨€çº§åˆ«çš„å†…å­˜æ¨¡å‹ï¼Œç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å’Œä¸åŒå¤„ç†å™¨å¹³å°ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œæä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p><h3 id="2-2-ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"><a href="#2-2-ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="2.2 ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"></a>2.2 ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</h3><p>åœ¨JMMæ¨¡å‹ä¸­ï¼Œå¯¹è±¡é©»ç•™åœ¨å…±äº«å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹å…·æœ‰ä¸€ä¸ªç§æœ‰çš„å†…å­˜å·¥ä½œåŒºï¼Œå…¶ä¸­å­˜æ”¾ç€è¯¥çº¿ç¨‹å·²è¯»/å·²å†™çš„åŸŸçš„cacheæ‹·è´ã€‚åœ¨æ²¡æœ‰æ˜¾ç¤ºåŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå¯¹ä¸€ä¸ªåŸŸæ‰§è¡Œäº†å†™æ“ä½œçš„çº¿ç¨‹å¯èƒ½æ²¡æœ‰å°†å®ƒçš„æ›´æ–°ç«‹å³ä¼ é€åˆ°å†…å­˜ä¸­ï¼›å¯¹ä¸€ä¸ªåŸŸæ‰§è¡Œè¯»æ“ä½œçš„çº¿ç¨‹ï¼Œå½“å†…å­˜ä¸­çš„åŸŸçš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ç›¸åº”çš„å†…å­˜å·¥ä½œåŒºå¯èƒ½è¿˜æ²¡æœ‰è¢«ä¿®æ”¹ã€‚JVMä¸ä¿æŒè¿™ç§cacheçš„ä¸€è‡´æ€§ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šåœ¨javaä¸­ï¼Œæ‰§è¡Œä¸‹é¢è¿™ä¸ªè¯­å¥ï¼š</p><p><code>i  = 10++;</code></p><p>1) æ‰§è¡Œçº¿ç¨‹å¿…é¡»å…ˆåœ¨è‡ªå·±çš„å·¥ä½œçº¿ç¨‹ä¸­å¯¹å˜é‡iæ‰€åœ¨çš„ç¼“å­˜è¡Œè¿›è¡Œèµ‹å€¼æ“ä½œï¼Œç„¶åå†å†™å…¥ä¸»å­˜å½“ä¸­ã€‚è€Œä¸æ˜¯ç›´æ¥å°†æ•°å€¼10å†™å…¥ä¸»å­˜å½“ä¸­ã€‚</p><p>2) æ¯”å¦‚åŒæ—¶æœ‰2ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå‡å¦‚åˆå§‹æ—¶içš„å€¼ä¸º10ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¹‹åiçš„å€¼å˜ä¸º12ã€‚ä½†æ˜¯äº‹å®ä¼šæ˜¯è¿™æ ·å—ï¼Ÿ</p><p>3) å¯èƒ½å­˜åœ¨ä¸‹é¢ä¸€ç§æƒ…å†µï¼šåˆå§‹æ—¶ï¼Œä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è¯»å–içš„å€¼å­˜å…¥å„è‡ªæ‰€åœ¨çš„å·¥ä½œå†…å­˜å½“ä¸­ï¼Œç„¶åçº¿ç¨‹1è¿›è¡ŒåŠ 1æ“ä½œï¼Œç„¶åæŠŠiçš„æœ€æ–°å€¼11å†™å…¥åˆ°å†…å­˜ã€‚æ­¤æ—¶çº¿ç¨‹2çš„å·¥ä½œå†…å­˜å½“ä¸­içš„å€¼è¿˜æ˜¯10ï¼Œè¿›è¡ŒåŠ 1æ“ä½œä¹‹åï¼Œiçš„å€¼ä¸º11ï¼Œç„¶åçº¿ç¨‹2æŠŠiçš„å€¼å†™å…¥å†…å­˜ã€‚</p><p>4) æœ€ç»ˆç»“æœiçš„å€¼æ˜¯11ï¼Œè€Œä¸æ˜¯12ã€‚è¿™å°±æ˜¯è‘—åçš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚é€šå¸¸ç§°è¿™ç§è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®çš„å˜é‡ä¸ºå…±äº«å˜é‡ã€‚</p><p>ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œéœ€è¦å„ä¸ªå¤„ç†å™¨è®¿é—®ç¼“å­˜æ—¶éµå¾ªä¸€äº›åè®®ï¼ˆMSIã€MESIã€MOSIã€Synapseç­‰ï¼‰ï¼Œåœ¨è¯»å†™æ—¶è¦æ ¹æ®åè®®è¿›è¡Œæ“ä½œã€‚<br><img src="/media/cache-consistency.png" alt="resort"><br>å›¾ç‰‡æ¥è‡ªï¼š<a href="#æŒ‡ä»¤åºåˆ—çš„é‡æ’åº">ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹</a></p><h3 id="2-3-æŒ‡ä»¤åºåˆ—çš„é‡æ’åº"><a href="#2-3-æŒ‡ä»¤åºåˆ—çš„é‡æ’åº" class="headerlink" title="2.3 æŒ‡ä»¤åºåˆ—çš„é‡æ’åº"></a>2.3 æŒ‡ä»¤åºåˆ—çš„é‡æ’åº</h3><p>é™¤äº†ä¸Šè¿°çš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜å¤–ï¼Œåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜ç¨‹åºçš„æ€§èƒ½ï¼Œä½¿å¾—å¤„ç†å™¨å†…éƒ¨çš„è¿ç®—å•å…ƒè¢«å……åˆ†åˆ©ç”¨ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åºã€‚é‡æ’åºä¹Ÿä¼šå¯¼è‡´å¤šçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚<br>é‡æ’åºåˆ†ç±»ï¼š</p><ol><li>ç¼–è¯‘å™¨é‡æ’åºã€‚ç¼–è¯‘å™¨ä¸æ”¹å˜å•çº¿ç¨‹è¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚</li><li>æŒ‡ä»¤çº§é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚<strong><em>å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</em></strong></li><li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚</li></ol><p>æ³¨ï¼š<br>æ•°æ®ä¾èµ–æ€§ï¼šç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä»¥æ¥å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚æ•°æ®ä¾èµ–æ€§ä»…é’ˆå¯¹å•ä¸ªå¤„ç†å™¨ä¸­æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—å’Œå•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒå¤„ç†å™¨ä¹‹é—´å’Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ä¸è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è€ƒè™‘ã€‚<br>as-if-serialï¼šä¸ç®¡å¦‚ä½•çš„é‡æ’åºï¼Œå•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆas-if-serialè¯­ä¹‰ã€‚</p><p><img src="/media/resort.png" alt="resort"></p><p>å›¾ä¸­çš„1ã€2ã€3é‡æ’åºå¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹çš„å†…å­˜å¯è§æ€§é—®é¢˜ã€‚è¿™ä¸ç°ä»£å¤„ç†å™¨ä½¿ç”¨å†™ç¼“å†²åŒºæœ‰å…³ã€‚æˆ‘ä»¬çŸ¥é“cpuå¤„ç†å’Œå†…å­˜è¯»å†™çš„å¤„ç†é€Ÿåº¦å·®è·å¤ªå¤§ï¼Œä¸ºäº†å‡å°‘cpuç­‰å¾…è¯»/å†™å†…å­˜äº§ç”Ÿçš„å»¶è¿Ÿï¼Œcpuä½¿ç”¨äº†å†™ç¼“å­˜åŒºã€‚å†™ç¼“å†²åŒºå¯ä»¥ä¿è¯æŒ‡ä»¤æµæ°´çº¿æŒç»­è¿è¡Œï¼Œé€šè¿‡æ‰¹å¤„ç†çš„æ–¹å¼åˆ·æ–°å†™ç¼“å†²ï¼Œä»¥åŠåˆå¹¶å†™ç¼“å†²ä¸­å¯¹åŒä¸€å†…å­˜åœ°å€çš„å¤šæ¬¡å†™ï¼Œå‡å°‘å¯¹å†…å­˜æ€»çº¿çš„å ç”¨ã€‚<br>ä¾‹å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * è¿™æ®µä»£ç ç”¨æ¥æ ¡éªŒcpuå¯¹å†…å­˜çš„è¯»/å†™æ“ä½œï¼Œä¸ä¸€å®šä¸å†…å­˜å®é™…å‘ç”Ÿçš„è¯»/å†™é¡ºåºä¸€è‡´ã€‚</span><br><span class="line"> */</span><br><span class="line">    //åˆå§‹çŠ¶æ€ a=b=0</span><br><span class="line">  </span><br><span class="line">    //çº¿ç¨‹1</span><br><span class="line">        a = 1; // A1</span><br><span class="line">        x = b; // A2</span><br><span class="line">   </span><br><span class="line">    // çº¿ç¨‹2</span><br><span class="line">        b=2; // B1</span><br><span class="line">        y=a; // B2</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªç¨‹åºçš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼Œæœ‰å¯èƒ½æ˜¯x=y=0ã€‚çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶æŠŠå…±äº«å˜é‡aã€bå†™å…¥è‡ªå·±çš„å†™ç¼“å†²åŒºï¼Œç„¶åä»å†…å­˜ä¸­è¯»å–å¦ä¸€ä¸ªå…±äº«å˜é‡aã€bçš„å€¼å¤åˆ¶ç»™xã€yï¼Œæœ€åå†æŠŠæ‰€æœ‰çš„æ•°æ®åˆ·å…¥å†…å­˜ã€‚è¿™ç§æƒ…å†µä¸‹x=y=0ã€‚<br><img src="/media/cpustore.png" alt="cpu-mem"><br>ä¸Šè¿°è¿™ç§æƒ…å†µå°±æ˜¯é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“ã€‚</p><h3 id="2-4-happens-before"><a href="#2-4-happens-before" class="headerlink" title="2.4 happens-before"></a>2.4 happens-before</h3><p>Javaè™šæ‹Ÿæœºè¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä¸”èƒ½å¤Ÿæœ‰è¶³å¤Ÿçš„è‡ªç”±ç©ºé—´åŒºåˆ©ç”¨ç¡¬ä»¶çš„å„ç§ç‰¹æ€§æ¥è·å–ä¸ªå¥½çš„æ‰§è¡Œé€Ÿåº¦ï¼Œä»JDK5å¼€å§‹ï¼ŒJavaä½¿ç”¨JSR-133å†…å­˜æ¨¡å‹ã€‚JSR-133ä½¿ç”¨happens-beforeæ¦‚å¿µä¿è¯å†…å­˜çš„å¯è§æ€§ã€‚å¦å¤–ï¼ŒJavaå†…å­˜æ¨¡å‹å…·å¤‡ä¸€äº›å…ˆå¤©çš„â€œæœ‰åºæ€§â€ï¼Œå³ä¸éœ€è¦é€šè¿‡ä»»ä½•æ‰‹æ®µå°±èƒ½å¤Ÿå¾—åˆ°ä¿è¯çš„æœ‰åºæ€§ï¼Œè¿™ä¸ªé€šå¸¸ä¹Ÿç§°ä¸º happens-before åŸåˆ™ã€‚å¦‚æœä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œæ¬¡åºæ— æ³•ä»happens-beforeåŸåˆ™æ¨å¯¼å‡ºæ¥ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¸èƒ½ä¿è¯å®ƒä»¬çš„æœ‰åºæ€§ï¼Œè™šæ‹Ÿæœºå¯ä»¥éšæ„åœ°å¯¹å®ƒä»¬è¿›è¡Œé‡æ’åºã€‚</p><p>ä¸‹é¢å°±æ¥å…·ä½“ä»‹ç»ä¸‹happens-beforeåŸåˆ™ï¼ˆå…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼‰ï¼š</p><ol><li><p><strong><em>ç¨‹åºæ¬¡åºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚</em></strong></p></li><li><p><strong><em>ç›‘è§†å™¨é”è§„åˆ™ï¼šä¸€ä¸ªunLockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œã€‚</em></strong></p></li><li><p><strong><em>volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œï¼Œhappens-beforeäºåç»­å¯¹è¿™ä¸ªvolatileå˜é‡çš„è¯»æ“ä½œã€‚</em></strong></p></li><li><p><strong><em>ä¼ é€’è§„åˆ™ï¼šå¦‚æœæ“ä½œA happens-beforeæ“ä½œBï¼Œè€Œæ“ä½œB happens-beforeæ“ä½œCï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œA happens-beforeæ“ä½œCã€‚</em></strong></p></li><li><p>start()è§„åˆ™ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•happens-beforeæ­¤çº¿ç¨‹çš„æ¯ä¸ªä¸€ä¸ªåŠ¨ä½œ</p></li><li><p>join()è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.join()å¹¶æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œhappens-beforeäºçº¿ç¨‹Aä»ThreadB.join()æ“ä½œæˆåŠŸè¿”å›ã€‚</p></li><li><p>çº¿ç¨‹ç»ˆç»“è§„åˆ™ï¼šçº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.join()æ–¹æ³•ç»“æŸã€Thread.isAlive()çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œ</p></li><li><p>å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºä»–çš„finalize()æ–¹æ³•çš„å¼€å§‹</p></li></ol><p>å¯¹äºç¨‹åºæ¬¡åºè§„åˆ™æ¥è¯´ï¼Œå°±æ˜¯ä¸€æ®µç¨‹åºä»£ç çš„æ‰§è¡Œåœ¨å•ä¸ªçº¿ç¨‹ä¸­<strong><em>çœ‹èµ·æ¥</em></strong>æ˜¯æœ‰åºçš„ã€‚ç¨‹åºçœ‹èµ·æ¥æ‰§è¡Œçš„é¡ºåºæ˜¯æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œçš„ï¼Œä½†æ˜¯è™šæ‹Ÿæœºå¯èƒ½ä¼šå¯¹ç¨‹åºä»£ç è¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚è™½ç„¶è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œçš„ç»“æœæ˜¯ä¸ç¨‹åºé¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´çš„ï¼Œå®ƒåªä¼šå¯¹ä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§çš„æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚å› æ­¤ï¼Œåœ¨å•ä¸ªçº¿ç¨‹ä¸­ï¼Œç¨‹åºæ‰§è¡Œçœ‹èµ·æ¥æ˜¯æœ‰åºæ‰§è¡Œçš„ï¼Œè¿™ä¸€ç‚¹è¦æ³¨æ„ç†è§£ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”¨æ¥ä¿è¯ç¨‹åºåœ¨<strong><em>å•çº¿ç¨‹ä¸­æ‰§è¡Œç»“æœçš„æ­£ç¡®æ€§ï¼Œä½†æ— æ³•ä¿è¯ç¨‹åºåœ¨å¤šçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚</em></strong><br>æ³¨æ„ï¼š<strong><em>ä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰çš„happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼Œä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œæ‰§è¡Œç»“æœå¯¹åä¸€ä¸ªæ“ä½œå¯è§ã€‚</em></strong></p><p><img src="/media/happens-before-design.png" alt="happens-before-design"><br>JMMè®¾è®¡å›¾ï¼Œå›¾ç‰‡æ¥è‡ª<a href="#2-4-happens-before">Javaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯</a></p><h2 id="JMMæ€»ç»“"><a href="#JMMæ€»ç»“" class="headerlink" title="JMMæ€»ç»“"></a>JMMæ€»ç»“</h2><p>JMMåœ¨è®¾è®¡ä¸Šè€ƒè™‘ä¸¤ä¸ªå…³é”®å› ç´ ï¼š</p><ol><li>è¦ä¸ºç¨‹åºå‘˜æä¾›è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</li><li>å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é™åˆ¶å°½å¯èƒ½çš„æ”¾æ¾ï¼Œæé«˜ç¨‹åºçš„è¿è¡Œæ€§èƒ½ï¼ŒåŒæ—¶è§£å†³é‡æ’åºå¯¼è‡´çš„å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚<br>æ€»çš„æ¥è¯´JMMåœ¨è®¾è®¡ä¸Šå®Œæˆäº†å¦‚ä¸‹çš„ç»“æœï¼š</li></ol><ul><li>å•çº¿ç¨‹ç¨‹åºã€‚<strong><em>å•çº¿ç¨‹ç¨‹åºä¸ä¼šå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚</em></strong>ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨ä¼šå…±åŒç¡®ä¿å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒã€‚</li><li>æ­£ç¡®<strong><em>åŒæ­¥</em></strong>çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒï¼‰ã€‚<strong><em>JMMé€šè¿‡é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é‡æ’åºæ¥ä¸ºç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚ï¼ˆè¿™å¥è¯è§£å†³äº†æœ¬æ–‡ä¸­çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç¼“å­˜ä¸€è‡´æ€§ä¸é‡æ’åºå¼•èµ·çš„å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œæˆ‘ä¼šåœ¨<a href="https://zhongyp.me/2018/12/06/concurrent/2018-12-06-thread-communication/">çº¿ç¨‹é€šä¿¡</a>çš„å…±äº«å˜é‡å°èŠ‚ä¸­è®²è§£ç¼“å­˜ä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨<a href="https://zhongyp.me/2018/12/06/concurrent/2018-12-06-thread-security/">çº¿ç¨‹å®‰å…¨</a>ä¸€ç« ä¸­è®²è§£é‡æ’åºå¼•èµ·çš„å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼‰</em></strong></li><li>æœªåŒæ­¥/æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚JMMä¸ºä»–ä»¬æä¾›æœ€å°çš„å®‰å…¨æ€§ä¿éšœï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ—¶é»˜è®¤å€¼ï¼ˆ0ã€nullã€falseï¼‰ã€‚</li></ul><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p><a href="http://www.importnew.com/24082.html" target="_blank" rel="noopener">ä½ çœŸçš„äº†è§£volatileå…³é”®å­—å—ï¼Ÿ</a></p><p><a href="https://www.cnblogs.com/zhengbin/p/5654805.html" target="_blank" rel="noopener">Javaä¸­Volatileå…³é”®å­—è¯¦è§£</a></p><p><a href="">Javaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯</a></p><p><a href="">æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº-JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åˆ†å¸ƒå¼é”</title>
      <link href="/2017/10/15/work/2017-10-15-Distribute-Lock/"/>
      <url>/2017/10/15/work/2017-10-15-Distribute-Lock/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼é”æ˜¯ä»€ä¹ˆ"><a href="#åˆ†å¸ƒå¼é”æ˜¯ä»€ä¹ˆ" class="headerlink" title="åˆ†å¸ƒå¼é”æ˜¯ä»€ä¹ˆ"></a>åˆ†å¸ƒå¼é”æ˜¯ä»€ä¹ˆ</h2><p>ç›®å‰å¤§å¤šæ•°ç½‘ç«™åŠåº”ç”¨éƒ½æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ï¼Œæˆ‘ä»¬ä¸ºäº†ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œéœ€è¦å¾ˆå¤šçš„æŠ€æœ¯æ–¹æ¡ˆæ¥æ”¯æŒï¼Œæ¯”å¦‚åˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†å¸ƒå¼é”ç­‰ã€‚</p><p>ä¸ºäº†å®ç°å¤šä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªæ—¶åˆ»åŒä¸€ä¸ªä»£ç å—åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯æ‰§è¡Œï¼Œé‚£ä¹ˆéœ€è¦åœ¨æŸä¸ªåœ°æ–¹åšä¸ªæ ‡è®°ï¼Œè¿™ä¸ªæ ‡è®°å¿…é¡»æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ï¼Œå½“æ ‡è®°ä¸å­˜åœ¨æ—¶å¯ä»¥è®¾ç½®è¯¥æ ‡è®°ï¼Œå…¶ä½™åç»­çº¿ç¨‹å‘ç°å·²ç»æœ‰æ ‡è®°äº†åˆ™ç­‰å¾…æ‹¥æœ‰æ ‡è®°çš„çº¿ç¨‹ç»“æŸåŒæ­¥ä»£ç å—å–æ¶ˆæ ‡è®°åå†å»å°è¯•è®¾ç½®æ ‡è®°ã€‚è¿™ä¸ªæ ‡è®°å¯ä»¥ç†è§£ä¸ºåˆ†å¸ƒå¼é”ã€‚</p><h2 id="åˆ†å¸ƒå¼é”ä½œç”¨"><a href="#åˆ†å¸ƒå¼é”ä½œç”¨" class="headerlink" title="åˆ†å¸ƒå¼é”ä½œç”¨"></a>åˆ†å¸ƒå¼é”ä½œç”¨</h2><ul><li>å½“åœ¨åˆ†å¸ƒå¼æ¨¡å‹ä¸‹ï¼Œæ•°æ®åªæœ‰ä¸€ä»½ï¼ˆæˆ–æœ‰é™åˆ¶ï¼‰ï¼Œæ­¤æ—¶éœ€è¦åˆ©ç”¨é”çš„æŠ€æœ¯æ§åˆ¶æŸä¸€æ—¶åˆ»ä¿®æ”¹æ•°æ®çš„è¿›ç¨‹æ•°ã€‚</li></ul><h2 id="åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹å¼"><a href="#åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹å¼" class="headerlink" title="åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹å¼"></a>åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹å¼</h2><pre><code>åŸºäºæ•°æ®åº“è¡¨</code></pre><ol><li><p>åŸºäºè¡¨çš„æ•°æ®æ“ä½œé”ï¼Œå½“æˆ‘ä»¬è¦åŠ é”æ˜¯ï¼Œåˆ›å»ºä¸€æ¡è®°å½•ï¼›é‡Šæ”¾é”æ—¶ï¼Œåˆ é™¤è¿™æ¡è®°å½•ã€‚</p></li><li><p>åŸºäºæ•°æ®åº“æ’ä»–é”ï¼Œåˆ©ç”¨æ•°æ®åº“è‡ªå¸¦çš„æ’ä»–é”æœºåˆ¶ã€‚select for updateã€‚</p></li></ol><p>è¯¥æ–¹æ¡ˆå¼ºä¾èµ–äºæ•°æ®åº“çš„å¯ç”¨æ€§ã€‚æ•°æ®åº“æ˜¯å•ç‚¹ï¼Œä¸€æ—¦æŒ‚æ‰ï¼Œå°†å¯¼è‡´æ•´ä¸ªä¸šåŠ¡ä¸å¯ç”¨ã€‚ï¼ˆ1,2ï¼‰</p><p>è¯¥é”ä¸æ˜¯é˜»å¡çš„ã€‚ä¾èµ–insertæ“ä½œï¼Œä¸€æ—¦å¤±è´¥ç›´æ¥è¿”å›ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹ä¸ä¼šè¿›å…¥é˜Ÿåˆ—ï¼Œè¦æƒ³è·å–é”ï¼Œåªèƒ½å†æ¬¡å‘èµ·insertã€‚ï¼ˆ1ï¼‰</p><p>å¤©ç”Ÿæ˜¯é˜»å¡çš„ã€‚for updateå¤±è´¥ä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚æ•°æ®åº“å®•æœºï¼Œåˆ™é”è‡ªåŠ¨é‡Šæ”¾ï¼ˆ2ï¼‰</p><p>è¯¥é”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ã€‚ä¸€æ—¦deleteå¤±è´¥ï¼Œé”å°±æ°¸è¿œå­˜åœ¨äº†ã€‚ï¼ˆ1ï¼‰</p><p>è¯¥é”ä¸æ˜¯å¯é‡å…¥é”ã€‚ï¼ˆ1,2ï¼‰</p><pre><code>åŸºäºç¼“å­˜å®ç°åŸºäºZookeeperå®ç°</code></pre><p>åŸºäºZookeeperä¸´æ—¶æœ‰åºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ã€‚ </p><p>å¤§ä½“åŸç†ï¼šå½“æ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨Zookeeperçš„å¯¹åº”ç›®å½•ä¸‹ï¼Œä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç¬æ€çš„æœ‰åºçš„znodeã€‚ </p><p>åˆ¤æ–­æ˜¯å¦è·å¾—é”ï¼Œåªè¦åˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯ç›®å½•ä¸‹æœ€å°çš„znodeã€‚ </p><p>å¦‚æœä¸æ˜¯ï¼Œæ³¨å†Œå¯¹æ¯”è‡ªå·±å°çš„znodeçš„ç›‘å¬ã€‚å½“æ¯”è‡ªå·±å°çš„znodeåˆ é™¤æ—¶ï¼Œæ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„ã€‚</p><p>å½“æŸä¸ªå®¢æˆ·ç«¯è·å–é”åï¼Œçªç„¶æŒ‚æ‰ã€‚æ²¡å…³ç³»ï¼Œå¯¹åº”çš„znodeä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä¸ä¼šå‡ºç°é”é‡Šæ”¾ä¸äº†çš„é—®é¢˜ã€‚ </p><p>æ˜¯é˜»å¡é” </p><p>å¯é‡å…¥ </p><p>é›†ç¾¤éƒ¨ç½²</p><p>ä½¿ç”¨zookeeperè¿˜æ˜¯æ¯”è¾ƒé è°±çš„ï¼Œè€Œä¸”å¯ä»¥ç›´æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…Curatorï¼Œè¿™ä¸ªåŒ…ç›´æ¥å°è£…äº†ä¸€ä¸ªå¯é‡å…¥çš„é”æœåŠ¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public boolean tryLock(long timeout, TimeUnit unit) throws Exception &#123;</span><br><span class="line">        return interProcessMutex.acquire(timeout, unit);</span><br><span class="line">&#125;</span><br><span class="line">public void unlock() throws Exception &#123;</span><br><span class="line">        interProcessMutex.release();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Curatorçš„interProcessMutex.acquireè·å–é”ï¼Œreleaseé‡Šæ”¾é”ã€‚</p><p>åªæ˜¯æ€§èƒ½ä¸Šè¦æ¯”åŸºäºç¼“å­˜å·®ä¸€ç‚¹ã€‚ </p><p>ä½†æ˜¯ç”Ÿäº§ç¯å¢ƒä¸Šè¿˜æ˜¯æ¨èzookeeperã€‚</p><h2 id="Redis-åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"><a href="#Redis-åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="Redis åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"></a>Redis åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2><pre><code>åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜</code></pre><p>å‡å¯èƒ½å­˜åœ¨å¤šè¿›ç¨‹æ‹¥æœ‰é”çš„æƒ…å†µã€‚redisé”ä¸»è¦æ˜¯expireæ—¶é—´ä¸ä»£ç æ‰§è¡Œæ—¶é—´çš„é—®é¢˜ï¼Œzké”çš„é—®é¢˜åœ¨äºzkæ˜¯é€šè¿‡å¿ƒè·³ç›‘æ§è¿›ç¨‹å­˜æ´»çŠ¶æ€ï¼Œå¦‚æœè¿›ç¨‹è¿›è¡ŒGC pauseæˆ–è€…å› ä¸ºç½‘ç»œåŸå› å¯¼è‡´å¾ˆé•¿æ—¶é—´æ²¡ä¸zkè”ç³»ï¼Œåˆ™å°†å¯¼è‡´zkè®¤ä¸ºè¿›ç¨‹å·²æŒ‚ï¼Œè€Œåé”è‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œæ­¤æ—¶è¿›ç¨‹å¹¶æœªæŒ‚ä»»ç„¶åœ¨æ‰§è¡Œã€‚<br>Redlocké”çš„æ—¶é—´é—®é¢˜ã€‚ç”±äºredisçš„expireçš„å®ç°æ˜¯é€šè¿‡pexpireatï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ—¶é’Ÿè·³è·ƒï¼Œåˆ™è¯¥èŠ‚ç‚¹å¯èƒ½è¿‡æ—©é‡Šæ”¾é”å¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ã€‚</p><pre><code>è§£å†³æ–¹æ¡ˆ</code></pre><p>è·å–é”æ—¶æä¾›ä¸€ä¸ªfencing token(ä¸¤ç§è¯´æ³•ï¼Œä¸€ç§è¯´éœ€è¦æœ‰åºï¼Œä¸€ç§è¯´éšæœºå€¼å°±å¯ä»¥ï¼Œæˆ‘è§‰å¾—éšæœºå€¼å°±å¯ä»¥)ï¼Œåœ¨è¿›ç¨‹è·å–é”åå¯¹æ•°æ®è¿›è¡Œæ“ä½œæ—¶ï¼Œæ•°æ®æ‰€åœ¨çš„èµ„æºæœåŠ¡å™¨éœ€è¦å»é”ä¸­æŸ¥çœ‹å½“å‰tokenï¼Œå¦‚æœtokenå¯¹çš„æ‰æ‰§è¡Œï¼Œä¸å¯¹åˆ™æ”¾å¼ƒæ‰§è¡Œã€‚<br>æˆ‘è§‰å¾—å¯¹äºæ”¾å¼ƒæ‰§è¡Œçš„åº”è¯¥åœ¨æˆ‘ä»¬çš„ä»£ç å—ä¸­å¢åŠ ç±»ä¼¼äº‹ç‰©çš„rollbackçš„æ“ä½œã€‚å› æ­¤å¦‚æœèµ„æºæœåŠ¡å™¨æ‹’ç»äº†æˆ‘ä»¬çš„æ“ä½œåˆ™è¡¨æ˜æ­¤æ—¶èµ·ç å·²ç»å­˜åœ¨äº†å¦å¤–ä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰é”äº†ï¼Œä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨æ€§ä¸èƒ½ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤éœ€è¦å›æ»šåˆ°æ‰§è¡Œä»£ç å—ä¹‹å‰è€Œç»§ç»­å»ç«äº‰é”ã€‚<br>è‡³äºRedisé”çš„æ—¶é—´é—®é¢˜ï¼ŒAntirezè¯´åœ¨è¿ç»´å±‚é¢æ˜¯å¯ä»¥æ§åˆ¶æ—¶é’Ÿè·³è·ƒçš„åŒºé—´çš„ï¼Œåªè¦èƒ½æ§åˆ¶è·³è·ƒåŒºé—´ä¸expireçš„æ¯”ä¾‹å°±æ²¡é—®é¢˜ï¼Œè¯¦ç»†å¯çœ‹ã€ŠåŸºäºRedisçš„åˆ†å¸ƒå¼é”çœŸçš„å®‰å…¨å—ï¼Ÿã€‹</p>]]></content>
      
      
      
        <tags>
            
            <tag> work </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åŸºäºSSOçš„å•ç‚¹ç™»å½•å®ç°</title>
      <link href="/2017/10/15/work/2017-10-15-SSO/"/>
      <url>/2017/10/15/work/2017-10-15-SSO/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> work </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ—…è¡Œ</title>
      <link href="/2017/07/05/life/2017-7-5-Journey/"/>
      <url>/2017/07/05/life/2017-7-5-Journey/</url>
      
        <content type="html"><![CDATA[<h2 id="æ—…è¡Œ"><a href="#æ—…è¡Œ" class="headerlink" title="æ—…è¡Œ"></a>æ—…è¡Œ</h2><p>æ—…è¡Œè®©æˆ‘èƒ½æœ›å¾—è¾½è¿œï¼Œæƒ³å¾—ç»†å¯†ï¼Œç†è§£äººç”Ÿçš„é—æ†¾ï¼Œä¸è¿™ä¸–ç•Œçš„å¥½å¤„ã€‚</p><h2 id="ç”Ÿæ´»çš„åŸå¸‚"><a href="#ç”Ÿæ´»çš„åŸå¸‚" class="headerlink" title="ç”Ÿæ´»çš„åŸå¸‚"></a>ç”Ÿæ´»çš„åŸå¸‚</h2><ul><li><p><a href="#æ»•å·2013-9">æ»•å·ï¼ˆ~2013-9ï¼‰</a></p></li><li><p><a href="#çƒŸå°2013-92016-7">çƒŸå°ï¼ˆ2013-9~2016-7ï¼‰</a></p></li><li><p><a href="#åŒ—äº¬2016-7">åŒ—äº¬ï¼ˆ2016-7~ï¼‰</a></p></li></ul><h2 id="é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹"><a href="#é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹" class="headerlink" title="é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹"></a>é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹</h2><ul><li><p><a href="#æ—¥ç…§2010-8">æ—¥ç…§ï¼ˆ2010-8ï¼‰</a></p></li><li><p><a href="#å»ŠåŠ2012-7">å»ŠåŠï¼ˆ2012-7ï¼‰</a></p></li><li><p><a href="#è“¬è±2013-10">è“¬è±ï¼ˆ2013-10ï¼‰</a></p></li><li><p><a href="#å¨æµ·2015-10">å¨æµ·ï¼ˆ2015-10ï¼‰</a></p></li><li><p><a href="#é•¿å²›2017-5">é•¿å²›ï¼ˆ2017-5ï¼‰</a></p></li><li><p><a href="#ä¹Œå…°å¸ƒç»Ÿ2017-7">ä¹Œå…°å¸ƒç»Ÿï¼ˆ2017-7ï¼‰</a></p></li></ul><h3 id="ç”Ÿæ´»çš„åŸå¸‚-1"><a href="#ç”Ÿæ´»çš„åŸå¸‚-1" class="headerlink" title="ç”Ÿæ´»çš„åŸå¸‚"></a>ç”Ÿæ´»çš„åŸå¸‚</h3><h3 id="æ»•å·ï¼ˆ-2013-9ï¼‰"><a href="#æ»•å·ï¼ˆ-2013-9ï¼‰" class="headerlink" title="æ»•å·ï¼ˆ~2013-9ï¼‰"></a>æ»•å·ï¼ˆ~2013-9ï¼‰</h3><h3 id="çƒŸå°ï¼ˆ2013-9-2016-7ï¼‰"><a href="#çƒŸå°ï¼ˆ2013-9-2016-7ï¼‰" class="headerlink" title="çƒŸå°ï¼ˆ2013-9~2016-7ï¼‰"></a>çƒŸå°ï¼ˆ2013-9~2016-7ï¼‰</h3><p>å¤§å­¦å››å¹´ï¼ˆå…¶å®åªå‘†è¿‡ä¸‰å¹´ï¼‰ç”Ÿæ´»çš„åœ°æ–¹ã€‚å››å¹´ä¹Ÿæ²¡å»è¿‡å¤šå°‘åœ°æ–¹ï¼Œå¤§éƒ½æ—¶é—´éƒ½åœ¨çå¿™ï¼Œç­‰è¿‡äº†æœ€é—²æš‡çš„æ—¶å…‰ï¼Œæ‰çŸ¥é“è‡ªå·±é”™è¿‡å¤ªå¤šã€‚</p><h3 id="åŒ—äº¬ï¼ˆ2016-7-ï¼‰"><a href="#åŒ—äº¬ï¼ˆ2016-7-ï¼‰" class="headerlink" title="åŒ—äº¬ï¼ˆ2016-7~ï¼‰"></a>åŒ—äº¬ï¼ˆ2016-7~ï¼‰</h3><h3 id="é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹-1"><a href="#é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹-1" class="headerlink" title="é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹"></a>é‚£äº›å€¼å¾—çºªå¿µçš„åœ°æ–¹</h3><h3 id="æ—¥ç…§ï¼ˆ2010-8ï¼‰"><a href="#æ—¥ç…§ï¼ˆ2010-8ï¼‰" class="headerlink" title="æ—¥ç…§ï¼ˆ2010-8ï¼‰"></a>æ—¥ç…§ï¼ˆ2010-8ï¼‰</h3><h3 id="å»ŠåŠï¼ˆ2012-7ï¼‰"><a href="#å»ŠåŠï¼ˆ2012-7ï¼‰" class="headerlink" title="å»ŠåŠï¼ˆ2012-7ï¼‰"></a>å»ŠåŠï¼ˆ2012-7ï¼‰</h3><h3 id="è“¬è±ï¼ˆ2013-10ï¼‰"><a href="#è“¬è±ï¼ˆ2013-10ï¼‰" class="headerlink" title="è“¬è±ï¼ˆ2013-10ï¼‰"></a>è“¬è±ï¼ˆ2013-10ï¼‰</h3><h3 id="å¨æµ·ï¼ˆ2015-10ï¼‰"><a href="#å¨æµ·ï¼ˆ2015-10ï¼‰" class="headerlink" title="å¨æµ·ï¼ˆ2015-10ï¼‰"></a>å¨æµ·ï¼ˆ2015-10ï¼‰</h3><h3 id="é•¿å²›ï¼ˆ2017-5ï¼‰"><a href="#é•¿å²›ï¼ˆ2017-5ï¼‰" class="headerlink" title="é•¿å²›ï¼ˆ2017-5ï¼‰"></a>é•¿å²›ï¼ˆ2017-5ï¼‰</h3><h3 id="ä¹Œå…°å¸ƒç»Ÿï¼ˆ2017-7ï¼‰"><a href="#ä¹Œå…°å¸ƒç»Ÿï¼ˆ2017-7ï¼‰" class="headerlink" title="ä¹Œå…°å¸ƒç»Ÿï¼ˆ2017-7ï¼‰"></a>ä¹Œå…°å¸ƒç»Ÿï¼ˆ2017-7ï¼‰</h3>]]></content>
      
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Redis(è½¬è½½)</title>
      <link href="/2017/07/02/redis/2017-07-02-Redis/"/>
      <url>/2017/07/02/redis/2017-07-02-Redis/</url>
      
        <content type="html"><![CDATA[<h2 id="redisæ˜¯ä»€ä¹ˆ"><a href="#redisæ˜¯ä»€ä¹ˆ" class="headerlink" title="redisæ˜¯ä»€ä¹ˆ"></a>redisæ˜¯ä»€ä¹ˆ</h2><p>redisæ˜¯ä¸€ä¸ªå¼€æºçš„ã€ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ã€æ”¯æŒç½‘ç»œäº¤äº’çš„ã€å¯åŸºäºå†…å­˜ä¹Ÿå¯æŒä¹…åŒ–çš„Key-Valueæ•°æ®åº“ã€‚</p><h2 id="å­¦ä¼šå®‰è£…redis"><a href="#å­¦ä¼šå®‰è£…redis" class="headerlink" title="å­¦ä¼šå®‰è£…redis"></a>å­¦ä¼šå®‰è£…redis</h2><p>ä»redis.ioä¸‹è½½æœ€æ–°ç‰ˆredis-X.Y.Z.tar.gzåè§£å‹ï¼Œç„¶åè¿›å…¥redis-X.Y.Zæ–‡ä»¶å¤¹åç›´æ¥makeå³å¯ï¼Œå®‰è£…éå¸¸ç®€å•ã€‚</p><p>makeæˆåŠŸåä¼šåœ¨srcæ–‡ä»¶å¤¹ä¸‹äº§ç”Ÿä¸€äº›äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒ…æ‹¬redis-serverã€redis-cliç­‰ç­‰ï¼š<br>ä»£ç å¦‚ä¸‹:<br>$ find . -type f -executable<br>./redis-benchmark //ç”¨äºè¿›è¡Œredisæ€§èƒ½æµ‹è¯•çš„å·¥å…·<br>./redis-check-dump //ç”¨äºä¿®å¤å‡ºé—®é¢˜çš„dump.rdbæ–‡ä»¶<br>./redis-cli //redisçš„å®¢æˆ·ç«¯<br>./redis-server //redisçš„æœåŠ¡ç«¯<br>./redis-check-aof //ç”¨äºä¿®å¤å‡ºé—®é¢˜çš„AOFæ–‡ä»¶<br>./redis-sentinel //ç”¨äºé›†ç¾¤ç®¡ç†</p><h2 id="å­¦ä¼šå¯åŠ¨redis"><a href="#å­¦ä¼šå¯åŠ¨redis" class="headerlink" title="å­¦ä¼šå¯åŠ¨redis"></a>å­¦ä¼šå¯åŠ¨redis</h2><p>å¯åŠ¨rediséå¸¸ç®€å•ï¼Œç›´æ¥./redis-serverå°±å¯ä»¥å¯åŠ¨æœåŠ¡ç«¯äº†ï¼Œè¿˜å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æŒ‡å®šè¦åŠ è½½çš„é…ç½®æ–‡ä»¶ï¼š<br>ä»£ç å¦‚ä¸‹:<br>./redis-server ../redis.conf</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œredis-serverä¼šä»¥édaemonçš„æ–¹å¼æ¥è¿è¡Œï¼Œä¸”é»˜è®¤æœåŠ¡ç«¯å£ä¸º6379ã€‚</p><h2 id="redisæ•°æ®ç»“æ„-â€“-ç®€ä»‹"><a href="#redisæ•°æ®ç»“æ„-â€“-ç®€ä»‹" class="headerlink" title="redisæ•°æ®ç»“æ„ â€“ ç®€ä»‹"></a>redisæ•°æ®ç»“æ„ â€“ ç®€ä»‹</h2><p>redisæ˜¯ä¸€ç§é«˜çº§çš„key:valueå­˜å‚¨ç³»ç»Ÿï¼Œå…¶ä¸­valueæ”¯æŒäº”ç§æ•°æ®ç±»å‹ï¼š</p><p>1.å­—ç¬¦ä¸²ï¼ˆstringsï¼‰</p><p>2.å­—ç¬¦ä¸²åˆ—è¡¨ï¼ˆlistsï¼‰</p><p>3.å­—ç¬¦ä¸²é›†åˆï¼ˆsetsï¼‰</p><p>4.æœ‰åºå­—ç¬¦ä¸²é›†åˆï¼ˆsorted setsï¼‰</p><p>5.å“ˆå¸Œï¼ˆhashesï¼‰</p><p>è€Œå…³äºkeyï¼Œæœ‰å‡ ä¸ªç‚¹è¦æé†’å¤§å®¶ï¼š</p><p>1.keyä¸è¦å¤ªé•¿ï¼Œå°½é‡ä¸è¦è¶…è¿‡1024å­—èŠ‚ï¼Œè¿™ä¸ä»…æ¶ˆè€—å†…å­˜ï¼Œè€Œä¸”ä¼šé™ä½æŸ¥æ‰¾çš„æ•ˆç‡ï¼›<br>2.keyä¹Ÿä¸è¦å¤ªçŸ­ï¼Œå¤ªçŸ­çš„è¯ï¼Œkeyçš„å¯è¯»æ€§ä¼šé™ä½ï¼›<br>3.åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œkeyæœ€å¥½ä½¿ç”¨ç»Ÿä¸€çš„å‘½åæ¨¡å¼ï¼Œä¾‹å¦‚user:10000:passwdã€‚</p><h2 id="redisæ•°æ®ç»“æ„-â€“-strings"><a href="#redisæ•°æ®ç»“æ„-â€“-strings" class="headerlink" title="redisæ•°æ®ç»“æ„ â€“ strings"></a>redisæ•°æ®ç»“æ„ â€“ strings</h2><p>æœ‰äººè¯´ï¼Œå¦‚æœåªä½¿ç”¨redisä¸­çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸”ä¸ä½¿ç”¨redisçš„æŒä¹…åŒ–åŠŸèƒ½ï¼Œé‚£ä¹ˆï¼Œrediså°±å’Œmemcacheéå¸¸éå¸¸çš„åƒäº†ã€‚è¿™è¯´æ˜stringsç±»å‹æ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯ä»»ä½•å­˜å‚¨ç³»ç»Ÿéƒ½å¿…å¤‡çš„æ•°æ®ç±»å‹ã€‚</p><p> ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">set mystr &quot;hello world!&quot; //è®¾ç½®å­—ç¬¦ä¸²ç±»å‹</span><br><span class="line">get mystr //è¯»å–å­—ç¬¦ä¸²ç±»å‹</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²ç±»å‹çš„ç”¨æ³•å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå› ä¸ºæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ‰€ä»¥ä½ å®Œå…¨å¯ä»¥æŠŠä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶çš„å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²æ¥å­˜å‚¨ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²ç±»å‹è¿›è¡Œæ•°å€¼æ“ä½œï¼š<br>ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; set mynum &quot;2&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get mynum</span><br><span class="line">&quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; incr mynum</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; get mynum</span><br><span class="line">&quot;3&quot;</span><br></pre></td></tr></table></figure><p>çœ‹ï¼Œåœ¨é‡åˆ°æ•°å€¼æ“ä½œæ—¶ï¼Œredisä¼šå°†å­—ç¬¦ä¸²ç±»å‹è½¬æ¢æˆæ•°å€¼ã€‚</p><p></p><p style="color:red">ç”±äºINCRç­‰æŒ‡ä»¤æœ¬èº«å°±å…·æœ‰åŸå­æ“ä½œçš„ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨redisçš„INCRã€INCRBYã€DECRã€DECRBYç­‰æŒ‡ä»¤æ¥å®ç°åŸå­è®¡æ•°çš„æ•ˆæœã€‚</p>å‡å¦‚ï¼Œåœ¨æŸç§åœºæ™¯ä¸‹æœ‰3ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¯»å–äº†mynumçš„å€¼ï¼ˆå€¼ä¸º2ï¼‰ï¼Œç„¶åå¯¹å…¶åŒæ—¶è¿›è¡Œäº†åŠ 1çš„æ“ä½œï¼Œé‚£ä¹ˆï¼Œæœ€åmynumçš„å€¼ä¸€å®šæ˜¯5ã€‚ä¸å°‘ç½‘ç«™éƒ½åˆ©ç”¨redisçš„è¿™ä¸ªç‰¹æ€§æ¥å®ç°ä¸šåŠ¡ä¸Šçš„ç»Ÿè®¡è®¡æ•°éœ€æ±‚ã€‚<p></p><h2 id="redisæ•°æ®ç»“æ„-â€“-lists"><a href="#redisæ•°æ®ç»“æ„-â€“-lists" class="headerlink" title="redisæ•°æ®ç»“æ„ â€“ lists"></a>redisæ•°æ®ç»“æ„ â€“ lists</h2><p>redisçš„å¦ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„å«åšlistsï¼Œç¿»è¯‘æˆä¸­æ–‡å«åšâ€œåˆ—è¡¨â€ã€‚</p><p>é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œredisä¸­çš„listsåœ¨åº•å±‚å®ç°ä¸Šå¹¶ä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯é“¾è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸€ä¸ªå…·æœ‰ä¸Šç™¾ä¸‡ä¸ªå…ƒç´ çš„listsæ¥è¯´ï¼Œåœ¨å¤´éƒ¨å’Œå°¾éƒ¨æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ˜¯å¸¸æ•°çº§åˆ«çš„ï¼Œæ¯”å¦‚ç”¨LPUSHåœ¨10ä¸ªå…ƒç´ çš„listså¤´éƒ¨æ’å…¥æ–°å…ƒç´ ï¼Œå’Œåœ¨ä¸Šåƒä¸‡å…ƒç´ çš„listså¤´éƒ¨æ’å…¥æ–°å…ƒç´ çš„é€Ÿåº¦åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚</p><p>è™½ç„¶listsæœ‰è¿™æ ·çš„ä¼˜åŠ¿ï¼Œä½†åŒæ ·æœ‰å…¶å¼Šç«¯ï¼Œé‚£å°±æ˜¯ï¼Œé“¾è¡¨å‹listsçš„å…ƒç´ å®šä½ä¼šæ¯”è¾ƒæ…¢ï¼Œè€Œæ•°ç»„å‹listsçš„å…ƒç´ å®šä½å°±ä¼šå¿«å¾—å¤šã€‚</p><p>listsçš„å¸¸ç”¨æ“ä½œåŒ…æ‹¬LPUSHã€RPUSHã€LRANGEç­‰ã€‚æˆ‘ä»¬å¯ä»¥ç”¨LPUSHåœ¨listsçš„å·¦ä¾§æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œç”¨RPUSHåœ¨listsçš„å³ä¾§æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œç”¨LRANGEå‘½ä»¤ä»listsä¸­æŒ‡å®šä¸€ä¸ªèŒƒå›´æ¥æå–å…ƒç´ ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼š</p><p>1.æˆ‘ä»¬å¯ä»¥åˆ©ç”¨listsæ¥å®ç°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸”å¯ä»¥ç¡®ä¿å…ˆåé¡ºåºï¼Œä¸å¿…åƒMySQLé‚£æ ·è¿˜éœ€è¦é€šè¿‡ORDER BYæ¥è¿›è¡Œæ’åºã€‚<br>2.åˆ©ç”¨LRANGEè¿˜å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°åˆ†é¡µçš„åŠŸèƒ½ã€‚<br>3.åœ¨åšå®¢ç³»ç»Ÿä¸­ï¼Œæ¯ç‰‡åšæ–‡çš„è¯„è®ºä¹Ÿå¯ä»¥å­˜å…¥ä¸€ä¸ªå•ç‹¬çš„listä¸­ã€‚</p><h2 id="redisæ•°æ®ç»“æ„-â€“-é›†åˆï¼ˆsetï¼‰"><a href="#redisæ•°æ®ç»“æ„-â€“-é›†åˆï¼ˆsetï¼‰" class="headerlink" title="redisæ•°æ®ç»“æ„ â€“ é›†åˆï¼ˆsetï¼‰"></a>redisæ•°æ®ç»“æ„ â€“ é›†åˆï¼ˆsetï¼‰</h2><p>redisçš„é›†åˆï¼Œæ˜¯ä¸€ç§æ— åºçš„é›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºã€‚</p><p>é›†åˆç›¸å…³çš„æ“ä½œä¹Ÿå¾ˆä¸°å¯Œï¼Œå¦‚æ·»åŠ æ–°å…ƒç´ ã€åˆ é™¤å·²æœ‰å…ƒç´ ã€å–äº¤é›†ã€å–å¹¶é›†ã€å–å·®é›†ç­‰ã€‚</p><p>å¯¹äºé›†åˆçš„ä½¿ç”¨ï¼Œä¹Ÿæœ‰ä¸€äº›å¸¸è§çš„æ–¹å¼ï¼Œæ¯”å¦‚ï¼ŒQQæœ‰ä¸€ä¸ªç¤¾äº¤åŠŸèƒ½å«åšâ€œå¥½å‹æ ‡ç­¾â€ï¼Œå¤§å®¶å¯ä»¥ç»™ä½ çš„å¥½å‹è´´æ ‡ç­¾ï¼Œæ¯”å¦‚â€œå¤§ç¾å¥³â€ã€â€œåœŸè±ªâ€ã€â€œæ¬§å·´â€ç­‰ç­‰ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨redisçš„é›†åˆæ¥å®ç°ï¼ŒæŠŠæ¯ä¸€ä¸ªç”¨æˆ·çš„æ ‡ç­¾éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªé›†åˆä¹‹ä¸­ã€‚</p><h2 id="redisæ•°æ®ç»“æ„-â€“-æœ‰åºé›†åˆ-sort-set"><a href="#redisæ•°æ®ç»“æ„-â€“-æœ‰åºé›†åˆ-sort-set" class="headerlink" title="redisæ•°æ®ç»“æ„ â€“ æœ‰åºé›†åˆ(sort-set)"></a>redisæ•°æ®ç»“æ„ â€“ æœ‰åºé›†åˆ(sort-set)</h2><p>redisä¸ä½†æä¾›äº†æ— éœ€é›†åˆï¼ˆsetsï¼‰ï¼Œè¿˜å¾ˆä½“è´´çš„æä¾›äº†æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ã€‚æœ‰åºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å…³è”ä¸€ä¸ªåºå·ï¼ˆscoreï¼‰ï¼Œè¿™ä¾¿æ˜¯æ’åºçš„ä¾æ®ã€‚</p><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å°†redisä¸­çš„æœ‰åºé›†åˆå«åšzsetsï¼Œè¿™æ˜¯å› ä¸ºåœ¨redisä¸­ï¼Œæœ‰åºé›†åˆç›¸å…³çš„æ“ä½œæŒ‡ä»¤éƒ½æ˜¯ä»¥zå¼€å¤´çš„ï¼Œæ¯”å¦‚zrangeã€zaddã€zrevrangeã€zrangebyscoreç­‰ç­‰</p><h2 id="redisæ•°æ®ç»“æ„-â€“-å“ˆå¸Œ"><a href="#redisæ•°æ®ç»“æ„-â€“-å“ˆå¸Œ" class="headerlink" title="redisæ•°æ®ç»“æ„ â€“ å“ˆå¸Œ"></a>redisæ•°æ®ç»“æ„ â€“ å“ˆå¸Œ</h2><p>æœ€åè¦ç»™å¤§å®¶ä»‹ç»çš„æ˜¯hashesï¼Œå³å“ˆå¸Œã€‚å“ˆå¸Œæ˜¯ä»redis-2.0.0ç‰ˆæœ¬ä¹‹åæ‰æœ‰çš„æ•°æ®ç»“æ„ã€‚</p><p>hasheså­˜çš„æ˜¯å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²å€¼ä¹‹é—´çš„æ˜ å°„ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·è¦å­˜å‚¨å…¶å…¨åã€å§“æ°ã€å¹´é¾„ç­‰ç­‰ï¼Œå°±å¾ˆé€‚åˆä½¿ç”¨å“ˆå¸Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; HMSET user:001 username antirez password P1pp0 age 34 </span><br><span class="line">OK</span><br><span class="line">//åˆ—å‡ºå“ˆå¸Œçš„å†…å®¹</span><br><span class="line">127.0.0.1:6379&gt; HGETALL user:001 </span><br><span class="line">1) &quot;username&quot;</span><br><span class="line">2) &quot;antirez&quot;</span><br><span class="line">3) &quot;password&quot;</span><br><span class="line">4) &quot;P1pp0&quot;</span><br><span class="line">5) &quot;age&quot;</span><br><span class="line">6) &quot;34&quot;</span><br><span class="line">//æ›´æ”¹å“ˆå¸Œä¸­çš„æŸä¸€ä¸ªå€¼</span><br><span class="line">127.0.0.1:6379&gt; HSET user:001 password 12345 </span><br><span class="line">(integer) 0</span><br><span class="line">//å†æ¬¡åˆ—å‡ºå“ˆå¸Œçš„å†…å®¹</span><br><span class="line">127.0.0.1:6379&gt; HGETALL user:001 </span><br><span class="line">1) &quot;username&quot;</span><br><span class="line">2) &quot;antirez&quot;</span><br><span class="line">3) &quot;password&quot;</span><br><span class="line">4) &quot;12345&quot;</span><br><span class="line">5) &quot;age&quot;</span><br><span class="line">6) &quot;34&quot;</span><br></pre></td></tr></table></figure><h2 id="èŠèŠredisæŒä¹…åŒ–-â€“-ä¸¤ç§æ–¹å¼"><a href="#èŠèŠredisæŒä¹…åŒ–-â€“-ä¸¤ç§æ–¹å¼" class="headerlink" title="èŠèŠredisæŒä¹…åŒ– â€“ ä¸¤ç§æ–¹å¼"></a>èŠèŠredisæŒä¹…åŒ– â€“ ä¸¤ç§æ–¹å¼</h2><p>redisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–çš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯RDBï¼ˆRedis DataBaseï¼‰å’ŒAOFï¼ˆAppend Only Fileï¼‰ã€‚</p><p>RDBï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯åœ¨ä¸åŒçš„æ—¶é—´ç‚¹ï¼Œå°†rediså­˜å‚¨çš„æ•°æ®ç”Ÿæˆå¿«ç…§å¹¶å­˜å‚¨åˆ°ç£ç›˜ç­‰ä»‹è´¨ä¸Šï¼›</p><p>AOFï¼Œåˆ™æ˜¯æ¢äº†ä¸€ä¸ªè§’åº¦æ¥å®ç°æŒä¹…åŒ–ï¼Œé‚£å°±æ˜¯å°†redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼Œåœ¨ä¸‹æ¬¡redisé‡æ–°å¯åŠ¨æ—¶ï¼Œåªè¦æŠŠè¿™äº›å†™æŒ‡ä»¤ä»å‰åˆ°åå†é‡å¤æ‰§è¡Œä¸€éï¼Œå°±å¯ä»¥å®ç°æ•°æ®æ¢å¤äº†ã€‚</p><p>å…¶å®RDBå’ŒAOFä¸¤ç§æ–¹å¼ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœredisé‡å¯çš„è¯ï¼Œåˆ™ä¼šä¼˜å…ˆé‡‡ç”¨AOFæ–¹å¼æ¥è¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ˜¯å› ä¸ºAOFæ–¹å¼çš„æ•°æ®æ¢å¤å®Œæ•´åº¦æ›´é«˜ã€‚</p><p>å¦‚æœä½ æ²¡æœ‰æ•°æ®æŒä¹…åŒ–çš„éœ€æ±‚ï¼Œä¹Ÿå®Œå…¨å¯ä»¥å…³é—­RDBå’ŒAOFæ–¹å¼ï¼Œè¿™æ ·çš„è¯ï¼Œrediså°†å˜æˆä¸€ä¸ªçº¯å†…å­˜æ•°æ®åº“ï¼Œå°±åƒmemcacheä¸€æ ·ã€‚</p><h2 id="èŠèŠredisæŒä¹…åŒ–-â€“-RDB"><a href="#èŠèŠredisæŒä¹…åŒ–-â€“-RDB" class="headerlink" title="èŠèŠredisæŒä¹…åŒ– â€“ RDB"></a>èŠèŠredisæŒä¹…åŒ– â€“ RDB</h2><p>RDBæ–¹å¼ï¼Œæ˜¯å°†redisæŸä¸€æ—¶åˆ»çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œæ˜¯ä¸€ç§å¿«ç…§å¼çš„æŒä¹…åŒ–æ–¹æ³•ã€‚</p><p>redisåœ¨è¿›è¡Œæ•°æ®æŒä¹…åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œæ‰ä¼šç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ­£æ˜¯è¿™ç§ç‰¹æ€§ï¼Œè®©æˆ‘ä»¬å¯ä»¥éšæ—¶æ¥è¿›è¡Œå¤‡ä»½ï¼Œå› ä¸ºå¿«ç…§æ–‡ä»¶æ€»æ˜¯å®Œæ•´å¯ç”¨çš„ã€‚</p><p>å¯¹äºRDBæ–¹å¼ï¼Œredisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œè€Œä¸»è¿›ç¨‹æ˜¯ä¸ä¼šè¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™æ ·å°±ç¡®ä¿äº†redisæé«˜çš„æ€§èƒ½ã€‚</p><p>å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚</p><p>è™½ç„¶RDBæœ‰ä¸å°‘ä¼˜ç‚¹ï¼Œä½†å®ƒçš„ç¼ºç‚¹ä¹Ÿæ˜¯ä¸å®¹å¿½è§†çš„ã€‚å¦‚æœä½ å¯¹æ•°æ®çš„å®Œæ•´æ€§éå¸¸æ•æ„Ÿï¼Œé‚£ä¹ˆRDBæ–¹å¼å°±ä¸å¤ªé€‚åˆä½ ï¼Œå› ä¸ºå³ä½¿ä½ æ¯5åˆ†é’Ÿéƒ½æŒä¹…åŒ–ä¸€æ¬¡ï¼Œå½“redisæ•…éšœæ—¶ï¼Œä»ç„¶ä¼šæœ‰è¿‘5åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œredisè¿˜æä¾›äº†å¦ä¸€ç§æŒä¹…åŒ–æ–¹å¼ï¼Œé‚£å°±æ˜¯AOFã€‚</p><h2 id="èŠèŠredisæŒä¹…åŒ–-â€“-AOF"><a href="#èŠèŠredisæŒä¹…åŒ–-â€“-AOF" class="headerlink" title="èŠèŠredisæŒä¹…åŒ– â€“ AOF"></a>èŠèŠredisæŒä¹…åŒ– â€“ AOF</h2><p>AOFï¼Œè‹±æ–‡æ˜¯Append Only Fileï¼Œå³åªå…è®¸è¿½åŠ ä¸å…è®¸æ”¹å†™çš„æ–‡ä»¶ã€‚</p><p>å¦‚å‰é¢ä»‹ç»çš„ï¼ŒAOFæ–¹å¼æ˜¯å°†æ‰§è¡Œè¿‡çš„å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼Œåœ¨æ•°æ®æ¢å¤æ—¶æŒ‰ç…§ä»å‰åˆ°åçš„é¡ºåºå†å°†æŒ‡ä»¤éƒ½æ‰§è¡Œä¸€éï¼Œå°±è¿™ä¹ˆç®€å•ã€‚</p><p>æˆ‘ä»¬é€šè¿‡é…ç½®redis.confä¸­çš„appendonly yeså°±å¯ä»¥æ‰“å¼€AOFåŠŸèƒ½ã€‚å¦‚æœæœ‰å†™æ“ä½œï¼ˆå¦‚SETç­‰ï¼‰ï¼Œrediså°±ä¼šè¢«è¿½åŠ åˆ°AOFæ–‡ä»¶çš„æœ«å°¾ã€‚</p><p>é»˜è®¤çš„AOFæŒä¹…åŒ–ç­–ç•¥æ˜¯æ¯ç§’é’Ÿfsyncä¸€æ¬¡ï¼ˆfsyncæ˜¯æŒ‡æŠŠç¼“å­˜ä¸­çš„å†™æŒ‡ä»¤è®°å½•åˆ°ç£ç›˜ä¸­ï¼‰ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œredisä»ç„¶å¯ä»¥ä¿æŒå¾ˆå¥½çš„å¤„ç†æ€§èƒ½ï¼Œå³ä½¿redisæ•…éšœï¼Œä¹Ÿåªä¼šä¸¢å¤±æœ€è¿‘1ç§’é’Ÿçš„æ•°æ®ã€‚</p><p>å¦‚æœåœ¨è¿½åŠ æ—¥å¿—æ—¶ï¼Œæ°å¥½é‡åˆ°ç£ç›˜ç©ºé—´æ»¡ã€inodeæ»¡æˆ–æ–­ç”µç­‰æƒ…å†µå¯¼è‡´æ—¥å¿—å†™å…¥ä¸å®Œæ•´ï¼Œä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œredisæä¾›äº†redis-check-aofå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ—¥å¿—ä¿®å¤ã€‚</p><p>å› ä¸ºé‡‡ç”¨äº†è¿½åŠ æ–¹å¼ï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†çš„è¯ï¼ŒAOFæ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œä¸ºæ­¤ï¼Œredisæä¾›äº†AOFæ–‡ä»¶é‡å†™ï¼ˆrewriteï¼‰æœºåˆ¶ï¼Œå³å½“AOFæ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œrediså°±ä¼šå¯åŠ¨AOFæ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œåªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†ã€‚ä¸¾ä¸ªä¾‹å­æˆ–è®¸æ›´å½¢è±¡ï¼Œå‡å¦‚æˆ‘ä»¬è°ƒç”¨äº†100æ¬¡INCRæŒ‡ä»¤ï¼Œåœ¨AOFæ–‡ä»¶ä¸­å°±è¦å­˜å‚¨100æ¡æŒ‡ä»¤ï¼Œä½†è¿™æ˜æ˜¾æ˜¯å¾ˆä½æ•ˆçš„ï¼Œå®Œå…¨å¯ä»¥æŠŠè¿™100æ¡æŒ‡ä»¤åˆå¹¶æˆä¸€æ¡SETæŒ‡ä»¤ï¼Œè¿™å°±æ˜¯é‡å†™æœºåˆ¶çš„åŸç†ã€‚</p><p>åœ¨è¿›è¡ŒAOFé‡å†™æ—¶ï¼Œä»ç„¶æ˜¯é‡‡ç”¨å…ˆå†™ä¸´æ—¶æ–‡ä»¶ï¼Œå…¨éƒ¨å®Œæˆåå†æ›¿æ¢çš„æµç¨‹ï¼Œæ‰€ä»¥æ–­ç”µã€ç£ç›˜æ»¡ç­‰é—®é¢˜éƒ½ä¸ä¼šå½±å“AOFæ–‡ä»¶çš„å¯ç”¨æ€§ï¼Œè¿™ç‚¹å¤§å®¶å¯ä»¥æ”¾å¿ƒã€‚</p><p>AOFæ–¹å¼çš„å¦ä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªâ€œåœºæ™¯å†ç°â€æ¥è¯´æ˜ã€‚æŸåŒå­¦åœ¨æ“ä½œredisæ—¶ï¼Œä¸å°å¿ƒæ‰§è¡Œäº†FLUSHALLï¼Œå¯¼è‡´rediså†…å­˜ä¸­çš„æ•°æ®å…¨éƒ¨è¢«æ¸…ç©ºäº†ï¼Œè¿™æ˜¯å¾ˆæ‚²å‰§çš„äº‹æƒ…ã€‚ä¸è¿‡è¿™ä¹Ÿä¸æ˜¯ä¸–ç•Œæœ«æ—¥ï¼Œåªè¦redisé…ç½®äº†AOFæŒä¹…åŒ–æ–¹å¼ï¼Œä¸”AOFæ–‡ä»¶è¿˜æ²¡æœ‰è¢«é‡å†™ï¼ˆrewriteï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æœ€å¿«çš„é€Ÿåº¦æš‚åœrediså¹¶ç¼–è¾‘AOFæ–‡ä»¶ï¼Œå°†æœ€åä¸€è¡Œçš„FLUSHALLå‘½ä»¤åˆ é™¤ï¼Œç„¶åé‡å¯redisï¼Œå°±å¯ä»¥æ¢å¤redisçš„æ‰€æœ‰æ•°æ®åˆ°FLUSHALLä¹‹å‰çš„çŠ¶æ€äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œè¿™å°±æ˜¯AOFæŒä¹…åŒ–æ–¹å¼çš„å¥½å¤„ä¹‹ä¸€ã€‚ä½†æ˜¯å¦‚æœAOFæ–‡ä»¶å·²ç»è¢«é‡å†™äº†ï¼Œé‚£å°±æ— æ³•é€šè¿‡è¿™ç§æ–¹æ³•æ¥æ¢å¤æ•°æ®äº†ã€‚</p><p>è™½ç„¶ä¼˜ç‚¹å¤šå¤šï¼Œä½†AOFæ–¹å¼ä¹ŸåŒæ ·å­˜åœ¨ç¼ºé™·ï¼Œæ¯”å¦‚åœ¨åŒæ ·æ•°æ®è§„æ¨¡çš„æƒ…å†µä¸‹ï¼ŒAOFæ–‡ä»¶è¦æ¯”RDBæ–‡ä»¶çš„ä½“ç§¯å¤§ã€‚è€Œä¸”ï¼ŒAOFæ–¹å¼çš„æ¢å¤é€Ÿåº¦ä¹Ÿè¦æ…¢äºRDBæ–¹å¼ã€‚</p><p>å¦‚æœä½ ç›´æ¥æ‰§è¡ŒBGREWRITEAOFå‘½ä»¤ï¼Œé‚£ä¹ˆredisä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„AOFæ–‡ä»¶ï¼Œå…¶ä¸­ä¾¿åŒ…æ‹¬äº†å¯ä»¥æ¢å¤ç°æœ‰æ•°æ®çš„æœ€å°‘çš„å‘½ä»¤é›†ã€‚</p><p>å¦‚æœè¿æ°”æ¯”è¾ƒå·®ï¼ŒAOFæ–‡ä»¶å‡ºç°äº†è¢«å†™åçš„æƒ…å†µï¼Œä¹Ÿä¸å¿…è¿‡åˆ†æ‹…å¿§ï¼Œrediså¹¶ä¸ä¼šè´¸ç„¶åŠ è½½è¿™ä¸ªæœ‰é—®é¢˜çš„AOFæ–‡ä»¶ï¼Œè€Œæ˜¯æŠ¥é”™é€€å‡ºã€‚è¿™æ—¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥ä¿®å¤å‡ºé”™çš„æ–‡ä»¶ï¼š</p><p>1.å¤‡ä»½è¢«å†™åçš„AOFæ–‡ä»¶<br>2.è¿è¡Œredis-check-aof â€“fixè¿›è¡Œä¿®å¤<br>3.ç”¨diff -uæ¥çœ‹ä¸‹ä¸¤ä¸ªæ–‡ä»¶çš„å·®å¼‚ï¼Œç¡®è®¤é—®é¢˜ç‚¹<br>4.é‡å¯redisï¼ŒåŠ è½½ä¿®å¤åçš„AOFæ–‡ä»¶</p><h2 id="èŠèŠredisæŒä¹…åŒ–-â€“-AOFé‡å†™"><a href="#èŠèŠredisæŒä¹…åŒ–-â€“-AOFé‡å†™" class="headerlink" title="èŠèŠredisæŒä¹…åŒ– â€“ AOFé‡å†™"></a>èŠèŠredisæŒä¹…åŒ– â€“ AOFé‡å†™</h2><p>åœ¨é‡å†™å³å°†å¼€å§‹ä¹‹é™…ï¼Œredisä¼šåˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªâ€œé‡å†™å­è¿›ç¨‹â€ï¼Œè¿™ä¸ªå­è¿›ç¨‹ä¼šé¦–å…ˆè¯»å–ç°æœ‰çš„AOFæ–‡ä»¶ï¼Œå¹¶å°†å…¶åŒ…å«çš„æŒ‡ä»¤è¿›è¡Œåˆ†æå‹ç¼©å¹¶å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œä¸»å·¥ä½œè¿›ç¨‹ä¼šå°†æ–°æ¥æ”¶åˆ°çš„å†™æŒ‡ä»¤ä¸€è¾¹ç´¯ç§¯åˆ°å†…å­˜ç¼“å†²åŒºä¸­ï¼Œä¸€è¾¹ç»§ç»­å†™å…¥åˆ°åŸæœ‰çš„AOFæ–‡ä»¶ä¸­ï¼Œè¿™æ ·åšæ˜¯ä¿è¯åŸæœ‰çš„AOFæ–‡ä»¶çš„å¯ç”¨æ€§ï¼Œé¿å…åœ¨é‡å†™è¿‡ç¨‹ä¸­å‡ºç°æ„å¤–ã€‚</p><p>å½“â€œé‡å†™å­è¿›ç¨‹â€å®Œæˆé‡å†™å·¥ä½œåï¼Œå®ƒä¼šç»™çˆ¶è¿›ç¨‹å‘ä¸€ä¸ªä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ”¶åˆ°ä¿¡å·åå°±ä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™æŒ‡ä»¤è¿½åŠ åˆ°æ–°AOFæ–‡ä»¶ä¸­ã€‚</p><p>å½“è¿½åŠ ç»“æŸåï¼Œrediså°±ä¼šç”¨æ–°AOFæ–‡ä»¶æ¥ä»£æ›¿æ—§AOFæ–‡ä»¶ï¼Œä¹‹åå†æœ‰æ–°çš„å†™æŒ‡ä»¤ï¼Œå°±éƒ½ä¼šè¿½åŠ åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­äº†ã€‚</p><h2 id="èŠèŠredisæŒä¹…åŒ–-â€“-å¦‚ä½•é€‰æ‹©RDBå’ŒAOF"><a href="#èŠèŠredisæŒä¹…åŒ–-â€“-å¦‚ä½•é€‰æ‹©RDBå’ŒAOF" class="headerlink" title="èŠèŠredisæŒä¹…åŒ– â€“ å¦‚ä½•é€‰æ‹©RDBå’ŒAOF"></a>èŠèŠredisæŒä¹…åŒ– â€“ å¦‚ä½•é€‰æ‹©RDBå’ŒAOF</h2><p>å¯¹äºæˆ‘ä»¬åº”è¯¥é€‰æ‹©RDBè¿˜æ˜¯AOFï¼Œå®˜æ–¹çš„å»ºè®®æ˜¯ä¸¤ä¸ªåŒæ—¶ä½¿ç”¨ã€‚è¿™æ ·å¯ä»¥æä¾›æ›´å¯é çš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚</p><h2 id="èŠèŠä¸»ä»-â€“-ç”¨æ³•"><a href="#èŠèŠä¸»ä»-â€“-ç”¨æ³•" class="headerlink" title="èŠèŠä¸»ä» â€“ ç”¨æ³•"></a>èŠèŠä¸»ä» â€“ ç”¨æ³•</h2><p>åƒMySQLä¸€æ ·ï¼Œredisæ˜¯æ”¯æŒä¸»ä»åŒæ­¥çš„ï¼Œè€Œä¸”ä¹Ÿæ”¯æŒä¸€ä¸»å¤šä»ä»¥åŠå¤šçº§ä»ç»“æ„ã€‚</p><p>ä¸»ä»ç»“æ„ï¼Œä¸€æ˜¯ä¸ºäº†çº¯ç²¹çš„å†—ä½™å¤‡ä»½ï¼ŒäºŒæ˜¯ä¸ºäº†æå‡è¯»æ€§èƒ½ï¼Œæ¯”å¦‚å¾ˆæ¶ˆè€—æ€§èƒ½çš„SORTå°±å¯ä»¥ç”±ä»æœåŠ¡å™¨æ¥æ‰¿æ‹…ã€‚</p><p>redisçš„ä¸»ä»åŒæ­¥æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œè¿™æ„å‘³ç€ä¸»ä»åŒæ­¥ä¸ä¼šå½±å“ä¸»é€»è¾‘ï¼Œä¹Ÿä¸ä¼šé™ä½redisçš„å¤„ç†æ€§èƒ½ã€‚</p><p>ä¸»ä»æ¶æ„ä¸­ï¼Œå¯ä»¥è€ƒè™‘å…³é—­ä¸»æœåŠ¡å™¨çš„æ•°æ®æŒä¹…åŒ–åŠŸèƒ½ï¼Œåªè®©ä»æœåŠ¡å™¨è¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿™æ ·å¯ä»¥æé«˜ä¸»æœåŠ¡å™¨çš„å¤„ç†æ€§èƒ½ã€‚</p><p>åœ¨ä¸»ä»æ¶æ„ä¸­ï¼Œä»æœåŠ¡å™¨é€šå¸¸è¢«è®¾ç½®ä¸ºåªè¯»æ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥é¿å…ä»æœåŠ¡å™¨çš„æ•°æ®è¢«è¯¯ä¿®æ”¹ã€‚ä½†æ˜¯ä»æœåŠ¡å™¨ä»ç„¶å¯ä»¥æ¥å—CONFIGç­‰æŒ‡ä»¤ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸åº”è¯¥å°†ä»æœåŠ¡å™¨ç›´æ¥æš´éœ²åˆ°ä¸å®‰å…¨çš„ç½‘ç»œç¯å¢ƒä¸­ã€‚å¦‚æœå¿…é¡»å¦‚æ­¤ï¼Œé‚£å¯ä»¥è€ƒè™‘ç»™é‡è¦æŒ‡ä»¤è¿›è¡Œé‡å‘½åï¼Œæ¥é¿å…å‘½ä»¤è¢«å¤–äººè¯¯æ‰§è¡Œã€‚</p><h2 id="èŠèŠä¸»ä»-â€“-åŒæ­¥åŸç†"><a href="#èŠèŠä¸»ä»-â€“-åŒæ­¥åŸç†" class="headerlink" title="èŠèŠä¸»ä» â€“ åŒæ­¥åŸç†"></a>èŠèŠä¸»ä» â€“ åŒæ­¥åŸç†</h2><p>ä»æœåŠ¡å™¨ä¼šå‘ä¸»æœåŠ¡å™¨å‘å‡ºSYNCæŒ‡ä»¤ï¼Œå½“ä¸»æœåŠ¡å™¨æ¥åˆ°æ­¤å‘½ä»¤åï¼Œå°±ä¼šè°ƒç”¨BGSAVEæŒ‡ä»¤æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ä¸“é—¨è¿›è¡Œæ•°æ®æŒä¹…åŒ–å·¥ä½œï¼Œä¹Ÿå°±æ˜¯å°†ä¸»æœåŠ¡å™¨çš„æ•°æ®å†™å…¥RDBæ–‡ä»¶ä¸­ã€‚åœ¨æ•°æ®æŒä¹…åŒ–æœŸé—´ï¼Œä¸»æœåŠ¡å™¨å°†æ‰§è¡Œçš„å†™æŒ‡ä»¤éƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚</p><p>åœ¨BGSAVEæŒ‡ä»¤æ‰§è¡Œå®Œæˆåï¼Œä¸»æœåŠ¡å™¨ä¼šå°†æŒä¹…åŒ–å¥½çš„RDBæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ¥åˆ°æ­¤æ–‡ä»¶åä¼šå°†å…¶å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œç„¶åå†å°†å…¶è¯»å–åˆ°å†…å­˜ä¸­ã€‚è¿™ä¸ªåŠ¨ä½œå®Œæˆåï¼Œä¸»æœåŠ¡å™¨ä¼šå°†è¿™æ®µæ—¶é—´ç¼“å­˜çš„å†™æŒ‡ä»¤å†ä»¥redisåè®®çš„æ ¼å¼å‘é€ç»™ä»æœåŠ¡å™¨ã€‚</p><p>å¦å¤–ï¼Œè¦è¯´çš„ä¸€ç‚¹æ˜¯ï¼Œå³ä½¿æœ‰å¤šä¸ªä»æœåŠ¡å™¨åŒæ—¶å‘æ¥SYNCæŒ‡ä»¤ï¼Œä¸»æœåŠ¡å™¨ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡BGSAVEï¼Œç„¶åæŠŠæŒä¹…åŒ–å¥½çš„RDBæ–‡ä»¶å‘ç»™å¤šä¸ªä¸‹æ¸¸ã€‚åœ¨redis2.8ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœä»æœåŠ¡å™¨ä¸ä¸»æœåŠ¡å™¨å› æŸäº›åŸå› æ–­å¼€è¿æ¥çš„è¯ï¼Œéƒ½ä¼šè¿›è¡Œä¸€æ¬¡ä¸»ä»ä¹‹é—´çš„å…¨é‡çš„æ•°æ®åŒæ­¥ï¼›è€Œåœ¨2.8ç‰ˆæœ¬ä¹‹åï¼Œredisæ”¯æŒäº†æ•ˆç‡æ›´é«˜çš„å¢é‡åŒæ­¥ç­–ç•¥ï¼Œè¿™å¤§å¤§é™ä½äº†è¿æ¥æ–­å¼€çš„æ¢å¤æˆæœ¬ã€‚</p><p>ä¸»æœåŠ¡å™¨ä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªç¼“å†²åŒºï¼Œç¼“å†²åŒºä¸­å­˜å‚¨ç€å°†è¦å‘ç»™ä»æœåŠ¡å™¨çš„å†…å®¹ã€‚ä»æœåŠ¡å™¨åœ¨ä¸ä¸»æœåŠ¡å™¨å‡ºç°ç½‘ç»œç¬æ–­ä¹‹åï¼Œä»æœåŠ¡å™¨ä¼šå°è¯•å†æ¬¡ä¸ä¸»æœåŠ¡å™¨è¿æ¥ï¼Œä¸€æ—¦è¿æ¥æˆåŠŸï¼Œä»æœåŠ¡å™¨å°±ä¼šæŠŠâ€œå¸Œæœ›åŒæ­¥çš„ä¸»æœåŠ¡å™¨IDâ€å’Œâ€œå¸Œæœ›è¯·æ±‚çš„æ•°æ®çš„åç§»ä½ç½®ï¼ˆreplication offsetï¼‰â€å‘é€å‡ºå»ã€‚ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™æ ·çš„åŒæ­¥è¯·æ±‚åï¼Œé¦–å…ˆä¼šéªŒè¯ä¸»æœåŠ¡å™¨IDæ˜¯å¦å’Œè‡ªå·±çš„IDåŒ¹é…ï¼Œå…¶æ¬¡ä¼šæ£€æŸ¥â€œè¯·æ±‚çš„åç§»ä½ç½®â€æ˜¯å¦å­˜åœ¨äºè‡ªå·±çš„ç¼“å†²åŒºä¸­ï¼Œå¦‚æœä¸¤è€…éƒ½æ»¡è¶³çš„è¯ï¼Œä¸»æœåŠ¡å™¨å°±ä¼šå‘ä»æœåŠ¡å™¨å‘é€å¢é‡å†…å®¹ã€‚</p><p>å¢é‡åŒæ­¥åŠŸèƒ½ï¼Œéœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒå…¨æ–°çš„PSYNCæŒ‡ä»¤ã€‚è¿™ä¸ªæŒ‡ä»¤ï¼Œåªæœ‰åœ¨redis-2.8ä¹‹åæ‰å…·æœ‰ã€‚</p><h2 id="èŠèŠredisçš„äº‹åŠ¡å¤„ç†"><a href="#èŠèŠredisçš„äº‹åŠ¡å¤„ç†" class="headerlink" title="èŠèŠredisçš„äº‹åŠ¡å¤„ç†"></a>èŠèŠredisçš„äº‹åŠ¡å¤„ç†</h2><p>åœ¨èŠredisäº‹åŠ¡å¤„ç†ä¹‹å‰ï¼Œè¦å…ˆå’Œå¤§å®¶ä»‹ç»å››ä¸ªredisæŒ‡ä»¤ï¼Œå³MULTIã€EXECã€DISCARDã€WATCHã€‚è¿™å››ä¸ªæŒ‡ä»¤æ„æˆäº†redisäº‹åŠ¡å¤„ç†çš„åŸºç¡€ã€‚</p><p>1.MULTIç”¨æ¥ç»„è£…ä¸€ä¸ªäº‹åŠ¡ï¼›</p><p>2.EXECç”¨æ¥æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼›</p><p>3.DISCARDç”¨æ¥å–æ¶ˆä¸€ä¸ªäº‹åŠ¡ï¼›</p><p>4.WATCHç”¨æ¥ç›‘è§†ä¸€äº›keyï¼Œä¸€æ—¦è¿™äº›keyåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¢«æ”¹å˜ï¼Œåˆ™å–æ¶ˆäº‹åŠ¡çš„æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªMULTIå’ŒEXECçš„ä¾‹å­ï¼š<br>ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">redis&gt; MULTI //æ ‡è®°äº‹åŠ¡å¼€å§‹</span><br><span class="line">OK</span><br><span class="line">redis&gt; INCR user_id //å¤šæ¡å‘½ä»¤æŒ‰é¡ºåºå…¥é˜Ÿ</span><br><span class="line">QUEUED</span><br><span class="line">redis&gt; INCR user_id</span><br><span class="line">QUEUED</span><br><span class="line">redis&gt; INCR user_id</span><br><span class="line">QUEUED</span><br><span class="line">redis&gt; PING</span><br><span class="line">QUEUED</span><br><span class="line">redis&gt; EXEC //æ‰§è¡Œ</span><br><span class="line">1) (integer) 1</span><br><span class="line">2) (integer) 2</span><br><span class="line">3) (integer) 3</span><br><span class="line">4) PONG</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†QUEUEDçš„å­—æ ·ï¼Œè¿™è¡¨ç¤ºæˆ‘ä»¬åœ¨ç”¨MULTIç»„è£…äº‹åŠ¡æ—¶ï¼Œæ¯ä¸€ä¸ªå‘½ä»¤éƒ½ä¼šè¿›å…¥åˆ°å†…å­˜é˜Ÿåˆ—ä¸­ç¼“å­˜èµ·æ¥ï¼Œå¦‚æœå‡ºç°QUEUEDåˆ™è¡¨ç¤ºæˆ‘ä»¬è¿™ä¸ªå‘½ä»¤æˆåŠŸæ’å…¥äº†ç¼“å­˜é˜Ÿåˆ—ï¼Œåœ¨å°†æ¥æ‰§è¡ŒEXECæ—¶ï¼Œè¿™äº›è¢«QUEUEDçš„å‘½ä»¤éƒ½ä¼šè¢«ç»„è£…æˆä¸€ä¸ªäº‹åŠ¡æ¥æ‰§è¡Œã€‚</p><p>å¯¹äºäº‹åŠ¡çš„æ‰§è¡Œæ¥è¯´ï¼Œå¦‚æœrediså¼€å¯äº†AOFæŒä¹…åŒ–çš„è¯ï¼Œé‚£ä¹ˆä¸€æ—¦äº‹åŠ¡è¢«æˆåŠŸæ‰§è¡Œï¼Œäº‹åŠ¡ä¸­çš„å‘½ä»¤å°±ä¼šé€šè¿‡writeå‘½ä»¤ä¸€æ¬¡æ€§å†™åˆ°ç£ç›˜ä¸­å»ï¼Œå¦‚æœåœ¨å‘ç£ç›˜ä¸­å†™çš„è¿‡ç¨‹ä¸­æ°å¥½å‡ºç°æ–­ç”µã€ç¡¬ä»¶æ•…éšœç­‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯èƒ½å‡ºç°åªæœ‰éƒ¨åˆ†å‘½ä»¤è¿›è¡Œäº†AOFæŒä¹…åŒ–ï¼Œè¿™æ—¶AOFæ–‡ä»¶å°±ä¼šå‡ºç°ä¸å®Œæ•´çš„æƒ…å†µï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨redis-check-aofå·¥å…·æ¥ä¿®å¤è¿™ä¸€é—®é¢˜ï¼Œè¿™ä¸ªå·¥å…·ä¼šå°†AOFæ–‡ä»¶ä¸­ä¸å®Œæ•´çš„ä¿¡æ¯ç§»é™¤ï¼Œç¡®ä¿AOFæ–‡ä»¶å®Œæ•´å¯ç”¨ã€‚</p><p>æœ‰å…³äº‹åŠ¡ï¼Œå¤§å®¶ç»å¸¸ä¼šé‡åˆ°çš„æ˜¯ä¸¤ç±»é”™è¯¯ï¼š</p><p>1.è°ƒç”¨EXECä¹‹å‰çš„é”™è¯¯<br>2.è°ƒç”¨EXECä¹‹åçš„é”™è¯¯</p><p>â€œè°ƒç”¨EXECä¹‹å‰çš„é”™è¯¯â€ï¼Œæœ‰å¯èƒ½æ˜¯ç”±äºè¯­æ³•æœ‰è¯¯å¯¼è‡´çš„ï¼Œä¹Ÿå¯èƒ½æ—¶ç”±äºå†…å­˜ä¸è¶³å¯¼è‡´çš„ã€‚åªè¦å‡ºç°æŸä¸ªå‘½ä»¤æ— æ³•æˆåŠŸå†™å…¥ç¼“å†²é˜Ÿåˆ—çš„æƒ…å†µï¼Œrediséƒ½ä¼šè¿›è¡Œè®°å½•ï¼Œåœ¨å®¢æˆ·ç«¯è°ƒç”¨EXECæ—¶ï¼Œredisä¼šæ‹’ç»æ‰§è¡Œè¿™ä¸€äº‹åŠ¡ã€‚ï¼ˆè¿™æ—¶2.6.5ç‰ˆæœ¬ä¹‹åçš„ç­–ç•¥ã€‚åœ¨2.6.5ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œredisä¼šå¿½ç•¥é‚£äº›å…¥é˜Ÿå¤±è´¥çš„å‘½ä»¤ï¼Œåªæ‰§è¡Œé‚£äº›å…¥é˜ŸæˆåŠŸçš„å‘½ä»¤ï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼š<br>ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; haha //ä¸€ä¸ªæ˜æ˜¾é”™è¯¯çš„æŒ‡ä»¤</span><br><span class="line">(error) ERR unknown command &apos;haha&apos;</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">//redisæ— æƒ…çš„æ‹’ç»äº†äº‹åŠ¡çš„æ‰§è¡Œï¼ŒåŸå› æ˜¯â€œä¹‹å‰å‡ºç°äº†é”™è¯¯â€</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br></pre></td></tr></table></figure><p>è€Œå¯¹äºâ€œè°ƒç”¨EXECä¹‹åçš„é”™è¯¯â€ï¼Œredisåˆ™é‡‡å–äº†å®Œå…¨ä¸åŒçš„ç­–ç•¥ï¼Œå³redisä¸ä¼šç†ç¬è¿™äº›é”™è¯¯ï¼Œè€Œæ˜¯ç»§ç»­å‘ä¸‹æ‰§è¡Œäº‹åŠ¡ä¸­çš„å…¶ä»–å‘½ä»¤ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹äºåº”ç”¨å±‚é¢çš„é”™è¯¯ï¼Œå¹¶ä¸æ˜¯redisè‡ªèº«éœ€è¦è€ƒè™‘å’Œå¤„ç†çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸€ä¸ªäº‹åŠ¡ä¸­å¦‚æœæŸä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå¹¶ä¸ä¼šå½±å“æ¥ä¸‹æ¥çš„å…¶ä»–å‘½ä»¤çš„æ‰§è¡Œã€‚æˆ‘ä»¬ä¹Ÿæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><p> ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set age 23</span><br><span class="line">QUEUED</span><br><span class="line">//ageä¸æ˜¯é›†åˆï¼Œæ‰€ä»¥å¦‚ä¸‹æ˜¯ä¸€æ¡æ˜æ˜¾é”™è¯¯çš„æŒ‡ä»¤</span><br><span class="line">127.0.0.1:6379&gt; sadd age 15 </span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set age 29</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec //æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œredisä¸ä¼šç†ç¬ç¬¬2æ¡æŒ‡ä»¤æ‰§è¡Œé”™è¯¯</span><br><span class="line">1) OK</span><br><span class="line">2) (error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br><span class="line">3) OK</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line">&quot;29&quot; //å¯ä»¥çœ‹å‡ºç¬¬3æ¡æŒ‡ä»¤è¢«æˆåŠŸæ‰§è¡Œäº†</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œæˆ‘ä»¬æ¥è¯´è¯´æœ€åä¸€ä¸ªæŒ‡ä»¤â€œWATCHâ€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬å®ç°ç±»ä¼¼äºâ€œä¹è§‚é”â€çš„æ•ˆæœï¼Œå³CASï¼ˆcheck and setï¼‰ã€‚</p><p>WATCHæœ¬èº«çš„ä½œç”¨æ˜¯â€œç›‘è§†keyæ˜¯å¦è¢«æ”¹åŠ¨è¿‡â€ï¼Œè€Œä¸”æ”¯æŒåŒæ—¶ç›‘è§†å¤šä¸ªkeyï¼Œåªè¦è¿˜æ²¡çœŸæ­£è§¦å‘äº‹åŠ¡ï¼ŒWATCHéƒ½ä¼šå°½èŒå°½è´£çš„ç›‘è§†ï¼Œä¸€æ—¦å‘ç°æŸä¸ªkeyè¢«ä¿®æ”¹äº†ï¼Œåœ¨æ‰§è¡ŒEXECæ—¶å°±ä¼šè¿”å›nilï¼Œè¡¨ç¤ºäº‹åŠ¡æ— æ³•è§¦å‘ã€‚<br>ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; set age 23</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch age //å¼€å§‹ç›‘è§†age</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set age 24 //åœ¨EXECä¹‹å‰ï¼Œageçš„å€¼è¢«ä¿®æ”¹äº†</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set age 25</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec //è§¦å‘EXEC</span><br><span class="line">(nil) //äº‹åŠ¡æ— æ³•è¢«æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-ç®€ä»‹"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-ç®€ä»‹" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ ç®€ä»‹"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ ç®€ä»‹</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨redis-serveræ—¶æŒ‡å®šåº”è¯¥åŠ è½½çš„é…ç½®æ–‡ä»¶ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br>ä»£ç å¦‚ä¸‹:</p><p>$ ./redis-server /path/to/redis.conf<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è®²è§£ä¸‹redisé…ç½®æ–‡ä»¶çš„å„ä¸ªé…ç½®é¡¹çš„å«ä¹‰ï¼Œæ³¨æ„ï¼Œæœ¬æ–‡æ˜¯åŸºäºredis-2.8.4ç‰ˆæœ¬è¿›è¡Œè®²è§£çš„ã€‚</p><p>rediså®˜æ–¹æä¾›çš„redis.confæ–‡ä»¶ï¼Œè¶³æœ‰700+è¡Œï¼Œå…¶ä¸­100å¤šè¡Œä¸ºæœ‰æ•ˆé…ç½®è¡Œï¼Œå¦å¤–çš„600å¤šè¡Œä¸ºæ³¨é‡Šè¯´æ˜ã€‚</p><p>åœ¨é…ç½®æ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†ï¼Œé¦–å…ˆæ˜ç¡®äº†ä¸€äº›åº¦é‡å•ä½ï¼š<br>ä»£ç å¦‚ä¸‹:</p><h1 id="1k-gt-1000-bytes"><a href="#1k-gt-1000-bytes" class="headerlink" title="1k =&gt; 1000 bytes"></a>1k =&gt; 1000 bytes</h1><h1 id="1kb-gt-1024-bytes"><a href="#1kb-gt-1024-bytes" class="headerlink" title="1kb =&gt; 1024 bytes"></a>1kb =&gt; 1024 bytes</h1><h1 id="1m-gt-1000000-bytes"><a href="#1m-gt-1000000-bytes" class="headerlink" title="1m =&gt; 1000000 bytes"></a>1m =&gt; 1000000 bytes</h1><h1 id="1mb-gt-1024-1024-bytes"><a href="#1mb-gt-1024-1024-bytes" class="headerlink" title="1mb =&gt; 1024*1024 bytes"></a>1mb =&gt; 1024*1024 bytes</h1><h1 id="1g-gt-1000000000-bytes"><a href="#1g-gt-1000000000-bytes" class="headerlink" title="1g =&gt; 1000000000 bytes"></a>1g =&gt; 1000000000 bytes</h1><h1 id="1gb-gt-102410241024-bytes"><a href="#1gb-gt-102410241024-bytes" class="headerlink" title="1gb =&gt; 102410241024 bytes"></a>1gb =&gt; 1024<em>1024</em>1024 bytes</h1><p>å¯ä»¥çœ‹å‡ºï¼Œredisé…ç½®ä¸­å¯¹å•ä½çš„å¤§å°å†™ä¸æ•æ„Ÿï¼Œ1GBã€1Gbå’Œ1gBéƒ½æ˜¯ç›¸åŒçš„ã€‚ç”±æ­¤ä¹Ÿè¯´æ˜ï¼Œredisåªæ”¯æŒbytesï¼Œä¸æ”¯æŒbitå•ä½ã€‚</p><p>redisæ”¯æŒâ€œä¸»é…ç½®æ–‡ä»¶ä¸­å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶â€ï¼Œå¾ˆåƒC/C++ä¸­çš„includeæŒ‡ä»¤ï¼Œæ¯”å¦‚ï¼š<br> ä»£ç å¦‚ä¸‹:</p><p>include /path/to/other.conf<br>å¦‚æœä½ çœ‹è¿‡redisçš„é…ç½®æ–‡ä»¶ï¼Œä¼šå‘ç°è¿˜æ˜¯å¾ˆæœ‰æ¡ç†çš„ã€‚redisé…ç½®æ–‡ä»¶è¢«åˆ†æˆäº†å‡ å¤§å—åŒºåŸŸï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><p>1.é€šç”¨ï¼ˆgeneralï¼‰<br>2.å¿«ç…§ï¼ˆsnapshottingï¼‰<br>3.å¤åˆ¶ï¼ˆreplicationï¼‰<br>4.å®‰å…¨ï¼ˆsecurityï¼‰<br>5.é™åˆ¶ï¼ˆlimits)<br>6.è¿½åŠ æ¨¡å¼ï¼ˆappend only mode)<br>7.LUAè„šæœ¬ï¼ˆlua scripting)<br>8.æ…¢æ—¥å¿—ï¼ˆslow log)<br>9.äº‹ä»¶é€šçŸ¥ï¼ˆevent notificationï¼‰</p><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-é€šç”¨"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-é€šç”¨" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® -é€šç”¨"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® -é€šç”¨</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-å¿«ç…§"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-å¿«ç…§" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ å¿«ç…§"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ å¿«ç…§</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-å¤åˆ¶"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-å¤åˆ¶" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ å¤åˆ¶"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ å¤åˆ¶</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-å®‰å…¨"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-å®‰å…¨" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ å®‰å…¨"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ å®‰å…¨</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-é™åˆ¶"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-é™åˆ¶" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® -é™åˆ¶"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® -é™åˆ¶</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-è¿½åŠ æ¨¡å¼"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-è¿½åŠ æ¨¡å¼" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ è¿½åŠ æ¨¡å¼"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ è¿½åŠ æ¨¡å¼</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-LUAè„šæœ¬"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-LUAè„šæœ¬" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ LUAè„šæœ¬"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ LUAè„šæœ¬</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-æ…¢æ—¥å¿—"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-æ…¢æ—¥å¿—" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ æ…¢æ—¥å¿—"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ æ…¢æ—¥å¿—</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-äº‹ä»¶é€šçŸ¥"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-äº‹ä»¶é€šçŸ¥" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ äº‹ä»¶é€šçŸ¥"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ äº‹ä»¶é€šçŸ¥</h2><h2 id="æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-é«˜çº§é…ç½®"><a href="#æ•™ä½ çœ‹æ‡‚redisé…ç½®-â€“-é«˜çº§é…ç½®" class="headerlink" title="æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ é«˜çº§é…ç½®"></a>æ•™ä½ çœ‹æ‡‚redisé…ç½® â€“ é«˜çº§é…ç½®</h2><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/wyy123/p/6078593.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¹è§‚é”ï¼Œæ‚²è§‚é”</title>
      <link href="/2017/03/08/mysql/2017-03-08-Locking/"/>
      <url>/2017/03/08/mysql/2017-03-08-Locking/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><p> ç›¸å¯¹æ‚²è§‚é”è€Œè¨€ï¼Œä¹è§‚é”æœºåˆ¶é‡‡å–äº†æ›´åŠ å®½æ¾çš„åŠ é”æœºåˆ¶ã€‚æ‚²è§‚é”å¤§å¤šæ•°æƒ…å†µä¸‹ä¾é æ•°æ®åº“çš„é”æœºåˆ¶å®ç°ï¼Œä»¥ä¿è¯æ“ä½œæœ€å¤§ç¨‹åº¦çš„ç‹¬å æ€§ã€‚ä½†éšä¹‹è€Œæ¥çš„å°±æ˜¯æ•°æ®åº“ æ€§èƒ½çš„å¤§é‡å¼€é”€ï¼Œç‰¹åˆ«æ˜¯å¯¹é•¿äº‹åŠ¡è€Œè¨€ï¼Œè¿™æ ·çš„å¼€é”€å¾€å¾€æ— æ³•æ‰¿å—ã€‚ è€Œä¹è§‚é”æœºåˆ¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¹è§‚é”ï¼Œå¤§å¤šæ˜¯åŸºäºæ•°æ®ç‰ˆæœ¬ï¼ˆ Version ï¼‰è®°å½•æœºåˆ¶å®ç°ã€‚ä½•è°“æ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œåœ¨åŸºäºæ•°æ®åº“è¡¨çš„ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢åŠ ä¸€ä¸ª â€œversionâ€ å­—æ®µæ¥å®ç°ã€‚è¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€åŒè¯»å‡ºï¼Œä¹‹åæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ ä¸€ã€‚æ­¤æ—¶ï¼Œå°†æäº¤æ•°æ®çš„ç‰ˆæœ¬æ•°æ®ä¸æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚ æœæäº¤çš„æ•°æ®ç‰ˆæœ¬å·å¤§äºæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚</p><p>å®ç°æ–¹å¼ï¼šå¤§å¤šæ•°åŸºäºæ•°æ®ç‰ˆæœ¬è®°å½•æœºåˆ¶å®ç°ï¼Œå³ä¸ºæ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œåœ¨åŸºäºæ•°æ®åº“è¡¨çš„ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢åŠ ä¸€ä¸ªâ€œversionâ€å­—æ®µæ¥å®ç°ã€‚è¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€åŒè¯»å‡ºï¼Œä¹‹åæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ ä¸€ã€‚æ­¤æ—¶ï¼Œå°†æäº¤æ•°æ®çš„ç‰ˆæœ¬æ•°æ®ä¸æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæäº¤çš„æ•°æ®ç‰ˆæœ¬å·å¤§äºæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚  </p><p>å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;hibernate-mapping &gt;  </span><br><span class="line"> &lt;class name=&quot;org.hibernate.sample.TUser&quot; table=&quot;t_user&quot; dynamic-update=&quot;true&quot; dynamic-insert=&quot;true&quot; optimistic-lock=&quot;version&quot;&gt;  </span><br><span class="line"> &lt;/class&gt;  </span><br><span class="line">&lt;/hibernate-mapping &gt;</span><br></pre></td></tr></table></figure><h2 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h2><p>å®ƒæŒ‡çš„æ˜¯å¯¹æ•°æ®è¢«å¤–ç•Œï¼ˆåŒ…æ‹¬æœ¬ç³»ç»Ÿå½“å‰çš„å…¶ä»–äº‹åŠ¡ï¼Œä»¥åŠæ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†ï¼‰ä¿®æ”¹æŒä¿å®ˆæ€åº¦ï¼Œå› æ­¤ï¼Œåœ¨æ•´ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®å¤„äºé”å®šçŠ¶æ€ã€‚æ‚²è§‚é”çš„å®ç°ï¼Œå¾€å¾€ä¾é æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ï¼ˆä¹Ÿåªæœ‰æ•°æ®åº“å±‚æä¾›çš„é”æœºåˆ¶æ‰èƒ½çœŸæ­£ä¿è¯æ•°æ®è®¿é—®çš„æ’ä»–æ€§ï¼Œå¦åˆ™ï¼Œå³ä½¿åœ¨æœ¬ç³»ç»Ÿä¸­å®ç°äº†åŠ é”æœºåˆ¶ï¼Œä¹Ÿæ— æ³•ä¿è¯å¤–éƒ¨ç³» ç»Ÿä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ã€‚</p><p>æ•°æ®åº“é”æœºåˆ¶:</p><ul><li><p>æœªæäº¤è¯»ï¼ˆread uncommittedï¼‰</p></li><li><p>æäº¤è¯»ï¼ˆread committedï¼‰</p></li><li><p>é‡å¤è¯»ï¼ˆrepeatable readï¼‰</p></li><li><p>åºåˆ—åŒ–ï¼ˆserializableï¼‰</p></li></ul><p>é”æœºåˆ¶ï¼š</p><p>   å…±äº«é”ï¼šå…¶ä»–äº‹åŠ¡å¯ä»¥è¯»ï¼Œä½†ä¸èƒ½ä¿®æ”¹ã€‚</p><p>   æ’ä»–é”ï¼šå…¶ä»–äº‹åŠ¡ä¸èƒ½è¯»å–ã€‚</p><p>é”ç²’åº¦ï¼šä¸€èˆ¬åˆ†ä¸ºï¼šè¡Œé”ã€è¡¨é”ã€åº“é”</p><p>è§£é‡Šï¼š</p><ul><li><p>æœªæäº¤è¯»ï¼ˆread uncommittedï¼‰</p><pre><code>ä¸€ä¸ªæ›´æ–°æ•°æ®åº“çš„äº‹åŠ¡Aåœ¨æœªcommitçš„æƒ…å†µä¸‹ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡Bæ­£åœ¨è¯»å–äº‹åŠ¡Aæ›´æ–°çš„è®°å½•ï¼Œä¼šäº§ç”Ÿè„è¯»ç°è±¡ï¼Œè¿™æ˜¯å› ä¸ºAäº‹åŠ¡åœ¨å¼€å¯ DB Transactionåï¼Œåšä¸€äº›DMLæ“ä½œæ—¶ï¼Œè®°å½•ä¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ—¶Bäº‹åŠ¡è¯»å–äº†Aäº‹åŠ¡æäº¤åœ¨å†…å­˜ä¸­çš„æ•°æ®ï¼Œäº§ç”Ÿäº†è„è¯»ã€‚</code></pre></li><li><p>æäº¤è¯»ï¼ˆread committedï¼‰</p><pre><code>æ•°æ®çš„ä¿®æ”¹åªæœ‰åœ¨commitä¹‹åï¼Œæ‰ä¼šè¢«è¯»å–ã€‚å’Œ1 ç›¸åã€‚</code></pre></li><li><p>é‡å¤è¯»ï¼ˆrepeatable readï¼‰</p><pre><code>å½“æ•°æ®åº“éš”ç¦»çº§åˆ«è®¾ç½®æˆ repeatable readåï¼Œäº‹åŠ¡Aä¸­çš„selectçš„è¿‡ç¨‹ä¸­äº‹åŠ¡Bå¯ä»¥ä¿®æ”¹Aè¯»å–éƒ¨åˆ†çš„æ•°æ®ï¼Œå½“Aç¬¬2æ¬¡æ‰§è¡ŒåŒæ ·çš„sqlæ—¶ï¼Œè¿”å›å’Œä¸Šæ¬¡ç›¸åŒçš„æ•°æ® ï¼Œæ¶ˆé™¤ä¸å¯é‡å¤è¯»ã€‚</code></pre><p>  æ³¨ï¼šä¸ªäººè®¤ä¸ºåªæ˜¯åº”ä¸ºAäº‹åŠ¡é‡‡ç”¨è¿™ç§éš”ç¦»çº§åˆ«åï¼Œè¯»å–çš„æ˜¯æ•°æ®åº“åœ¨äº‹åŠ¡å¼€å§‹æ—¶é—´ç‚¹çš„æ˜ è±¡ï¼Œåœ¨è¿™ä¸ªæ—¶é—´ç‚¹åçš„æ‰€æœ‰æ“ä½œéƒ½ä¸ä¼šå¯¹Aäº‹åŠ¡ä¸­çš„æŸ¥è¯¢äº§ç”Ÿå½±å“ï¼Œä¾æ®æ˜¯æœ¬æ–‡åç»­çš„å®éªŒï¼Œå¦‚æœæœ‰ç–‘é—®ï¼Œè¯·æŒ‡å‡ºã€‚</p></li><li><p>åºåˆ—åŒ–ï¼ˆserializableï¼‰</p><pre><code>å½“æ•°æ®åº“éš”ç¦»çº§åˆ«è®¾ç½®æˆSerializeableåï¼Œäº‹åŠ¡Aä¸­çš„select ä¼šä»¥å…±äº«é”é”å®šç›¸å…³çš„æ•°æ®ï¼ˆåœ¨select è¿”å›çš„æ•°æ®ç»“æœé›†ï¼‰ï¼Œè¿™äº›æ•°æ®ä¸å¯ä»¥è¢«ä¿®æ”¹ï¼ˆå¯ä»¥è¢«è¯»å–ï¼‰ï¼Œè‹¥äº‹åŠ¡Bå¯¹è¿™äº›æ•°æ®åšUPDATEæ“ä½œï¼Œä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œæ¶ˆé™¤å¹»è¯»ã€‚</code></pre><p>   æ³¨ï¼šäº‹åŠ¡Bå¯ä»¥UPDATE äº‹åŠ¡Aä¸­ä¸ºé”å®šçš„æ•°æ®ï¼Œåé¢çš„å®éªŒå¯ä»¥è¯æ˜ã€‚</p></li></ul><p>å®ç°æ–¹å¼ï¼š</p><p>æ‚²è§‚é”çš„å®ç°ï¼Œå¾€å¾€ä¾é æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ï¼ˆä¹Ÿåªæœ‰æ•°æ®åº“å±‚æä¾›çš„é”æœºåˆ¶æ‰èƒ½çœŸæ­£ä¿è¯æ•°æ®è®¿é—®çš„æ’ä»–æ€§ï¼Œå¦åˆ™ï¼Œå³ä½¿åœ¨æœ¬ç³»ç»Ÿä¸­å®ç°äº†åŠ é”æœºåˆ¶ï¼Œä¹Ÿæ— æ³•ä¿è¯å¤–éƒ¨ç³»ç»Ÿä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ã€‚</p><p>Hibernateçš„åŠ é”æ¨¡å¼æœ‰ï¼š<br>Ã˜ LockMode.NONE ï¼š æ— é”æœºåˆ¶ã€‚<br>Ã˜ LockMode.WRITE ï¼šHibernateåœ¨Insertå’ŒUpdateè®°å½•çš„æ—¶å€™ä¼šè‡ªåŠ¨<br>è·å–ã€‚<br>Ã˜ LockMode.READ ï¼š Hibernateåœ¨è¯»å–è®°å½•çš„æ—¶å€™ä¼šè‡ªåŠ¨è·å–ã€‚<br>ä»¥ä¸Šè¿™ä¸‰ç§é”æœºåˆ¶ä¸€èˆ¬ç”±Hibernateå†…éƒ¨ä½¿ç”¨ï¼Œå¦‚Hibernateä¸ºäº†ä¿è¯Update<br>è¿‡ç¨‹ä¸­å¯¹è±¡ä¸ä¼šè¢«å¤–ç•Œä¿®æ”¹ï¼Œä¼šåœ¨saveæ–¹æ³•å®ç°ä¸­è‡ªåŠ¨ä¸ºç›®æ ‡å¯¹è±¡åŠ ä¸ŠWRITEé”ã€‚<br>Ã˜ LockMode.UPGRADE ï¼šåˆ©ç”¨æ•°æ®åº“çš„for updateå­å¥åŠ é”ã€‚<br>Ã˜ LockMode. UPGRADE_NOWAIT ï¼šOracleçš„ç‰¹å®šå®ç°ï¼Œåˆ©ç”¨Oracleçš„for update nowaitå­å¥å®ç°åŠ é”ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> String hqlStr  =   &quot; from TUser as user where user.name=â€™Ericaâ€™ &quot; ;</span><br><span class="line"> Query query  =  session.createQuery(hqlStr);</span><br><span class="line"> query.setLockMode( &quot; user &quot; ,LockMode.UPGRADE);  // åŠ é”  </span><br><span class="line"> List userList  =  query.list(); // æ‰§è¡ŒæŸ¥è¯¢ï¼Œ</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">è·å–æ•°æ® query.setLockMode å¯¹æŸ¥è¯¢è¯­å¥ä¸­ç‰¹å®šåˆ«åæ‰€å¯¹åº”çš„è®°å½•è¿›è¡ŒåŠ é”ï¼ˆæˆ‘ä»¬ä¸º TUserç±»æŒ‡å®šäº†ä¸€ä¸ªåˆ«åâ€œuserâ€ï¼‰ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯å¯¹è¿”å›çš„æ‰€æœ‰userè®°å½•è¿›è¡ŒåŠ é”ã€‚ è§‚å¯Ÿè¿è¡ŒæœŸHibernateç”Ÿæˆçš„SQLè¯­å¥ï¼š</span><br></pre></td></tr></table></figure><p>select tuser0_.id as id, tuser0_.name as name, tuser0_.group_id as group_id, tuser0_.user_type as user_type, tuser0_.sex as sex from t_user tuser0_ where (tuser0_.name = â€™Ericaâ€™ )  for  update<br><code>`</code><br>è¿™é‡ŒHibernateé€šè¿‡ä½¿ç”¨æ•°æ®åº“çš„for updateå­å¥å®ç°äº†æ‚²è§‚é”æœºåˆ¶ã€‚</p><p>ä¸Šé¢è¿™ä¸¤ç§é”æœºåˆ¶æ˜¯æˆ‘ä»¬åœ¨åº”ç”¨å±‚è¾ƒä¸ºå¸¸ç”¨çš„ï¼ŒåŠ é”ä¸€èˆ¬é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°ï¼š<br>Criteria.setLockMode<br>Query.setLockMode<br>Session.lock<br>æ³¨æ„ï¼Œåªæœ‰åœ¨æŸ¥è¯¢å¼€å§‹ä¹‹å‰ï¼ˆä¹Ÿå°±æ˜¯Hiberate ç”ŸæˆSQL ä¹‹å‰ï¼‰è®¾å®šåŠ é”ï¼Œæ‰ä¼š çœŸæ­£é€šè¿‡æ•°æ®åº“çš„é”æœºåˆ¶è¿›è¡ŒåŠ é”å¤„ç†ï¼Œå¦åˆ™ï¼Œæ•°æ®å·²ç»é€šè¿‡ä¸åŒ…å«for update å­å¥çš„Select SQLåŠ è½½è¿›æ¥ï¼Œæ‰€è°“æ•°æ®åº“åŠ é”ä¹Ÿå°±æ— ä»è°ˆèµ·ã€‚</p><p>ä¸‰ç§å¹¶å‘å®¹æ˜“é‡åˆ°çš„é—®é¢˜ã€‚</p><ul><li><p>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰æäº¤çš„æ•°æ®ã€‚</p></li><li><p>ä¸å¯é‡å¤åº¦ï¼šåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œä¸¤æ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œå¾—åˆ°å†…å®¹ä¸åŒã€‚ä¸¾ä¾‹ï¼šäº‹åŠ¡AæŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œäº‹åŠ¡Bæ›´æ–°äº‹åŠ¡AæŸ¥è¯¢çš„è¿™æ¡æ•°æ®ï¼Œäº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢è¿™æ¡æ•°æ®ï¼Œæ•°æ®å´ä¸ä¸€æ ·ï¼Œå‡ºç°äº†ä¸å¯é‡å¤è¯»é”™è¯¯ã€‚</p></li><li><p>å¹»è¯»ï¼šåŒä¸€äº‹åŠ¡ä¸­ï¼Œç”¨åŒæ ·çš„æ“ä½œè¯»å–ä¸¤æ¬¡ï¼Œå¾—åˆ°çš„è®°å½•æ•°ä¸ç›¸åŒã€‚ä¸¾ä¾‹ï¼šäº‹åŠ¡AæŸ¥è¯¢ç¬¬ä¸€æ¬¡æŸ¥è¯¢å‡ºä¸€æ¡è®°å½•ï¼Œäº‹åŠ¡Bæ’å…¥ä¸€æ¡æ•°æ®ï¼Œäº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‡ºä¸¤æ¡è®°å½•ï¼Œå‡ºç°äº†å¹»è¯»ã€‚</p></li></ul><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/coderMark/p/5599508.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®å­˜å‚¨ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ•°æ®åº“äº‹åŠ¡</title>
      <link href="/2017/02/28/mysql/2018-02-28-Transaction/"/>
      <url>/2017/02/28/mysql/2018-02-28-Transaction/</url>
      
        <content type="html"><![CDATA[<h2 id="äº‹åŠ¡ï¼š"><a href="#äº‹åŠ¡ï¼š" class="headerlink" title="äº‹åŠ¡ï¼š"></a>äº‹åŠ¡ï¼š</h2><p>äº‹åŠ¡æ˜¯ç¨‹åºä¸­ä¸€ç³»åˆ—ä¸¥å¯†çš„æ“ä½œï¼Œæ‰€æœ‰æ“ä½œæ‰§è¡Œå¿…é¡»æˆåŠŸå®Œæˆï¼Œå¦åˆ™åœ¨æ¯ä¸ªæ“ä½œæ‰€åšçš„æ›´æ”¹å°†ä¼šè¢«æ’¤é”€ï¼Œè¿™ä¹Ÿæ˜¯äº‹åŠ¡çš„åŸå­æ€§ï¼ˆè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼‰ã€‚</p><h2 id="äº‹åŠ¡ç‰¹æ€§ï¼š"><a href="#äº‹åŠ¡ç‰¹æ€§ï¼š" class="headerlink" title="äº‹åŠ¡ç‰¹æ€§ï¼š"></a>äº‹åŠ¡ç‰¹æ€§ï¼š</h2><p>äº‹åŠ¡ç‰¹æ€§åˆ†ä¸ºå››ä¸ªï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒç»­æ€§ï¼ˆDurabilityï¼‰ç®€ç§°ACIDã€‚</p><ul><li><p>åŸå­æ€§ï¼ˆAtomicityï¼‰:äº‹åŠ¡æ˜¯æ•°æ®åº“é€»è¾‘å·¥ä½œå•å…ƒï¼Œäº‹åŠ¡ä¸­åŒ…å«çš„æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œå¤±è´¥ã€‚</p></li><li><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡æ‰§è¡Œçš„ç»“æœå¿…é¡»æ˜¯ä½¿æ•°æ®åº“æ•°æ®ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦å¤–ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€ã€‚å½“äº‹åŠ¡æ‰§è¡ŒæˆåŠŸåå°±è¯´æ•°æ®åº“å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¿™äº›æœªå®Œæˆäº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„ä¿®æ”¹æœ‰ä¸€éƒ¨åˆ†å·²å†™å…¥ç‰©ç†æ•°æ®åº“ï¼Œè¿™æ˜¯æ•°æ®åº“å°±å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚</p></li><li><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½å½±å“åˆ°å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œï¼Œå³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œå„ä¸ªäº‹åŠ¡ä¹‹é—´æ— ä¸å¹²æ‰°ã€‚</p></li><li><p>æŒç»­æ€§ï¼ˆDurabilityï¼‰ï¼šå³ä¸€ä¸ªäº‹åŠ¡æ‰§ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“æ•°æ®çš„æ”¹å˜æ˜¯æ°¸ä¹…æ€§çš„ã€‚ä¹‹åçš„å…¶å®ƒæ“ä½œä¸åº”è¯¥å¯¹å…¶æ‰§è¡Œç»“æœæœ‰ä»»ä½•å½±å“ã€‚</p></li></ul><h2 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š</h2><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¹Ÿåˆ†ä¸ºå››ç§ï¼Œç”±ä½åˆ°é«˜ä¾æ¬¡åˆ†åˆ«ä¸ºï¼šread uncommitedï¼ˆæœªæäº¤è¯»ï¼‰ã€read commitedï¼ˆæäº¤è¯»ï¼‰ã€read repeatableï¼ˆé‡å¤è¯»ï¼‰ã€serializableï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œè¿™å››ä¸ªçº§åˆ«å¯ä»¥é€ä¸ªè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™å‡ ç±»é—®é¢˜ã€‚</p><ul><li><p>read uncommitedï¼šæ˜¯æœ€ä½çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒå…è®¸å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°è¿™ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚</p></li><li><p>read commitedï¼šä¿è¯ä¸€ä¸ªäº‹ç‰©æäº¤åæ‰èƒ½è¢«å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»å–ã€‚å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸èƒ½è¯»å–è¯¥äº‹ç‰©æœªæäº¤çš„æ•°æ®ã€‚</p></li><li><p>repeatable readï¼šè¿™ç§äº‹åŠ¡éš”ç¦»çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ï¼Œä¸å¯é‡å¤è¯»ã€‚ä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å¹»è±¡è¯»ã€‚å®ƒé™¤äº†ä¿è¯ä¸€ä¸ªäº‹åŠ¡ä¸èƒ½è¢«å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»å–æœªæäº¤çš„æ•°æ®ä¹‹å¤–è¿˜é¿å…äº†ä»¥ä¸‹æƒ…å†µäº§ç”Ÿï¼ˆä¸å¯é‡å¤è¯»ï¼‰ã€‚</p></li><li><p>serializableï¼šè¿™æ˜¯èŠ±è´¹æœ€é«˜ä»£ä»·ä½†æœ€å¯é çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚äº‹åŠ¡è¢«å¤„ç†ä¸ºé¡ºåºæ‰§è¡Œã€‚é™¤äº†é˜²æ­¢è„è¯»ï¼Œä¸å¯é‡å¤è¯»ä¹‹å¤–ï¼Œè¿˜é¿å…äº†å¹»è±¡è¯»ã€‚</p></li></ul><p>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è±¡è¯»æ¦‚å¿µè¯´æ˜ï¼š</p><ul><li>è„è¯»ï¼šæŒ‡å½“ä¸€ä¸ªäº‹åŠ¡æ­£å­—è®¿é—®æ•°æ®ï¼Œå¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§æ•°æ®è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚å› ä¸ºè¿™ä¸ªæ•°æ®è¿˜æ²¡æœ‰æäº¤é‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°çš„è¿™ä¸ªæ•°æ®æˆ‘ä»¬ç§°ä¹‹ä¸ºè„æ•°æ®ã€‚ä¾æ®è„æ•°æ®æ‰€åšçš„æ“ä½œè‚¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ã€‚</li></ul><ul><li>ä¸å¯é‡å¤è¯»ï¼šæŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œç»“æŸï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥åŒä¸€æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»å–æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ ·å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹ç‰©å†…ä¸¤æ¬¡è¿ç»­è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä¸ºæ˜¯ä¸å¯é‡å¤è¯»ã€‚</li></ul><ul><li>å¹»è±¡è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„çºªå½•æ•°ä¸åŒï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¹»è±¡è¯»ï¼ˆä¸¤æ¬¡æ‰§è¡ŒåŒä¸€æ¡ select è¯­å¥ä¼šå‡ºç°ä¸åŒçš„ç»“æœï¼Œç¬¬äºŒæ¬¡è¯»ä¼šå¢åŠ ä¸€æ•°æ®è¡Œï¼Œå¹¶æ²¡æœ‰è¯´è¿™ä¸¤æ¬¡æ‰§è¡Œæ˜¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼‰</li></ul><h2 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h2><p><a href="https://www.cnblogs.com/zhangqian1031/p/6542037.html" target="_blank" rel="noopener">å‚è€ƒåšæ–‡</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®å­˜å‚¨ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>2017ä¹¦å•</title>
      <link href="/2017/01/01/life/2017-1-1-books/"/>
      <url>/2017/01/01/life/2017-1-1-books/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¹¦æ¶"><a href="#ä¹¦æ¶" class="headerlink" title="ä¹¦æ¶"></a>ä¹¦æ¶</h2><p>â€“2017ä¹¦å•</p><h2 id="greate-mindsï¼šsource"><a href="#greate-mindsï¼šsource" class="headerlink" title="greate mindsï¼šsource"></a>greate mindsï¼š<a href="https://github.com/camda/mybook/tree/master/minds" target="_blank" rel="noopener">source</a></h2><pre><code>+ æ·±å…¥æµ…å‡ºè®¾è®¡æ¨¡å¼+ äººæœˆç¥è¯+ ä»£ç æ•´æ´ä¹‹é“+ ç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“+ ç¼–ç¨‹ä¹‹ç¾ï¼šå¾®è½¯æŠ€æœ¯é¢è¯•å¿ƒå¾—+ ç¼–ç¨‹ç ç‘+ ç¼–ç¨‹ç ç‘ï¼ˆç»­ï¼‰+ è®¾è®¡æ¨¡å¼+ Javaç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“+ ç®—æ³•å¯¼è®º3</code></pre><h2 id="javaï¼šsource"><a href="#javaï¼šsource" class="headerlink" title="javaï¼šsource"></a>javaï¼š<a href="https://github.com/camda/mybook/tree/master/java" target="_blank" rel="noopener">source</a></h2><pre><code>+ Java_TCPIP_Socketç½‘ç»œç¼–ç¨‹</code></pre><h2 id="smartï¼šsource"><a href="#smartï¼šsource" class="headerlink" title="smartï¼šsource"></a>smartï¼š<a href="https://github.com/camda/mybook/tree/master/smart" target="_blank" rel="noopener">source</a></h2><pre><code>+ å‘¨å¿—å-æœºå™¨å­¦ä¹ + å‘¨å¿—å-æ•°æ®æŒ–æ˜ä¸æœºå™¨å­¦ä¹ </code></pre><h2 id="frameworkï¼šsource"><a href="#frameworkï¼šsource" class="headerlink" title="frameworkï¼šsource"></a>frameworkï¼š<a href="https://github.com/camda/mybook/tree/master/framework" target="_blank" rel="noopener">source</a></h2><pre><code>+ Hibernateå¼€å‘æŒ‡å—+ SpringGuide+ Springæºç æ·±åº¦è§£æ+ dubboæºç è§£æ2.0+ ZooKeeper</code></pre><h2 id="other-source"><a href="#other-source" class="headerlink" title="other: source"></a>other: <a href="https://github.com/camda/mybook/tree/master/other" target="_blank" rel="noopener">source</a></h2><pre><code>+ äº§å“ç»ç†æ‰‹å†Œ+ ç»æµå­¦åŸç†+ ä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿ+ ç‰›æ´¥é€šè¯†ç²¾é€‰+ ä¸‰ä½“2 é»‘æš—æ£®æ—+ æ‰‹æŠŠæ‰‹æ•™ä½ è¯»è´¢æŠ¥+ More Effective C++</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ä¹¦å• </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Knockout.jsç¬”è®°</title>
      <link href="/2016/12/16/javascript/2016-12-16-Knockout/"/>
      <url>/2016/12/16/javascript/2016-12-16-Knockout/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Knockout-jsç®€ä»‹"><a href="#1-Knockout-jsç®€ä»‹" class="headerlink" title="1.Knockout.jsç®€ä»‹"></a>1.Knockout.jsç®€ä»‹</h1><p>Knockoutæ˜¯ä¸€ä¸ªè½»é‡çº§çš„UIç±»åº“ï¼Œé€šè¿‡åº”ç”¨MVVMæ¨¡å¼ä½¿JavaScriptå‰ç«¯UIç®€å•åŒ–ã€‚</p><p>Knockoutæœ‰å¦‚ä¸‹4å¤§é‡è¦æ¦‚å¿µï¼š</p><ul><li>å£°æ˜å¼ç»‘å®š (Declarative Bindings)ï¼šä½¿ç”¨ç®€æ˜æ˜“è¯»çš„è¯­æ³•å¾ˆå®¹æ˜“åœ°å°†æ¨¡å‹(model)æ•°æ®å…³è”åˆ°DOMå…ƒç´ ä¸Šã€‚</li><li>UIç•Œé¢è‡ªåŠ¨åˆ·æ–° (Automatic UI Refresh)ï¼šå½“æ‚¨çš„æ¨¡å‹çŠ¶æ€(model state)æ”¹å˜æ—¶ï¼Œæ‚¨çš„UIç•Œé¢å°†è‡ªåŠ¨æ›´æ–°ã€‚</li><li>ä¾èµ–è·Ÿè¸ª (Dependency Tracking)ï¼šä¸ºè½¬å˜å’Œè”åˆæ•°æ®ï¼Œåœ¨ä½ çš„æ¨¡å‹æ•°æ®ä¹‹é—´éšå¼å»ºç«‹å…³ç³»ã€‚</li><li>æ¨¡æ¿ (Templating)ï¼šä¸ºæ‚¨çš„æ¨¡å‹æ•°æ®å¿«é€Ÿç¼–å†™å¤æ‚çš„å¯åµŒå¥—çš„UIã€‚</li></ul><p>é‡è¦ç‰¹æ€§:</p><ul><li>ä¼˜é›…çš„ä¾èµ–è¿½è¸ª- ä¸ç®¡ä»»ä½•æ—¶å€™ä½ çš„æ•°æ®æ¨¡å‹æ›´æ–°ï¼Œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°ç›¸åº”çš„å†…å®¹ã€‚</li><li>å£°æ˜å¼ç»‘å®š- æµ…æ˜¾æ˜“æ‡‚çš„æ–¹å¼å°†ä½ çš„ç”¨æˆ·ç•Œé¢æŒ‡å®šéƒ¨åˆ†å…³è”åˆ°ä½ çš„æ•°æ®æ¨¡å‹ä¸Šã€‚</li><li>çµæ´»å…¨é¢çš„æ¨¡æ¿- ä½¿ç”¨åµŒå¥—æ¨¡æ¿å¯ä»¥æ„å»ºå¤æ‚çš„åŠ¨æ€ç•Œé¢ã€‚</li><li>è½»æ˜“å¯æ‰©å±•- å‡ è¡Œä»£ç å°±å¯ä»¥å®ç°è‡ªå®šä¹‰è¡Œä¸ºä½œä¸ºæ–°çš„å£°æ˜å¼ç»‘å®šã€‚</li></ul><p>é¢å¤–çš„å¥½å¤„ï¼š</p><ul><li>çº¯JavaScriptç±»åº“ â€“ å…¼å®¹ä»»ä½•æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æŠ€æœ¯</li><li>å¯æ·»åŠ åˆ°Webç¨‹åºæœ€ä¸Šéƒ¨ â€“ ä¸éœ€è¦å¤§çš„æ¶æ„æ”¹å˜</li><li>ç®€æ´çš„ â€“ Gzipä¹‹å‰å¤§çº¦25kb</li><li>å…¼å®¹ä»»ä½•ä¸»æµæµè§ˆå™¨ (IE 6+ã€Firefox 2+ã€Chromeã€Safariã€å…¶å®ƒ)</li><li>Comprehensive suite of specifications ï¼ˆé‡‡ç”¨è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰ - æ„å‘³ç€åœ¨æ–°çš„æµè§ˆå™¨å’Œå¹³å°ä¸Šå¯ä»¥å¾ˆå®¹æ˜“é€šè¿‡éªŒè¯ã€‚</li></ul><p>æ³¨ï¼šMVVMæ¨¡å¼å’ŒMVCæ¨¡å¼ä¸€æ ·ï¼Œä¸»è¦ç›®çš„æ˜¯åˆ†ç¦»è§†å›¾ï¼ˆViewï¼‰å’Œæ¨¡å‹ï¼ˆModelï¼‰ï¼Œæœ‰å‡ å¤§ä¼˜ç‚¹</p><ol><li>ä½è€¦åˆã€‚è§†å›¾ï¼ˆViewï¼‰å¯ä»¥ç‹¬ç«‹äºModelå˜åŒ–å’Œä¿®æ”¹ï¼Œä¸€ä¸ªViewModelå¯ä»¥ç»‘å®šåˆ°ä¸åŒçš„â€Viewâ€ä¸Šï¼Œå½“Viewå˜åŒ–çš„æ—¶å€™Modelå¯ä»¥ä¸å˜ï¼Œå½“Modelå˜åŒ–çš„æ—¶å€™Viewä¹Ÿå¯ä»¥ä¸å˜ã€‚</li><li>å¯é‡ç”¨æ€§ã€‚ä½ å¯ä»¥æŠŠä¸€äº›è§†å›¾é€»è¾‘æ”¾åœ¨ä¸€ä¸ªViewModelé‡Œé¢ï¼Œè®©å¾ˆå¤šviewé‡ç”¨è¿™æ®µè§†å›¾é€»è¾‘ã€‚</li><li>ç‹¬ç«‹å¼€å‘ã€‚å¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„å¼€å‘ï¼ˆViewModelï¼‰ï¼Œè®¾è®¡äººå‘˜å¯ä»¥ä¸“æ³¨äºé¡µé¢è®¾è®¡ï¼Œä½¿ç”¨Expression Blendå¯ä»¥å¾ˆå®¹æ˜“è®¾è®¡ç•Œé¢å¹¶ç”Ÿæˆxmlä»£ç ã€‚</li><li>å¯æµ‹è¯•ã€‚ç•Œé¢ç´ æ¥æ˜¯æ¯”è¾ƒéš¾äºæµ‹è¯•çš„ï¼Œè€Œç°åœ¨æµ‹è¯•å¯ä»¥é’ˆå¯¹ViewModelæ¥å†™ã€‚</li></ol><p>Knockoutæ˜¯ä¸€ä¸ªä»¥æ•°æ®æ¨¡å‹ï¼ˆdata modelï¼‰ä¸ºåŸºç¡€çš„èƒ½å¤Ÿå¸®åŠ©ä½ åˆ›å»ºå¯Œæ–‡æœ¬ï¼Œå“åº”æ˜¾ç¤ºå’Œç¼–è¾‘ç”¨æˆ·ç•Œé¢çš„JavaScriptç±»åº“ã€‚ä»»ä½•æ—¶å€™å¦‚æœä½ çš„UIéœ€è¦è‡ªåŠ¨æ›´æ–°ï¼ˆæ¯”å¦‚ï¼šæ›´æ–°ä¾èµ–äºç”¨æˆ·çš„è¡Œä¸ºæˆ–è€…å¤–éƒ¨æ•°æ®æºçš„æ”¹å˜ï¼‰ï¼ŒKOèƒ½å¤Ÿå¾ˆç®€å•çš„å¸®ä½ å®ç°å¹¶ä¸”å¾ˆå®¹æ˜“ç»´æŠ¤ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JSæ¨¡å—åŒ–ä¹‹è·¯RequireJS</title>
      <link href="/2016/12/15/javascript/2016-12-15-RequireJS/"/>
      <url>/2016/12/15/javascript/2016-12-15-RequireJS/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-RequireJSæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1-RequireJSæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1 RequireJSæ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.1 RequireJSæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>RequireJSçš„ç›®æ ‡æ˜¯é¼“åŠ±ä»£ç çš„æ¨¡å—åŒ–ï¼Œå®ƒä½¿ç”¨äº†ä¸åŒäºä¼ ç»Ÿ<code>&lt;script&gt;</code>æ ‡ç­¾çš„è„šæœ¬åŠ è½½æ­¥éª¤ã€‚å¯ä»¥ç”¨å®ƒæ¥åŠ é€Ÿã€ä¼˜åŒ–ä»£ç ï¼Œä½†å…¶ä¸»è¦ç›®çš„è¿˜æ˜¯ä¸ºäº†ä»£ç çš„æ¨¡å—åŒ–ã€‚å®ƒé¼“åŠ±åœ¨ä½¿ç”¨è„šæœ¬æ—¶ä»¥module IDæ›¿ä»£URLåœ°å€ã€‚</p><h2 id="1-2-ä½¿ç”¨RequireJS"><a href="#1-2-ä½¿ç”¨RequireJS" class="headerlink" title="1.2 ä½¿ç”¨RequireJS"></a>1.2 ä½¿ç”¨RequireJS</h2><h3 id="1-2-1-åŠ è½½JavaScriptæ–‡ä»¶"><a href="#1-2-1-åŠ è½½JavaScriptæ–‡ä»¶" class="headerlink" title="1.2.1 åŠ è½½JavaScriptæ–‡ä»¶"></a>1.2.1 åŠ è½½JavaScriptæ–‡ä»¶</h3><p>RequireJSä»¥ä¸€ä¸ªç›¸å¯¹äºbaseUrlçš„åœ°å€åŠ è½½æ‰€æœ‰çš„jsä»£ç ï¼ŒbaseUrlè®¾ç½®æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><h4 id="1-2-1-1-data-mainå±æ€§"><a href="#1-2-1-1-data-mainå±æ€§" class="headerlink" title="1.2.1.1 data-mainå±æ€§"></a>1.2.1.1 data-mainå±æ€§</h4><p>ä¸€ä¸ªæ˜¯ç”¨<code>&lt;scirpt&gt;</code>æ ‡ç­¾çš„data-mainå±æ€§ï¼Œä¾‹å¦‚ï¼š<br><code>&lt;script data-main=&quot;script/main.js&quot; src=&quot;script/require.js&quot;&gt;&lt;/script&gt;</code><br>é¡µé¢åœ¨åŠ è½½require.jsåä¼šè‡ªåŠ¨åŠ è½½main.jsé‡Œçš„å†…å®¹ã€‚æ­¤æ—¶çš„baseUrlçš„åœ°å€ä¸º<code>script/</code>ã€‚æ³¨ï¼šdata-mainæ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨å…¶ä»–é¡µé¢é…ç½®äº†å…¶ä»–çš„JSåŠ è½½ï¼Œåˆ™ä¸èƒ½ä¿è¯ä»–ä»¬æ‰€ä¾èµ–çš„JSå·²ç»åŠ è½½æˆåŠŸã€‚<br>ä¾‹å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script data-main=&quot;scripts/main&quot; src=&quot;scripts/require.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;scripts/other.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// contents of main.js:</span><br><span class="line">require.config(&#123;</span><br><span class="line">    paths: &#123;</span><br><span class="line">        foo: &apos;libs/foo-1.1.3&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// contents of other.js:</span><br><span class="line"></span><br><span class="line">// This code might be called before the require.config() in main.js</span><br><span class="line">// has executed. When that happens, require.js will attempt to</span><br><span class="line">// load &apos;scripts/foo.js&apos; instead of &apos;scripts/libs/foo-1.1.3.js&apos;</span><br><span class="line">require( [&apos;foo&apos;], function( foo ) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="1-2-1-2-é…ç½®å‡½æ•°"><a href="#1-2-1-2-é…ç½®å‡½æ•°" class="headerlink" title="1.2.1.2 é…ç½®å‡½æ•°"></a>1.2.1.2 é…ç½®å‡½æ•°</h4><p>baseUrläº¦å¯é€šè¿‡é…ç½®å‡½æ•°æ‰‹åŠ¨é…ç½®ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šconfigåŠdata-mainï¼Œåˆ™é»˜è®¤çš„baseUrlä¸ºåŒ…å«RequireJSçš„é‚£ä¸ªHTMLé¡µé¢çš„æ‰€å±ç›®å½•ã€‚å¦‚æœä½ éœ€è¦ä¿®æ”¹RequireJSçš„é»˜è®¤é…ç½®æ¥ä½¿ç”¨è‡ªå·±çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨require.configå‡½æ•°ï¼Œrequire.configå‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ªå¯é€‰çš„å‚æ•°å¯¹è±¡ï¼Œå¦‚ä¸‹æ˜¯å¯ä»¥ä½¿ç”¨çš„é…ç½®å‚æ•°é€‰é¡¹ã€‚</p><ul><li>baseUrlâ€“ç”¨äºåŠ è½½æ¨¡å—çš„æ ¹è·¯å¾„</li><li>pathsâ€“ç”¨äºæ˜ å°„ä¸å­˜åœ¨äºæ ¹è·¯å¾„ä¸‹çš„æ¨¡å—è·¯å¾„</li><li>shimsâ€“é…ç½®åœ¨è„šæœ¬/æ¨¡å—å¤–é¢å¹¶æ²¡æœ‰ä½¿ç”¨RequireJSçš„å‡½æ•°ä¾èµ–å¹¶ä¸”åˆå§‹åŒ–å‡½æ•°ã€‚å‡è®¾underscoreå¹¶æ²¡æœ‰ä½¿ç”¨  RequireJSå®šä¹‰ï¼Œä½†æ˜¯ä½ è¿˜æ˜¯æƒ³é€šè¿‡RequireJSæ¥ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆä½ å°±éœ€è¦åœ¨é…ç½®ä¸­æŠŠå®ƒå®šä¹‰ä¸ºä¸€ä¸ªshimã€‚</li><li>depsâ€“åŠ è½½ä¾èµ–å…³ç³»æ•°ç»„</li><li>exportsâ€“exportså€¼ï¼ˆè¾“å‡ºçš„å˜é‡åï¼‰ï¼Œè¡¨æ˜è¿™ä¸ªæ¨¡å—å¤–éƒ¨è°ƒç”¨æ—¶çš„åç§°</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨baseUrlåŠâ€pathsâ€ configå»è®¾ç½®module IDã€‚å®ƒä¼šç»™ä½ å¸¦æ¥é¢å¤–çš„çµæ´»æ€§ï¼Œå¦‚ä¾¿äºè„šæœ¬çš„é‡å‘½åã€é‡å®šä½ç­‰ã€‚ åŒæ—¶ï¼Œä¸ºäº†é¿å…å‡Œä¹±çš„é…ç½®ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨å¤šçº§åµŒå¥—çš„ç›®å½•å±‚æ¬¡æ¥ç»„ç»‡ä»£ç ï¼Œè€Œæ˜¯è¦ä¹ˆå°†æ‰€æœ‰çš„è„šæœ¬éƒ½æ”¾ç½®åˆ°baseUrlä¸­ï¼Œè¦ä¹ˆåˆ†ç½®ä¸ºé¡¹ç›®åº“/ç¬¬ä¸‰æ–¹åº“çš„ä¸€ä¸ªæ‰å¹³ç»“æ„ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- www/</span><br><span class="line">  - index.html</span><br><span class="line">  - js/</span><br><span class="line">    - app/</span><br><span class="line">  -sub.js </span><br><span class="line">    - lib/</span><br><span class="line">  -jquery.js</span><br><span class="line">  -cancas.js</span><br><span class="line">  -app.js</span><br></pre></td></tr></table></figure></p><p>index.html</p><p><code>&lt;script data-main=&quot;js/app.js&quot; src=&quot;js/require.js&quot;&gt;&lt;/script&gt;</code></p><p>app.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">    //By default load any module IDs from js/lib</span><br><span class="line">    baseUrl: &apos;js/lib&apos;,</span><br><span class="line">    //except, if the module ID starts with &quot;app&quot;,</span><br><span class="line">    //load it from the js/app directory. paths</span><br><span class="line">    //config is relative to the baseUrl, and</span><br><span class="line">    //never includes a &quot;.js&quot; extension since</span><br><span class="line">    //the paths config could be for a directory.</span><br><span class="line">    paths: &#123;</span><br><span class="line">        app: &apos;../app&apos;</span><br><span class="line">    &#125;</span><br><span class="line">shim: &#123;</span><br><span class="line">        &apos;backbone&apos;: &#123;</span><br><span class="line">            //The underscore script dependency should be loaded before loading backbone.js</span><br><span class="line">            deps: [&apos;underscore&apos;],</span><br><span class="line">            // use the global &apos;Backbone&apos; as the module name.</span><br><span class="line">            exports: &apos;Backbone&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// Start the main app logic.</span><br><span class="line">requirejs([&apos;jquery&apos;, &apos;canvas&apos;, &apos;app/sub&apos;],</span><br><span class="line">function   ($, canvas, sub) &#123;</span><br><span class="line">    //jQuery, canvas and the app/sub module are all</span><br><span class="line">    //loaded and can be used here now.</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h3 id="1-2-2-ç”¨RequireJSå®šä¹‰æ¨¡å—"><a href="#1-2-2-ç”¨RequireJSå®šä¹‰æ¨¡å—" class="headerlink" title="1.2.2 ç”¨RequireJSå®šä¹‰æ¨¡å—"></a>1.2.2 ç”¨RequireJSå®šä¹‰æ¨¡å—</h3><p>æ¨¡å—æ˜¯è¿›è¡Œäº†å†…éƒ¨å®ç°å°è£…ã€æš´éœ²æ¥å£å’Œåˆç†é™åˆ¶èŒƒå›´çš„å¯¹è±¡ã€‚ReuqireJSæä¾›äº†defineå‡½æ•°ç”¨äºå®šä¹‰æ¨¡å—ã€‚æŒ‰ç« æƒ¯ä¾‹æ¯ä¸ªJavascriptæ–‡ä»¶åªåº”è¯¥å®šä¹‰ä¸€ä¸ªæ¨¡å—ã€‚defineå‡½æ•°æ¥å—ä¸€ä¸ªä¾èµ–æ•°ç»„å’Œä¸€ä¸ªåŒ…å«æ¨¡å—å®šä¹‰çš„å‡½æ•°ã€‚é€šå¸¸æ¨¡å—å®šä¹‰å‡½æ•°ä¼šæŠŠå‰é¢çš„æ•°ç»„ä¸­çš„ä¾èµ–æ¨¡å—æŒ‰é¡ºåºåšä¸ºå‚æ•°æ¥æ”¶ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡å—å®šä¹‰:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">define([&quot;logger&quot;], function(logger) &#123;        </span><br><span class="line">        return &#123;</span><br><span class="line">             firstName: â€œJohn&quot;,</span><br><span class="line">             lastName: â€œBlackâ€œ,</span><br><span class="line">             sayHello: function () &#123;</span><br><span class="line">                logger.log(â€˜helloâ€™);</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬çœ‹ï¼Œä¸€ä¸ªåŒ…å«äº†loggerçš„æ¨¡å—ä¾èµ–æ•°ç»„è¢«ä¼ ç»™äº†defineå‡½æ•°,è¯¥æ¨¡å—åé¢ä¼šè¢«è°ƒç”¨ã€‚åŒæ ·æˆ‘ä»¬çœ‹æ‰€å®šä¹‰çš„æ¨¡å—ä¸­æœ‰ä¸€ä¸ªåä¸ºloggerçš„å‚æ•°ï¼Œå®ƒä¼šè¢«è®¾ç½®ä¸ºloggeræ¨¡å—ã€‚æ¯ä¸€ä¸ªæ¨¡å—éƒ½åº”è¯¥è¿”å›å®ƒçš„API.è¿™ä¸ªç¤ºä¾‹ä¸­æˆ‘ä»¬æœ‰ä¸¤ä¸ªå±æ€§(firstNameå’ŒlastName)å’Œä¸€ä¸ªå‡½æ•°(sayHello)ã€‚ç„¶åï¼Œåªè¦ä½ åé¢å®šä¹‰çš„æ¨¡å—é€šè¿‡IDæ¥å¼•ç”¨è¿™ä¸ªæ¨¡å—ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨å…¶æš´éœ²çš„APIã€‚</p><h3 id="1-2-3-ä½¿ç”¨requireå‡½æ•°"><a href="#1-2-3-ä½¿ç”¨requireå‡½æ•°" class="headerlink" title="1.2.3 ä½¿ç”¨requireå‡½æ•°"></a>1.2.3 ä½¿ç”¨requireå‡½æ•°</h3><p>åœ¨RequireJSä¸­å¦å¤–ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‡½æ•°æ˜¯requireå‡½æ•°ã€‚requireå‡½æ•°ç”¨äºåŠ è½½æ¨¡å—ä¾èµ–ä½†å¹¶ä¸ä¼šåˆ›å»ºä¸€ä¸ªæ¨¡å—ã€‚ä¾‹å¦‚ï¼šä¸‹é¢å°±æ˜¯ä½¿ç”¨requireå®šä¹‰äº†èƒ½å¤Ÿä½¿ç”¨jQueryçš„ä¸€ä¸ªå‡½æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">require([&apos;jquery&apos;], function ($) &#123;</span><br><span class="line">    //jQuery was loaded and can be used now</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å†’æ³¡æ’åº</title>
      <link href="/2015/08/04/algorithm/2015-08-04-BubbleSort/"/>
      <url>/2015/08/04/algorithm/2015-08-04-BubbleSort/</url>
      
        <content type="html"><![CDATA[<h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å†’æ³¡æ’åºæ˜¯ä¾æ¬¡æ¯”è¾ƒæ•°åˆ—ç›¸é‚»çš„ä¸¤ä¸ªæ•°å­—çš„å¤§å°ï¼ŒæŒ‰ç…§ä»å¤§åˆ°å°æˆ–è€…ä»å°åˆ°å¤§çš„è§„åˆ™è¿›è¡Œäº¤æ¢ï¼Œé‡å¤éå†æ•°åˆ—ç›´è‡³æ²¡æœ‰å¯äº¤æ¢çš„æ•°åˆ—ï¼Œæ’åºå®Œæˆã€‚</p><h2 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h2><p>æ•°åˆ—ï¼š[3,5,1,7,4]</p><p>è§„åˆ™ï¼šä»å°åˆ°å¤§</p><p>æ’åºï¼š</p><ul><li>æ¯”è¾ƒ3-5ï¼Œ5å¤§äº3ï¼Œä¸äº¤æ¢ï¼Œæ•°åˆ—ä¸å˜[3,5,1,7,4]</li><li>æ¯”è¾ƒ5-1,5å¤§äº1ï¼Œäº¤æ¢ï¼Œæ•°åˆ—å˜åŒ–[3,1,5,7,4]</li><li>æ¯”è¾ƒ5-7,7å¤§äº5ï¼Œä¸äº¤æ¢ï¼Œæ•°åˆ—ä¸å˜[3,1,5,7,4]</li><li>æ¯”è¾ƒ7-4,7å¤§çº¦4ï¼Œäº¤æ¢ï¼Œæ•°åˆ—å˜åŒ–[3,1,5,4,7]</li><li>ç„¶åé‡å¤éå†æ•°åˆ—,ç›´è‡³æœ€åæ²¡æœ‰å¯ä»¥äº¤æ¢çš„æ•°åˆ—ã€‚</li></ul><h2 id="Javaä»£ç å®ç°"><a href="#Javaä»£ç å®ç°" class="headerlink" title="Javaä»£ç å®ç°"></a>Javaä»£ç å®ç°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    public static void bubbleSort()&#123;</span><br><span class="line">//        int[] arr = &#123;3,5,7,1,4&#125;;</span><br><span class="line">        int[] arr = &#123;1,2,3,4,5&#125;;</span><br><span class="line">        int i,j,temp,len=arr.length;</span><br><span class="line">        //æ˜¯å¦å·²ç»å®Œæˆæ’åºçš„æ ‡å¿—</span><br><span class="line">        boolean flag;</span><br><span class="line">        //æ’åº</span><br><span class="line">        for(i=0;i&lt;arr.length-1;i++)&#123;</span><br><span class="line">            flag = true;</span><br><span class="line">            for(j=i+1;j&lt;arr.length;j++)&#123;</span><br><span class="line">                if(arr[j]&lt;arr[i])&#123;</span><br><span class="line">                    temp = arr[i];</span><br><span class="line">                    arr[i] = arr[j];</span><br><span class="line">                    arr[j] = temp;</span><br><span class="line">                    flag = false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if(flag)&#123;</span><br><span class="line">                System.out.println(&quot;ç¬¬&quot; + (i+1) + &quot;è¶Ÿç»“æŸäº†&quot;);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //éå†è¾“å‡ºæ•°ç»„</span><br><span class="line">        for(int o:arr)&#123;</span><br><span class="line">            System.out.print(&quot; &quot; + o);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ—¶é—´å¤æ‚åº¦åˆ†æ"><a href="#æ—¶é—´å¤æ‚åº¦åˆ†æ" class="headerlink" title="æ—¶é—´å¤æ‚åº¦åˆ†æ"></a>æ—¶é—´å¤æ‚åº¦åˆ†æ</h2><p>æœ€åæƒ…å†µä¸‹ï¼šç¬¬1è¶Ÿæ’åºéœ€è¦æ¯”è¾ƒ(n-1)æ¬¡ï¼Œâ€¦ ç¬¬(n-1)è¶Ÿæ¯”è¾ƒ1æ¬¡ï¼ŒO(n)=((n-1)+1)<em>(n-1)/2=n</em>(n-1)/2=n^2ã€‚</p><p>æœ€å¥½æƒ…å†µä¸‹ï¼šæ¯”è¾ƒ(n-1)æ¬¡ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
